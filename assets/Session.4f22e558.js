import{_ as ft,c as Qu,d as Ce,j as ht,a as ge,r as dr,e as Mf,G as ts,f as Cn,b as jf,L as eo}from"./index.e4e9eba6.js";import{B as Er}from"./Button.dd0e1ce3.js";import{I as Lf}from"./Input.452f75d9.js";var Nf=Ce({"node_modules/prop-types/lib/ReactPropTypesSecret.js"(e,t){var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";t.exports=r}}),Uf=Ce({"node_modules/prop-types/factoryWithThrowingShims.js"(e,t){var r=Nf();function n(){}function i(){}i.resetWarningCache=n,t.exports=function(){function a(c,u,l,d,h,f){if(f!==r){var g=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw g.name="Invariant Violation",g}}a.isRequired=a;function s(){return a}var o={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:s,element:a,elementType:a,instanceOf:s,node:a,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:i,resetWarningCache:n};return o.PropTypes=o,o}}}),zf=Ce({"node_modules/prop-types/index.js"(e,t){t.exports=Uf()()}}),to=ft(Qu()),he=ft(zf()),Ye=typeof window<"u"?window:null,rs=Ye===null,an=rs?void 0:Ye.document,tt="addEventListener",rt="removeEventListener",$i="getBoundingClientRect",Nr="_a",nt="_b",Dt="_c",wn="horizontal",it=function(){return!1},$f=rs?"calc":["","-webkit-","-moz-","-o-"].filter(function(e){var t=an.createElement("div");return t.style.cssText="width:"+e+"calc(9px)",!!t.style.length}).shift()+"calc",ec=function(e){return typeof e=="string"||e instanceof String},ro=function(e){if(ec(e)){var t=an.querySelector(e);if(!t)throw new Error("Selector "+e+" did not match a DOM element");return t}return e},Re=function(e,t,r){var n=e[t];return n!==void 0?n:r},kn=function(e,t,r,n){if(t){if(n==="end")return 0;if(n==="center")return e/2}else if(r){if(n==="start")return 0;if(n==="center")return e/2}return e},Wf=function(e,t){var r=an.createElement("div");return r.className="gutter gutter-"+t,r},Vf=function(e,t,r){var n={};return ec(t)?n[e]=t:n[e]=$f+"("+t+"% - "+r+"px)",n},Gf=function(e,t){var r;return r={},r[e]=t+"px",r},qf=function(e,t){if(t===void 0&&(t={}),rs)return{};var r=e,n,i,a,s,o,c;Array.from&&(r=Array.from(r));var u=ro(r[0]),l=u.parentNode,d=getComputedStyle?getComputedStyle(l):null,h=d?d.flexDirection:null,f=Re(t,"sizes")||r.map(function(){return 100/r.length}),g=Re(t,"minSize",100),y=Array.isArray(g)?g:r.map(function(){return g}),E=Re(t,"maxSize",1/0),A=Array.isArray(E)?E:r.map(function(){return E}),v=Re(t,"expandToMin",!1),m=Re(t,"gutterSize",10),b=Re(t,"gutterAlign","center"),C=Re(t,"snapOffset",30),_=Array.isArray(C)?C:r.map(function(){return C}),P=Re(t,"dragInterval",1),S=Re(t,"direction",wn),L=Re(t,"cursor",S===wn?"col-resize":"row-resize"),H=Re(t,"gutter",Wf),j=Re(t,"elementStyle",Vf),T=Re(t,"gutterStyle",Gf);S===wn?(n="width",i="clientX",a="left",s="right",o="clientWidth"):S==="vertical"&&(n="height",i="clientY",a="top",s="bottom",o="clientHeight");function V(z,x,N,q){var ae=j(n,x,N,q);Object.keys(ae).forEach(function(Q){z.style[Q]=ae[Q]})}function W(z,x,N){var q=T(n,x,N);Object.keys(q).forEach(function(ae){z.style[ae]=q[ae]})}function k(){return c.map(function(z){return z.size})}function Y(z){return"touches"in z?z.touches[0][i]:z[i]}function B(z){var x=c[this.a],N=c[this.b],q=x.size+N.size;x.size=z/this.size*q,N.size=q-z/this.size*q,V(x.element,x.size,this[nt],x.i),V(N.element,N.size,this[Dt],N.i)}function F(z){var x,N=c[this.a],q=c[this.b];!this.dragging||(x=Y(z)-this.start+(this[nt]-this.dragOffset),P>1&&(x=Math.round(x/P)*P),x<=N.minSize+N.snapOffset+this[nt]?x=N.minSize+this[nt]:x>=this.size-(q.minSize+q.snapOffset+this[Dt])&&(x=this.size-(q.minSize+this[Dt])),x>=N.maxSize-N.snapOffset+this[nt]?x=N.maxSize+this[nt]:x<=this.size-(q.maxSize-q.snapOffset+this[Dt])&&(x=this.size-(q.maxSize+this[Dt])),B.call(this,x),Re(t,"onDrag",it)(k()))}function R(){var z=c[this.a].element,x=c[this.b].element,N=z[$i](),q=x[$i]();this.size=N[n]+q[n]+this[nt]+this[Dt],this.start=N[a],this.end=N[s]}function M(z){if(!getComputedStyle)return null;var x=getComputedStyle(z);if(!x)return null;var N=z[o];return N===0?null:(S===wn?N-=parseFloat(x.paddingLeft)+parseFloat(x.paddingRight):N-=parseFloat(x.paddingTop)+parseFloat(x.paddingBottom),N)}function J(z){var x=M(l);if(x===null||y.reduce(function(Q,de){return Q+de},0)>x)return z;var N=0,q=[],ae=z.map(function(Q,de){var De=x*Q/100,Ae=kn(m,de===0,de===z.length-1,b),Ke=y[de]+Ae;return De<Ke?(N+=Ke-De,q.push(0),Ke):(q.push(De-Ke),De)});return N===0?z:ae.map(function(Q,de){var De=Q;if(N>0&&q[de]-N>0){var Ae=Math.min(N,q[de]-N);N-=Ae,De=Q-Ae}return De/x*100})}function ee(){var z=this,x=c[z.a].element,N=c[z.b].element;z.dragging&&Re(t,"onDragEnd",it)(k()),z.dragging=!1,Ye[rt]("mouseup",z.stop),Ye[rt]("touchend",z.stop),Ye[rt]("touchcancel",z.stop),Ye[rt]("mousemove",z.move),Ye[rt]("touchmove",z.move),z.stop=null,z.move=null,x[rt]("selectstart",it),x[rt]("dragstart",it),N[rt]("selectstart",it),N[rt]("dragstart",it),x.style.userSelect="",x.style.webkitUserSelect="",x.style.MozUserSelect="",x.style.pointerEvents="",N.style.userSelect="",N.style.webkitUserSelect="",N.style.MozUserSelect="",N.style.pointerEvents="",z.gutter.style.cursor="",z.parent.style.cursor="",an.body.style.cursor=""}function X(z){if(!("button"in z&&z.button!==0)){var x=this,N=c[x.a].element,q=c[x.b].element;x.dragging||Re(t,"onDragStart",it)(k()),z.preventDefault(),x.dragging=!0,x.move=F.bind(x),x.stop=ee.bind(x),Ye[tt]("mouseup",x.stop),Ye[tt]("touchend",x.stop),Ye[tt]("touchcancel",x.stop),Ye[tt]("mousemove",x.move),Ye[tt]("touchmove",x.move),N[tt]("selectstart",it),N[tt]("dragstart",it),q[tt]("selectstart",it),q[tt]("dragstart",it),N.style.userSelect="none",N.style.webkitUserSelect="none",N.style.MozUserSelect="none",N.style.pointerEvents="none",q.style.userSelect="none",q.style.webkitUserSelect="none",q.style.MozUserSelect="none",q.style.pointerEvents="none",x.gutter.style.cursor=L,x.parent.style.cursor=L,an.body.style.cursor=L,R.call(x),x.dragOffset=Y(z)-x.end}}f=J(f);var Z=[];c=r.map(function(z,x){var N={element:ro(z),size:f[x],minSize:y[x],maxSize:A[x],snapOffset:_[x],i:x},q;if(x>0&&(q={a:x-1,b:x,dragging:!1,direction:S,parent:l},q[nt]=kn(m,x-1===0,!1,b),q[Dt]=kn(m,!1,x===r.length-1,b),h==="row-reverse"||h==="column-reverse")){var ae=q.a;q.a=q.b,q.b=ae}if(x>0){var Q=H(x,S,N.element);W(Q,m,x),q[Nr]=X.bind(q),Q[tt]("mousedown",q[Nr]),Q[tt]("touchstart",q[Nr]),l.insertBefore(Q,N.element),q.gutter=Q}return V(N.element,N.size,kn(m,x===0,x===r.length-1,b),x),x>0&&Z.push(q),N});function re(z){var x=z.i===Z.length,N=x?Z[z.i-1]:Z[z.i];R.call(N);var q=x?N.size-z.minSize-N[Dt]:z.minSize+N[nt];B.call(N,q)}c.forEach(function(z){var x=z.element[$i]()[n];x<z.minSize&&(v?re(z):z.minSize=x)});function oe(z){var x=J(z);x.forEach(function(N,q){if(q>0){var ae=Z[q-1],Q=c[ae.a],de=c[ae.b];Q.size=x[q-1],de.size=N,V(Q.element,Q.size,ae[nt],Q.i),V(de.element,de.size,ae[Dt],de.i)}})}function ue(z,x){Z.forEach(function(N){if(x!==!0?N.parent.removeChild(N.gutter):(N.gutter[rt]("mousedown",N[Nr]),N.gutter[rt]("touchstart",N[Nr])),z!==!0){var q=j(n,N.a.size,N[nt]);Object.keys(q).forEach(function(ae){c[N.a].element.style[ae]="",c[N.b].element.style[ae]=""})}})}return{setSizes:oe,getSizes:k,collapse:function(x){re(c[x])},destroy:ue,parent:l,pairs:Z}},no=qf;function Wi(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)===-1&&(r[n]=e[n]);return r}var ns=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.componentDidMount=function(){var n=this.props;n.children;var i=n.gutter,a=Wi(n,["children","gutter"]),s=a;s.gutter=function(o,c){var u;return i?u=i(o,c):(u=document.createElement("div"),u.className="gutter gutter-"+c),u.__isSplitGutter=!0,u},this.split=no(this.parent.children,s)},t.prototype.componentDidUpdate=function(n){var i=this,a=this.props;a.children;var s=a.minSize,o=a.sizes,c=a.collapsed,u=Wi(a,["children","minSize","sizes","collapsed"]),l=u,d=n.minSize,h=n.sizes,f=n.collapsed,g=["maxSize","expandToMin","gutterSize","gutterAlign","snapOffset","dragInterval","direction","cursor"],y=g.map(function(v){return i.props[v]!==n[v]}).reduce(function(v,m){return v||m},!1);if(Array.isArray(s)&&Array.isArray(d)){var E=!1;s.forEach(function(v,m){E=E||v!==d[m]}),y=y||E}else Array.isArray(s)||Array.isArray(d)?y=!0:y=y||s!==d;if(y)l.minSize=s,l.sizes=o||this.split.getSizes(),this.split.destroy(!0,!0),l.gutter=function(v,m,b){return b.previousSibling},this.split=no(Array.from(this.parent.children).filter(function(v){return!v.__isSplitGutter}),l);else if(o){var A=!1;o.forEach(function(v,m){A=A||v!==h[m]}),A&&this.split.setSizes(this.props.sizes)}Number.isInteger(c)&&(c!==f||y)&&this.split.collapse(c)},t.prototype.componentWillUnmount=function(){this.split.destroy(),delete this.split},t.prototype.render=function(){var n=this,i=this.props;i.sizes,i.minSize,i.maxSize,i.expandToMin,i.gutterSize,i.gutterAlign,i.snapOffset,i.dragInterval,i.direction,i.cursor,i.gutter,i.elementStyle,i.gutterStyle,i.onDrag,i.onDragStart,i.onDragEnd,i.collapsed;var a=i.children,s=Wi(i,["sizes","minSize","maxSize","expandToMin","gutterSize","gutterAlign","snapOffset","dragInterval","direction","cursor","gutter","elementStyle","gutterStyle","onDrag","onDragStart","onDragEnd","collapsed","children"]),o=s;return to.default.createElement("div",Object.assign({},{ref:function(c){n.parent=c}},o),a)},t}(to.default.Component);ns.propTypes={sizes:he.default.arrayOf(he.default.number),minSize:he.default.oneOfType([he.default.number,he.default.arrayOf(he.default.number)]),maxSize:he.default.oneOfType([he.default.number,he.default.arrayOf(he.default.number)]),expandToMin:he.default.bool,gutterSize:he.default.number,gutterAlign:he.default.string,snapOffset:he.default.oneOfType([he.default.number,he.default.arrayOf(he.default.number)]),dragInterval:he.default.number,direction:he.default.string,cursor:he.default.string,gutter:he.default.func,elementStyle:he.default.func,gutterStyle:he.default.func,onDrag:he.default.func,onDragStart:he.default.func,onDragEnd:he.default.func,collapsed:he.default.number,children:he.default.arrayOf(he.default.element)};ns.defaultProps={sizes:void 0,minSize:void 0,maxSize:void 0,expandToMin:void 0,gutterSize:void 0,gutterAlign:void 0,snapOffset:void 0,dragInterval:void 0,direction:void 0,cursor:void 0,gutter:void 0,elementStyle:void 0,gutterStyle:void 0,onDrag:void 0,onDragStart:void 0,onDragEnd:void 0,collapsed:void 0,children:void 0};var Hf=ns,Kf=Hf;/*
object-assign
(c) Sindre Sorhus
@license MIT
*//** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *//** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pa=(e=>(e.Fountain="fountain",e.Markdown="md",e))(pa||{});const Yf=dr.useState;function Jf({list:e,selectFile:t}){const[r,n]=Yf(e.getCurrentList());return e.setCallback(n),ht("div",{className:"flex flex-col justify-start gap-4",children:[ht("div",{className:"flex flex-col items-stretch gap-1",children:[ge(Er,{label:"New Script",click:()=>{e.createFile("untitled script",pa.Fountain)}}),ge(Er,{label:"New Markdown",click:()=>{e.createFile("untitled markdown",pa.Markdown)}}),ge(Er,{label:"Upload File",click:()=>{}})]}),ge("div",{className:"flex flex-grow flex-col items-stretch gap-1",children:r.map(i=>ge(Er,{label:i.name,click:()=>{t(i)}},i.key))})]})}function io(e){return Object.prototype.toString.call(e)==="[object Object]"}function Ie(e){var t,r;return io(e)===!1?!1:(t=e.constructor,t===void 0?!0:(r=t.prototype,!(io(r)===!1||r.hasOwnProperty("isPrototypeOf")===!1)))}function st(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function or(e){return!!e&&!!e[Ge]}function ur(e){return!!e&&(function(t){if(!t||typeof t!="object")return!1;var r=Object.getPrototypeOf(t);if(r===null)return!0;var n=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return n===Object||typeof n=="function"&&Function.toString.call(n)===id}(e)||Array.isArray(e)||!!e[ho]||!!e.constructor[ho]||is(e)||as(e))}function sn(e,t,r){r===void 0&&(r=!1),Pr(e)===0?(r?Object.keys:ls)(e).forEach(function(n){r&&typeof n=="symbol"||t(n,e[n],e)}):e.forEach(function(n,i){return t(i,n,e)})}function Pr(e){var t=e[Ge];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:is(e)?2:as(e)?3:0}function va(e,t){return Pr(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Xf(e,t){return Pr(e)===2?e.get(t):e[t]}function tc(e,t,r){var n=Pr(e);n===2?e.set(t,r):n===3?(e.delete(t),e.add(r)):e[t]=r}function Zf(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function is(e){return rd&&e instanceof Map}function as(e){return nd&&e instanceof Set}function Qt(e){return e.o||e.t}function ss(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=ad(e);delete t[Ge];for(var r=ls(t),n=0;n<r.length;n++){var i=r[n],a=t[i];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[i]})}return Object.create(Object.getPrototypeOf(e),t)}function os(e,t){return t===void 0&&(t=!1),us(e)||or(e)||!ur(e)||(Pr(e)>1&&(e.set=e.add=e.clear=e.delete=Qf),Object.freeze(e),t&&sn(e,function(r,n){return os(n,!0)},!0)),e}function Qf(){st(2)}function us(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function pt(e){var t=sd[e];return t||st(18,e),t}function ao(){return on}function Vi(e,t){t&&(pt("Patches"),e.u=[],e.s=[],e.v=t)}function ii(e){ga(e),e.p.forEach(ed),e.p=null}function ga(e){e===on&&(on=e.l)}function so(e){return on={p:[],l:on,h:e,m:!0,_:0}}function ed(e){var t=e[Ge];t.i===0||t.i===1?t.j():t.O=!0}function Gi(e,t){t._=t.p.length;var r=t.p[0],n=e!==void 0&&e!==r;return t.h.g||pt("ES5").S(t,e,n),n?(r[Ge].P&&(ii(t),st(4)),ur(e)&&(e=ai(t,e),t.l||si(t,e)),t.u&&pt("Patches").M(r[Ge].t,e,t.u,t.s)):e=ai(t,r,[]),ii(t),t.u&&t.v(t.u,t.s),e!==rc?e:void 0}function ai(e,t,r){if(us(t))return t;var n=t[Ge];if(!n)return sn(t,function(a,s){return oo(e,n,t,a,s,r)},!0),t;if(n.A!==e)return t;if(!n.P)return si(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var i=n.i===4||n.i===5?n.o=ss(n.k):n.o;sn(n.i===3?new Set(i):i,function(a,s){return oo(e,n,i,a,s,r)}),si(e,i,!1),r&&e.u&&pt("Patches").R(n,r,e.u,e.s)}return n.o}function oo(e,t,r,n,i,a){if(or(i)){var s=ai(e,i,a&&t&&t.i!==3&&!va(t.D,n)?a.concat(n):void 0);if(tc(r,n,s),!or(s))return;e.m=!1}if(ur(i)&&!us(i)){if(!e.h.F&&e._<1)return;ai(e,i),t&&t.A.l||si(e,i)}}function si(e,t,r){r===void 0&&(r=!1),e.h.F&&e.m&&os(t,r)}function qi(e,t){var r=e[Ge];return(r?Qt(r):e)[t]}function uo(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function ma(e){e.P||(e.P=!0,e.l&&ma(e.l))}function Hi(e){e.o||(e.o=ss(e.t))}function ya(e,t,r){var n=is(t)?pt("MapSet").N(t,r):as(t)?pt("MapSet").T(t,r):e.g?function(i,a){var s=Array.isArray(i),o={i:s?1:0,A:a?a.A:ao(),P:!1,I:!1,D:{},l:a,t:i,k:null,o:null,j:null,C:!1},c=o,u=Ca;s&&(c=[o],u=Gr);var l=Proxy.revocable(c,u),d=l.revoke,h=l.proxy;return o.k=h,o.j=d,h}(t,r):pt("ES5").J(t,r);return(r?r.A:ao()).p.push(n),n}function td(e){return or(e)||st(22,e),function t(r){if(!ur(r))return r;var n,i=r[Ge],a=Pr(r);if(i){if(!i.P&&(i.i<4||!pt("ES5").K(i)))return i.t;i.I=!0,n=co(r,a),i.I=!1}else n=co(r,a);return sn(n,function(s,o){i&&Xf(i.t,s)===o||tc(n,s,t(o))}),a===3?new Set(n):n}(e)}function co(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return ss(e)}var lo,on,cs=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",rd=typeof Map<"u",nd=typeof Set<"u",fo=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",rc=cs?Symbol.for("immer-nothing"):((lo={})["immer-nothing"]=!0,lo),ho=cs?Symbol.for("immer-draftable"):"__$immer_draftable",Ge=cs?Symbol.for("immer-state"):"__$immer_state",id=""+Object.prototype.constructor,ls=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,ad=Object.getOwnPropertyDescriptors||function(e){var t={};return ls(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},sd={},Ca={get:function(e,t){if(t===Ge)return e;var r=Qt(e);if(!va(r,t))return function(i,a,s){var o,c=uo(a,s);return c?"value"in c?c.value:(o=c.get)===null||o===void 0?void 0:o.call(i.k):void 0}(e,r,t);var n=r[t];return e.I||!ur(n)?n:n===qi(e.t,t)?(Hi(e),e.o[t]=ya(e.A.h,n,e)):n},has:function(e,t){return t in Qt(e)},ownKeys:function(e){return Reflect.ownKeys(Qt(e))},set:function(e,t,r){var n=uo(Qt(e),t);if(n?.set)return n.set.call(e.k,r),!0;if(!e.P){var i=qi(Qt(e),t),a=i?.[Ge];if(a&&a.t===r)return e.o[t]=r,e.D[t]=!1,!0;if(Zf(r,i)&&(r!==void 0||va(e.t,t)))return!0;Hi(e),ma(e)}return e.o[t]===r&&typeof r!="number"&&(r!==void 0||t in e.o)||(e.o[t]=r,e.D[t]=!0,!0)},deleteProperty:function(e,t){return qi(e.t,t)!==void 0||t in e.t?(e.D[t]=!1,Hi(e),ma(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=Qt(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty:function(){st(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){st(12)}},Gr={};sn(Ca,function(e,t){Gr[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),Gr.deleteProperty=function(e,t){return Gr.set.call(this,e,t,void 0)},Gr.set=function(e,t,r){return Ca.set.call(this,e[0],t,r,e[0])};var od=function(){function e(r){var n=this;this.g=fo,this.F=!0,this.produce=function(i,a,s){if(typeof i=="function"&&typeof a!="function"){var o=a;a=i;var c=n;return function(y){var E=this;y===void 0&&(y=o);for(var A=arguments.length,v=Array(A>1?A-1:0),m=1;m<A;m++)v[m-1]=arguments[m];return c.produce(y,function(b){var C;return(C=a).call.apply(C,[E,b].concat(v))})}}var u;if(typeof a!="function"&&st(6),s!==void 0&&typeof s!="function"&&st(7),ur(i)){var l=so(n),d=ya(n,i,void 0),h=!0;try{u=a(d),h=!1}finally{h?ii(l):ga(l)}return typeof Promise<"u"&&u instanceof Promise?u.then(function(y){return Vi(l,s),Gi(y,l)},function(y){throw ii(l),y}):(Vi(l,s),Gi(u,l))}if(!i||typeof i!="object"){if((u=a(i))===void 0&&(u=i),u===rc&&(u=void 0),n.F&&os(u,!0),s){var f=[],g=[];pt("Patches").M(i,u,f,g),s(f,g)}return u}st(21,i)},this.produceWithPatches=function(i,a){if(typeof i=="function")return function(u){for(var l=arguments.length,d=Array(l>1?l-1:0),h=1;h<l;h++)d[h-1]=arguments[h];return n.produceWithPatches(u,function(f){return i.apply(void 0,[f].concat(d))})};var s,o,c=n.produce(i,a,function(u,l){s=u,o=l});return typeof Promise<"u"&&c instanceof Promise?c.then(function(u){return[u,s,o]}):[c,s,o]},typeof r?.useProxies=="boolean"&&this.setUseProxies(r.useProxies),typeof r?.autoFreeze=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){ur(r)||st(8),or(r)&&(r=td(r));var n=so(this),i=ya(this,r,void 0);return i[Ge].C=!0,ga(n),i},t.finishDraft=function(r,n){var i=r&&r[Ge],a=i.A;return Vi(a,n),Gi(void 0,a)},t.setAutoFreeze=function(r){this.F=r},t.setUseProxies=function(r){r&&!fo&&st(20),this.g=r},t.applyPatches=function(r,n){var i;for(i=n.length-1;i>=0;i--){var a=n[i];if(a.path.length===0&&a.op==="replace"){r=a.value;break}}i>-1&&(n=n.slice(i+1));var s=pt("Patches").$;return or(r)?s(r,n):this.produce(r,function(o){return s(o,n)})},e}(),qe=new od,bi=qe.produce;qe.produceWithPatches.bind(qe);qe.setAutoFreeze.bind(qe);qe.setUseProxies.bind(qe);qe.applyPatches.bind(qe);var po=qe.createDraft.bind(qe),vo=qe.finishDraft.bind(qe);function yt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var oi=new WeakMap,ui=new WeakMap,Ur=new WeakMap,go=new WeakMap,mo=new WeakMap,yo=new WeakMap,Co=new WeakMap;function Do(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Fn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Do(Object(r),!0).forEach(function(n){yt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Do(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ud=()=>{var e={children:[],operations:[],selection:null,marks:null,isInline:()=>!1,isVoid:()=>!1,onChange:()=>{},apply:t=>{for(var r of p.pathRefs(e))Ld.transform(r,t);for(var n of p.pointRefs(e))Nd.transform(n,t);for(var i of p.rangeRefs(e))$d.transform(i,t);var a=oi.get(e)||[],s=ui.get(e)||new Set,o,c,u=g=>{if(g){var y=g.join(",");c.has(y)||(c.add(y),o.push(g))}};if(D.operationCanTransformPath(t)){o=[],c=new Set;for(var l of a){var d=D.transform(l,t);u(d)}}else o=a,c=s;var h=e.getDirtyPaths(t);for(var f of h)u(f);oi.set(e,o),ui.set(e,c),O.transform(e,t),e.operations.push(t),p.normalize(e),t.type==="set_selection"&&(e.marks=null),Ur.get(e)||(Ur.set(e,!0),Promise.resolve().then(()=>{Ur.set(e,!1),e.onChange(),e.operations=[]}))},addMark:(t,r)=>{var{selection:n}=e;if(n)if(w.isExpanded(n))O.setNodes(e,{[t]:r},{match:G.isText,split:!0});else{var i=Fn(Fn({},p.marks(e)||{}),{},{[t]:r});e.marks=i,Ur.get(e)||e.onChange()}},deleteBackward:t=>{var{selection:r}=e;r&&w.isCollapsed(r)&&O.delete(e,{unit:t,reverse:!0})},deleteForward:t=>{var{selection:r}=e;r&&w.isCollapsed(r)&&O.delete(e,{unit:t})},deleteFragment:t=>{var{selection:r}=e;r&&w.isExpanded(r)&&O.delete(e,{reverse:t==="backward"})},getFragment:()=>{var{selection:t}=e;return t?$.fragment(e,t):[]},insertBreak:()=>{O.splitNodes(e,{always:!0})},insertSoftBreak:()=>{O.splitNodes(e,{always:!0})},insertFragment:t=>{O.insertFragment(e,t)},insertNode:t=>{O.insertNodes(e,t)},insertText:t=>{var{selection:r,marks:n}=e;if(r){if(n){var i=Fn({text:t},n);O.insertNodes(e,i)}else O.insertText(e,t);e.marks=null}},normalizeNode:t=>{var[r,n]=t;if(!G.isText(r)){if(le.isElement(r)&&r.children.length===0){var i={text:""};O.insertNodes(e,i,{at:n.concat(0),voids:!0});return}for(var a=p.isEditor(r)?!1:le.isElement(r)&&(e.isInline(r)||r.children.length===0||G.isText(r.children[0])||e.isInline(r.children[0])),s=0,o=0;o<r.children.length;o++,s++){var c=$.get(e,n);if(!G.isText(c)){var u=r.children[o],l=c.children[s-1],d=o===r.children.length-1,h=G.isText(u)||le.isElement(u)&&e.isInline(u);if(h!==a)O.removeNodes(e,{at:n.concat(s),voids:!0}),s--;else if(le.isElement(u)){if(e.isInline(u)){if(l==null||!G.isText(l)){var f={text:""};O.insertNodes(e,f,{at:n.concat(s),voids:!0}),s++}else if(d){var g={text:""};O.insertNodes(e,g,{at:n.concat(s+1),voids:!0}),s++}}}else l!=null&&G.isText(l)&&(G.equals(u,l,{loose:!0})?(O.mergeNodes(e,{at:n.concat(s),voids:!0}),s--):l.text===""?(O.removeNodes(e,{at:n.concat(s-1),voids:!0}),s--):u.text===""&&(O.removeNodes(e,{at:n.concat(s),voids:!0}),s--))}}}},removeMark:t=>{var{selection:r}=e;if(r)if(w.isExpanded(r))O.unsetNodes(e,t,{match:G.isText,split:!0});else{var n=Fn({},p.marks(e)||{});delete n[t],e.marks=n,Ur.get(e)||e.onChange()}},getDirtyPaths:t=>{switch(t.type){case"insert_text":case"remove_text":case"set_node":{var{path:r}=t;return D.levels(r)}case"insert_node":{var{node:n,path:i}=t,a=D.levels(i),s=G.isText(n)?[]:Array.from($.nodes(n),H=>{var[,j]=H;return i.concat(j)});return[...a,...s]}case"merge_node":{var{path:o}=t,c=D.ancestors(o),u=D.previous(o);return[...c,u]}case"move_node":{var{path:l,newPath:d}=t;if(D.equals(l,d))return[];var h=[],f=[];for(var g of D.ancestors(l)){var y=D.transform(g,t);h.push(y)}for(var E of D.ancestors(d)){var A=D.transform(E,t);f.push(A)}var v=f[f.length-1],m=d[d.length-1],b=v.concat(m);return[...h,...f,b]}case"remove_node":{var{path:C}=t,_=D.ancestors(C);return[..._]}case"split_node":{var{path:P}=t,S=D.levels(P),L=D.next(P);return[...S,L]}default:return[]}}};return e};function cd(e,t){if(e==null)return{};var r={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}function wt(e,t){if(e==null)return{};var r=cd(e,t),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(t.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}var fs=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=!r,i=r?vd(t):t,a=te.None,s=te.None,o=0,c=null,u=null;for(var l of i){var d=l.codePointAt(0);if(!d)break;var h=wd(l,d);if([a,s]=n?[s,h]:[h,a],Sr(a,te.ZWJ)&&Sr(s,te.ExtPict)&&(n?c=bo(t.substring(0,o)):c=bo(t.substring(0,t.length-o)),!c)||Sr(a,te.RI)&&Sr(s,te.RI)&&(u!==null?u=!u:n?u=!0:u=xd(t.substring(0,t.length-o)),!u)||a!==te.None&&s!==te.None&&Fd(a,s))break;o+=l.length}return o||1},ld=/\s/,fd=/[\u0021-\u0023\u0025-\u002A\u002C-\u002F\u003A\u003B\u003F\u0040\u005B-\u005D\u005F\u007B\u007D\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E3B\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]/,dd=/['\u2018\u2019]/,hd=function(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=0,i=!1;t.length>0;){var a=fs(t,r),[s,o]=ds(t,a,r);if(pd(s,o,r))i=!0,n+=a;else if(!i)n+=a;else break;t=o}return n},ds=(e,t,r)=>{if(r){var n=e.length-t;return[e.slice(n,e.length),e.slice(0,n)]}return[e.slice(0,t),e.slice(t)]},pd=function e(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(ld.test(t))return!1;if(dd.test(t)){var i=fs(r,n),[a,s]=ds(r,i,n);if(e(a,s,n))return!0}return!fd.test(t)},vd=function*(t){for(var r=t.length-1,n=0;n<t.length;n++){var i=t.charAt(r-n);if(md(i.charCodeAt(0))){var a=t.charAt(r-n-1);if(gd(a.charCodeAt(0))){yield a+i,n++;continue}}yield i}},gd=e=>e>=55296&&e<=56319,md=e=>e>=56320&&e<=57343,te;(function(e){e[e.None=0]="None",e[e.Extend=1]="Extend",e[e.ZWJ=2]="ZWJ",e[e.RI=4]="RI",e[e.Prepend=8]="Prepend",e[e.SpacingMark=16]="SpacingMark",e[e.L=32]="L",e[e.V=64]="V",e[e.T=128]="T",e[e.LV=256]="LV",e[e.LVT=512]="LVT",e[e.ExtPict=1024]="ExtPict",e[e.Any=2048]="Any"})(te||(te={}));var yd=/^(?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0902\u093A\u093C\u0941-\u0948\u094D\u0951-\u0957\u0962\u0963\u0981\u09BC\u09BE\u09C1-\u09C4\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01\u0B3C\u0B3E\u0B3F\u0B41-\u0B44\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE\u0BC0\u0BCD\u0BD7\u0C00\u0C04\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81\u0CBC\u0CBF\u0CC2\u0CC6\u0CCC\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00\u0D01\u0D3B\u0D3C\u0D3E\u0D41-\u0D44\u0D4D\u0D57\u0D62\u0D63\u0D81\u0DCA\u0DCF\u0DD2-\u0DD4\u0DD6\u0DDF\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4\u17B5\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1A17\u1A18\u1A1B\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1AB0-\u1AC0\u1B00-\u1B03\u1B34-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1BAB-\u1BAD\u1BE6\u1BE8\u1BE9\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u200C\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA825\uA826\uA82C\uA8C4\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uA9BD\uA9E5\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAA7C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEC\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFF9E\uFF9F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDF46-\uDF50]|\uD804[\uDC01\uDC38-\uDC46\uDC7F-\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA\uDD00-\uDD02\uDD27-\uDD2B\uDD2D-\uDD34\uDD73\uDD80\uDD81\uDDB6-\uDDBE\uDDC9-\uDDCC\uDDCF\uDE2F-\uDE31\uDE34\uDE36\uDE37\uDE3E\uDEDF\uDEE3-\uDEEA\uDF00\uDF01\uDF3B\uDF3C\uDF3E\uDF40\uDF57\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC38-\uDC3F\uDC42-\uDC44\uDC46\uDC5E\uDCB0\uDCB3-\uDCB8\uDCBA\uDCBD\uDCBF\uDCC0\uDCC2\uDCC3\uDDAF\uDDB2-\uDDB5\uDDBC\uDDBD\uDDBF\uDDC0\uDDDC\uDDDD\uDE33-\uDE3A\uDE3D\uDE3F\uDE40\uDEAB\uDEAD\uDEB0-\uDEB5\uDEB7\uDF1D-\uDF1F\uDF22-\uDF25\uDF27-\uDF2B]|\uD806[\uDC2F-\uDC37\uDC39\uDC3A\uDD30\uDD3B\uDD3C\uDD3E\uDD43\uDDD4-\uDDD7\uDDDA\uDDDB\uDDE0\uDE01-\uDE0A\uDE33-\uDE38\uDE3B-\uDE3E\uDE47\uDE51-\uDE56\uDE59-\uDE5B\uDE8A-\uDE96\uDE98\uDE99]|\uD807[\uDC30-\uDC36\uDC38-\uDC3D\uDC3F\uDC92-\uDCA7\uDCAA-\uDCB0\uDCB2\uDCB3\uDCB5\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD90\uDD91\uDD95\uDD97\uDEF3\uDEF4]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF8F-\uDF92\uDFE4]|\uD82F[\uDC9D\uDC9E]|\uD834[\uDD65\uDD67-\uDD69\uDD6E-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uD83C[\uDFFB-\uDFFF]|\uDB40[\uDC20-\uDC7F\uDD00-\uDDEF])$/,Cd=/^(?:[\u0600-\u0605\u06DD\u070F\u0890\u0891\u08E2\u0D4E]|\uD804[\uDCBD\uDCCD\uDDC2\uDDC3]|\uD806[\uDD3F\uDD41\uDE3A\uDE84-\uDE89]|\uD807\uDD46)$/,Dd=/^(?:[\u0903\u093B\u093E-\u0940\u0949-\u094C\u094E\u094F\u0982\u0983\u09BF\u09C0\u09C7\u09C8\u09CB\u09CC\u0A03\u0A3E-\u0A40\u0A83\u0ABE-\u0AC0\u0AC9\u0ACB\u0ACC\u0B02\u0B03\u0B40\u0B47\u0B48\u0B4B\u0B4C\u0BBF\u0BC1\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCC\u0C01-\u0C03\u0C41-\u0C44\u0C82\u0C83\u0CBE\u0CC0\u0CC1\u0CC3\u0CC4\u0CC7\u0CC8\u0CCA\u0CCB\u0D02\u0D03\u0D3F\u0D40\u0D46-\u0D48\u0D4A-\u0D4C\u0D82\u0D83\u0DD0\u0DD1\u0DD8-\u0DDE\u0DF2\u0DF3\u0E33\u0EB3\u0F3E\u0F3F\u0F7F\u1031\u103B\u103C\u1056\u1057\u1084\u1715\u1734\u17B6\u17BE-\u17C5\u17C7\u17C8\u1923-\u1926\u1929-\u192B\u1930\u1931\u1933-\u1938\u1A19\u1A1A\u1A55\u1A57\u1A6D-\u1A72\u1B04\u1B3B\u1B3D-\u1B41\u1B43\u1B44\u1B82\u1BA1\u1BA6\u1BA7\u1BAA\u1BE7\u1BEA-\u1BEC\u1BEE\u1BF2\u1BF3\u1C24-\u1C2B\u1C34\u1C35\u1CE1\u1CF7\uA823\uA824\uA827\uA880\uA881\uA8B4-\uA8C3\uA952\uA953\uA983\uA9B4\uA9B5\uA9BA\uA9BB\uA9BE-\uA9C0\uAA2F\uAA30\uAA33\uAA34\uAA4D\uAAEB\uAAEE\uAAEF\uAAF5\uABE3\uABE4\uABE6\uABE7\uABE9\uABEA\uABEC]|\uD804[\uDC00\uDC02\uDC82\uDCB0-\uDCB2\uDCB7\uDCB8\uDD2C\uDD45\uDD46\uDD82\uDDB3-\uDDB5\uDDBF\uDDC0\uDDCE\uDE2C-\uDE2E\uDE32\uDE33\uDE35\uDEE0-\uDEE2\uDF02\uDF03\uDF3F\uDF41-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF62\uDF63]|\uD805[\uDC35-\uDC37\uDC40\uDC41\uDC45\uDCB1\uDCB2\uDCB9\uDCBB\uDCBC\uDCBE\uDCC1\uDDB0\uDDB1\uDDB8-\uDDBB\uDDBE\uDE30-\uDE32\uDE3B\uDE3C\uDE3E\uDEAC\uDEAE\uDEAF\uDEB6\uDF26]|\uD806[\uDC2C-\uDC2E\uDC38\uDD31-\uDD35\uDD37\uDD38\uDD3D\uDD40\uDD42\uDDD1-\uDDD3\uDDDC-\uDDDF\uDDE4\uDE39\uDE57\uDE58\uDE97]|\uD807[\uDC2F\uDC3E\uDCA9\uDCB1\uDCB4\uDD8A-\uDD8E\uDD93\uDD94\uDD96\uDEF5\uDEF6]|\uD81B[\uDF51-\uDF87\uDFF0\uDFF1]|\uD834[\uDD66\uDD6D])$/,bd=/^[\u1100-\u115F\uA960-\uA97C]$/,Ed=/^[\u1160-\u11A7\uD7B0-\uD7C6]$/,Sd=/^[\u11A8-\u11FF\uD7CB-\uD7FB]$/,Bd=/^[\uAC00\uAC1C\uAC38\uAC54\uAC70\uAC8C\uACA8\uACC4\uACE0\uACFC\uAD18\uAD34\uAD50\uAD6C\uAD88\uADA4\uADC0\uADDC\uADF8\uAE14\uAE30\uAE4C\uAE68\uAE84\uAEA0\uAEBC\uAED8\uAEF4\uAF10\uAF2C\uAF48\uAF64\uAF80\uAF9C\uAFB8\uAFD4\uAFF0\uB00C\uB028\uB044\uB060\uB07C\uB098\uB0B4\uB0D0\uB0EC\uB108\uB124\uB140\uB15C\uB178\uB194\uB1B0\uB1CC\uB1E8\uB204\uB220\uB23C\uB258\uB274\uB290\uB2AC\uB2C8\uB2E4\uB300\uB31C\uB338\uB354\uB370\uB38C\uB3A8\uB3C4\uB3E0\uB3FC\uB418\uB434\uB450\uB46C\uB488\uB4A4\uB4C0\uB4DC\uB4F8\uB514\uB530\uB54C\uB568\uB584\uB5A0\uB5BC\uB5D8\uB5F4\uB610\uB62C\uB648\uB664\uB680\uB69C\uB6B8\uB6D4\uB6F0\uB70C\uB728\uB744\uB760\uB77C\uB798\uB7B4\uB7D0\uB7EC\uB808\uB824\uB840\uB85C\uB878\uB894\uB8B0\uB8CC\uB8E8\uB904\uB920\uB93C\uB958\uB974\uB990\uB9AC\uB9C8\uB9E4\uBA00\uBA1C\uBA38\uBA54\uBA70\uBA8C\uBAA8\uBAC4\uBAE0\uBAFC\uBB18\uBB34\uBB50\uBB6C\uBB88\uBBA4\uBBC0\uBBDC\uBBF8\uBC14\uBC30\uBC4C\uBC68\uBC84\uBCA0\uBCBC\uBCD8\uBCF4\uBD10\uBD2C\uBD48\uBD64\uBD80\uBD9C\uBDB8\uBDD4\uBDF0\uBE0C\uBE28\uBE44\uBE60\uBE7C\uBE98\uBEB4\uBED0\uBEEC\uBF08\uBF24\uBF40\uBF5C\uBF78\uBF94\uBFB0\uBFCC\uBFE8\uC004\uC020\uC03C\uC058\uC074\uC090\uC0AC\uC0C8\uC0E4\uC100\uC11C\uC138\uC154\uC170\uC18C\uC1A8\uC1C4\uC1E0\uC1FC\uC218\uC234\uC250\uC26C\uC288\uC2A4\uC2C0\uC2DC\uC2F8\uC314\uC330\uC34C\uC368\uC384\uC3A0\uC3BC\uC3D8\uC3F4\uC410\uC42C\uC448\uC464\uC480\uC49C\uC4B8\uC4D4\uC4F0\uC50C\uC528\uC544\uC560\uC57C\uC598\uC5B4\uC5D0\uC5EC\uC608\uC624\uC640\uC65C\uC678\uC694\uC6B0\uC6CC\uC6E8\uC704\uC720\uC73C\uC758\uC774\uC790\uC7AC\uC7C8\uC7E4\uC800\uC81C\uC838\uC854\uC870\uC88C\uC8A8\uC8C4\uC8E0\uC8FC\uC918\uC934\uC950\uC96C\uC988\uC9A4\uC9C0\uC9DC\uC9F8\uCA14\uCA30\uCA4C\uCA68\uCA84\uCAA0\uCABC\uCAD8\uCAF4\uCB10\uCB2C\uCB48\uCB64\uCB80\uCB9C\uCBB8\uCBD4\uCBF0\uCC0C\uCC28\uCC44\uCC60\uCC7C\uCC98\uCCB4\uCCD0\uCCEC\uCD08\uCD24\uCD40\uCD5C\uCD78\uCD94\uCDB0\uCDCC\uCDE8\uCE04\uCE20\uCE3C\uCE58\uCE74\uCE90\uCEAC\uCEC8\uCEE4\uCF00\uCF1C\uCF38\uCF54\uCF70\uCF8C\uCFA8\uCFC4\uCFE0\uCFFC\uD018\uD034\uD050\uD06C\uD088\uD0A4\uD0C0\uD0DC\uD0F8\uD114\uD130\uD14C\uD168\uD184\uD1A0\uD1BC\uD1D8\uD1F4\uD210\uD22C\uD248\uD264\uD280\uD29C\uD2B8\uD2D4\uD2F0\uD30C\uD328\uD344\uD360\uD37C\uD398\uD3B4\uD3D0\uD3EC\uD408\uD424\uD440\uD45C\uD478\uD494\uD4B0\uD4CC\uD4E8\uD504\uD520\uD53C\uD558\uD574\uD590\uD5AC\uD5C8\uD5E4\uD600\uD61C\uD638\uD654\uD670\uD68C\uD6A8\uD6C4\uD6E0\uD6FC\uD718\uD734\uD750\uD76C\uD788]$/,_d=/^[\uAC01-\uAC1B\uAC1D-\uAC37\uAC39-\uAC53\uAC55-\uAC6F\uAC71-\uAC8B\uAC8D-\uACA7\uACA9-\uACC3\uACC5-\uACDF\uACE1-\uACFB\uACFD-\uAD17\uAD19-\uAD33\uAD35-\uAD4F\uAD51-\uAD6B\uAD6D-\uAD87\uAD89-\uADA3\uADA5-\uADBF\uADC1-\uADDB\uADDD-\uADF7\uADF9-\uAE13\uAE15-\uAE2F\uAE31-\uAE4B\uAE4D-\uAE67\uAE69-\uAE83\uAE85-\uAE9F\uAEA1-\uAEBB\uAEBD-\uAED7\uAED9-\uAEF3\uAEF5-\uAF0F\uAF11-\uAF2B\uAF2D-\uAF47\uAF49-\uAF63\uAF65-\uAF7F\uAF81-\uAF9B\uAF9D-\uAFB7\uAFB9-\uAFD3\uAFD5-\uAFEF\uAFF1-\uB00B\uB00D-\uB027\uB029-\uB043\uB045-\uB05F\uB061-\uB07B\uB07D-\uB097\uB099-\uB0B3\uB0B5-\uB0CF\uB0D1-\uB0EB\uB0ED-\uB107\uB109-\uB123\uB125-\uB13F\uB141-\uB15B\uB15D-\uB177\uB179-\uB193\uB195-\uB1AF\uB1B1-\uB1CB\uB1CD-\uB1E7\uB1E9-\uB203\uB205-\uB21F\uB221-\uB23B\uB23D-\uB257\uB259-\uB273\uB275-\uB28F\uB291-\uB2AB\uB2AD-\uB2C7\uB2C9-\uB2E3\uB2E5-\uB2FF\uB301-\uB31B\uB31D-\uB337\uB339-\uB353\uB355-\uB36F\uB371-\uB38B\uB38D-\uB3A7\uB3A9-\uB3C3\uB3C5-\uB3DF\uB3E1-\uB3FB\uB3FD-\uB417\uB419-\uB433\uB435-\uB44F\uB451-\uB46B\uB46D-\uB487\uB489-\uB4A3\uB4A5-\uB4BF\uB4C1-\uB4DB\uB4DD-\uB4F7\uB4F9-\uB513\uB515-\uB52F\uB531-\uB54B\uB54D-\uB567\uB569-\uB583\uB585-\uB59F\uB5A1-\uB5BB\uB5BD-\uB5D7\uB5D9-\uB5F3\uB5F5-\uB60F\uB611-\uB62B\uB62D-\uB647\uB649-\uB663\uB665-\uB67F\uB681-\uB69B\uB69D-\uB6B7\uB6B9-\uB6D3\uB6D5-\uB6EF\uB6F1-\uB70B\uB70D-\uB727\uB729-\uB743\uB745-\uB75F\uB761-\uB77B\uB77D-\uB797\uB799-\uB7B3\uB7B5-\uB7CF\uB7D1-\uB7EB\uB7ED-\uB807\uB809-\uB823\uB825-\uB83F\uB841-\uB85B\uB85D-\uB877\uB879-\uB893\uB895-\uB8AF\uB8B1-\uB8CB\uB8CD-\uB8E7\uB8E9-\uB903\uB905-\uB91F\uB921-\uB93B\uB93D-\uB957\uB959-\uB973\uB975-\uB98F\uB991-\uB9AB\uB9AD-\uB9C7\uB9C9-\uB9E3\uB9E5-\uB9FF\uBA01-\uBA1B\uBA1D-\uBA37\uBA39-\uBA53\uBA55-\uBA6F\uBA71-\uBA8B\uBA8D-\uBAA7\uBAA9-\uBAC3\uBAC5-\uBADF\uBAE1-\uBAFB\uBAFD-\uBB17\uBB19-\uBB33\uBB35-\uBB4F\uBB51-\uBB6B\uBB6D-\uBB87\uBB89-\uBBA3\uBBA5-\uBBBF\uBBC1-\uBBDB\uBBDD-\uBBF7\uBBF9-\uBC13\uBC15-\uBC2F\uBC31-\uBC4B\uBC4D-\uBC67\uBC69-\uBC83\uBC85-\uBC9F\uBCA1-\uBCBB\uBCBD-\uBCD7\uBCD9-\uBCF3\uBCF5-\uBD0F\uBD11-\uBD2B\uBD2D-\uBD47\uBD49-\uBD63\uBD65-\uBD7F\uBD81-\uBD9B\uBD9D-\uBDB7\uBDB9-\uBDD3\uBDD5-\uBDEF\uBDF1-\uBE0B\uBE0D-\uBE27\uBE29-\uBE43\uBE45-\uBE5F\uBE61-\uBE7B\uBE7D-\uBE97\uBE99-\uBEB3\uBEB5-\uBECF\uBED1-\uBEEB\uBEED-\uBF07\uBF09-\uBF23\uBF25-\uBF3F\uBF41-\uBF5B\uBF5D-\uBF77\uBF79-\uBF93\uBF95-\uBFAF\uBFB1-\uBFCB\uBFCD-\uBFE7\uBFE9-\uC003\uC005-\uC01F\uC021-\uC03B\uC03D-\uC057\uC059-\uC073\uC075-\uC08F\uC091-\uC0AB\uC0AD-\uC0C7\uC0C9-\uC0E3\uC0E5-\uC0FF\uC101-\uC11B\uC11D-\uC137\uC139-\uC153\uC155-\uC16F\uC171-\uC18B\uC18D-\uC1A7\uC1A9-\uC1C3\uC1C5-\uC1DF\uC1E1-\uC1FB\uC1FD-\uC217\uC219-\uC233\uC235-\uC24F\uC251-\uC26B\uC26D-\uC287\uC289-\uC2A3\uC2A5-\uC2BF\uC2C1-\uC2DB\uC2DD-\uC2F7\uC2F9-\uC313\uC315-\uC32F\uC331-\uC34B\uC34D-\uC367\uC369-\uC383\uC385-\uC39F\uC3A1-\uC3BB\uC3BD-\uC3D7\uC3D9-\uC3F3\uC3F5-\uC40F\uC411-\uC42B\uC42D-\uC447\uC449-\uC463\uC465-\uC47F\uC481-\uC49B\uC49D-\uC4B7\uC4B9-\uC4D3\uC4D5-\uC4EF\uC4F1-\uC50B\uC50D-\uC527\uC529-\uC543\uC545-\uC55F\uC561-\uC57B\uC57D-\uC597\uC599-\uC5B3\uC5B5-\uC5CF\uC5D1-\uC5EB\uC5ED-\uC607\uC609-\uC623\uC625-\uC63F\uC641-\uC65B\uC65D-\uC677\uC679-\uC693\uC695-\uC6AF\uC6B1-\uC6CB\uC6CD-\uC6E7\uC6E9-\uC703\uC705-\uC71F\uC721-\uC73B\uC73D-\uC757\uC759-\uC773\uC775-\uC78F\uC791-\uC7AB\uC7AD-\uC7C7\uC7C9-\uC7E3\uC7E5-\uC7FF\uC801-\uC81B\uC81D-\uC837\uC839-\uC853\uC855-\uC86F\uC871-\uC88B\uC88D-\uC8A7\uC8A9-\uC8C3\uC8C5-\uC8DF\uC8E1-\uC8FB\uC8FD-\uC917\uC919-\uC933\uC935-\uC94F\uC951-\uC96B\uC96D-\uC987\uC989-\uC9A3\uC9A5-\uC9BF\uC9C1-\uC9DB\uC9DD-\uC9F7\uC9F9-\uCA13\uCA15-\uCA2F\uCA31-\uCA4B\uCA4D-\uCA67\uCA69-\uCA83\uCA85-\uCA9F\uCAA1-\uCABB\uCABD-\uCAD7\uCAD9-\uCAF3\uCAF5-\uCB0F\uCB11-\uCB2B\uCB2D-\uCB47\uCB49-\uCB63\uCB65-\uCB7F\uCB81-\uCB9B\uCB9D-\uCBB7\uCBB9-\uCBD3\uCBD5-\uCBEF\uCBF1-\uCC0B\uCC0D-\uCC27\uCC29-\uCC43\uCC45-\uCC5F\uCC61-\uCC7B\uCC7D-\uCC97\uCC99-\uCCB3\uCCB5-\uCCCF\uCCD1-\uCCEB\uCCED-\uCD07\uCD09-\uCD23\uCD25-\uCD3F\uCD41-\uCD5B\uCD5D-\uCD77\uCD79-\uCD93\uCD95-\uCDAF\uCDB1-\uCDCB\uCDCD-\uCDE7\uCDE9-\uCE03\uCE05-\uCE1F\uCE21-\uCE3B\uCE3D-\uCE57\uCE59-\uCE73\uCE75-\uCE8F\uCE91-\uCEAB\uCEAD-\uCEC7\uCEC9-\uCEE3\uCEE5-\uCEFF\uCF01-\uCF1B\uCF1D-\uCF37\uCF39-\uCF53\uCF55-\uCF6F\uCF71-\uCF8B\uCF8D-\uCFA7\uCFA9-\uCFC3\uCFC5-\uCFDF\uCFE1-\uCFFB\uCFFD-\uD017\uD019-\uD033\uD035-\uD04F\uD051-\uD06B\uD06D-\uD087\uD089-\uD0A3\uD0A5-\uD0BF\uD0C1-\uD0DB\uD0DD-\uD0F7\uD0F9-\uD113\uD115-\uD12F\uD131-\uD14B\uD14D-\uD167\uD169-\uD183\uD185-\uD19F\uD1A1-\uD1BB\uD1BD-\uD1D7\uD1D9-\uD1F3\uD1F5-\uD20F\uD211-\uD22B\uD22D-\uD247\uD249-\uD263\uD265-\uD27F\uD281-\uD29B\uD29D-\uD2B7\uD2B9-\uD2D3\uD2D5-\uD2EF\uD2F1-\uD30B\uD30D-\uD327\uD329-\uD343\uD345-\uD35F\uD361-\uD37B\uD37D-\uD397\uD399-\uD3B3\uD3B5-\uD3CF\uD3D1-\uD3EB\uD3ED-\uD407\uD409-\uD423\uD425-\uD43F\uD441-\uD45B\uD45D-\uD477\uD479-\uD493\uD495-\uD4AF\uD4B1-\uD4CB\uD4CD-\uD4E7\uD4E9-\uD503\uD505-\uD51F\uD521-\uD53B\uD53D-\uD557\uD559-\uD573\uD575-\uD58F\uD591-\uD5AB\uD5AD-\uD5C7\uD5C9-\uD5E3\uD5E5-\uD5FF\uD601-\uD61B\uD61D-\uD637\uD639-\uD653\uD655-\uD66F\uD671-\uD68B\uD68D-\uD6A7\uD6A9-\uD6C3\uD6C5-\uD6DF\uD6E1-\uD6FB\uD6FD-\uD717\uD719-\uD733\uD735-\uD74F\uD751-\uD76B\uD76D-\uD787\uD789-\uD7A3]$/,Ad=/^(?:[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u2388\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2605\u2607-\u2612\u2614-\u2685\u2690-\u2705\u2708-\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763-\u2767\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC00-\uDCFF\uDD0D-\uDD0F\uDD2F\uDD6C-\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDAD-\uDDE5\uDE01-\uDE0F\uDE1A\uDE2F\uDE32-\uDE3A\uDE3C-\uDE3F\uDE49-\uDFFA]|\uD83D[\uDC00-\uDD3D\uDD46-\uDE4F\uDE80-\uDEFF\uDF74-\uDF7F\uDFD5-\uDFFF]|\uD83E[\uDC0C-\uDC0F\uDC48-\uDC4F\uDC5A-\uDC5F\uDC88-\uDC8F\uDCAE-\uDCFF\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDEFF]|\uD83F[\uDC00-\uDFFD])$/,wd=(e,t)=>{var r=te.Any;return e.search(yd)!==-1&&(r|=te.Extend),t===8205&&(r|=te.ZWJ),t>=127462&&t<=127487&&(r|=te.RI),e.search(Cd)!==-1&&(r|=te.Prepend),e.search(Dd)!==-1&&(r|=te.SpacingMark),e.search(bd)!==-1&&(r|=te.L),e.search(Ed)!==-1&&(r|=te.V),e.search(Sd)!==-1&&(r|=te.T),e.search(Bd)!==-1&&(r|=te.LV),e.search(_d)!==-1&&(r|=te.LVT),e.search(Ad)!==-1&&(r|=te.ExtPict),r};function Sr(e,t){return(e&t)!==0}var kd=[[te.L,te.L|te.V|te.LV|te.LVT],[te.LV|te.V,te.V|te.T],[te.LVT|te.T,te.T],[te.Any,te.Extend|te.ZWJ],[te.Any,te.SpacingMark],[te.Prepend,te.Any],[te.ZWJ,te.ExtPict],[te.RI,te.RI]];function Fd(e,t){return kd.findIndex(r=>Sr(e,r[0])&&Sr(t,r[1]))===-1}var Td=/(?:[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u2388\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2605\u2607-\u2612\u2614-\u2685\u2690-\u2705\u2708-\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763-\u2767\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC00-\uDCFF\uDD0D-\uDD0F\uDD2F\uDD6C-\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDAD-\uDDE5\uDE01-\uDE0F\uDE1A\uDE2F\uDE32-\uDE3A\uDE3C-\uDE3F\uDE49-\uDFFA]|\uD83D[\uDC00-\uDD3D\uDD46-\uDE4F\uDE80-\uDEFF\uDF74-\uDF7F\uDFD5-\uDFFF]|\uD83E[\uDC0C-\uDC0F\uDC48-\uDC4F\uDC5A-\uDC5F\uDC88-\uDC8F\uDCAE-\uDCFF\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDEFF]|\uD83F[\uDC00-\uDFFD])(?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0902\u093A\u093C\u0941-\u0948\u094D\u0951-\u0957\u0962\u0963\u0981\u09BC\u09BE\u09C1-\u09C4\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01\u0B3C\u0B3E\u0B3F\u0B41-\u0B44\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE\u0BC0\u0BCD\u0BD7\u0C00\u0C04\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81\u0CBC\u0CBF\u0CC2\u0CC6\u0CCC\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00\u0D01\u0D3B\u0D3C\u0D3E\u0D41-\u0D44\u0D4D\u0D57\u0D62\u0D63\u0D81\u0DCA\u0DCF\u0DD2-\u0DD4\u0DD6\u0DDF\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4\u17B5\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1A17\u1A18\u1A1B\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1AB0-\u1AC0\u1B00-\u1B03\u1B34-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1BAB-\u1BAD\u1BE6\u1BE8\u1BE9\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u200C\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA825\uA826\uA82C\uA8C4\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uA9BD\uA9E5\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAA7C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEC\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFF9E\uFF9F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDF46-\uDF50]|\uD804[\uDC01\uDC38-\uDC46\uDC7F-\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA\uDD00-\uDD02\uDD27-\uDD2B\uDD2D-\uDD34\uDD73\uDD80\uDD81\uDDB6-\uDDBE\uDDC9-\uDDCC\uDDCF\uDE2F-\uDE31\uDE34\uDE36\uDE37\uDE3E\uDEDF\uDEE3-\uDEEA\uDF00\uDF01\uDF3B\uDF3C\uDF3E\uDF40\uDF57\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC38-\uDC3F\uDC42-\uDC44\uDC46\uDC5E\uDCB0\uDCB3-\uDCB8\uDCBA\uDCBD\uDCBF\uDCC0\uDCC2\uDCC3\uDDAF\uDDB2-\uDDB5\uDDBC\uDDBD\uDDBF\uDDC0\uDDDC\uDDDD\uDE33-\uDE3A\uDE3D\uDE3F\uDE40\uDEAB\uDEAD\uDEB0-\uDEB5\uDEB7\uDF1D-\uDF1F\uDF22-\uDF25\uDF27-\uDF2B]|\uD806[\uDC2F-\uDC37\uDC39\uDC3A\uDD30\uDD3B\uDD3C\uDD3E\uDD43\uDDD4-\uDDD7\uDDDA\uDDDB\uDDE0\uDE01-\uDE0A\uDE33-\uDE38\uDE3B-\uDE3E\uDE47\uDE51-\uDE56\uDE59-\uDE5B\uDE8A-\uDE96\uDE98\uDE99]|\uD807[\uDC30-\uDC36\uDC38-\uDC3D\uDC3F\uDC92-\uDCA7\uDCAA-\uDCB0\uDCB2\uDCB3\uDCB5\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD90\uDD91\uDD95\uDD97\uDEF3\uDEF4]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF8F-\uDF92\uDFE4]|\uD82F[\uDC9D\uDC9E]|\uD834[\uDD65\uDD67-\uDD69\uDD6E-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uD83C[\uDFFB-\uDFFF]|\uDB40[\uDC20-\uDC7F\uDD00-\uDDEF])*\u200D$/,bo=e=>e.search(Td)!==-1,Od=/(?:\uD83C[\uDDE6-\uDDFF])+$/g,xd=e=>{var t=e.match(Od);if(t===null)return!1;var r=t[0].length/2;return r%2===1},Eo=e=>Ie(e)&&$.isNodeList(e.children)&&!p.isEditor(e),le={isAncestor(e){return Ie(e)&&$.isNodeList(e.children)},isElement:Eo,isElementList(e){return Array.isArray(e)&&e.every(t=>le.isElement(t))},isElementProps(e){return e.children!==void 0},isElementType:function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"type";return Eo(t)&&t[n]===r},matches(e,t){for(var r in t)if(r!=="children"&&e[r]!==t[r])return!1;return!0}},Pd=["text"],Rd=["text"];function So(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Cr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?So(Object(r),!0).forEach(function(n){yt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):So(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Bo=new WeakMap,p={above(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{voids:r=!1,mode:n="lowest",at:i=e.selection,match:a}=t;if(!!i){var s=p.path(e,i),o=n==="lowest";for(var[c,u]of p.levels(e,{at:s,voids:r,match:a,reverse:o}))if(!G.isText(c)&&!D.equals(s,u))return[c,u]}},addMark(e,t,r){e.addMark(t,r)},after(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=p.point(e,t,{edge:"end"}),i=p.end(e,[]),a={anchor:n,focus:i},{distance:s=1}=r,o=0,c;for(var u of p.positions(e,Cr(Cr({},r),{},{at:a}))){if(o>s)break;o!==0&&(c=u),o++}return c},before(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=p.start(e,[]),i=p.point(e,t,{edge:"start"}),a={anchor:n,focus:i},{distance:s=1}=r,o=0,c;for(var u of p.positions(e,Cr(Cr({},r),{},{at:a,reverse:!0}))){if(o>s)break;o!==0&&(c=u),o++}return c},deleteBackward(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{unit:r="character"}=t;e.deleteBackward(r)},deleteForward(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{unit:r="character"}=t;e.deleteForward(r)},deleteFragment(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{direction:r="forward"}=t;e.deleteFragment(r)},edges(e,t){return[p.start(e,t),p.end(e,t)]},end(e,t){return p.point(e,t,{edge:"end"})},first(e,t){var r=p.path(e,t,{edge:"start"});return p.node(e,r)},fragment(e,t){var r=p.range(e,t),n=$.fragment(e,r);return n},hasBlocks(e,t){return t.children.some(r=>p.isBlock(e,r))},hasInlines(e,t){return t.children.some(r=>G.isText(r)||p.isInline(e,r))},hasTexts(e,t){return t.children.every(r=>G.isText(r))},insertBreak(e){e.insertBreak()},insertSoftBreak(e){e.insertSoftBreak()},insertFragment(e,t){e.insertFragment(t)},insertNode(e,t){e.insertNode(t)},insertText(e,t){e.insertText(t)},isBlock(e,t){return le.isElement(t)&&!e.isInline(t)},isEditor(e){var t=Bo.get(e);if(t!==void 0)return t;if(!Ie(e))return!1;var r=typeof e.addMark=="function"&&typeof e.apply=="function"&&typeof e.deleteBackward=="function"&&typeof e.deleteForward=="function"&&typeof e.deleteFragment=="function"&&typeof e.insertBreak=="function"&&typeof e.insertSoftBreak=="function"&&typeof e.insertFragment=="function"&&typeof e.insertNode=="function"&&typeof e.insertText=="function"&&typeof e.isInline=="function"&&typeof e.isVoid=="function"&&typeof e.normalizeNode=="function"&&typeof e.onChange=="function"&&typeof e.removeMark=="function"&&typeof e.getDirtyPaths=="function"&&(e.marks===null||Ie(e.marks))&&(e.selection===null||w.isRange(e.selection))&&$.isNodeList(e.children)&&qr.isOperationList(e.operations);return Bo.set(e,r),r},isEnd(e,t,r){var n=p.end(e,r);return se.equals(t,n)},isEdge(e,t,r){return p.isStart(e,t,r)||p.isEnd(e,t,r)},isEmpty(e,t){var{children:r}=t,[n]=r;return r.length===0||r.length===1&&G.isText(n)&&n.text===""&&!e.isVoid(t)},isInline(e,t){return le.isElement(t)&&e.isInline(t)},isNormalizing(e){var t=go.get(e);return t===void 0?!0:t},isStart(e,t,r){if(t.offset!==0)return!1;var n=p.start(e,r);return se.equals(t,n)},isVoid(e,t){return le.isElement(t)&&e.isVoid(t)},last(e,t){var r=p.path(e,t,{edge:"end"});return p.node(e,r)},leaf(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=p.path(e,t,r),i=$.leaf(e,n);return[i,n]},*levels(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{at:r=e.selection,reverse:n=!1,voids:i=!1}=t,{match:a}=t;if(a==null&&(a=()=>!0),!!r){var s=[],o=p.path(e,r);for(var[c,u]of $.levels(e,o))if(!!a(c,u)&&(s.push([c,u]),!i&&p.isVoid(e,c)))break;n&&s.reverse(),yield*s}},marks(e){var{marks:t,selection:r}=e;if(!r)return null;if(t)return t;if(w.isExpanded(r)){var[n]=p.nodes(e,{match:G.isText});if(n){var[i]=n,a=wt(i,Pd);return a}else return{}}var{anchor:s}=r,{path:o}=s,[c]=p.leaf(e,o);if(s.offset===0){var u=p.previous(e,{at:o,match:G.isText}),l=p.above(e,{match:y=>p.isBlock(e,y)});if(u&&l){var[d,h]=u,[,f]=l;D.isAncestor(f,h)&&(c=d)}}var g=wt(c,Rd);return g},next(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{mode:r="lowest",voids:n=!1}=t,{match:i,at:a=e.selection}=t;if(!!a){var s=p.after(e,a,{voids:n});if(!!s){var[,o]=p.last(e,[]),c=[s.path,o];if(D.isPath(a)&&a.length===0)throw new Error("Cannot get the next node from the root node!");if(i==null)if(D.isPath(a)){var[u]=p.parent(e,a);i=d=>u.children.includes(d)}else i=()=>!0;var[l]=p.nodes(e,{at:c,match:i,mode:r,voids:n});return l}}},node(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=p.path(e,t,r),i=$.get(e,n);return[i,n]},*nodes(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{at:r=e.selection,mode:n="all",universal:i=!1,reverse:a=!1,voids:s=!1}=t,{match:o}=t;if(o||(o=()=>!0),!!r){var c,u;if(Id.isSpan(r))c=r[0],u=r[1];else{var l=p.path(e,r,{edge:"start"}),d=p.path(e,r,{edge:"end"});c=a?d:l,u=a?l:d}var h=$.nodes(e,{reverse:a,from:c,to:u,pass:m=>{var[b]=m;return s?!1:p.isVoid(e,b)}}),f=[],g;for(var[y,E]of h){var A=g&&D.compare(E,g[1])===0;if(!(n==="highest"&&A)){if(!o(y,E)){if(i&&!A&&G.isText(y))return;continue}if(n==="lowest"&&A){g=[y,E];continue}var v=n==="lowest"?g:[y,E];v&&(i?f.push(v):yield v),g=[y,E]}}n==="lowest"&&g&&(i?f.push(g):yield g),i&&(yield*f)}},normalize(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{force:r=!1}=t,n=c=>oi.get(c)||[],i=c=>ui.get(c)||new Set,a=c=>{var u=n(c).pop(),l=u.join(",");return i(c).delete(l),u};if(!!p.isNormalizing(e)){if(r){var s=Array.from($.nodes(e),c=>{var[,u]=c;return u}),o=new Set(s.map(c=>c.join(",")));oi.set(e,s),ui.set(e,o)}n(e).length!==0&&p.withoutNormalizing(e,()=>{for(var c of n(e))if($.has(e,c)){var u=p.node(e,c),[l,d]=u;le.isElement(l)&&l.children.length===0&&e.normalizeNode(u)}for(var h=n(e).length*42,f=0;n(e).length!==0;){if(f>h)throw new Error(`
            Could not completely normalize the editor after `.concat(h,` iterations! This is usually due to incorrect normalization logic that leaves a node in an invalid state.
          `));var g=a(e);if($.has(e,g)){var y=p.node(e,g);e.normalizeNode(y)}f++}})}},parent(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=p.path(e,t,r),i=D.parent(n),a=p.node(e,i);return a},path(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{depth:n,edge:i}=r;if(D.isPath(t)){if(i==="start"){var[,a]=$.first(e,t);t=a}else if(i==="end"){var[,s]=$.last(e,t);t=s}}return w.isRange(t)&&(i==="start"?t=w.start(t):i==="end"?t=w.end(t):t=D.common(t.anchor.path,t.focus.path)),se.isPoint(t)&&(t=t.path),n!=null&&(t=t.slice(0,n)),t},hasPath(e,t){return $.has(e,t)},pathRef(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{affinity:n="forward"}=r,i={current:t,affinity:n,unref(){var{current:s}=i,o=p.pathRefs(e);return o.delete(i),i.current=null,s}},a=p.pathRefs(e);return a.add(i),i},pathRefs(e){var t=mo.get(e);return t||(t=new Set,mo.set(e,t)),t},point(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{edge:n="start"}=r;if(D.isPath(t)){var i;if(n==="end"){var[,a]=$.last(e,t);i=a}else{var[,s]=$.first(e,t);i=s}var o=$.get(e,i);if(!G.isText(o))throw new Error("Cannot get the ".concat(n," point in the node at path [").concat(t,"] because it has no ").concat(n," text node."));return{path:i,offset:n==="end"?o.text.length:0}}if(w.isRange(t)){var[c,u]=w.edges(t);return n==="start"?c:u}return t},pointRef(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{affinity:n="forward"}=r,i={current:t,affinity:n,unref(){var{current:s}=i,o=p.pointRefs(e);return o.delete(i),i.current=null,s}},a=p.pointRefs(e);return a.add(i),i},pointRefs(e){var t=yo.get(e);return t||(t=new Set,yo.set(e,t)),t},*positions(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{at:r=e.selection,unit:n="offset",reverse:i=!1,voids:a=!1}=t;if(!r)return;var s=p.range(e,r),[o,c]=w.edges(s),u=i?c:o,l=!1,d="",h=0,f=0,g=0;for(var[y,E]of p.nodes(e,{at:r,reverse:i,voids:a})){if(le.isElement(y)){if(!a&&e.isVoid(y)){yield p.start(e,E);continue}if(e.isInline(y))continue;if(p.hasInlines(e,y)){var A=D.isAncestor(E,c.path)?c:p.end(e,E),v=D.isAncestor(E,o.path)?o:p.start(e,E);d=p.string(e,{anchor:v,focus:A},{voids:a}),l=!0}}if(G.isText(y)){var m=D.equals(E,u.path);for(m?(f=i?u.offset:y.text.length-u.offset,g=u.offset):(f=y.text.length,g=i?f:0),(m||l||n==="offset")&&(yield{path:E,offset:g},l=!1);;){if(h===0){if(d==="")break;h=b(d,n,i),d=ds(d,h,i)[1]}if(g=i?g-h:g+h,f=f-h,f<0){h=-f;break}h=0,yield{path:E,offset:g}}}}function b(C,_,P){return _==="character"?fs(C,P):_==="word"?hd(C,P):_==="line"||_==="block"?C.length:1}},previous(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{mode:r="lowest",voids:n=!1}=t,{match:i,at:a=e.selection}=t;if(!!a){var s=p.before(e,a,{voids:n});if(!!s){var[,o]=p.first(e,[]),c=[s.path,o];if(D.isPath(a)&&a.length===0)throw new Error("Cannot get the previous node from the root node!");if(i==null)if(D.isPath(a)){var[u]=p.parent(e,a);i=d=>u.children.includes(d)}else i=()=>!0;var[l]=p.nodes(e,{reverse:!0,at:c,match:i,mode:r,voids:n});return l}}},range(e,t,r){if(w.isRange(t)&&!r)return t;var n=p.start(e,t),i=p.end(e,r||t);return{anchor:n,focus:i}},rangeRef(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{affinity:n="forward"}=r,i={current:t,affinity:n,unref(){var{current:s}=i,o=p.rangeRefs(e);return o.delete(i),i.current=null,s}},a=p.rangeRefs(e);return a.add(i),i},rangeRefs(e){var t=Co.get(e);return t||(t=new Set,Co.set(e,t)),t},removeMark(e,t){e.removeMark(t)},setNormalizing(e,t){go.set(e,t)},start(e,t){return p.point(e,t,{edge:"start"})},string(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{voids:n=!1}=r,i=p.range(e,t),[a,s]=w.edges(i),o="";for(var[c,u]of p.nodes(e,{at:i,match:G.isText,voids:n})){var l=c.text;D.equals(u,s.path)&&(l=l.slice(0,s.offset)),D.equals(u,a.path)&&(l=l.slice(a.offset)),o+=l}return o},unhangRange(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{voids:n=!1}=r,[i,a]=w.edges(t);if(i.offset!==0||a.offset!==0||w.isCollapsed(t))return t;var s=p.above(e,{at:a,match:f=>p.isBlock(e,f)}),o=s?s[1]:[],c=p.start(e,i),u={anchor:c,focus:a},l=!0;for(var[d,h]of p.nodes(e,{at:u,match:G.isText,reverse:!0,voids:n})){if(l){l=!1;continue}if(d.text!==""||D.isBefore(h,o)){a={path:h,offset:d.text.length};break}}return{anchor:i,focus:a}},void(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return p.above(e,Cr(Cr({},t),{},{match:r=>p.isVoid(e,r)}))},withoutNormalizing(e,t){var r=p.isNormalizing(e);p.setNormalizing(e,!1);try{t()}finally{p.setNormalizing(e,r)}p.normalize(e)}},Id={isSpan(e){return Array.isArray(e)&&e.length===2&&e.every(D.isPath)}},Md=["children"],jd=["text"],_o=new WeakMap,$={ancestor(e,t){var r=$.get(e,t);if(G.isText(r))throw new Error("Cannot get the ancestor node at path [".concat(t,"] because it refers to a text node instead: ").concat(Fe.stringify(r)));return r},*ancestors(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(var n of D.ancestors(t,r)){var i=$.ancestor(e,n),a=[i,n];yield a}},child(e,t){if(G.isText(e))throw new Error("Cannot get the child of a text node: ".concat(Fe.stringify(e)));var r=e.children[t];if(r==null)throw new Error("Cannot get child at index `".concat(t,"` in node: ").concat(Fe.stringify(e)));return r},*children(e,t){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{reverse:n=!1}=r,i=$.ancestor(e,t),{children:a}=i,s=n?a.length-1:0;n?s>=0:s<a.length;){var o=$.child(i,s),c=t.concat(s);yield[o,c],s=n?s-1:s+1}},common(e,t,r){var n=D.common(t,r),i=$.get(e,n);return[i,n]},descendant(e,t){var r=$.get(e,t);if(p.isEditor(r))throw new Error("Cannot get the descendant node at path [".concat(t,"] because it refers to the root editor node instead: ").concat(Fe.stringify(r)));return r},*descendants(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var[r,n]of $.nodes(e,t))n.length!==0&&(yield[r,n])},*elements(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var[r,n]of $.nodes(e,t))le.isElement(r)&&(yield[r,n])},extractProps(e){if(le.isAncestor(e)){var t=wt(e,Md);return t}else{var t=wt(e,jd);return t}},first(e,t){for(var r=t.slice(),n=$.get(e,r);n&&!(G.isText(n)||n.children.length===0);)n=n.children[0],r.push(0);return[n,r]},fragment(e,t){if(G.isText(e))throw new Error("Cannot get a fragment starting from a root text node: ".concat(Fe.stringify(e)));var r=bi({children:e.children},n=>{var[i,a]=w.edges(t),s=$.nodes(n,{reverse:!0,pass:h=>{var[,f]=h;return!w.includes(t,f)}});for(var[,o]of s){if(!w.includes(t,o)){var c=$.parent(n,o),u=o[o.length-1];c.children.splice(u,1)}if(D.equals(o,a.path)){var l=$.leaf(n,o);l.text=l.text.slice(0,a.offset)}if(D.equals(o,i.path)){var d=$.leaf(n,o);d.text=d.text.slice(i.offset)}}p.isEditor(n)&&(n.selection=null)});return r.children},get(e,t){for(var r=e,n=0;n<t.length;n++){var i=t[n];if(G.isText(r)||!r.children[i])throw new Error("Cannot find a descendant at path [".concat(t,"] in node: ").concat(Fe.stringify(e)));r=r.children[i]}return r},has(e,t){for(var r=e,n=0;n<t.length;n++){var i=t[n];if(G.isText(r)||!r.children[i])return!1;r=r.children[i]}return!0},isNode(e){return G.isText(e)||le.isElement(e)||p.isEditor(e)},isNodeList(e){if(!Array.isArray(e))return!1;var t=_o.get(e);if(t!==void 0)return t;var r=e.every(n=>$.isNode(n));return _o.set(e,r),r},last(e,t){for(var r=t.slice(),n=$.get(e,r);n&&!(G.isText(n)||n.children.length===0);){var i=n.children.length-1;n=n.children[i],r.push(i)}return[n,r]},leaf(e,t){var r=$.get(e,t);if(!G.isText(r))throw new Error("Cannot get the leaf node at path [".concat(t,"] because it refers to a non-leaf node: ").concat(Fe.stringify(r)));return r},*levels(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(var n of D.levels(t,r)){var i=$.get(e,n);yield[i,n]}},matches(e,t){return le.isElement(e)&&le.isElementProps(t)&&le.matches(e,t)||G.isText(e)&&G.isTextProps(t)&&G.matches(e,t)},*nodes(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{pass:r,reverse:n=!1}=t,{from:i=[],to:a}=t,s=new Set,o=[],c=e;!(a&&(n?D.isBefore(o,a):D.isAfter(o,a)));){if(s.has(c)||(yield[c,o]),!s.has(c)&&!G.isText(c)&&c.children.length!==0&&(r==null||r([c,o])===!1)){s.add(c);var u=n?c.children.length-1:0;D.isAncestor(o,i)&&(u=i[o.length]),o=o.concat(u),c=$.get(e,o);continue}if(o.length===0)break;if(!n){var l=D.next(o);if($.has(e,l)){o=l,c=$.get(e,o);continue}}if(n&&o[o.length-1]!==0){var d=D.previous(o);o=d,c=$.get(e,o);continue}o=D.parent(o),c=$.get(e,o),s.add(c)}},parent(e,t){var r=D.parent(t),n=$.get(e,r);if(G.isText(n))throw new Error("Cannot get the parent of path [".concat(t,"] because it does not exist in the root."));return n},string(e){return G.isText(e)?e.text:e.children.map($.string).join("")},*texts(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var[r,n]of $.nodes(e,t))G.isText(r)&&(yield[r,n])}};function Ao(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function me(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ao(Object(r),!0).forEach(function(n){yt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ao(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var qr={isNodeOperation(e){return qr.isOperation(e)&&e.type.endsWith("_node")},isOperation(e){if(!Ie(e))return!1;switch(e.type){case"insert_node":return D.isPath(e.path)&&$.isNode(e.node);case"insert_text":return typeof e.offset=="number"&&typeof e.text=="string"&&D.isPath(e.path);case"merge_node":return typeof e.position=="number"&&D.isPath(e.path)&&Ie(e.properties);case"move_node":return D.isPath(e.path)&&D.isPath(e.newPath);case"remove_node":return D.isPath(e.path)&&$.isNode(e.node);case"remove_text":return typeof e.offset=="number"&&typeof e.text=="string"&&D.isPath(e.path);case"set_node":return D.isPath(e.path)&&Ie(e.properties)&&Ie(e.newProperties);case"set_selection":return e.properties===null&&w.isRange(e.newProperties)||e.newProperties===null&&w.isRange(e.properties)||Ie(e.properties)&&Ie(e.newProperties);case"split_node":return D.isPath(e.path)&&typeof e.position=="number"&&Ie(e.properties);default:return!1}},isOperationList(e){return Array.isArray(e)&&e.every(t=>qr.isOperation(t))},isSelectionOperation(e){return qr.isOperation(e)&&e.type.endsWith("_selection")},isTextOperation(e){return qr.isOperation(e)&&e.type.endsWith("_text")},inverse(e){switch(e.type){case"insert_node":return me(me({},e),{},{type:"remove_node"});case"insert_text":return me(me({},e),{},{type:"remove_text"});case"merge_node":return me(me({},e),{},{type:"split_node",path:D.previous(e.path)});case"move_node":{var{newPath:t,path:r}=e;if(D.equals(t,r))return e;if(D.isSibling(r,t))return me(me({},e),{},{path:t,newPath:r});var n=D.transform(r,e),i=D.transform(D.next(r),e);return me(me({},e),{},{path:n,newPath:i})}case"remove_node":return me(me({},e),{},{type:"insert_node"});case"remove_text":return me(me({},e),{},{type:"insert_text"});case"set_node":{var{properties:a,newProperties:s}=e;return me(me({},e),{},{properties:s,newProperties:a})}case"set_selection":{var{properties:o,newProperties:c}=e;return o==null?me(me({},e),{},{properties:c,newProperties:null}):c==null?me(me({},e),{},{properties:null,newProperties:o}):me(me({},e),{},{properties:c,newProperties:o})}case"split_node":return me(me({},e),{},{type:"merge_node",path:D.next(e.path)})}}},D={ancestors(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{reverse:r=!1}=t,n=D.levels(e,t);return r?n=n.slice(1):n=n.slice(0,-1),n},common(e,t){for(var r=[],n=0;n<e.length&&n<t.length;n++){var i=e[n],a=t[n];if(i!==a)break;r.push(i)}return r},compare(e,t){for(var r=Math.min(e.length,t.length),n=0;n<r;n++){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1}return 0},endsAfter(e,t){var r=e.length-1,n=e.slice(0,r),i=t.slice(0,r),a=e[r],s=t[r];return D.equals(n,i)&&a>s},endsAt(e,t){var r=e.length,n=e.slice(0,r),i=t.slice(0,r);return D.equals(n,i)},endsBefore(e,t){var r=e.length-1,n=e.slice(0,r),i=t.slice(0,r),a=e[r],s=t[r];return D.equals(n,i)&&a<s},equals(e,t){return e.length===t.length&&e.every((r,n)=>r===t[n])},hasPrevious(e){return e[e.length-1]>0},isAfter(e,t){return D.compare(e,t)===1},isAncestor(e,t){return e.length<t.length&&D.compare(e,t)===0},isBefore(e,t){return D.compare(e,t)===-1},isChild(e,t){return e.length===t.length+1&&D.compare(e,t)===0},isCommon(e,t){return e.length<=t.length&&D.compare(e,t)===0},isDescendant(e,t){return e.length>t.length&&D.compare(e,t)===0},isParent(e,t){return e.length+1===t.length&&D.compare(e,t)===0},isPath(e){return Array.isArray(e)&&(e.length===0||typeof e[0]=="number")},isSibling(e,t){if(e.length!==t.length)return!1;var r=e.slice(0,-1),n=t.slice(0,-1),i=e[e.length-1],a=t[t.length-1];return i!==a&&D.equals(r,n)},levels(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{reverse:r=!1}=t,n=[],i=0;i<=e.length;i++)n.push(e.slice(0,i));return r&&n.reverse(),n},next(e){if(e.length===0)throw new Error("Cannot get the next path of a root path [".concat(e,"], because it has no next index."));var t=e[e.length-1];return e.slice(0,-1).concat(t+1)},operationCanTransformPath(e){switch(e.type){case"insert_node":case"remove_node":case"merge_node":case"split_node":case"move_node":return!0;default:return!1}},parent(e){if(e.length===0)throw new Error("Cannot get the parent path of the root path [".concat(e,"]."));return e.slice(0,-1)},previous(e){if(e.length===0)throw new Error("Cannot get the previous path of a root path [".concat(e,"], because it has no previous index."));var t=e[e.length-1];if(t<=0)throw new Error("Cannot get the previous path of a first child path [".concat(e,"] because it would result in a negative index."));return e.slice(0,-1).concat(t-1)},relative(e,t){if(!D.isAncestor(t,e)&&!D.equals(e,t))throw new Error("Cannot get the relative path of [".concat(e,"] inside ancestor [").concat(t,"], because it is not above or equal to the path."));return e.slice(t.length)},transform(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return bi(e,n=>{var{affinity:i="forward"}=r;if(!(!e||e?.length===0)){if(n===null)return null;switch(t.type){case"insert_node":{var{path:a}=t;(D.equals(a,n)||D.endsBefore(a,n)||D.isAncestor(a,n))&&(n[a.length-1]+=1);break}case"remove_node":{var{path:s}=t;if(D.equals(s,n)||D.isAncestor(s,n))return null;D.endsBefore(s,n)&&(n[s.length-1]-=1);break}case"merge_node":{var{path:o,position:c}=t;D.equals(o,n)||D.endsBefore(o,n)?n[o.length-1]-=1:D.isAncestor(o,n)&&(n[o.length-1]-=1,n[o.length]+=c);break}case"split_node":{var{path:u,position:l}=t;if(D.equals(u,n)){if(i==="forward")n[n.length-1]+=1;else if(i!=="backward")return null}else D.endsBefore(u,n)?n[u.length-1]+=1:D.isAncestor(u,n)&&e[u.length]>=l&&(n[u.length-1]+=1,n[u.length]-=l);break}case"move_node":{var{path:d,newPath:h}=t;if(D.equals(d,h))return;if(D.isAncestor(d,n)||D.equals(d,n)){var f=h.slice();return D.endsBefore(d,h)&&d.length<h.length&&(f[d.length-1]-=1),f.concat(n.slice(d.length))}else D.isSibling(d,h)&&(D.isAncestor(h,n)||D.equals(h,n))?D.endsBefore(d,n)?n[d.length-1]-=1:n[d.length-1]+=1:D.endsBefore(h,n)||D.equals(h,n)||D.isAncestor(h,n)?(D.endsBefore(d,n)&&(n[d.length-1]-=1),n[h.length-1]+=1):D.endsBefore(d,n)&&(D.equals(h,n)&&(n[h.length-1]+=1),n[d.length-1]-=1);break}}}})}},Ld={transform(e,t){var{current:r,affinity:n}=e;if(r!=null){var i=D.transform(r,t,{affinity:n});e.current=i,i==null&&e.unref()}}};function wo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function ko(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?wo(Object(r),!0).forEach(function(n){yt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var se={compare(e,t){var r=D.compare(e.path,t.path);return r===0?e.offset<t.offset?-1:e.offset>t.offset?1:0:r},isAfter(e,t){return se.compare(e,t)===1},isBefore(e,t){return se.compare(e,t)===-1},equals(e,t){return e.offset===t.offset&&D.equals(e.path,t.path)},isPoint(e){return Ie(e)&&typeof e.offset=="number"&&D.isPath(e.path)},transform(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return bi(e,n=>{if(n===null)return null;var{affinity:i="forward"}=r,{path:a,offset:s}=n;switch(t.type){case"insert_node":case"move_node":{n.path=D.transform(a,t,r);break}case"insert_text":{D.equals(t.path,a)&&(t.offset<s||t.offset===s&&i==="forward")&&(n.offset+=t.text.length);break}case"merge_node":{D.equals(t.path,a)&&(n.offset+=t.position),n.path=D.transform(a,t,r);break}case"remove_text":{D.equals(t.path,a)&&t.offset<=s&&(n.offset-=Math.min(s-t.offset,t.text.length));break}case"remove_node":{if(D.equals(t.path,a)||D.isAncestor(t.path,a))return null;n.path=D.transform(a,t,r);break}case"split_node":{if(D.equals(t.path,a)){if(t.position===s&&i==null)return null;(t.position<s||t.position===s&&i==="forward")&&(n.offset-=t.position,n.path=D.transform(a,t,ko(ko({},r),{},{affinity:"forward"})))}else n.path=D.transform(a,t,r);break}}})}},Nd={transform(e,t){var{current:r,affinity:n}=e;if(r!=null){var i=se.transform(r,t,{affinity:n});e.current=i,i==null&&e.unref()}}},Ud=["anchor","focus"];function Fo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function zd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Fo(Object(r),!0).forEach(function(n){yt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var w={edges(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{reverse:r=!1}=t,{anchor:n,focus:i}=e;return w.isBackward(e)===r?[n,i]:[i,n]},end(e){var[,t]=w.edges(e);return t},equals(e,t){return se.equals(e.anchor,t.anchor)&&se.equals(e.focus,t.focus)},includes(e,t){if(w.isRange(t)){if(w.includes(e,t.anchor)||w.includes(e,t.focus))return!0;var[r,n]=w.edges(e),[i,a]=w.edges(t);return se.isBefore(r,i)&&se.isAfter(n,a)}var[s,o]=w.edges(e),c=!1,u=!1;return se.isPoint(t)?(c=se.compare(t,s)>=0,u=se.compare(t,o)<=0):(c=D.compare(t,s.path)>=0,u=D.compare(t,o.path)<=0),c&&u},intersection(e,t){var r=wt(e,Ud),[n,i]=w.edges(e),[a,s]=w.edges(t),o=se.isBefore(n,a)?a:n,c=se.isBefore(i,s)?i:s;return se.isBefore(c,o)?null:zd({anchor:o,focus:c},r)},isBackward(e){var{anchor:t,focus:r}=e;return se.isAfter(t,r)},isCollapsed(e){var{anchor:t,focus:r}=e;return se.equals(t,r)},isExpanded(e){return!w.isCollapsed(e)},isForward(e){return!w.isBackward(e)},isRange(e){return Ie(e)&&se.isPoint(e.anchor)&&se.isPoint(e.focus)},*points(e){yield[e.anchor,"anchor"],yield[e.focus,"focus"]},start(e){var[t]=w.edges(e);return t},transform(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return bi(e,n=>{if(n===null)return null;var{affinity:i="inward"}=r,a,s;if(i==="inward"){var o=w.isCollapsed(n);w.isForward(n)?(a="forward",s=o?a:"backward"):(a="backward",s=o?a:"forward")}else i==="outward"?w.isForward(n)?(a="backward",s="forward"):(a="forward",s="backward"):(a=i,s=i);var c=se.transform(n.anchor,t,{affinity:a}),u=se.transform(n.focus,t,{affinity:s});if(!c||!u)return null;n.anchor=c,n.focus=u})}},$d={transform(e,t){var{current:r,affinity:n}=e;if(r!=null){var i=w.transform(r,t,{affinity:n});e.current=i,i==null&&e.unref()}}},To=void 0,Fe={setScrubber(e){To=e},stringify(e){return JSON.stringify(e,To)}},nc=(e,t)=>{for(var r in e){var n=e[r],i=t[r];if(Ie(n)&&Ie(i)){if(!nc(n,i))return!1}else if(Array.isArray(n)&&Array.isArray(i)){if(n.length!==i.length)return!1;for(var a=0;a<n.length;a++)if(n[a]!==i[a])return!1}else if(n!==i)return!1}for(var s in t)if(e[s]===void 0&&t[s]!==void 0)return!1;return!0},Wd=["text"],Vd=["anchor","focus"];function Oo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function bt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Oo(Object(r),!0).forEach(function(n){yt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Oo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var G={equals(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{loose:n=!1}=r;function i(a){var s=wt(a,Wd);return s}return nc(n?i(e):e,n?i(t):t)},isText(e){return Ie(e)&&typeof e.text=="string"},isTextList(e){return Array.isArray(e)&&e.every(t=>G.isText(t))},isTextProps(e){return e.text!==void 0},matches(e,t){for(var r in t)if(r!=="text"&&(!e.hasOwnProperty(r)||e[r]!==t[r]))return!1;return!0},decorations(e,t){var r=[bt({},e)];for(var n of t){var i=wt(n,Vd),[a,s]=w.edges(n),o=[],c=0,u=a.offset,l=s.offset;for(var d of r){var{length:h}=d.text,f=c;if(c+=h,u<=f&&c<=l){Object.assign(d,i),o.push(d);continue}if(u!==l&&(u===c||l===f)||u>c||l<f||l===f&&f!==0){o.push(d);continue}var g=d,y=void 0,E=void 0;if(l<c){var A=l-f;E=bt(bt({},g),{},{text:g.text.slice(A)}),g=bt(bt({},g),{},{text:g.text.slice(0,A)})}if(u>f){var v=u-f;y=bt(bt({},g),{},{text:g.text.slice(0,v)}),g=bt(bt({},g),{},{text:g.text.slice(v)})}Object.assign(g,i),y&&o.push(y),o.push(g),E&&o.push(E)}r=o}return r}};function xo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function zr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xo(Object(r),!0).forEach(function(n){yt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Gd=(e,t,r)=>{switch(r.type){case"insert_node":{var{path:n,node:i}=r,a=$.parent(e,n),s=n[n.length-1];if(s>a.children.length)throw new Error('Cannot apply an "insert_node" operation at path ['.concat(n,"] because the destination is past the end of the node."));if(a.children.splice(s,0,i),t)for(var[o,c]of w.points(t))t[c]=se.transform(o,r);break}case"insert_text":{var{path:u,offset:l,text:d}=r;if(d.length===0)break;var h=$.leaf(e,u),f=h.text.slice(0,l),g=h.text.slice(l);if(h.text=f+d+g,t)for(var[y,E]of w.points(t))t[E]=se.transform(y,r);break}case"merge_node":{var{path:A}=r,v=$.get(e,A),m=D.previous(A),b=$.get(e,m),C=$.parent(e,A),_=A[A.length-1];if(G.isText(v)&&G.isText(b))b.text+=v.text;else if(!G.isText(v)&&!G.isText(b))b.children.push(...v.children);else throw new Error('Cannot apply a "merge_node" operation at path ['.concat(A,"] to nodes of different interfaces: ").concat(Fe.stringify(v)," ").concat(Fe.stringify(b)));if(C.children.splice(_,1),t)for(var[P,S]of w.points(t))t[S]=se.transform(P,r);break}case"move_node":{var{path:L,newPath:H}=r;if(D.isAncestor(L,H))throw new Error("Cannot move a path [".concat(L,"] to new path [").concat(H,"] because the destination is inside itself."));var j=$.get(e,L),T=$.parent(e,L),V=L[L.length-1];T.children.splice(V,1);var W=D.transform(L,r),k=$.get(e,D.parent(W)),Y=W[W.length-1];if(k.children.splice(Y,0,j),t)for(var[B,F]of w.points(t))t[F]=se.transform(B,r);break}case"remove_node":{var{path:R}=r,M=R[R.length-1],J=$.parent(e,R);if(J.children.splice(M,1),t)for(var[ee,X]of w.points(t)){var Z=se.transform(ee,r);if(t!=null&&Z!=null)t[X]=Z;else{var re=void 0,oe=void 0;for(var[ue,z]of $.texts(e))if(D.compare(z,R)===-1)re=[ue,z];else{oe=[ue,z];break}var x=!1;re&&oe&&(D.equals(oe[1],R)?x=!D.hasPrevious(oe[1]):x=D.common(re[1],R).length<D.common(oe[1],R).length),re&&!x?(ee.path=re[1],ee.offset=re[0].text.length):oe?(ee.path=oe[1],ee.offset=0):t=null}}break}case"remove_text":{var{path:N,offset:q,text:ae}=r;if(ae.length===0)break;var Q=$.leaf(e,N),de=Q.text.slice(0,q),De=Q.text.slice(q+ae.length);if(Q.text=de+De,t)for(var[Ae,Ke]of w.points(t))t[Ke]=se.transform(Ae,r);break}case"set_node":{var{path:Ht,properties:Be,newProperties:xt}=r;if(Ht.length===0)throw new Error("Cannot set properties on the root node!");var Lr=$.get(e,Ht);for(var gr in xt){if(gr==="children"||gr==="text")throw new Error('Cannot set the "'.concat(gr,'" property of nodes!'));var Js=xt[gr];Js==null?delete Lr[gr]:Lr[gr]=Js}for(var Xs in Be)xt.hasOwnProperty(Xs)||delete Lr[Xs];break}case"set_selection":{var{newProperties:Kt}=r;if(Kt==null)t=Kt;else{if(t==null){if(!w.isRange(Kt))throw new Error('Cannot apply an incomplete "set_selection" operation properties '.concat(Fe.stringify(Kt)," when there is no current selection."));t=zr({},Kt)}for(var mr in Kt){var Zs=Kt[mr];if(Zs==null){if(mr==="anchor"||mr==="focus")throw new Error('Cannot remove the "'.concat(mr,'" selection property'));delete t[mr]}else t[mr]=Zs}}break}case"split_node":{var{path:yr,position:An,properties:Qs}=r;if(yr.length===0)throw new Error('Cannot apply a "split_node" operation at path ['.concat(yr,"] because the root node cannot be split."));var Yt=$.get(e,yr),kf=$.parent(e,yr),Ff=yr[yr.length-1],zi;if(G.isText(Yt)){var Tf=Yt.text.slice(0,An),Of=Yt.text.slice(An);Yt.text=Tf,zi=zr(zr({},Qs),{},{text:Of})}else{var xf=Yt.children.slice(0,An),Pf=Yt.children.slice(An);Yt.children=xf,zi=zr(zr({},Qs),{},{children:Pf})}if(kf.children.splice(Ff+1,0,zi),t)for(var[Rf,If]of w.points(t))t[If]=se.transform(Rf,r);break}}return t},qd={transform(e,t){e.children=po(e.children);var r=e.selection&&po(e.selection);try{r=Gd(e,r,t)}finally{e.children=vo(e.children),r?e.selection=or(r)?vo(r):r:e.selection=null}}},Hd=["text"],Kd=["children"];function Po(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Ro(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Po(Object(r),!0).forEach(function(n){yt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Po(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Yd={insertNodes(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};p.withoutNormalizing(e,()=>{var{hanging:n=!1,voids:i=!1,mode:a="lowest"}=r,{at:s,match:o,select:c}=r;if($.isNode(t)&&(t=[t]),t.length!==0){var[u]=t;if(s||(e.selection?s=e.selection:e.children.length>0?s=p.end(e,[]):s=[0],c=!0),c==null&&(c=!1),w.isRange(s))if(n||(s=p.unhangRange(e,s)),w.isCollapsed(s))s=s.anchor;else{var[,l]=w.edges(s),d=p.pointRef(e,l);O.delete(e,{at:s}),s=d.unref()}if(se.isPoint(s)){o==null&&(G.isText(u)?o=_=>G.isText(_):e.isInline(u)?o=_=>G.isText(_)||p.isInline(e,_):o=_=>p.isBlock(e,_));var[h]=p.nodes(e,{at:s.path,match:o,mode:a,voids:i});if(h){var[,f]=h,g=p.pathRef(e,f),y=p.isEnd(e,s,f);O.splitNodes(e,{at:s,match:o,mode:a,voids:i});var E=g.unref();s=y?D.next(E):E}else return}var A=D.parent(s),v=s[s.length-1];if(!(!i&&p.void(e,{at:A}))){for(var m of t){var b=A.concat(v);v++,e.apply({type:"insert_node",path:b,node:m}),s=D.next(s)}if(s=D.previous(s),c){var C=p.end(e,s);C&&O.select(e,C)}}}})},liftNodes(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};p.withoutNormalizing(e,()=>{var{at:r=e.selection,mode:n="lowest",voids:i=!1}=t,{match:a}=t;if(a==null&&(a=D.isPath(r)?Dr(e,r):m=>p.isBlock(e,m)),!!r){var s=p.nodes(e,{at:r,match:a,mode:n,voids:i}),o=Array.from(s,m=>{var[,b]=m;return p.pathRef(e,b)});for(var c of o){var u=c.unref();if(u.length<2)throw new Error("Cannot lift node at a path [".concat(u,"] because it has a depth of less than `2`."));var l=p.node(e,D.parent(u)),[d,h]=l,f=u[u.length-1],{length:g}=d.children;if(g===1){var y=D.next(h);O.moveNodes(e,{at:u,to:y,voids:i}),O.removeNodes(e,{at:h,voids:i})}else if(f===0)O.moveNodes(e,{at:u,to:h,voids:i});else if(f===g-1){var E=D.next(h);O.moveNodes(e,{at:u,to:E,voids:i})}else{var A=D.next(u),v=D.next(h);O.splitNodes(e,{at:A,voids:i}),O.moveNodes(e,{at:u,to:v,voids:i})}}}})},mergeNodes(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};p.withoutNormalizing(e,()=>{var{match:r,at:n=e.selection}=t,{hanging:i=!1,voids:a=!1,mode:s="lowest"}=t;if(!!n){if(r==null)if(D.isPath(n)){var[o]=p.parent(e,n);r=L=>o.children.includes(L)}else r=L=>p.isBlock(e,L);if(!i&&w.isRange(n)&&(n=p.unhangRange(e,n)),w.isRange(n))if(w.isCollapsed(n))n=n.anchor;else{var[,c]=w.edges(n),u=p.pointRef(e,c);O.delete(e,{at:n}),n=u.unref(),t.at==null&&O.select(e,n)}var[l]=p.nodes(e,{at:n,match:r,voids:a,mode:s}),d=p.previous(e,{at:n,match:r,voids:a,mode:s});if(!(!l||!d)){var[h,f]=l,[g,y]=d;if(!(f.length===0||y.length===0)){var E=D.next(y),A=D.common(f,y),v=D.isSibling(f,y),m=Array.from(p.levels(e,{at:f}),L=>{var[H]=L;return H}).slice(A.length).slice(0,-1),b=p.above(e,{at:f,mode:"highest",match:L=>m.includes(L)&&ic(e,L)}),C=b&&p.pathRef(e,b[1]),_,P;if(G.isText(h)&&G.isText(g)){var S=wt(h,Hd);P=g.text.length,_=S}else if(le.isElement(h)&&le.isElement(g)){var S=wt(h,Kd);P=g.children.length,_=S}else throw new Error("Cannot merge the node at path [".concat(f,"] with the previous sibling because it is not the same kind: ").concat(Fe.stringify(h)," ").concat(Fe.stringify(g)));v||O.moveNodes(e,{at:f,to:E,voids:a}),C&&O.removeNodes(e,{at:C.current,voids:a}),le.isElement(g)&&p.isEmpty(e,g)||G.isText(g)&&g.text===""&&y[y.length-1]!==0?O.removeNodes(e,{at:y,voids:a}):e.apply({type:"merge_node",path:E,position:P,properties:_}),C&&C.unref()}}}})},moveNodes(e,t){p.withoutNormalizing(e,()=>{var{to:r,at:n=e.selection,mode:i="lowest",voids:a=!1}=t,{match:s}=t;if(!!n){s==null&&(s=D.isPath(n)?Dr(e,n):f=>p.isBlock(e,f));var o=p.pathRef(e,r),c=p.nodes(e,{at:n,match:s,mode:i,voids:a}),u=Array.from(c,f=>{var[,g]=f;return p.pathRef(e,g)});for(var l of u){var d=l.unref(),h=o.current;d.length!==0&&e.apply({type:"move_node",path:d,newPath:h}),o.current&&D.isSibling(h,d)&&D.isAfter(h,d)&&(o.current=D.next(o.current))}o.unref()}})},removeNodes(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};p.withoutNormalizing(e,()=>{var{hanging:r=!1,voids:n=!1,mode:i="lowest"}=t,{at:a=e.selection,match:s}=t;if(!!a){s==null&&(s=D.isPath(a)?Dr(e,a):h=>p.isBlock(e,h)),!r&&w.isRange(a)&&(a=p.unhangRange(e,a));var o=p.nodes(e,{at:a,match:s,mode:i,voids:n}),c=Array.from(o,h=>{var[,f]=h;return p.pathRef(e,f)});for(var u of c){var l=u.unref();if(l){var[d]=p.node(e,l);e.apply({type:"remove_node",path:l,node:d})}}}})},setNodes(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};p.withoutNormalizing(e,()=>{var{match:n,at:i=e.selection,compare:a,merge:s}=r,{hanging:o=!1,mode:c="lowest",split:u=!1,voids:l=!1}=r;if(!!i){if(n==null&&(n=D.isPath(i)?Dr(e,i):P=>p.isBlock(e,P)),!o&&w.isRange(i)&&(i=p.unhangRange(e,i)),u&&w.isRange(i)){if(w.isCollapsed(i)&&p.leaf(e,i.anchor)[0].text.length>0)return;var d=p.rangeRef(e,i,{affinity:"inward"}),[h,f]=w.edges(i),g=c==="lowest"?"lowest":"highest",y=p.isEnd(e,f,f.path);O.splitNodes(e,{at:f,match:n,mode:g,voids:l,always:!y});var E=p.isStart(e,h,h.path);O.splitNodes(e,{at:h,match:n,mode:g,voids:l,always:!E}),i=d.unref(),r.at==null&&O.select(e,i)}a||(a=(P,S)=>P!==S);for(var[A,v]of p.nodes(e,{at:i,match:n,mode:c,voids:l})){var m={},b={};if(v.length!==0){var C=!1;for(var _ in t)_==="children"||_==="text"||a(t[_],A[_])&&(C=!0,A.hasOwnProperty(_)&&(m[_]=A[_]),s?t[_]!=null&&(b[_]=s(A[_],t[_])):t[_]!=null&&(b[_]=t[_]));C&&e.apply({type:"set_node",path:v,properties:m,newProperties:b})}}}})},splitNodes(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};p.withoutNormalizing(e,()=>{var{mode:r="lowest",voids:n=!1}=t,{match:i,at:a=e.selection,height:s=0,always:o=!1}=t;if(i==null&&(i=F=>p.isBlock(e,F)),w.isRange(a)&&(a=Jd(e,a)),D.isPath(a)){var c=a,u=p.point(e,c),[l]=p.parent(e,c);i=F=>F===l,s=u.path.length-c.length+1,a=u,o=!0}if(!!a){var d=p.pointRef(e,a,{affinity:"backward"}),h;try{var[f]=p.nodes(e,{at:a,match:i,mode:r,voids:n});if(!f)return;var g=p.void(e,{at:a,mode:"highest"}),y=0;if(!n&&g){var[E,A]=g;if(le.isElement(E)&&e.isInline(E)){var v=p.after(e,A);if(!v){var m={text:""},b=D.next(A);O.insertNodes(e,m,{at:b,voids:n}),v=p.point(e,b)}a=v,o=!0}var C=a.path.length-A.length;s=C+1,o=!0}h=p.pointRef(e,a);var _=a.path.length-s,[,P]=f,S=a.path.slice(0,_),L=s===0?a.offset:a.path[_]+y;for(var[H,j]of p.levels(e,{at:S,reverse:!0,voids:n})){var T=!1;if(j.length<P.length||j.length===0||!n&&p.isVoid(e,H))break;var V=d.current,W=p.isEnd(e,V,j);if(o||!d||!p.isEdge(e,V,j)){T=!0;var k=$.extractProps(H);e.apply({type:"split_node",path:j,position:L,properties:k})}L=j[j.length-1]+(T||W?1:0)}if(t.at==null){var Y=h.current||p.end(e,[]);O.select(e,Y)}}finally{var B;d.unref(),(B=h)===null||B===void 0||B.unref()}}})},unsetNodes(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Array.isArray(t)||(t=[t]);var n={};for(var i of t)n[i]=null;O.setNodes(e,n,r)},unwrapNodes(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};p.withoutNormalizing(e,()=>{var{mode:r="lowest",split:n=!1,voids:i=!1}=t,{at:a=e.selection,match:s}=t;if(!!a){s==null&&(s=D.isPath(a)?Dr(e,a):h=>p.isBlock(e,h)),D.isPath(a)&&(a=p.range(e,a));var o=w.isRange(a)?p.rangeRef(e,a):null,c=p.nodes(e,{at:a,match:s,mode:r,voids:i}),u=Array.from(c,h=>{var[,f]=h;return p.pathRef(e,f)}).reverse(),l=function(f){var g=f.unref(),[y]=p.node(e,g),E=p.range(e,g);n&&o&&(E=w.intersection(o.current,E)),O.liftNodes(e,{at:E,match:A=>le.isAncestor(y)&&y.children.includes(A),voids:i})};for(var d of u)l(d);o&&o.unref()}})},wrapNodes(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};p.withoutNormalizing(e,()=>{var{mode:n="lowest",split:i=!1,voids:a=!1}=r,{match:s,at:o=e.selection}=r;if(!!o){if(s==null&&(D.isPath(o)?s=Dr(e,o):e.isInline(t)?s=E=>p.isInline(e,E)||G.isText(E):s=E=>p.isBlock(e,E)),i&&w.isRange(o)){var[c,u]=w.edges(o),l=p.rangeRef(e,o,{affinity:"inward"});O.splitNodes(e,{at:u,match:s,voids:a}),O.splitNodes(e,{at:c,match:s,voids:a}),o=l.unref(),r.at==null&&O.select(e,o)}var d=Array.from(p.nodes(e,{at:o,match:e.isInline(t)?E=>p.isBlock(e,E):E=>p.isEditor(E),mode:"lowest",voids:a}));for(var[,h]of d){var f=w.isRange(o)?w.intersection(o,p.range(e,h)):o;if(!!f){var g=Array.from(p.nodes(e,{at:f,match:s,mode:n,voids:a}));if(g.length>0){var y=function(){var[E]=g,A=g[g.length-1],[,v]=E,[,m]=A;if(v.length===0&&m.length===0)return"continue";var b=D.equals(v,m)?D.parent(v):D.common(v,m),C=p.range(e,v,m),_=p.node(e,b),[P]=_,S=b.length+1,L=D.next(m.slice(0,S)),H=Ro(Ro({},t),{},{children:[]});O.insertNodes(e,H,{at:L,voids:a}),O.moveNodes(e,{at:C,match:j=>le.isAncestor(P)&&P.children.includes(j),to:L.concat(0),voids:a})}();if(y==="continue")continue}}}}})}},ic=(e,t)=>{if(le.isElement(t)){var r=t;return p.isVoid(e,t)?!0:r.children.length===1?ic(e,r.children[0]):!1}else return!p.isEditor(t)},Jd=(e,t)=>{if(w.isCollapsed(t))return t.anchor;var[,r]=w.edges(t),n=p.pointRef(e,r);return O.delete(e,{at:t}),n.unref()},Dr=(e,t)=>{var[r]=p.node(e,t);return n=>n===r};function Io(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Mo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Io(Object(r),!0).forEach(function(n){yt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Io(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Xd={collapse(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{edge:r="anchor"}=t,{selection:n}=e;if(n){if(r==="anchor")O.select(e,n.anchor);else if(r==="focus")O.select(e,n.focus);else if(r==="start"){var[i]=w.edges(n);O.select(e,i)}else if(r==="end"){var[,a]=w.edges(n);O.select(e,a)}}else return},deselect(e){var{selection:t}=e;t&&e.apply({type:"set_selection",properties:t,newProperties:null})},move(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{selection:r}=e,{distance:n=1,unit:i="character",reverse:a=!1}=t,{edge:s=null}=t;if(!!r){s==="start"&&(s=w.isBackward(r)?"focus":"anchor"),s==="end"&&(s=w.isBackward(r)?"anchor":"focus");var{anchor:o,focus:c}=r,u={distance:n,unit:i},l={};if(s==null||s==="anchor"){var d=a?p.before(e,o,u):p.after(e,o,u);d&&(l.anchor=d)}if(s==null||s==="focus"){var h=a?p.before(e,c,u):p.after(e,c,u);h&&(l.focus=h)}O.setSelection(e,l)}},select(e,t){var{selection:r}=e;if(t=p.range(e,t),r){O.setSelection(e,t);return}if(!w.isRange(t))throw new Error("When setting the selection and the current selection is `null` you must provide at least an `anchor` and `focus`, but you passed: ".concat(Fe.stringify(t)));e.apply({type:"set_selection",properties:r,newProperties:t})},setPoint(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{selection:n}=e,{edge:i="both"}=r;if(!!n){i==="start"&&(i=w.isBackward(n)?"focus":"anchor"),i==="end"&&(i=w.isBackward(n)?"anchor":"focus");var{anchor:a,focus:s}=n,o=i==="anchor"?a:s;O.setSelection(e,{[i==="anchor"?"anchor":"focus"]:Mo(Mo({},o),t)})}},setSelection(e,t){var{selection:r}=e,n={},i={};if(!!r){for(var a in t)(a==="anchor"&&t.anchor!=null&&!se.equals(t.anchor,r.anchor)||a==="focus"&&t.focus!=null&&!se.equals(t.focus,r.focus)||a!=="anchor"&&a!=="focus"&&t[a]!==r[a])&&(n[a]=r[a],i[a]=t[a]);Object.keys(n).length>0&&e.apply({type:"set_selection",properties:n,newProperties:i})}}},Zd={delete(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};p.withoutNormalizing(e,()=>{var{reverse:r=!1,unit:n="character",distance:i=1,voids:a=!1}=t,{at:s=e.selection,hanging:o=!1}=t;if(!!s){var c=!1;if(w.isRange(s)&&w.isCollapsed(s)&&(c=!0,s=s.anchor),se.isPoint(s)){var u=p.void(e,{at:s,mode:"highest"});if(!a&&u){var[,l]=u;s=l}else{var d={unit:n,distance:i},h=r?p.before(e,s,d)||p.start(e,[]):p.after(e,s,d)||p.end(e,[]);s={anchor:s,focus:h},o=!0}}if(D.isPath(s)){O.removeNodes(e,{at:s,voids:a});return}if(!w.isCollapsed(s)){if(!o){var[,f]=w.edges(s),g=p.end(e,[]);se.equals(f,g)||(s=p.unhangRange(e,s,{voids:a}))}var[y,E]=w.edges(s),A=p.above(e,{match:Q=>p.isBlock(e,Q),at:y,voids:a}),v=p.above(e,{match:Q=>p.isBlock(e,Q),at:E,voids:a}),m=A&&v&&!D.equals(A[1],v[1]),b=D.equals(y.path,E.path),C=a?null:p.void(e,{at:y,mode:"highest"}),_=a?null:p.void(e,{at:E,mode:"highest"});if(C){var P=p.before(e,y);P&&A&&D.isAncestor(A[1],P.path)&&(y=P)}if(_){var S=p.after(e,E);S&&v&&D.isAncestor(v[1],S.path)&&(E=S)}var L=[],H;for(var j of p.nodes(e,{at:s,voids:a})){var[T,V]=j;H&&D.compare(V,H)===0||(!a&&p.isVoid(e,T)||!D.isCommon(V,y.path)&&!D.isCommon(V,E.path))&&(L.push(j),H=V)}var W=Array.from(L,Q=>{var[,de]=Q;return p.pathRef(e,de)}),k=p.pointRef(e,y),Y=p.pointRef(e,E),B="";if(!b&&!C){var F=k.current,[R]=p.leaf(e,F),{path:M}=F,{offset:J}=y,ee=R.text.slice(J);ee.length>0&&(e.apply({type:"remove_text",path:M,offset:J,text:ee}),B=ee)}for(var X of W){var Z=X.unref();O.removeNodes(e,{at:Z,voids:a})}if(!_){var re=Y.current,[oe]=p.leaf(e,re),{path:ue}=re,z=b?y.offset:0,x=oe.text.slice(z,E.offset);x.length>0&&(e.apply({type:"remove_text",path:ue,offset:z,text:x}),B=x)}!b&&m&&Y.current&&k.current&&O.mergeNodes(e,{at:Y.current,hanging:!0,voids:a}),c&&r&&n==="character"&&B.length>1&&B.match(/[\u0E00-\u0E7F]+/)&&O.insertText(e,B.slice(0,B.length-i));var N=k.unref(),q=Y.unref(),ae=r?N||q:q||N;t.at==null&&ae&&O.select(e,ae)}}})},insertFragment(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};p.withoutNormalizing(e,()=>{var{hanging:n=!1,voids:i=!1}=r,{at:a=e.selection}=r;if(!!t.length){if(a)if(w.isRange(a))if(n||(a=p.unhangRange(e,a)),w.isCollapsed(a))a=a.anchor;else{var[,s]=w.edges(a);if(!i&&p.void(e,{at:s}))return;var o=p.pointRef(e,s);O.delete(e,{at:a}),a=o.unref()}else D.isPath(a)&&(a=p.start(e,a));else return;if(!(!i&&p.void(e,{at:a}))){var c=p.above(e,{at:a,match:X=>p.isInline(e,X),mode:"highest",voids:i});if(c){var[,u]=c;if(p.isEnd(e,a,u)){var l=p.after(e,u);a=l}else if(p.isStart(e,a,u)){var d=p.before(e,u);a=d}}var h=p.above(e,{match:X=>p.isBlock(e,X),at:a,voids:i}),[,f]=h,g=p.isStart(e,a,f),y=p.isEnd(e,a,f),E=g&&y,A=!g||g&&y,v=!y,[,m]=$.first({children:t},[]),[,b]=$.last({children:t},[]),C=[],_=X=>{var[Z,re]=X,oe=re.length===0;return oe?!1:E?!0:!(A&&D.isAncestor(re,m)&&le.isElement(Z)&&!e.isVoid(Z)&&!e.isInline(Z)||v&&D.isAncestor(re,b)&&le.isElement(Z)&&!e.isVoid(Z)&&!e.isInline(Z))};for(var P of $.nodes({children:t},{pass:_}))_(P)&&C.push(P);var S=[],L=[],H=[],j=!0,T=!1;for(var[V]of C)le.isElement(V)&&!e.isInline(V)?(j=!1,T=!0,L.push(V)):j?S.push(V):H.push(V);var[W]=p.nodes(e,{at:a,match:X=>G.isText(X)||p.isInline(e,X),mode:"highest",voids:i}),[,k]=W,Y=p.isStart(e,a,k),B=p.isEnd(e,a,k),F=p.pathRef(e,y&&!H.length?D.next(f):f),R=p.pathRef(e,B?D.next(k):k);O.splitNodes(e,{at:a,match:X=>T?p.isBlock(e,X):G.isText(X)||p.isInline(e,X),mode:T?"lowest":"highest",always:T&&(!g||S.length>0)&&(!y||H.length>0),voids:i});var M=p.pathRef(e,!Y||Y&&B?D.next(k):k);if(O.insertNodes(e,S,{at:M.current,match:X=>G.isText(X)||p.isInline(e,X),mode:"highest",voids:i}),E&&!S.length&&L.length&&!H.length&&O.delete(e,{at:f,voids:i}),O.insertNodes(e,L,{at:F.current,match:X=>p.isBlock(e,X),mode:"lowest",voids:i}),O.insertNodes(e,H,{at:R.current,match:X=>G.isText(X)||p.isInline(e,X),mode:"highest",voids:i}),!r.at){var J;if(H.length>0&&R.current?J=D.previous(R.current):L.length>0&&F.current?J=D.previous(F.current):M.current&&(J=D.previous(M.current)),J){var ee=p.end(e,J);O.select(e,ee)}}M.unref(),F.unref(),R.unref()}}})},insertText(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};p.withoutNormalizing(e,()=>{var{voids:n=!1}=r,{at:i=e.selection}=r;if(!!i){if(D.isPath(i)&&(i=p.range(e,i)),w.isRange(i))if(w.isCollapsed(i))i=i.anchor;else{var a=w.end(i);if(!n&&p.void(e,{at:a}))return;var s=w.start(i),o=p.pointRef(e,s),c=p.pointRef(e,a);O.delete(e,{at:i,voids:n});var u=o.unref(),l=c.unref();i=u||l,O.setSelection(e,{anchor:i,focus:i})}if(!(!n&&p.void(e,{at:i}))){var{path:d,offset:h}=i;t.length>0&&e.apply({type:"insert_text",path:d,offset:h,text:t})}}})}};function jo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Tn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?jo(Object(r),!0).forEach(function(n){yt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var O=Tn(Tn(Tn(Tn({},qd),Yd),Xd),Zd);/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Qd=Ce({"node_modules/direction/index.js"(e,t){t.exports=s;var r="\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC",n="A-Za-z\xC0-\xD6\xD8-\xF6\xF8-\u02B8\u0300-\u0590\u0800-\u1FFF\u200E\u2C00-\uFB1C\uFE00-\uFE6F\uFEFD-\uFFFF",i=new RegExp("^[^"+n+"]*["+r+"]"),a=new RegExp("^[^"+r+"]*["+n+"]");function s(o){return o=String(o||""),i.test(o)?"rtl":a.test(o)?"ltr":"neutral"}}}),hs=Ce({"node_modules/lodash/isObject.js"(e,t){function r(n){var i=typeof n;return n!=null&&(i=="object"||i=="function")}t.exports=r}}),eh=Ce({"node_modules/lodash/_freeGlobal.js"(e,t){var r=typeof global=="object"&&global&&global.Object===Object&&global;t.exports=r}}),ac=Ce({"node_modules/lodash/_root.js"(e,t){var r=eh(),n=typeof self=="object"&&self&&self.Object===Object&&self,i=r||n||Function("return this")();t.exports=i}}),th=Ce({"node_modules/lodash/now.js"(e,t){var r=ac(),n=function(){return r.Date.now()};t.exports=n}}),rh=Ce({"node_modules/lodash/_trimmedEndIndex.js"(e,t){var r=/\s/;function n(i){for(var a=i.length;a--&&r.test(i.charAt(a)););return a}t.exports=n}}),nh=Ce({"node_modules/lodash/_baseTrim.js"(e,t){var r=rh(),n=/^\s+/;function i(a){return a&&a.slice(0,r(a)+1).replace(n,"")}t.exports=i}}),sc=Ce({"node_modules/lodash/_Symbol.js"(e,t){var r=ac(),n=r.Symbol;t.exports=n}}),ih=Ce({"node_modules/lodash/_getRawTag.js"(e,t){var r=sc(),n=Object.prototype,i=n.hasOwnProperty,a=n.toString,s=r?r.toStringTag:void 0;function o(c){var u=i.call(c,s),l=c[s];try{c[s]=void 0;var d=!0}catch{}var h=a.call(c);return d&&(u?c[s]=l:delete c[s]),h}t.exports=o}}),ah=Ce({"node_modules/lodash/_objectToString.js"(e,t){var r=Object.prototype,n=r.toString;function i(a){return n.call(a)}t.exports=i}}),sh=Ce({"node_modules/lodash/_baseGetTag.js"(e,t){var r=sc(),n=ih(),i=ah(),a="[object Null]",s="[object Undefined]",o=r?r.toStringTag:void 0;function c(u){return u==null?u===void 0?s:a:o&&o in Object(u)?n(u):i(u)}t.exports=c}}),oh=Ce({"node_modules/lodash/isObjectLike.js"(e,t){function r(n){return n!=null&&typeof n=="object"}t.exports=r}}),uh=Ce({"node_modules/lodash/isSymbol.js"(e,t){var r=sh(),n=oh(),i="[object Symbol]";function a(s){return typeof s=="symbol"||n(s)&&r(s)==i}t.exports=a}}),ch=Ce({"node_modules/lodash/toNumber.js"(e,t){var r=nh(),n=hs(),i=uh(),a=0/0,s=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt;function l(d){if(typeof d=="number")return d;if(i(d))return a;if(n(d)){var h=typeof d.valueOf=="function"?d.valueOf():d;d=n(h)?h+"":h}if(typeof d!="string")return d===0?d:+d;d=r(d);var f=o.test(d);return f||c.test(d)?u(d.slice(2),f?2:8):s.test(d)?a:+d}t.exports=l}}),oc=Ce({"node_modules/lodash/debounce.js"(e,t){var r=hs(),n=th(),i=ch(),a="Expected a function",s=Math.max,o=Math.min;function c(u,l,d){var h,f,g,y,E,A,v=0,m=!1,b=!1,C=!0;if(typeof u!="function")throw new TypeError(a);l=i(l)||0,r(d)&&(m=!!d.leading,b="maxWait"in d,g=b?s(i(d.maxWait)||0,l):g,C="trailing"in d?!!d.trailing:C);function _(k){var Y=h,B=f;return h=f=void 0,v=k,y=u.apply(B,Y),y}function P(k){return v=k,E=setTimeout(H,l),m?_(k):y}function S(k){var Y=k-A,B=k-v,F=l-Y;return b?o(F,g-B):F}function L(k){var Y=k-A,B=k-v;return A===void 0||Y>=l||Y<0||b&&B>=g}function H(){var k=n();if(L(k))return j(k);E=setTimeout(H,S(k))}function j(k){return E=void 0,C&&h?_(k):(h=f=void 0,y)}function T(){E!==void 0&&clearTimeout(E),v=0,h=A=f=E=void 0}function V(){return E===void 0?y:j(n())}function W(){var k=n(),Y=L(k);if(h=arguments,f=this,A=k,Y){if(E===void 0)return P(A);if(b)return clearTimeout(E),E=setTimeout(H,l),_(A)}return E===void 0&&(E=setTimeout(H,l)),y}return W.cancel=T,W.flush=V,W}t.exports=c}}),lh=Ce({"node_modules/lodash/throttle.js"(e,t){var r=oc(),n=hs(),i="Expected a function";function a(s,o,c){var u=!0,l=!0;if(typeof s!="function")throw new TypeError(i);return n(c)&&(u="leading"in c?!!c.leading:u,l="trailing"in c?!!c.trailing:l),r(s,o,{leading:u,maxWait:o,trailing:l})}t.exports=a}}),fh=Ce({"node_modules/is-hotkey/lib/index.js"(e){Object.defineProperty(e,"__esModule",{value:!0});var t=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),r={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},n={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:t?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},i={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222};for(a=1;a<20;a++)i["f"+a]=111+a;var a;function s(f,g,y){g&&!("byKey"in g)&&(y=g,g=null),Array.isArray(f)||(f=[f]);var E=f.map(function(m){return u(m,g)}),A=function(b){return E.some(function(C){return l(C,b)})},v=y==null?A:A(y);return v}function o(f,g){return s(f,g)}function c(f,g){return s(f,{byKey:!0},g)}function u(f,g){var y=g&&g.byKey,E={};f=f.replace("++","+add");var A=f.split("+"),v=A.length;for(var m in r)E[r[m]]=!1;var b=!0,C=!1,_=void 0;try{for(var P=A[Symbol.iterator](),S;!(b=(S=P.next()).done);b=!0){var L=S.value,H=L.endsWith("?")&&L.length>1;H&&(L=L.slice(0,-1));var j=h(L),T=r[j];(v===1||!T)&&(y?E.key=j:E.which=d(L)),T&&(E[T]=H?null:!0)}}catch(V){C=!0,_=V}finally{try{!b&&P.return&&P.return()}finally{if(C)throw _}}return E}function l(f,g){for(var y in f){var E=f[y],A=void 0;if(E!=null&&(y==="key"&&g.key!=null?A=g.key.toLowerCase():y==="which"?A=E===91&&g.which===93?91:g.which:A=g[y],!(A==null&&E===!1)&&A!==E))return!1}return!0}function d(f){f=h(f);var g=i[f]||f.toUpperCase().charCodeAt(0);return g}function h(f){return f=f.toLowerCase(),f=n[f]||f,f}e.default=s,e.isHotkey=s,e.isCodeHotkey=o,e.isKeyHotkey=c,e.parseHotkey=u,e.compareHotkey=l,e.toKeyCode=d,e.toKeyName=h}}),uc=ft(Qd()),dh=ft(oc()),hh=ft(lh()),I=ft(Qu());function Lo(e){return typeof e=="object"&&e!=null&&e.nodeType===1}function No(e,t){return(!t||e!=="hidden")&&e!=="visible"&&e!=="clip"}function Ki(e,t){if(e.clientHeight<e.scrollHeight||e.clientWidth<e.scrollWidth){var r=getComputedStyle(e,null);return No(r.overflowY,t)||No(r.overflowX,t)||function(n){var i=function(a){if(!a.ownerDocument||!a.ownerDocument.defaultView)return null;try{return a.ownerDocument.defaultView.frameElement}catch{return null}}(n);return!!i&&(i.clientHeight<n.scrollHeight||i.clientWidth<n.scrollWidth)}(e)}return!1}function On(e,t,r,n,i,a,s,o){return a<e&&s>t||a>e&&s<t?0:a<=e&&o<=r||s>=t&&o>=r?a-e-n:s>t&&o<r||a<e&&o>r?s-t+i:0}function Uo(e,t){var r=window,n=t.scrollMode,i=t.block,a=t.inline,s=t.boundary,o=t.skipOverflowHiddenElements,c=typeof s=="function"?s:function(N){return N!==s};if(!Lo(e))throw new TypeError("Invalid target");for(var u=document.scrollingElement||document.documentElement,l=[],d=e;Lo(d)&&c(d);){if((d=d.parentElement)===u){l.push(d);break}d!=null&&d===document.body&&Ki(d)&&!Ki(document.documentElement)||d!=null&&Ki(d,o)&&l.push(d)}for(var h=r.visualViewport?r.visualViewport.width:innerWidth,f=r.visualViewport?r.visualViewport.height:innerHeight,g=window.scrollX||pageXOffset,y=window.scrollY||pageYOffset,E=e.getBoundingClientRect(),A=E.height,v=E.width,m=E.top,b=E.right,C=E.bottom,_=E.left,P=i==="start"||i==="nearest"?m:i==="end"?C:m+A/2,S=a==="center"?_+v/2:a==="end"?b:_,L=[],H=0;H<l.length;H++){var j=l[H],T=j.getBoundingClientRect(),V=T.height,W=T.width,k=T.top,Y=T.right,B=T.bottom,F=T.left;if(n==="if-needed"&&m>=0&&_>=0&&C<=f&&b<=h&&m>=k&&C<=B&&_>=F&&b<=Y)return L;var R=getComputedStyle(j),M=parseInt(R.borderLeftWidth,10),J=parseInt(R.borderTopWidth,10),ee=parseInt(R.borderRightWidth,10),X=parseInt(R.borderBottomWidth,10),Z=0,re=0,oe="offsetWidth"in j?j.offsetWidth-j.clientWidth-M-ee:0,ue="offsetHeight"in j?j.offsetHeight-j.clientHeight-J-X:0;if(u===j)Z=i==="start"?P:i==="end"?P-f:i==="nearest"?On(y,y+f,f,J,X,y+P,y+P+A,A):P-f/2,re=a==="start"?S:a==="center"?S-h/2:a==="end"?S-h:On(g,g+h,h,M,ee,g+S,g+S+v,v),Z=Math.max(0,Z+y),re=Math.max(0,re+g);else{Z=i==="start"?P-k-J:i==="end"?P-B+X+ue:i==="nearest"?On(k,B,V,J,X+ue,P,P+A,A):P-(k+V/2)+ue/2,re=a==="start"?S-F-M:a==="center"?S-(F+W/2)+oe/2:a==="end"?S-Y+ee+oe:On(F,Y,W,M,ee+oe,S,S+v,v);var z=j.scrollLeft,x=j.scrollTop;P+=x-(Z=Math.max(0,Math.min(x+Z,j.scrollHeight-V+ue))),S+=z-(re=Math.max(0,Math.min(z+re,j.scrollWidth-W+oe)))}L.push({el:j,top:Z,left:re})}return L}function cc(e){return e===Object(e)&&Object.keys(e).length!==0}function ph(e,t){t===void 0&&(t="auto");var r="scrollBehavior"in document.body.style;e.forEach(function(n){var i=n.el,a=n.top,s=n.left;i.scroll&&r?i.scroll({top:a,left:s,behavior:t}):(i.scrollTop=a,i.scrollLeft=s)})}function vh(e){return e===!1?{block:"end",inline:"nearest"}:cc(e)?e:{block:"start",inline:"nearest"}}function gh(e,t){var r=e.isConnected||e.ownerDocument.documentElement.contains(e);if(cc(t)&&typeof t.behavior=="function")return t.behavior(r?Uo(e,t):[]);if(!!r){var n=vh(t);return ph(Uo(e,n),n.behavior)}}var mh=gh,Yi=ft(fh()),yh=ft(Mf());function Ei(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ch(e,t){if(e==null)return{};var r={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}function nr(e,t){if(e==null)return{};var r=Ch(e,t),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(t.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}var Dh=0,bh=class{constructor(){this.id="".concat(Dh++)}},ps=new WeakMap,vs=new WeakMap,lc=new WeakMap,Da=new WeakMap,ba=new WeakMap,Si=new WeakMap,wr=new WeakMap,Ea=new WeakMap,Bi=new WeakMap,gs=new WeakMap,tr=new WeakMap,rr=new WeakMap,Zr=new WeakMap,Sa=new WeakMap,ms=new WeakMap,ut=new WeakMap,Bt=new WeakMap,Ue=new WeakMap,Rt=new WeakMap,It=new WeakMap,fc=new WeakMap,kr=Symbol("placeholder"),dc=Symbol("mark-placeholder"),ys=e=>e&&e.ownerDocument&&e.ownerDocument.defaultView||null,Eh=e=>cr(e)&&e.nodeType===8,Je=e=>cr(e)&&e.nodeType===1,cr=e=>{var t=ys(e);return!!t&&e instanceof t.Node},Ba=e=>{var t=e&&e.anchorNode&&ys(e.anchorNode);return!!t&&e instanceof t.Selection},hc=e=>cr(e)&&e.nodeType===3,Sh=e=>e.clipboardData&&e.clipboardData.getData("text/plain")!==""&&e.clipboardData.types.length===1,Bh=e=>{var[t,r]=e;if(Je(t)&&t.childNodes.length){var n=r===t.childNodes.length,i=n?r-1:r;for([t,i]=pc(t,i,n?"backward":"forward"),n=i<r;Je(t)&&t.childNodes.length;){var a=n?t.childNodes.length-1:0;t=Ah(t,a,n?"backward":"forward")}r=n&&t.textContent!=null?t.textContent.length:0}return[t,r]},_h=()=>!!(window.document.activeElement&&window.document.activeElement.shadowRoot),pc=(e,t,r)=>{for(var{childNodes:n}=e,i=n[t],a=t,s=!1,o=!1;(Eh(i)||Je(i)&&i.childNodes.length===0||Je(i)&&i.getAttribute("contenteditable")==="false")&&!(s&&o);){if(a>=n.length){s=!0,a=t-1,r="backward";continue}if(a<0){o=!0,a=t+1,r="forward";continue}i=n[a],t=a,a+=r==="forward"?1:-1}return[i,t]},Ah=(e,t,r)=>{var[n]=pc(e,t,r);return n},vc=e=>{var t="";if(hc(e)&&e.nodeValue)return e.nodeValue;if(Je(e)){for(var r of Array.from(e.childNodes))t+=vc(r);var n=getComputedStyle(e).getPropertyValue("display");(n==="block"||n==="list"||e.tagName==="BR")&&(t+=`
`)}return t},wh=/data-slate-fragment="(.+?)"/m,kh=e=>{var t=e.getData("text/html"),[,r]=t.match(wh)||[];return r},Cs=(e,t,r)=>{var{target:n}=t;if(Je(n)&&n.matches('[contentEditable="false"]'))return!1;var{document:i}=U.getWindow(e);if(i.contains(n))return U.hasDOMNode(e,n,{editable:!0});var a=r.find(s=>{var{addedNodes:o,removedNodes:c}=s;for(var u of o)if(u===n||u.contains(n))return!0;for(var l of c)if(l===n||l.contains(n))return!0});return!a||a===t?!1:Cs(e,a,r)},Fh=parseInt(I.default.version.split(".")[0],10)>=17,Th=typeof navigator<"u"&&typeof window<"u"&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,zo=typeof navigator<"u"&&/Mac OS X/.test(navigator.userAgent),ct=typeof navigator<"u"&&/Android/.test(navigator.userAgent),_a=typeof navigator<"u"&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),Ji=typeof navigator<"u"&&/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),Oh=typeof navigator<"u"&&/Edge?\/(?:[0-6][0-9]|[0-7][0-8])(?:\.)/i.test(navigator.userAgent),gc=typeof navigator<"u"&&/Chrome/i.test(navigator.userAgent),xh=typeof navigator<"u"&&/Chrome?\/(?:[0-7][0-5]|[0-6][0-9])(?:\.)/i.test(navigator.userAgent),Ph=typeof navigator<"u"&&/^(?!.*Seamonkey)(?=.*Firefox\/(?:[0-7][0-9]|[0-8][0-6])(?:\.)).*/i.test(navigator.userAgent),Rh=typeof navigator<"u"&&/.*QQBrowser/.test(navigator.userAgent),Ih=typeof navigator<"u"&&/.*UCBrowser/.test(navigator.userAgent),Mh=typeof navigator<"u"&&/.*Wechat/.test(navigator.userAgent),Gn=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Pt=!xh&&!Oh&&typeof globalThis<"u"&&globalThis.InputEvent&&typeof globalThis.InputEvent.prototype.getTargetRanges=="function",U={isComposing(e){return!!rr.get(e)},getWindow(e){var t=lc.get(e);if(!t)throw new Error("Unable to find a host window element for this editor");return t},findKey(e,t){var r=Ea.get(t);return r||(r=new bh,Ea.set(t,r)),r},findPath(e,t){for(var r=[],n=t;;){var i=vs.get(n);if(i==null){if(p.isEditor(n))return r;break}var a=ps.get(n);if(a==null)break;r.unshift(a),n=i}throw new Error("Unable to find the path for Slate node: ".concat(Fe.stringify(t)))},findDocumentOrShadowRoot(e){var t=U.toDOMNode(e,e),r=t.getRootNode();return(r instanceof Document||r instanceof ShadowRoot)&&r.getSelection!=null?r:t.ownerDocument},isFocused(e){return!!tr.get(e)},isReadOnly(e){return!!gs.get(e)},blur(e){var t=U.toDOMNode(e,e),r=U.findDocumentOrShadowRoot(e);tr.set(e,!1),r.activeElement===t&&t.blur()},focus(e){var t=U.toDOMNode(e,e),r=U.findDocumentOrShadowRoot(e);tr.set(e,!0),r.activeElement!==t&&t.focus({preventScroll:!0})},deselect(e){U.toDOMNode(e,e);var{selection:t}=e,r=U.findDocumentOrShadowRoot(e),n=r.getSelection();n&&n.rangeCount>0&&n.removeAllRanges(),t&&O.deselect(e)},hasDOMNode(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{editable:n=!1}=r,i=U.toDOMNode(e,e),a;try{a=Je(t)?t:t.parentElement}catch(s){if(!s.message.includes('Permission denied to access property "nodeType"'))throw s}return a?a.closest("[data-slate-editor]")===i&&(!n||a.isContentEditable?!0:typeof a.isContentEditable=="boolean"&&a.closest('[contenteditable="false"]')===i||!!a.getAttribute("data-slate-zero-width")):!1},insertData(e,t){e.insertData(t)},insertFragmentData(e,t){return e.insertFragmentData(t)},insertTextData(e,t){return e.insertTextData(t)},setFragmentData(e,t,r){e.setFragmentData(t,r)},toDOMNode(e,t){var r=Bi.get(e),n=p.isEditor(t)?Da.get(e):r?.get(U.findKey(e,t));if(!n)throw new Error("Cannot resolve a DOM node from Slate node: ".concat(Fe.stringify(t)));return n},toDOMPoint(e,t){var[r]=p.node(e,t.path),n=U.toDOMNode(e,r),i;p.void(e,{at:t})&&(t={path:t.path,offset:0});for(var a="[data-slate-string], [data-slate-zero-width]",s=Array.from(n.querySelectorAll(a)),o=0,c=0;c<s.length;c++){var u=s[c],l=u.childNodes[0];if(!(l==null||l.textContent==null)){var{length:d}=l.textContent,h=u.getAttribute("data-slate-length"),f=h==null?d:parseInt(h,10),g=o+f,y=s[c+1];if(t.offset===g&&y!==null&&y!==void 0&&y.hasAttribute("data-slate-mark-placeholder")){var E;i=[y,(E=y.textContent)!==null&&E!==void 0&&E.startsWith("\uFEFF")?1:0];break}if(t.offset<=g){var A=Math.min(d,Math.max(0,t.offset-o));i=[l,A];break}o=g}}if(!i)throw new Error("Cannot resolve a DOM point from Slate point: ".concat(Fe.stringify(t)));return i},toDOMRange(e,t){var{anchor:r,focus:n}=t,i=w.isBackward(t),a=U.toDOMPoint(e,r),s=w.isCollapsed(t)?a:U.toDOMPoint(e,n),o=U.getWindow(e),c=o.document.createRange(),[u,l]=i?s:a,[d,h]=i?a:s,f=Je(u)?u:u.parentElement,g=!!f.getAttribute("data-slate-zero-width"),y=Je(d)?d:d.parentElement,E=!!y.getAttribute("data-slate-zero-width");return c.setStart(u,g?1:l),c.setEnd(d,E?1:h),c},toSlateNode(e,t){var r=Je(t)?t:t.parentElement;r&&!r.hasAttribute("data-slate-node")&&(r=r.closest("[data-slate-node]"));var n=r?Si.get(r):null;if(!n)throw new Error("Cannot resolve a Slate node from DOM node: ".concat(r));return n},findEventRange(e,t){"nativeEvent"in t&&(t=t.nativeEvent);var{clientX:r,clientY:n,target:i}=t;if(r==null||n==null)throw new Error("Cannot resolve a Slate range from a DOM event: ".concat(t));var a=U.toSlateNode(e,t.target),s=U.findPath(e,a);if(p.isVoid(e,a)){var o=i.getBoundingClientRect(),c=e.isInline(a)?r-o.left<o.left+o.width-r:n-o.top<o.top+o.height-n,u=p.point(e,s,{edge:c?"start":"end"}),l=c?p.before(e,u):p.after(e,u);if(l){var d=p.range(e,l);return d}}var h,{document:f}=U.getWindow(e);if(f.caretRangeFromPoint)h=f.caretRangeFromPoint(r,n);else{var g=f.caretPositionFromPoint(r,n);g&&(h=f.createRange(),h.setStart(g.offsetNode,g.offset),h.setEnd(g.offsetNode,g.offset))}if(!h)throw new Error("Cannot resolve a Slate range from a DOM event: ".concat(t));var y=U.toSlateRange(e,h,{exactMatch:!1,suppressThrow:!1});return y},toSlatePoint(e,t,r){var{exactMatch:n,suppressThrow:i}=r,[a,s]=n?t:Bh(t),o=a.parentNode,c=null,u=0;if(o){var l,d,h=U.toDOMNode(e,e),f=o.closest('[data-slate-void="true"]'),g=f&&h.contains(f)?f:null,y=o.closest("[data-slate-leaf]"),E=null;if(y){if(c=y.closest('[data-slate-node="text"]'),c){var A=U.getWindow(e),v=A.document.createRange();v.setStart(c,0),v.setEnd(a,s);var m=v.cloneContents(),b=[...Array.prototype.slice.call(m.querySelectorAll("[data-slate-zero-width]")),...Array.prototype.slice.call(m.querySelectorAll("[contenteditable=false]"))];b.forEach(W=>{if(ct&&!n&&W.hasAttribute("data-slate-zero-width")&&W.textContent.length>0&&W.textContext!=="\uFEFF"){W.textContent.startsWith("\uFEFF")&&(W.textContent=W.textContent.slice(1));return}W.parentNode.removeChild(W)}),u=m.textContent.length,E=c}}else if(g){for(var C=g.querySelectorAll("[data-slate-leaf]"),_=0;_<C.length;_++){var P=C[_];if(U.hasDOMNode(e,P)){y=P;break}}y?(c=y.closest('[data-slate-node="text"]'),E=y,u=E.textContent.length,E.querySelectorAll("[data-slate-zero-width]").forEach(W=>{u-=W.textContent.length})):u=1}E&&u===E.textContent.length&&ct&&E.getAttribute("data-slate-zero-width")==="z"&&(l=E.textContent)!==null&&l!==void 0&&l.startsWith("\uFEFF")&&(o.hasAttribute("data-slate-zero-width")||_a&&(d=E.textContent)!==null&&d!==void 0&&d.endsWith(`

`))&&u--}if(ct&&!c&&!n){var S=o.hasAttribute("data-slate-node")?o:o.closest("[data-slate-node]");if(S&&U.hasDOMNode(e,S,{editable:!0})){var L=U.toSlateNode(e,S),{path:H,offset:j}=p.start(e,U.findPath(e,L));return S.querySelector("[data-slate-leaf]")||(j=s),{path:H,offset:j}}}if(!c){if(i)return null;throw new Error("Cannot resolve a Slate point from DOM point: ".concat(t))}var T=U.toSlateNode(e,c),V=U.findPath(e,T);return{path:V,offset:u}},toSlateRange(e,t,r){var{exactMatch:n,suppressThrow:i}=r,a=Ba(t)?t.anchorNode:t.startContainer,s,o,c,u,l;if(a&&(Ba(t)?(s=t.anchorNode,o=t.anchorOffset,c=t.focusNode,u=t.focusOffset,gc&&_h()?l=t.anchorNode===t.focusNode&&t.anchorOffset===t.focusOffset:l=t.isCollapsed):(s=t.startContainer,o=t.startOffset,c=t.endContainer,u=t.endOffset,l=t.collapsed)),s==null||c==null||o==null||u==null)throw new Error("Cannot resolve a Slate range from DOM range: ".concat(t));var d=U.toSlatePoint(e,[s,o],{exactMatch:n,suppressThrow:i});if(!d)return null;var h=l?d:U.toSlatePoint(e,[c,u],{exactMatch:n,suppressThrow:i});if(!h)return null;var f={anchor:d,focus:h};return w.isExpanded(f)&&w.isForward(f)&&Je(c)&&p.void(e,{at:f.focus,mode:"highest"})&&(f=p.unhangRange(e,f,{voids:!0})),f},hasRange(e,t){var{anchor:r,focus:n}=t;return p.hasPath(e,r.path)&&p.hasPath(e,n.path)},androidScheduleFlush(e){var t;(t=ms.get(e))===null||t===void 0||t()},androidPendingDiffs(e){return Ue.get(e)}},Nt=Gn?I.useLayoutEffect:I.useEffect,jh=["anchor","focus"],Lh=["anchor","focus"],Nh=(e,t)=>Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(r=>t.hasOwnProperty(r)&&e[r]===t[r]),mc=(e,t)=>{if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++){var n=e[r],i=t[r],a=nr(n,jh),s=nr(i,Lh);if(!w.equals(n,i)||n[kr]!==i[kr]||!Nh(a,s))return!1}return!0},Uh=e=>{var{isLast:t,leaf:r,parent:n,text:i}=e,a=Gt(),s=U.findPath(a,i),o=D.parent(s),c=r[dc]===!0;return a.isVoid(n)?I.default.createElement(Xi,{length:$.string(n).length}):r.text===""&&n.children[n.children.length-1]===i&&!a.isInline(n)&&p.string(a,o)===""?I.default.createElement(Xi,{isLineBreak:!0,isMarkPlaceholder:c}):r.text===""?I.default.createElement(Xi,{isMarkPlaceholder:c}):t&&r.text.slice(-1)===`
`?I.default.createElement($o,{isTrailing:!0,text:r.text}):I.default.createElement($o,{text:r.text})},$o=e=>{var{text:t,isTrailing:r=!1}=e,n=(0,I.useRef)(null),i=()=>"".concat(t??"").concat(r?`
`:"");return Nt(()=>{var a=i();n.current&&n.current.textContent!==a&&(n.current.textContent=a)}),n.current?I.default.createElement("span",{"data-slate-string":!0,ref:n}):I.default.createElement("span",{"data-slate-string":!0,ref:n},i())},Xi=e=>{var{length:t=0,isLineBreak:r=!1,isMarkPlaceholder:n=!1}=e,i={"data-slate-zero-width":r?"n":"z","data-slate-length":t};return n&&(i["data-slate-mark-placeholder"]=!0),I.default.createElement("span",Object.assign({},i),!ct||!r?"\uFEFF":null,r?I.default.createElement("br",null):null)},Ds=(0,I.createContext)(null),Gt=()=>{var e=(0,I.useContext)(Ds);if(!e)throw new Error("The `useSlateStatic` hook must be used inside the <Slate> component's context.");return e},zh=e=>{var{leaf:t,isLast:r,text:n,parent:i,renderPlaceholder:a,renderLeaf:s=h=>I.default.createElement(Wh,Object.assign({},h))}=e,o=(0,I.useRef)(null),c=Gt();(0,I.useEffect)(()=>{var h=o?.current,f=document.querySelector('[data-slate-editor="true"]');if(!(!h||!f))return f.style.minHeight="".concat(h.clientHeight,"px"),ba.set(c,h),()=>{f.style.minHeight="auto",ba.delete(c)}},[o,t]);var u=I.default.createElement(Uh,{isLast:r,leaf:t,parent:i,text:n});if(t[kr]){var l={children:t.placeholder,attributes:{"data-slate-placeholder":!0,style:{position:"absolute",pointerEvents:"none",width:"100%",maxWidth:"100%",display:"block",opacity:"0.333",userSelect:"none",textDecoration:"none"},contentEditable:!1,ref:o}};u=I.default.createElement(I.default.Fragment,null,a(l),u)}var d={"data-slate-leaf":!0};return s({attributes:d,children:u,leaf:t,text:n})},$h=I.default.memo(zh,(e,t)=>t.parent===e.parent&&t.isLast===e.isLast&&t.renderLeaf===e.renderLeaf&&t.renderPlaceholder===e.renderPlaceholder&&t.text===e.text&&G.equals(t.leaf,e.leaf)&&t.leaf[kr]===e.leaf[kr]),Wh=e=>{var{attributes:t,children:r}=e;return I.default.createElement("span",Object.assign({},t),r)},Vh=e=>{for(var{decorations:t,isLast:r,parent:n,renderPlaceholder:i,renderLeaf:a,text:s}=e,o=Gt(),c=(0,I.useRef)(null),u=G.decorations(s,t),l=U.findKey(o,s),d=[],h=0;h<u.length;h++){var f=u[h];d.push(I.default.createElement($h,{isLast:r&&h===u.length-1,key:"".concat(l.id,"-").concat(h),renderPlaceholder:i,leaf:f,text:s,parent:n,renderLeaf:a}))}return Nt(()=>{var g=Bi.get(o);c.current?(g?.set(l,c.current),wr.set(s,c.current),Si.set(c.current,s)):(g?.delete(l),wr.delete(s))}),I.default.createElement("span",{"data-slate-node":"text",ref:c},d)},yc=I.default.memo(Vh,(e,t)=>t.parent===e.parent&&t.isLast===e.isLast&&t.renderLeaf===e.renderLeaf&&t.text===e.text&&mc(t.decorations,e.decorations)),Gh=e=>{var{decorations:t,element:r,renderElement:n=v=>I.default.createElement(Hh,Object.assign({},v)),renderPlaceholder:i,renderLeaf:a,selection:s}=e,o=(0,I.useRef)(null),c=Gt(),u=Jh(),l=c.isInline(r),d=U.findKey(c,r),h=Dc({decorations:t,node:r,renderElement:n,renderPlaceholder:i,renderLeaf:a,selection:s}),f={"data-slate-node":"element",ref:o};if(l&&(f["data-slate-inline"]=!0),!l&&p.hasInlines(c,r)){var g=$.string(r),y=(0,uc.default)(g);y==="rtl"&&(f.dir=y)}if(p.isVoid(c,r)){f["data-slate-void"]=!0,!u&&l&&(f.contentEditable=!1);var E=l?"span":"div",[[A]]=$.texts(r);h=I.default.createElement(E,{"data-slate-spacer":!0,style:{height:"0",color:"transparent",outline:"none",position:"absolute"}},I.default.createElement(yc,{renderPlaceholder:i,decorations:[],isLast:!1,parent:r,text:A})),ps.set(A,0),vs.set(A,r)}return Nt(()=>{var v=Bi.get(c);o.current?(v?.set(d,o.current),wr.set(r,o.current),Si.set(o.current,r)):(v?.delete(d),wr.delete(r))}),n({attributes:f,children:h,element:r})},qh=I.default.memo(Gh,(e,t)=>e.element===t.element&&e.renderElement===t.renderElement&&e.renderLeaf===t.renderLeaf&&mc(e.decorations,t.decorations)&&(e.selection===t.selection||!!e.selection&&!!t.selection&&w.equals(e.selection,t.selection))),Hh=e=>{var{attributes:t,children:r,element:n}=e,i=Gt(),a=i.isInline(n)?"span":"div";return I.default.createElement(a,Object.assign({},t,{style:{position:"relative"}}),r)},Cc=(0,I.createContext)(()=>[]),Kh=()=>(0,I.useContext)(Cc),Yh=(0,I.createContext)(!1),Dc=e=>{for(var{decorations:t,node:r,renderElement:n,renderPlaceholder:i,renderLeaf:a,selection:s}=e,o=Kh(),c=Gt(),u=U.findPath(c,r),l=[],d=le.isElement(r)&&!c.isInline(r)&&p.hasInlines(c,r),h=0;h<r.children.length;h++){var f=u.concat(h),g=r.children[h],y=U.findKey(c,g),E=p.range(c,f),A=s&&w.intersection(E,s),v=o([g,f]);for(var m of t){var b=w.intersection(m,E);b&&v.push(b)}le.isElement(g)?l.push(I.default.createElement(Yh.Provider,{key:"provider-".concat(y.id),value:!!A},I.default.createElement(qh,{decorations:v,element:g,key:y.id,renderElement:n,renderPlaceholder:i,renderLeaf:a,selection:A}))):l.push(I.default.createElement(yc,{decorations:v,key:y.id,isLast:d&&h===r.children.length-1,parent:r,renderPlaceholder:i,renderLeaf:a,text:g})),ps.set(g,h),vs.set(g,r)}return l},bc=(0,I.createContext)(!1),Jh=()=>(0,I.useContext)(bc),Ec=(0,I.createContext)(null),Xh=()=>{var e=(0,I.useContext)(Ec);if(!e)throw new Error("The `useSlate` hook must be used inside the <Slate> component's context.");var{editor:t}=e;return t},Zh=3,Qh={bold:"mod+b",compose:["down","left","right","up","backspace","enter"],moveBackward:"left",moveForward:"right",moveWordBackward:"ctrl+left",moveWordForward:"ctrl+right",deleteBackward:"shift?+backspace",deleteForward:"shift?+delete",extendBackward:"shift+left",extendForward:"shift+right",italic:"mod+i",insertSoftBreak:"shift+enter",splitBlock:"enter",undo:"mod+z"},ep={moveLineBackward:"opt+up",moveLineForward:"opt+down",moveWordBackward:"opt+left",moveWordForward:"opt+right",deleteBackward:["ctrl+backspace","ctrl+h"],deleteForward:["ctrl+delete","ctrl+d"],deleteLineBackward:"cmd+shift?+backspace",deleteLineForward:["cmd+shift?+delete","ctrl+k"],deleteWordBackward:"opt+shift?+backspace",deleteWordForward:"opt+shift?+delete",extendLineBackward:"opt+shift+up",extendLineForward:"opt+shift+down",redo:"cmd+shift+z",transposeCharacter:"ctrl+t"},tp={deleteWordBackward:"ctrl+shift?+backspace",deleteWordForward:"ctrl+shift?+delete",redo:["ctrl+y","ctrl+shift+z"]},ye=e=>{var t=Qh[e],r=ep[e],n=tp[e],i=t&&(0,Yi.isKeyHotkey)(t),a=r&&(0,Yi.isKeyHotkey)(r),s=n&&(0,Yi.isKeyHotkey)(n);return o=>!!(i&&i(o)||zo&&a&&a(o)||!zo&&s&&s(o))},be={isBold:ye("bold"),isCompose:ye("compose"),isMoveBackward:ye("moveBackward"),isMoveForward:ye("moveForward"),isDeleteBackward:ye("deleteBackward"),isDeleteForward:ye("deleteForward"),isDeleteLineBackward:ye("deleteLineBackward"),isDeleteLineForward:ye("deleteLineForward"),isDeleteWordBackward:ye("deleteWordBackward"),isDeleteWordForward:ye("deleteWordForward"),isExtendBackward:ye("extendBackward"),isExtendForward:ye("extendForward"),isExtendLineBackward:ye("extendLineBackward"),isExtendLineForward:ye("extendLineForward"),isItalic:ye("italic"),isMoveLineBackward:ye("moveLineBackward"),isMoveLineForward:ye("moveLineForward"),isMoveWordBackward:ye("moveWordBackward"),isMoveWordForward:ye("moveWordForward"),isRedo:ye("redo"),isSoftBreak:ye("insertSoftBreak"),isSplitBlock:ye("splitBlock"),isTransposeCharacter:ye("transposeCharacter"),isUndo:ye("undo")},rp=(e,t)=>{var r=[],n=()=>{r=[]},i=s=>{if(!!t.current){var o=s.filter(c=>Cs(e,c,s));r.push(...o)}};function a(){r.reverse().forEach(s=>{if(s.type==="characterData"){s.target.textContent=s.oldValue;return}s.removedNodes.forEach(o=>{s.target.insertBefore(o,s.nextSibling)}),s.addedNodes.forEach(o=>{s.target.removeChild(o)})}),n()}return{registerMutations:i,restoreDOM:a,clear:n}},np={subtree:!0,childList:!0,characterData:!0,characterDataOldValue:!0},Sc=class extends I.Component{constructor(){super(...arguments),this.context=null,this.manager=null,this.mutationObserver=null}observe(){var e,{node:t}=this.props;if(!t.current)throw new Error("Failed to attach MutationObserver, `node` is undefined");(e=this.mutationObserver)===null||e===void 0||e.observe(t.current,np)}componentDidMount(){var{receivedUserInput:e}=this.props,t=this.context;this.manager=rp(t,e),this.mutationObserver=new MutationObserver(this.manager.registerMutations),this.observe()}getSnapshotBeforeUpdate(){var e,t,r,n=(e=this.mutationObserver)===null||e===void 0?void 0:e.takeRecords();if(n!=null&&n.length){var i;(i=this.manager)===null||i===void 0||i.registerMutations(n)}return(t=this.mutationObserver)===null||t===void 0||t.disconnect(),(r=this.manager)===null||r===void 0||r.restoreDOM(),null}componentDidUpdate(){var e;(e=this.manager)===null||e===void 0||e.clear(),this.observe()}componentWillUnmount(){var e;(e=this.mutationObserver)===null||e===void 0||e.disconnect()}render(){return this.props.children}};Sc.contextType=Ds;var ip=ct?Sc:e=>{var{children:t}=e;return I.default.createElement(I.default.Fragment,null,t)};function ap(e,t){var{path:r,diff:n}=t;if(!p.hasPath(e,r))return!1;var i=$.get(e,r);if(!G.isText(i))return!1;if(n.start!==i.text.length||n.text.length===0)return i.text.slice(n.start,n.start+n.text.length)===n.text;var a=D.next(r);if(!p.hasPath(e,a))return!1;var s=$.get(e,a);return G.isText(s)&&s.text.startsWith(n.text)}function sp(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return r.reduce((i,a)=>i.slice(0,a.start)+a.text+i.slice(a.end),e)}function op(e,t){for(var r=Math.min(e.length,t.length),n=0;n<r;n++)if(e.charAt(n)!==t.charAt(n))return n;return r}function up(e,t,r){for(var n=Math.min(e.length,t.length,r),i=0;i<n;i++)if(e.charAt(e.length-i-1)!==t.charAt(t.length-i-1))return i;return n}function Bc(e,t){var{start:r,end:n,text:i}=t,a=e.slice(r,n),s=op(a,i),o=Math.min(a.length-s,i.length-s),c=up(a,i,o),u={start:r+s,end:n-c,text:i.slice(s,i.length-c)};return u.start===u.end&&u.text.length===0?null:u}function cp(e,t,r){var n=Math.min(t.start,r.start),i=Math.max(0,Math.min(t.start+t.text.length,r.end)-r.start),a=sp(e,t,r),s=Math.max(r.start+r.text.length,t.start+t.text.length+(t.start+t.text.length>r.start?r.text.length:0)-i),o=a.slice(n,s),c=Math.max(t.end,r.end-t.text.length+(t.end-t.start));return Bc(e,{start:n,end:c,text:o})}function lp(e){var{path:t,diff:r}=e;return{anchor:{path:t,offset:r.start},focus:{path:t,offset:r.end}}}function Aa(e,t){var{path:r,offset:n}=t;if(!p.hasPath(e,r))return null;var i=$.get(e,r);if(!G.isText(i))return null;var a=p.above(e,{match:o=>p.isBlock(e,o),at:r});if(!a)return null;for(;n>i.text.length;){var s=p.next(e,{at:r,match:G.isText});if(!s||!D.isDescendant(s[1],a[1]))return null;n-=i.text.length,i=s[0],r=s[1]}return{path:r,offset:n}}function Wo(e,t){var r=Aa(e,t.anchor);if(!r)return null;if(w.isCollapsed(t))return{anchor:r,focus:r};var n=Aa(e,t.focus);return n?{anchor:r,focus:n}:null}function wa(e,t,r){var n=Ue.get(e),i=n?.find(l=>{var{path:d}=l;return D.equals(d,t.path)});if(!i||t.offset<=i.diff.start)return se.transform(t,r,{affinity:"backward"});var{diff:a}=i;if(t.offset<=a.start+a.text.length){var s={path:t.path,offset:a.start},o=se.transform(s,r,{affinity:"backward"});return o?{path:o.path,offset:o.offset+t.offset-a.start}:null}var c={path:t.path,offset:t.offset-a.text.length+a.end-a.start},u=se.transform(c,r,{affinity:"backward"});return u?r.type==="split_node"&&D.equals(r.path,t.path)&&c.offset<r.position&&a.start<r.position?u:{path:u.path,offset:u.offset+a.text.length-a.end+a.start}:null}function Vo(e,t,r){var n=wa(e,t.anchor,r);if(!n)return null;if(w.isCollapsed(t))return{anchor:n,focus:n};var i=wa(e,t.focus,r);return i?{anchor:n,focus:i}:null}function fp(e,t){var{path:r,diff:n,id:i}=e;switch(t.type){case"insert_text":return!D.equals(t.path,r)||t.offset>=n.end?e:t.offset<=n.start?{diff:{start:t.text.length+n.start,end:t.text.length+n.end,text:n.text},id:i,path:r}:{diff:{start:n.start,end:n.end+t.text.length,text:n.text},id:i,path:r};case"remove_text":return!D.equals(t.path,r)||t.offset>=n.end?e:t.offset+t.text.length<=n.start?{diff:{start:n.start-t.text.length,end:n.end-t.text.length,text:n.text},id:i,path:r}:{diff:{start:n.start,end:n.end-t.text.length,text:n.text},id:i,path:r};case"split_node":return!D.equals(t.path,r)||t.position>=n.end?{diff:n,id:i,path:D.transform(r,t,{affinity:"backward"})}:t.position>n.start?{diff:{start:n.start,end:Math.min(t.position,n.end),text:n.text},id:i,path:r}:{diff:{start:n.start-t.position,end:n.end-t.position,text:n.text},id:i,path:D.transform(r,t,{affinity:"forward"})};case"merge_node":return D.equals(t.path,r)?{diff:{start:n.start+t.position,end:n.end+t.position,text:n.text},id:i,path:D.transform(r,t)}:{diff:n,id:i,path:D.transform(r,t)}}var a=D.transform(r,t);return a?{diff:n,path:a,id:i}:null}function Go(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function xn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Go(Object(r),!0).forEach(function(n){Ei(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Go(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var dp=25,hp=200,pp=function(){};function vp(e){var{editor:t,scheduleOnDOMSelectionChange:r,onDOMSelectionChange:n}=e,i=!1,a=null,s=null,o=null,c=0,u=!1,l=()=>{var T=It.get(t);if(It.delete(t),T){var{selection:V}=t,W=Wo(t,T);W&&(!V||!w.equals(W,V))&&O.select(t,W)}},d=()=>{var T=Rt.get(t);if(Rt.delete(t),!!T){if(T.at){var V=se.isPoint(T.at)?Aa(t,T.at):Wo(t,T.at);if(!V)return;var W=p.range(t,V);(!t.selection||!w.equals(t.selection,W))&&O.select(t,V)}T.run()}},h=()=>{var T;if(s&&(clearTimeout(s),s=null),o&&(clearTimeout(o),o=null),!b()&&!m()){l();return}i||(i=!0,setTimeout(()=>i=!1)),m()&&(i="action");var V=t.selection&&p.rangeRef(t,t.selection,{affinity:"forward"});Bt.set(t,t.marks),pp("flush",Rt.get(t),Ue.get(t));for(var W=!!((T=Ue.get(t))!==null&&T!==void 0&&T.length),k;k=(Y=Ue.get(t))===null||Y===void 0?void 0:Y[0];){var Y,B,F=ut.get(t);F!==void 0&&(ut.delete(t),t.marks=F),F&&u===!1&&(u=null);var R=lp(k);(!t.selection||!w.equals(t.selection,R))&&O.select(t,R),k.diff.text?p.insertText(t,k.diff.text):p.deleteFragment(t),Ue.set(t,(B=Ue.get(t))===null||B===void 0?void 0:B.filter(ee=>{var{id:X}=ee;return X!==k.id})),ap(t,k)||(W=!1,Rt.delete(t),Bt.delete(t),i="action",It.delete(t),r.cancel(),n.cancel(),V?.unref())}var M=V?.unref();if(M&&!It.get(t)&&(!t.selection||!w.equals(M,t.selection))&&O.select(t,M),m()){d();return}W&&r(),r.flush(),n.flush(),l();var J=Bt.get(t);Bt.delete(t),J!==void 0&&(t.marks=J,t.onChange())},f=T=>{a&&clearTimeout(a),a=setTimeout(()=>{rr.set(t,!1),h()},dp)},g=T=>{rr.set(t,!0),a&&(clearTimeout(a),a=null)},y=function(){var V=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,W=ba.get(t);if(!!W){if(b()||V){W.style.display="none";return}W.style.removeProperty("display")}},E=(T,V)=>{var W,k=(W=Ue.get(t))!==null&&W!==void 0?W:[];Ue.set(t,k);var Y=$.leaf(t,T),B=k.findIndex(M=>D.equals(M.path,T));if(B<0){var F=Bc(Y.text,V);F&&k.push({path:T,diff:V,id:c++}),y();return}var R=cp(Y.text,k[B].diff,V);if(!R){k.splice(B,1),y();return}k[B]=xn(xn({},k[B]),{},{diff:R})},A=function(V){var{at:W}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};u=!1,It.delete(t),r.cancel(),n.cancel(),m()&&h(),Rt.set(t,{at:W,run:V}),o=setTimeout(h)},v=T=>{var V;s&&(clearTimeout(s),s=null);var{inputType:W}=T,k=null,Y=T.dataTransfer||T.data||void 0;u!==!1&&W!=="insertText"&&W!=="insertCompositionText"&&(u=!1);var[B]=T.getTargetRanges();B&&(k=U.toSlateRange(t,B,{exactMatch:!1,suppressThrow:!0}));var F=U.getWindow(t),R=F.getSelection();if(!k&&R&&(B=R,k=U.toSlateRange(t,R,{exactMatch:!1,suppressThrow:!0})),k=(V=k)!==null&&V!==void 0?V:t.selection,!!k){if(w.isExpanded(k)&&W.startsWith("delete")){var[M,J]=w.edges(k),ee=$.leaf(t,M.path);if(ee.text.length===M.offset&&J.offset===0){var X=p.next(t,{at:M.path,match:G.isText});X&&D.equals(X[1],J.path)&&(k={anchor:J,focus:J})}}if(w.isExpanded(k)&&W.startsWith("delete")){if(D.equals(k.anchor.path,k.focus.path)){var[Z,re]=w.edges(k);return E(k.anchor.path,{text:"",end:re.offset,start:Z.offset})}var oe=W.endsWith("Backward")?"backward":"forward";return A(()=>p.deleteFragment(t,{direction:oe}),{at:k})}switch(W){case"deleteByComposition":case"deleteByCut":case"deleteByDrag":return A(()=>p.deleteFragment(t),{at:k});case"deleteContent":case"deleteContentForward":{var{anchor:ue}=k;if(w.isCollapsed(k)){var z=$.leaf(t,ue.path);if(ue.offset<z.text.length)return E(ue.path,{text:"",start:ue.offset,end:ue.offset+1})}return A(()=>p.deleteForward(t),{at:k})}case"deleteContentBackward":{var x,{anchor:N}=k,q=Ba(B)?B.isCollapsed:!!((x=B)!==null&&x!==void 0&&x.collapsed);return q&&w.isCollapsed(k)&&N.offset>0?E(N.path,{text:"",start:N.offset-1,end:N.offset}):A(()=>p.deleteBackward(t),{at:k})}case"deleteEntireSoftLine":return A(()=>{p.deleteBackward(t,{unit:"line"}),p.deleteForward(t,{unit:"line"})},{at:k});case"deleteHardLineBackward":return A(()=>p.deleteBackward(t,{unit:"block"}),{at:k});case"deleteSoftLineBackward":return A(()=>p.deleteBackward(t,{unit:"line"}),{at:k});case"deleteHardLineForward":return A(()=>p.deleteForward(t,{unit:"block"}),{at:k});case"deleteSoftLineForward":return A(()=>p.deleteForward(t,{unit:"line"}),{at:k});case"deleteWordBackward":return A(()=>p.deleteBackward(t,{unit:"word"}),{at:k});case"deleteWordForward":return A(()=>p.deleteForward(t,{unit:"word"}),{at:k});case"insertLineBreak":return A(()=>p.insertSoftBreak(t),{at:k});case"insertParagraph":return A(()=>p.insertBreak(t),{at:k});case"insertCompositionText":case"deleteCompositionText":case"insertFromComposition":case"insertFromDrop":case"insertFromPaste":case"insertFromYank":case"insertReplacementText":case"insertText":{if(Y?.constructor.name==="DataTransfer")return A(()=>U.insertData(t,Y),{at:k});if(typeof Y=="string"&&Y.includes(`
`))return A(()=>p.insertSoftBreak(t),{at:w.end(k)});var ae=Y??"";if(ut.get(t)&&(ae=ae.replace("\uFEFF","")),D.equals(k.anchor.path,k.focus.path)){var[Q,de]=w.edges(k),De={start:Q.offset,end:de.offset,text:ae};if(ae&&u&&W==="insertCompositionText"){var Ae=u.start+u.text.search(/\S|$/),Ke=De.start+De.text.search(/\S|$/);Ke===Ae+1&&De.end===u.start+u.text.length?(De.start-=1,u=null,H()):u=!1}else W==="insertText"?u===null?u=De:u&&w.isCollapsed(k)&&u.end+u.text.length===Q.offset?u=xn(xn({},u),{},{text:u.text+ae}):u=!1:u=!1;E(Q.path,De);return}return A(()=>p.insertText(t,ae),{at:k})}}}},m=()=>!!Rt.get(t),b=()=>{var T;return!!((T=Ue.get(t))!==null&&T!==void 0&&T.length)},C=()=>m()||b(),_=()=>i,P=T=>{It.set(t,T),s&&(clearTimeout(s),s=null);var{selection:V}=t;if(!!T){var W=!V||!D.equals(V.anchor.path,T.anchor.path),k=!V||!D.equals(V.anchor.path.slice(0,-1),T.anchor.path.slice(0,-1));(W&&u||k)&&(u=!1),(W||!b())&&(s=setTimeout(h,hp))}},S=()=>{(m()||!b())&&h()},L=T=>{b()||(y(!0),setTimeout(y))},H=()=>{m()||(o=setTimeout(h))},j=T=>{if(!(b()||m())&&T.some(W=>Cs(t,W,T))){var V;(V=fc.get(t))===null||V===void 0||V()}};return{flush:h,scheduleFlush:H,hasPendingDiffs:b,hasPendingAction:m,hasPendingChanges:C,isFlushing:_,handleUserSelect:P,handleCompositionEnd:f,handleCompositionStart:g,handleDOMBeforeInput:v,handleKeyDown:L,handleDomMutations:j,handleInput:S}}function gp(){var e=(0,I.useRef)(!1);return(0,I.useEffect)(()=>(e.current=!0,()=>{e.current=!1}),[]),e.current}function mp(e,t,r){var[n]=(0,I.useState)(()=>new MutationObserver(t));Nt(()=>{n.takeRecords()}),(0,I.useEffect)(()=>{if(!e.current)throw new Error("Failed to attach MutationObserver, `node` is undefined");return n.observe(e.current,r),()=>n.disconnect()},[])}var yp=["node"];function qo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Cp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?qo(Object(r),!0).forEach(function(n){Ei(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Dp={subtree:!0,childList:!0,characterData:!0};function bp(e){var{node:t}=e,r=nr(e,yp);if(!ct)return null;var n=Gt(),i=gp(),[a]=(0,I.useState)(()=>vp(Cp({editor:n},r)));return mp(t,a.handleDomMutations,Dp),ms.set(n,a.scheduleFlush),i&&a.flush(),a}function Ep(){var e=Gt(),t=(0,I.useRef)(!1),r=(0,I.useRef)(0),n=(0,I.useCallback)(()=>{if(!t.current){t.current=!0;var i=U.getWindow(e);i.cancelAnimationFrame(r.current),r.current=i.requestAnimationFrame(()=>{t.current=!1})}},[]);return(0,I.useEffect)(()=>()=>cancelAnimationFrame(r.current),[]),{receivedUserInput:t,onUserInput:n}}var Sp=["autoFocus","decorate","onDOMBeforeInput","placeholder","readOnly","renderElement","renderLeaf","renderPlaceholder","scrollSelectionIntoView","style","as"],Bp=["text"],_p=["text"];function Ho(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Pn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ho(Object(r),!0).forEach(function(n){Ei(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ho(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Ap=e=>I.default.createElement(I.default.Fragment,null,Dc(e)),wp=e=>{var{autoFocus:t,decorate:r=Fp,onDOMBeforeInput:n,placeholder:i,readOnly:a=!1,renderElement:s,renderLeaf:o,renderPlaceholder:c=B=>I.default.createElement(kp,Object.assign({},B)),scrollSelectionIntoView:u=Tp,style:l={},as:d="div"}=e,h=nr(e,Sp),f=Xh(),[g,y]=(0,I.useState)(!1),E=(0,I.useRef)(null),A=(0,I.useRef)([]),{onUserInput:v,receivedUserInput:m}=Ep(),[,b]=(0,I.useReducer)(B=>B+1,0);fc.set(f,b),gs.set(f,a);var C=(0,I.useMemo)(()=>({isDraggingInternally:!1,isUpdatingSelection:!1,latestElement:null,hasMarkPlaceholder:!1}),[]);(0,I.useEffect)(()=>{E.current&&t&&E.current.focus()},[t]);var _=(0,I.useCallback)((0,hh.default)(()=>{if((ct||!U.isComposing(f))&&(!C.isUpdatingSelection||S!=null&&S.isFlushing())&&!C.isDraggingInternally){var B=U.findDocumentOrShadowRoot(f),{activeElement:F}=B,R=U.toDOMNode(f,f),M=B.getSelection();if(F===R?(C.latestElement=F,tr.set(f,!0)):tr.delete(f),!M)return O.deselect(f);var{anchorNode:J,focusNode:ee}=M,X=ze(f,J)||Ko(f,J),Z=ze(f,ee)||Ko(f,ee);if(X&&Z){var re=U.toSlateRange(f,M,{exactMatch:!1,suppressThrow:!0});re&&(!U.isComposing(f)&&!(S!=null&&S.hasPendingChanges())&&!(S!=null&&S.isFlushing())?O.select(f,re):S?.handleUserSelect(re))}}},100),[a]),P=(0,I.useMemo)(()=>(0,dh.default)(_,0),[_]),S=bp({node:E,onDOMSelectionChange:_,scheduleOnDOMSelectionChange:P});Nt(()=>{var B;E.current&&(B=ys(E.current))?(lc.set(f,B),Da.set(f,E.current),wr.set(f,E.current),Si.set(E.current,f)):wr.delete(f);var{selection:F}=f,R=U.findDocumentOrShadowRoot(f),M=R.getSelection();if(!(!M||!U.isFocused(f)||S!=null&&S.hasPendingAction())){var J=oe=>{var ue=M.type!=="None";if(!(!F&&!ue)){var z=Da.get(f),x=!1;if(z.contains(M.anchorNode)&&z.contains(M.focusNode)&&(x=!0),ue&&x&&F&&!oe){var N=U.toSlateRange(f,M,{exactMatch:!0,suppressThrow:!0});if(N&&w.equals(N,F)){var q;if(!C.hasMarkPlaceholder)return;var{anchorNode:ae}=M;if(ae!=null&&(q=ae.parentElement)!==null&&q!==void 0&&q.hasAttribute("data-slate-mark-placeholder"))return}}if(F&&!U.hasRange(f,F)){f.selection=U.toSlateRange(f,M,{exactMatch:!1,suppressThrow:!0});return}C.isUpdatingSelection=!0;var Q=F&&U.toDOMRange(f,F);return Q?(w.isBackward(F)?M.setBaseAndExtent(Q.endContainer,Q.endOffset,Q.startContainer,Q.startOffset):M.setBaseAndExtent(Q.startContainer,Q.startOffset,Q.endContainer,Q.endOffset),u(f,Q)):M.removeAllRanges(),Q}},ee=J(),X=S?.isFlushing()==="action";if(!ct||!X){setTimeout(()=>{if(ee&&_a){var oe=U.toDOMNode(f,f);oe.focus()}C.isUpdatingSelection=!1});return}var Z=null,re=requestAnimationFrame(()=>{if(X){var oe=ue=>{try{var z=U.toDOMNode(f,f);z.focus(),J(ue)}catch{}};oe(),Z=setTimeout(()=>{oe(!0),C.isUpdatingSelection=!1})}});return()=>{cancelAnimationFrame(re),Z&&clearTimeout(Z)}}});var L=(0,I.useCallback)(B=>{if(v(),!a&&ze(f,B.target)&&!Op(B,n)){var F;if(S)return S.handleDOMBeforeInput(B);P.flush(),_.flush();var{selection:R}=f,{inputType:M}=B,J=B.dataTransfer||B.data||void 0,ee=M==="insertCompositionText"||M==="deleteCompositionText";if(ee&&U.isComposing(f))return;var X=!1;if(M==="insertText"&&R&&w.isCollapsed(R)&&B.data&&B.data.length===1&&/[a-z ]/i.test(B.data)&&R.anchor.offset!==0){var Z,re;X=!0,f.marks&&(X=!1);var{anchor:oe}=R,[ue,z]=U.toDOMPoint(f,oe),x=(Z=ue.parentElement)===null||Z===void 0?void 0:Z.closest("a"),N=U.getWindow(f);if(X&&x&&U.hasDOMNode(f,x)){var q,ae=N?.document.createTreeWalker(x,NodeFilter.SHOW_TEXT).lastChild();ae===ue&&((q=ae.textContent)===null||q===void 0?void 0:q.length)===z&&(X=!1)}if(X&&ue.parentElement&&(N==null||(re=N.getComputedStyle(ue.parentElement))===null||re===void 0?void 0:re.whiteSpace)==="pre"){var Q=p.above(f,{at:oe.path,match:xt=>p.isBlock(f,xt)});Q&&$.string(Q[0]).includes("	")&&(X=!1)}}if(!M.startsWith("delete")||M.startsWith("deleteBy")){var[de]=B.getTargetRanges();if(de){var De=U.toSlateRange(f,de,{exactMatch:!1,suppressThrow:!1});if(!R||!w.equals(R,De)){X=!1;var Ae=!ee&&f.selection&&p.rangeRef(f,f.selection);O.select(f,De),Ae&&Zr.set(f,Ae)}}}if(ee)return;if(X||B.preventDefault(),R&&w.isExpanded(R)&&M.startsWith("delete")){var Ke=M.endsWith("Backward")?"backward":"forward";p.deleteFragment(f,{direction:Ke});return}switch(M){case"deleteByComposition":case"deleteByCut":case"deleteByDrag":{p.deleteFragment(f);break}case"deleteContent":case"deleteContentForward":{p.deleteForward(f);break}case"deleteContentBackward":{p.deleteBackward(f);break}case"deleteEntireSoftLine":{p.deleteBackward(f,{unit:"line"}),p.deleteForward(f,{unit:"line"});break}case"deleteHardLineBackward":{p.deleteBackward(f,{unit:"block"});break}case"deleteSoftLineBackward":{p.deleteBackward(f,{unit:"line"});break}case"deleteHardLineForward":{p.deleteForward(f,{unit:"block"});break}case"deleteSoftLineForward":{p.deleteForward(f,{unit:"line"});break}case"deleteWordBackward":{p.deleteBackward(f,{unit:"word"});break}case"deleteWordForward":{p.deleteForward(f,{unit:"word"});break}case"insertLineBreak":p.insertSoftBreak(f);break;case"insertParagraph":{p.insertBreak(f);break}case"insertFromComposition":case"insertFromDrop":case"insertFromPaste":case"insertFromYank":case"insertReplacementText":case"insertText":{var{selection:Ht}=f;Ht&&w.isExpanded(Ht)&&p.deleteFragment(f),M==="insertFromComposition"&&U.isComposing(f)&&(y(!1),rr.set(f,!1)),J?.constructor.name==="DataTransfer"?U.insertData(f,J):typeof J=="string"&&(X?A.current.push(()=>p.insertText(f,J)):p.insertText(f,J));break}}var Be=(F=Zr.get(f))===null||F===void 0?void 0:F.unref();Zr.delete(f),Be&&(!f.selection||!w.equals(f.selection,Be))&&O.select(f,Be)}},[a,n]);Nt(()=>(E.current&&Pt&&E.current.addEventListener("beforeinput",L),()=>{E.current&&Pt&&E.current.removeEventListener("beforeinput",L)}),[L]),Nt(()=>{var B=U.getWindow(f);return B.document.addEventListener("selectionchange",P),()=>{B.document.removeEventListener("selectionchange",P)}},[P]);var H=r([f,[]]);if(i&&f.children.length===1&&Array.from($.texts(f)).length===1&&$.string(f)===""&&!g){var j=p.start(f,[]);H.push({[kr]:!0,placeholder:i,anchor:j,focus:j})}var{marks:T}=f;if(C.hasMarkPlaceholder=!1,f.selection&&w.isCollapsed(f.selection)&&T){var{anchor:V}=f.selection,W=$.leaf(f,V.path),k=nr(W,Bp);if(!G.equals(k,T,{loose:!0})){C.hasMarkPlaceholder=!0;var Y=Object.fromEntries(Object.keys(k).map(B=>[B,null]));H.push(Pn(Pn(Pn({[dc]:!0},Y),T),{},{anchor:V,focus:V}))}}return(0,I.useEffect)(()=>{setTimeout(()=>{var{selection:B}=f;if(B){var{anchor:F}=B,R=$.leaf(f,F.path),M=nr(R,_p);if(!G.equals(M,T,{loose:!0})){ut.set(f,T);return}}ut.delete(f)})}),I.default.createElement(bc.Provider,{value:a},I.default.createElement(Cc.Provider,{value:r},I.default.createElement(ip,{node:E,receivedUserInput:m},I.default.createElement(d,Object.assign({role:a?void 0:"textbox"},h,{spellCheck:Pt||!Gn?h.spellCheck:!1,autoCorrect:Pt||!Gn?h.autoCorrect:"false",autoCapitalize:Pt||!Gn?h.autoCapitalize:"false","data-slate-editor":!0,"data-slate-node":"value",contentEditable:!a,zindex:-1,suppressContentEditableWarning:!0,ref:E,style:Pn({position:"relative",outline:"none",whiteSpace:"pre-wrap",wordWrap:"break-word"},l),onBeforeInput:(0,I.useCallback)(B=>{if(!Pt&&!a&&!Le(B,h.onBeforeInput)&&ze(f,B.target)&&(B.preventDefault(),!U.isComposing(f))){var F=B.data;p.insertText(f,F)}},[a]),onInput:(0,I.useCallback)(B=>{if(S){S.handleInput();return}for(var F of A.current)F();A.current=[]},[]),onBlur:(0,I.useCallback)(B=>{if(!(a||C.isUpdatingSelection||!ze(f,B.target)||Le(B,h.onBlur))){var F=U.findDocumentOrShadowRoot(f);if(C.latestElement!==F.activeElement){var{relatedTarget:R}=B,M=U.toDOMNode(f,f);if(R!==M&&!(Je(R)&&R.hasAttribute("data-slate-spacer"))){if(R!=null&&cr(R)&&U.hasDOMNode(f,R)){var J=U.toSlateNode(f,R);if(le.isElement(J)&&!f.isVoid(J))return}if(Ji){var ee=F.getSelection();ee?.removeAllRanges()}tr.delete(f)}}}},[a,h.onBlur]),onClick:(0,I.useCallback)(B=>{if(br(f,B.target)&&!Le(B,h.onClick)&&cr(B.target)){var F=U.toSlateNode(f,B.target),R=U.findPath(f,F);if(!p.hasPath(f,R)||$.get(f,R)!==F)return;if(B.detail===Zh&&R.length>=1){var M=R;if(!p.isBlock(f,F)){var J,ee=p.above(f,{match:x=>p.isBlock(f,x),at:R});M=(J=ee?.[1])!==null&&J!==void 0?J:R.slice(0,1)}var X=p.range(f,M);O.select(f,X);return}if(a)return;var Z=p.start(f,R),re=p.end(f,R),oe=p.void(f,{at:Z}),ue=p.void(f,{at:re});if(oe&&ue&&D.equals(oe[1],ue[1])){var z=p.range(f,Z);O.select(f,z)}}},[a,h.onClick]),onCompositionEnd:(0,I.useCallback)(B=>{if(ze(f,B.target)){if(U.isComposing(f)&&(y(!1),rr.set(f,!1)),S?.handleCompositionEnd(B),Le(B,h.onCompositionEnd)||ct)return;if(!Ji&&!Ph&&!Th&&!Rh&&!Mh&&!Ih&&B.data){var F=ut.get(f);ut.delete(f),F!==void 0&&(Bt.set(f,f.marks),f.marks=F),p.insertText(f,B.data);var R=Bt.get(f);Bt.delete(f),R!==void 0&&(f.marks=R)}}},[h.onCompositionEnd]),onCompositionUpdate:(0,I.useCallback)(B=>{ze(f,B.target)&&!Le(B,h.onCompositionUpdate)&&(U.isComposing(f)||(y(!0),rr.set(f,!0)))},[h.onCompositionUpdate]),onCompositionStart:(0,I.useCallback)(B=>{if(ze(f,B.target)){if(S?.handleCompositionStart(B),Le(B,h.onCompositionStart)||ct)return;y(!0);var{selection:F}=f;if(F){if(w.isExpanded(F)){p.deleteFragment(f);return}var R=p.above(f,{match:ee=>p.isInline(f,ee),mode:"highest"});if(R){var[,M]=R;if(p.isEnd(f,F.anchor,M)){var J=p.after(f,M);O.setSelection(f,{anchor:J,focus:J})}}}}},[h.onCompositionStart]),onCopy:(0,I.useCallback)(B=>{ze(f,B.target)&&!Le(B,h.onCopy)&&(B.preventDefault(),U.setFragmentData(f,B.clipboardData,"copy"))},[h.onCopy]),onCut:(0,I.useCallback)(B=>{if(!a&&ze(f,B.target)&&!Le(B,h.onCut)){B.preventDefault(),U.setFragmentData(f,B.clipboardData,"cut");var{selection:F}=f;if(F)if(w.isExpanded(F))p.deleteFragment(f);else{var R=$.parent(f,F.anchor.path);p.isVoid(f,R)&&O.delete(f)}}},[a,h.onCut]),onDragOver:(0,I.useCallback)(B=>{if(br(f,B.target)&&!Le(B,h.onDragOver)){var F=U.toSlateNode(f,B.target);p.isVoid(f,F)&&B.preventDefault()}},[h.onDragOver]),onDragStart:(0,I.useCallback)(B=>{if(!a&&br(f,B.target)&&!Le(B,h.onDragStart)){var F=U.toSlateNode(f,B.target),R=U.findPath(f,F),M=p.isVoid(f,F)||p.void(f,{at:R,voids:!0});if(M){var J=p.range(f,R);O.select(f,J)}C.isDraggingInternally=!0,U.setFragmentData(f,B.dataTransfer,"drag")}},[a,h.onDragStart]),onDrop:(0,I.useCallback)(B=>{if(!a&&br(f,B.target)&&!Le(B,h.onDrop)){B.preventDefault();var F=f.selection,R=U.findEventRange(f,B),M=B.dataTransfer;O.select(f,R),C.isDraggingInternally&&F&&!w.equals(F,R)&&!p.void(f,{at:R,voids:!0})&&O.delete(f,{at:F}),U.insertData(f,M),U.isFocused(f)||U.focus(f)}C.isDraggingInternally=!1},[a,h.onDrop]),onDragEnd:(0,I.useCallback)(B=>{!a&&C.isDraggingInternally&&h.onDragEnd&&br(f,B.target)&&h.onDragEnd(B),C.isDraggingInternally=!1},[a,h.onDragEnd]),onFocus:(0,I.useCallback)(B=>{if(!a&&!C.isUpdatingSelection&&ze(f,B.target)&&!Le(B,h.onFocus)){var F=U.toDOMNode(f,f),R=U.findDocumentOrShadowRoot(f);if(C.latestElement=R.activeElement,_a&&B.target!==F){F.focus();return}tr.set(f,!0)}},[a,h.onFocus]),onKeyDown:(0,I.useCallback)(B=>{if(!a&&ze(f,B.target)){S?.handleKeyDown(B);var{nativeEvent:F}=B;if(U.isComposing(f)&&F.isComposing===!1&&(rr.set(f,!1),y(!1)),Le(B,h.onKeyDown)||U.isComposing(f))return;var{selection:R}=f,M=f.children[R!==null?R.focus.path[0]:0],J=(0,uc.default)($.string(M))==="rtl";if(be.isRedo(F)){B.preventDefault();var ee=f;typeof ee.redo=="function"&&ee.redo();return}if(be.isUndo(F)){B.preventDefault();var X=f;typeof X.undo=="function"&&X.undo();return}if(be.isMoveLineBackward(F)){B.preventDefault(),O.move(f,{unit:"line",reverse:!0});return}if(be.isMoveLineForward(F)){B.preventDefault(),O.move(f,{unit:"line"});return}if(be.isExtendLineBackward(F)){B.preventDefault(),O.move(f,{unit:"line",edge:"focus",reverse:!0});return}if(be.isExtendLineForward(F)){B.preventDefault(),O.move(f,{unit:"line",edge:"focus"});return}if(be.isMoveBackward(F)){B.preventDefault(),R&&w.isCollapsed(R)?O.move(f,{reverse:!J}):O.collapse(f,{edge:"start"});return}if(be.isMoveForward(F)){B.preventDefault(),R&&w.isCollapsed(R)?O.move(f,{reverse:J}):O.collapse(f,{edge:"end"});return}if(be.isMoveWordBackward(F)){B.preventDefault(),R&&w.isExpanded(R)&&O.collapse(f,{edge:"focus"}),O.move(f,{unit:"word",reverse:!J});return}if(be.isMoveWordForward(F)){B.preventDefault(),R&&w.isExpanded(R)&&O.collapse(f,{edge:"focus"}),O.move(f,{unit:"word",reverse:J});return}if(Pt){if((gc||Ji)&&R&&(be.isDeleteBackward(F)||be.isDeleteForward(F))&&w.isCollapsed(R)){var Z=$.parent(f,R.anchor.path);if(le.isElement(Z)&&p.isVoid(f,Z)&&p.isInline(f,Z)){B.preventDefault(),p.deleteBackward(f,{unit:"block"});return}}}else{if(be.isBold(F)||be.isItalic(F)||be.isTransposeCharacter(F)){B.preventDefault();return}if(be.isSoftBreak(F)){B.preventDefault(),p.insertSoftBreak(f);return}if(be.isSplitBlock(F)){B.preventDefault(),p.insertBreak(f);return}if(be.isDeleteBackward(F)){B.preventDefault(),R&&w.isExpanded(R)?p.deleteFragment(f,{direction:"backward"}):p.deleteBackward(f);return}if(be.isDeleteForward(F)){B.preventDefault(),R&&w.isExpanded(R)?p.deleteFragment(f,{direction:"forward"}):p.deleteForward(f);return}if(be.isDeleteLineBackward(F)){B.preventDefault(),R&&w.isExpanded(R)?p.deleteFragment(f,{direction:"backward"}):p.deleteBackward(f,{unit:"line"});return}if(be.isDeleteLineForward(F)){B.preventDefault(),R&&w.isExpanded(R)?p.deleteFragment(f,{direction:"forward"}):p.deleteForward(f,{unit:"line"});return}if(be.isDeleteWordBackward(F)){B.preventDefault(),R&&w.isExpanded(R)?p.deleteFragment(f,{direction:"backward"}):p.deleteBackward(f,{unit:"word"});return}if(be.isDeleteWordForward(F)){B.preventDefault(),R&&w.isExpanded(R)?p.deleteFragment(f,{direction:"forward"}):p.deleteForward(f,{unit:"word"});return}}}},[a,h.onKeyDown]),onPaste:(0,I.useCallback)(B=>{!a&&ze(f,B.target)&&!Le(B,h.onPaste)&&(!Pt||Sh(B.nativeEvent))&&(B.preventDefault(),U.insertData(f,B.clipboardData))},[a,h.onPaste])}),I.default.createElement(Ap,{decorations:H,node:f,renderElement:s,renderPlaceholder:c,renderLeaf:o,selection:f.selection})))))},kp=e=>{var{attributes:t,children:r}=e;return I.default.createElement("span",Object.assign({},t),r,ct&&I.default.createElement("br",null))},Fp=()=>[],Tp=(e,t)=>{if(!e.selection||e.selection&&w.isCollapsed(e.selection)){var r=t.startContainer.parentElement;r.getBoundingClientRect=t.getBoundingClientRect.bind(t),mh(r,{scrollMode:"if-needed"}),delete r.getBoundingClientRect}},br=(e,t)=>cr(t)&&U.hasDOMNode(e,t),ze=(e,t)=>cr(t)&&U.hasDOMNode(e,t,{editable:!0}),Ko=(e,t)=>{if(gs.get(e))return!1;var r=br(e,t)&&U.toSlateNode(e,t);return p.isVoid(e,r)},Le=(e,t)=>{if(!t)return!1;var r=t(e);return r??(e.isDefaultPrevented()||e.isPropagationStopped())},Op=(e,t)=>{if(!t)return!1;var r=t(e);return r??e.defaultPrevented},xp=(0,I.createContext)(!1),Pp=(0,I.createContext)({});function Rp(e){var t=(0,I.useRef)([]).current,r=(0,I.useRef)({editor:e}).current,n=(0,I.useCallback)(a=>{r.editor=a,t.forEach(s=>s(a))},[]),i=(0,I.useMemo)(()=>({getSlate:()=>r.editor,addEventListener:a=>(t.push(a),()=>{t.splice(t.indexOf(a),1)})}),[t,r]);return{selectorContext:i,onChange:n}}var Ip=["editor","children","onChange","value"],Mp=e=>{var{editor:t,children:r,onChange:n,value:i}=e,a=nr(e,Ip),s=(0,I.useRef)(!1),[o,c]=I.default.useState(()=>{if(!$.isNodeList(i))throw new Error("[Slate] value is invalid! Expected a list of elements"+"but got: ".concat(Fe.stringify(i)));if(!p.isEditor(t))throw new Error("[Slate] editor is invalid! you passed:"+"".concat(Fe.stringify(t)));return t.children=i,Object.assign(t,a),{v:0,editor:t}}),{selectorContext:u,onChange:l}=Rp(t),d=(0,I.useCallback)(()=>{n&&n(t.children),c(g=>({v:g.v+1,editor:t})),l(t)},[n]);Sa.set(t,d),(0,I.useEffect)(()=>()=>{Sa.set(t,()=>{}),s.current=!0},[]);var[h,f]=(0,I.useState)(U.isFocused(t));return(0,I.useEffect)(()=>{f(U.isFocused(t))}),Nt(()=>{var g=()=>f(U.isFocused(t));return Fh?(document.addEventListener("focusin",g),document.addEventListener("focusout",g),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",g)}):(document.addEventListener("focus",g,!0),document.addEventListener("blur",g,!0),()=>{document.removeEventListener("focus",g,!0),document.removeEventListener("blur",g,!0)})},[]),I.default.createElement(Pp.Provider,{value:u},I.default.createElement(Ec.Provider,{value:o},I.default.createElement(Ds.Provider,{value:o.editor},I.default.createElement(xp.Provider,{value:h},r))))},Yo=(e,t)=>{var r=(t.top+t.bottom)/2;return e.top<=r&&e.bottom>=r},Jo=(e,t,r)=>{var n=U.toDOMRange(e,t).getBoundingClientRect(),i=U.toDOMRange(e,r).getBoundingClientRect();return Yo(n,i)&&Yo(i,n)},jp=(e,t)=>{var r=p.range(e,w.end(t)),n=Array.from(p.positions(e,{at:t})),i=0,a=n.length,s=Math.floor(a/2);if(Jo(e,p.range(e,n[i]),r))return p.range(e,n[i],r);if(n.length<2)return p.range(e,n[n.length-1],r);for(;s!==n.length&&s!==i;)Jo(e,p.range(e,n[s]),r)?a=s:i=s,s=Math.floor((i+a)/2);return p.range(e,n[a],r)};function Xo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Zo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Xo(Object(r),!0).forEach(function(n){Ei(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Lp=e=>{var t=e,{apply:r,onChange:n,deleteBackward:i,addMark:a,removeMark:s}=t;return Bi.set(t,new WeakMap),t.addMark=(o,c)=>{var u,l;(u=ms.get(t))===null||u===void 0||u(),!ut.get(t)&&(l=Ue.get(t))!==null&&l!==void 0&&l.length&&ut.set(t,null),Bt.delete(t),a(o,c)},t.removeMark=o=>{var c;!ut.get(t)&&(c=Ue.get(t))!==null&&c!==void 0&&c.length&&ut.set(t,null),Bt.delete(t),s(o)},t.deleteBackward=o=>{if(o!=="line")return i(o);if(t.selection&&w.isCollapsed(t.selection)){var c=p.above(t,{match:h=>p.isBlock(t,h),at:t.selection});if(c){var[,u]=c,l=p.range(t,u,t.selection.anchor),d=jp(t,l);w.isCollapsed(d)||O.delete(t,{at:d})}}},t.apply=o=>{var c=[],u=Ue.get(t);if(u!=null&&u.length){var l=u.map(b=>fp(b,o)).filter(Boolean);Ue.set(t,l)}var d=It.get(t);d&&It.set(t,Vo(t,d,o));var h=Rt.get(t);if(h!=null&&h.at){var f=se.isPoint(h?.at)?wa(t,h.at,o):Vo(t,h.at,o);Rt.set(t,f?Zo(Zo({},h),{},{at:f}):null)}switch(o.type){case"insert_text":case"remove_text":case"set_node":case"split_node":{c.push(...Rn(t,o.path));break}case"set_selection":{var g;(g=Zr.get(t))===null||g===void 0||g.unref(),Zr.delete(t);break}case"insert_node":case"remove_node":{c.push(...Rn(t,D.parent(o.path)));break}case"merge_node":{var y=D.previous(o.path);c.push(...Rn(t,y));break}case"move_node":{var E=D.common(D.parent(o.path),D.parent(o.newPath));c.push(...Rn(t,E));break}}r(o);for(var[A,v]of c){var[m]=p.node(t,A);Ea.set(m,v)}},t.setFragmentData=o=>{var{selection:c}=t;if(!!c){var[u,l]=w.edges(c),d=p.void(t,{at:u.path}),h=p.void(t,{at:l.path});if(!(w.isCollapsed(c)&&!d)){var f=U.toDOMRange(t,c),g=f.cloneContents(),y=g.childNodes[0];if(g.childNodes.forEach(S=>{S.textContent&&S.textContent.trim()!==""&&(y=S)}),h){var[E]=h,A=f.cloneRange(),v=U.toDOMNode(t,E);A.setEndAfter(v),g=A.cloneContents()}if(d&&(y=g.querySelector("[data-slate-spacer]")),Array.from(g.querySelectorAll("[data-slate-zero-width]")).forEach(S=>{var L=S.getAttribute("data-slate-zero-width")==="n";S.textContent=L?`
`:""}),hc(y)){var m=y.ownerDocument.createElement("span");m.style.whiteSpace="pre",m.appendChild(y),g.appendChild(m),y=m}var b=t.getFragment(),C=JSON.stringify(b),_=window.btoa(encodeURIComponent(C));y.setAttribute("data-slate-fragment",_),o.setData("application/x-slate-fragment",_);var P=g.ownerDocument.createElement("div");return P.appendChild(g),P.setAttribute("hidden","true"),g.ownerDocument.body.appendChild(P),o.setData("text/html",P.innerHTML),o.setData("text/plain",vc(P)),g.ownerDocument.body.removeChild(P),o}}},t.insertData=o=>{t.insertFragmentData(o)||t.insertTextData(o)},t.insertFragmentData=o=>{var c=o.getData("application/x-slate-fragment")||kh(o);if(c){var u=decodeURIComponent(window.atob(c)),l=JSON.parse(u);return t.insertFragment(l),!0}return!1},t.insertTextData=o=>{var c=o.getData("text/plain");if(c){var u=c.split(/\r\n|\r|\n/),l=!1;for(var d of u)l&&O.splitNodes(t,{always:!0}),t.insertText(d),l=!0;return!0}return!1},t.onChange=()=>{yh.default.unstable_batchedUpdates(()=>{var o=Sa.get(t);o&&o(),n()})},t},Rn=(e,t)=>{var r=[];for(var[n,i]of p.levels(e,{at:t})){var a=U.findKey(e,n);r.push([i,a])}return r},vt=()=>new Map,ci=e=>{const t=vt();return e.forEach((r,n)=>{t.set(n,r)}),t},qt=(e,t,r)=>{let n=e.get(t);return n===void 0&&e.set(t,n=r()),n},Np=(e,t)=>{const r=[];for(const[n,i]of e)r.push(t(i,n));return r},Up=(e,t)=>{for(const[r,n]of e)if(t(n,r))return!0;return!1},un=()=>new Set,Zi=e=>e[e.length-1],zp=(e,t)=>{for(let r=0;r<t.length;r++)e.push(t[r])},_c=Array.from,$p=class{constructor(){this._observers=vt()}on(e,t){qt(this._observers,e,un).add(t)}once(e,t){const r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){const r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return _c((this._observers.get(e)||vt()).values()).forEach(r=>r(...t))}destroy(){this._observers=vt()}},$t=Math.floor,qn=Math.abs,Ac=(e,t)=>e<t?e:t,hr=(e,t)=>e>t?e:t,wc=e=>e!==0?e<0:1/e<0,Wp=e=>e.toLowerCase(),Vp=/^\s*/g,Gp=e=>e.replace(Vp,""),qp=/([A-Z])/g,Qo=(e,t)=>Gp(e.replace(qp,r=>`${t}${Wp(r)}`)),Hp=e=>{const t=unescape(encodeURIComponent(e)),r=t.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=t.codePointAt(i);return n},_i=typeof TextEncoder<"u"?new TextEncoder:null,Kp=e=>_i.encode(e),Yp=_i?Kp:Hp,Qr=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Qr&&Qr.decode(new Uint8Array).length===1&&(Qr=null);var eu=e=>e===void 0?null:e,Jp=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},kc=new Jp,Xp=!0;try{typeof localStorage<"u"&&(kc=localStorage,Xp=!1)}catch{}var Zp=kc,bs=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name);typeof navigator<"u"&&/Mac/.test(navigator.platform);var dt,Qp=()=>{if(dt===void 0)if(bs){dt=vt();const e=process.argv;let t=null;for(let r=0;r<e.length;r++){const n=e[r];n[0]==="-"?(t!==null&&dt.set(t,""),t=n):t!==null&&(dt.set(t,n),t=null)}t!==null&&dt.set(t,"")}else typeof location=="object"?(dt=vt(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,r]=e.split("=");dt.set(`--${Qo(t,"-")}`,r),dt.set(`-${Qo(t,"-")}`,r)}})):dt=vt();return dt},ev=e=>Qp().has(e),tv=e=>eu(bs?process.env[e.toUpperCase()]:Zp.getItem(e)),rv=e=>ev("--"+e)||tv(e)!==null;rv("production");var tu=1,ru=2,Qi=4,ea=8,cn=32,At=64,Ve=128,Ai=31,ka=63,ir=127,nv=2147483647,Fc=Number.MAX_SAFE_INTEGER,iv=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&$t(e)===e),wi=class{constructor(e){this.arr=e,this.pos=0}},pr=e=>new wi(e),Tc=e=>e.pos!==e.arr.length,av=(e,t)=>{const r=Ss(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,r},$e=e=>av(e,ne(e)),Fr=e=>e.arr[e.pos++],ne=e=>{let t=0,r=1;for(;;){const n=e.arr[e.pos++];if(t=t+(n&ir)*r,r*=128,n<Ve)return t;if(t>Fc)throw new Error("Integer out of range!")}},ki=e=>{let t=e.arr[e.pos++],r=t&ka,n=64;const i=(t&At)>0?-1:1;if((t&Ve)===0)return i*r;for(;;){if(t=e.arr[e.pos++],r=r+(t&ir)*n,n*=128,t<Ve)return i*r;if(r>Fc)throw new Error("Integer out of range!")}},sv=e=>{let t=ne(e);if(t===0)return"";{let r=String.fromCodePoint(Fr(e));if(--t<100)for(;t--;)r+=String.fromCodePoint(Fr(e));else for(;t>0;){const n=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+n);e.pos+=n,r+=String.fromCodePoint.apply(null,i),t-=n}return decodeURIComponent(escape(r))}},ov=e=>Qr.decode($e(e)),ar=Qr?ov:sv,Es=(e,t)=>{const r=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,r},uv=e=>Es(e,4).getFloat32(0,!1),cv=e=>Es(e,8).getFloat64(0,!1),lv=e=>Es(e,8).getBigInt64(0,!1),fv=[e=>{},e=>null,ki,uv,cv,lv,e=>!1,e=>!0,ar,e=>{const t=ne(e),r={};for(let n=0;n<t;n++){const i=ar(e);r[i]=ln(e)}return r},e=>{const t=ne(e),r=[];for(let n=0;n<t;n++)r.push(ln(e));return r},$e],ln=e=>fv[127-Fr(e)](e),nu=class extends wi{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Tc(this)?this.count=ne(this)+1:this.count=-1),this.count--,this.s}},Hn=class extends wi{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=ki(this);const e=wc(this.s);this.count=1,e&&(this.s=-this.s,this.count=ne(this)+2)}return this.count--,this.s}},ta=class extends wi{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=ki(this),t=e&1;this.diff=$t(e/2),this.count=1,t&&(this.count=ne(this)+2)}return this.s+=this.diff,this.count--,this.s}},dv=class{constructor(e){this.decoder=new Hn(e),this.str=ar(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}},hv=e=>new Uint8Array(e),Ss=(e,t,r)=>new Uint8Array(e,t,r),pv=e=>{const t=hv(e.byteLength);return t.set(e),t},Dn=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},bn=()=>new Dn,vv=e=>{let t=e.cpos;for(let r=0;r<e.bufs.length;r++)t+=e.bufs[r].length;return t},lt=e=>{const t=new Uint8Array(vv(e));let r=0;for(let n=0;n<e.bufs.length;n++){const i=e.bufs[n];t.set(i,r),r+=i.length}return t.set(Ss(e.cbuf.buffer,0,e.cpos),r),t},gv=(e,t)=>{const r=e.cbuf.length;r-e.cpos<t&&(e.bufs.push(Ss(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(hr(r,t)*2),e.cpos=0)},ke=(e,t)=>{const r=e.cbuf.length;e.cpos===r&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(r*2),e.cpos=0),e.cbuf[e.cpos++]=t},fn=ke,ce=(e,t)=>{for(;t>ir;)ke(e,Ve|ir&t),t=$t(t/128);ke(e,ir&t)},Fi=(e,t)=>{const r=wc(t);for(r&&(t=-t),ke(e,(t>ka?Ve:0)|(r?At:0)|ka&t),t=$t(t/64);t>0;)ke(e,(t>ir?Ve:0)|ir&t),t=$t(t/128)},Fa=new Uint8Array(3e4),mv=Fa.length/3,yv=(e,t)=>{if(t.length<mv){const r=_i.encodeInto(t,Fa).written||0;ce(e,r);for(let n=0;n<r;n++)ke(e,Fa[n])}else We(e,Yp(t))},Cv=(e,t)=>{const r=unescape(encodeURIComponent(t)),n=r.length;ce(e,n);for(let i=0;i<n;i++)ke(e,r.codePointAt(i))},sr=_i?yv:Cv,Ti=(e,t)=>{const r=e.cbuf.length,n=e.cpos,i=Ac(r-n,t.length),a=t.length-i;e.cbuf.set(t.subarray(0,i),n),e.cpos+=i,a>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(hr(r*2,a)),e.cbuf.set(t.subarray(i)),e.cpos=a)},We=(e,t)=>{ce(e,t.byteLength),Ti(e,t)},Bs=(e,t)=>{gv(e,t);const r=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,r},Dv=(e,t)=>Bs(e,4).setFloat32(0,t,!1),bv=(e,t)=>Bs(e,8).setFloat64(0,t,!1),Ev=(e,t)=>Bs(e,8).setBigInt64(0,t,!1),iu=new DataView(new ArrayBuffer(4)),Sv=e=>(iu.setFloat32(0,e),iu.getFloat32(0)===e),dn=(e,t)=>{switch(typeof t){case"string":ke(e,119),sr(e,t);break;case"number":iv(t)&&qn(t)<=nv?(ke(e,125),Fi(e,t)):Sv(t)?(ke(e,124),Dv(e,t)):(ke(e,123),bv(e,t));break;case"bigint":ke(e,122),Ev(e,t);break;case"object":if(t===null)ke(e,126);else if(t instanceof Array){ke(e,117),ce(e,t.length);for(let r=0;r<t.length;r++)dn(e,t[r])}else if(t instanceof Uint8Array)ke(e,116),We(e,t);else{ke(e,118);const r=Object.keys(t);ce(e,r.length);for(let n=0;n<r.length;n++){const i=r[n];sr(e,i),dn(e,t[i])}}break;case"boolean":ke(e,t?120:121);break;default:ke(e,127)}},au=class extends Dn{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&ce(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}},su=e=>{e.count>0&&(Fi(e.encoder,e.count===1?e.s:-e.s),e.count>1&&ce(e.encoder,e.count-2))},Kn=class{constructor(){this.encoder=new Dn,this.s=0,this.count=0}write(e){this.s===e?this.count++:(su(this),this.count=1,this.s=e)}toUint8Array(){return su(this),lt(this.encoder)}},ou=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);Fi(e.encoder,t),e.count>1&&ce(e.encoder,e.count-2)}},ra=class{constructor(){this.encoder=new Dn,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(ou(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return ou(this),lt(this.encoder)}},Bv=class{constructor(){this.sarr=[],this.s="",this.lensE=new Kn}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Dn;return this.sarr.push(this.s),this.s="",sr(e,this.sarr.join("")),Ti(e,this.lensE.toUint8Array()),lt(e)}},uu=typeof crypto>"u"?null:crypto,_v=uu!==null?e=>{const t=new ArrayBuffer(e),r=new Uint8Array(t);return uu.getRandomValues(r),t}:e=>{const t=new ArrayBuffer(e),r=new Uint8Array(t);for(let n=0;n<e;n++)r[n]=Math.ceil(Math.random()*4294967295>>>0);return t},Oc=()=>new Uint32Array(_v(4))[0],Av=[1e7]+-1e3+-4e3+-8e3+-1e11,wv=()=>Av.replace(/[018]/g,e=>(e^Oc()&15>>e/4).toString(16)),kv=e=>new Promise(e),Oi=e=>new Error(e),gt=()=>{throw Oi("Method unimplemented")},Qe=()=>{throw Oi("Unexpected case")},Fv=Object.keys,cu=e=>Fv(e).length,Tv=(e,t)=>{for(const r in e)if(!t(e[r],r))return!1;return!0},Ov=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),xv=(e,t)=>e===t||cu(e)===cu(t)&&Tv(e,(r,n)=>(r!==void 0||Ov(t,n))&&t[n]===r),_s=(e,t,r=0)=>{try{for(;r<e.length;r++)e[r](...t)}finally{r<e.length&&_s(e,t,r+1)}},Ft=Symbol,Pv=class{constructor(e,t){this.left=e,this.right=t}},Et=(e,t)=>new Pv(e,t),vr=typeof document<"u"?document:{};typeof DOMParser<"u"&&new DOMParser;var Rv=e=>Np(e,(t,r)=>`${r}:${t};`).join("");vr.ELEMENT_NODE;vr.TEXT_NODE;vr.CDATA_SECTION_NODE;vr.COMMENT_NODE;vr.DOCUMENT_NODE;vr.DOCUMENT_TYPE_NODE;vr.DOCUMENT_FRAGMENT_NODE;var As=Ft(),ws=Ft(),xc=Ft(),Pc=Ft(),Rc=Ft(),ks=Ft(),Ic=Ft(),Fs=Ft(),Mc=Ft(),Iv={[As]:Et("font-weight","bold"),[ws]:Et("font-weight","normal"),[xc]:Et("color","blue"),[Rc]:Et("color","green"),[Pc]:Et("color","grey"),[ks]:Et("color","red"),[Ic]:Et("color","purple"),[Fs]:Et("color","orange"),[Mc]:Et("color","black")},Mv={[As]:"\x1B[1m",[ws]:"\x1B[2m",[xc]:"\x1B[34m",[Rc]:"\x1B[32m",[Pc]:"\x1B[37m",[ks]:"\x1B[31m",[Ic]:"\x1B[35m",[Fs]:"\x1B[38;5;208m",[Mc]:"\x1B[0m"},jv=e=>{const t=[],r=[],n=vt();let i=[],a=0;for(;a<e.length;a++){const s=e[a],o=Iv[s];if(o!==void 0)n.set(o.left,o.right);else if(s.constructor===String||s.constructor===Number){const c=Rv(n);a>0||c.length>0?(t.push("%c"+s),r.push(c)):t.push(s)}else break}for(a>0&&(i=r,i.unshift(t.join("")));a<e.length;a++){const s=e[a];s instanceof Symbol||i.push(s)}return i},Lv=e=>{const t=[],r=[];let n=0;for(;n<e.length;n++){const i=e[n],a=Mv[i];if(a!==void 0)t.push(a);else if(i.constructor===String||i.constructor===Number)t.push(i);else break}for(n>0&&(t.push("\x1B[0m"),r.push(t.join("")));n<e.length;n++){const i=e[n];i instanceof Symbol||r.push(i)}return r},Nv=bs?Lv:jv,Uv=(...e)=>{console.log(...Nv(e)),zv.forEach(t=>t.print(e))},zv=new Set,jc=e=>({[Symbol.iterator](){return this},next:e}),$v=(e,t)=>jc(()=>{let r;do r=e.next();while(!r.done&&!t(r.value));return r}),na=(e,t)=>jc(()=>{const{done:r,value:n}=e.next();return{done:r,value:r?void 0:t(n)}}),Ts=class{constructor(e,t){this.clock=e,this.len=t}},En=class{constructor(){this.clients=new Map}},Ta=(e,t,r)=>t.clients.forEach((n,i)=>{const a=e.doc.store.clients.get(i);for(let s=0;s<n.length;s++){const o=n[s];Zc(e,a,o.clock,o.len,r)}}),Wv=(e,t)=>{let r=0,n=e.length-1;for(;r<=n;){const i=$t((r+n)/2),a=e[i],s=a.clock;if(s<=t){if(t<s+a.len)return i;r=i+1}else n=i-1}return null},Lc=(e,t)=>{const r=e.clients.get(t.client);return r!==void 0&&Wv(r,t.clock)!==null},Os=e=>{e.clients.forEach(t=>{t.sort((i,a)=>i.clock-a.clock);let r,n;for(r=1,n=1;r<t.length;r++){const i=t[n-1],a=t[r];i.clock+i.len>=a.clock?i.len=hr(i.len,a.clock+a.len-i.clock):(n<r&&(t[n]=a),n++)}t.length=n})},Vv=e=>{const t=new En;for(let r=0;r<e.length;r++)e[r].clients.forEach((n,i)=>{if(!t.clients.has(i)){const a=n.slice();for(let s=r+1;s<e.length;s++)zp(a,e[s].clients.get(i)||[]);t.clients.set(i,a)}});return Os(t),t},li=(e,t,r,n)=>{qt(e.clients,t,()=>[]).push(new Ts(r,n))},Nc=()=>new En,Gv=e=>{const t=Nc();return e.clients.forEach((r,n)=>{const i=[];for(let a=0;a<r.length;a++){const s=r[a];if(s.deleted){const o=s.id.clock;let c=s.length;if(a+1<r.length)for(let u=r[a+1];a+1<r.length&&u.deleted;u=r[++a+1])c+=u.length;i.push(new Ts(o,c))}}i.length>0&&t.clients.set(n,i)}),t},Rr=(e,t)=>{ce(e.restEncoder,t.clients.size),t.clients.forEach((r,n)=>{e.resetDsCurVal(),ce(e.restEncoder,n);const i=r.length;ce(e.restEncoder,i);for(let a=0;a<i;a++){const s=r[a];e.writeDsClock(s.clock),e.writeDsLen(s.len)}})},xs=e=>{const t=new En,r=ne(e.restDecoder);for(let n=0;n<r;n++){e.resetDsCurVal();const i=ne(e.restDecoder),a=ne(e.restDecoder);if(a>0){const s=qt(t.clients,i,()=>[]);for(let o=0;o<a;o++)s.push(new Ts(e.readDsClock(),e.readDsLen()))}}return t},lu=(e,t,r)=>{const n=new En,i=ne(e.restDecoder);for(let a=0;a<i;a++){e.resetDsCurVal();const s=ne(e.restDecoder),o=ne(e.restDecoder),c=r.clients.get(s)||[],u=_e(r,s);for(let l=0;l<o;l++){const d=e.readDsClock(),h=d+e.readDsLen();if(d<u){u<h&&li(n,s,u,h-u);let f=mt(c,d),g=c[f];for(!g.deleted&&g.id.clock<d&&(c.splice(f+1,0,gi(t,g,d-g.id.clock)),f++);f<c.length&&(g=c[f++],g.id.clock<h);)g.deleted||(h<g.id.clock+g.length&&c.splice(f,0,gi(t,g,h-g.id.clock)),g.delete(t))}else li(n,s,d,h-d)}}if(n.clients.size>0){const a=new lr;return ce(a.restEncoder,0),Rr(a,n),a.toUint8Array()}return null},Uc=Oc,Wt=class extends $p{constructor({guid:e=wv(),collectionid:t=null,gc:r=!0,gcFilter:n=()=>!0,meta:i=null,autoLoad:a=!1,shouldLoad:s=!0}={}){super(),this.gc=r,this.gcFilter=n,this.clientID=Uc(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new Jc,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=s,this.autoLoad=a,this.meta=i,this.isLoaded=!1,this.whenLoaded=kv(o=>{this.on("load",()=>{this.isLoaded=!0,o(this)})})}load(){const e=this._item;e!==null&&!this.shouldLoad&&pe(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Array.from(this.subdocs).map(e=>e.guid))}transact(e,t=null){pe(this,e,t)}get(e,t=Pe){const r=qt(this.share,e,()=>{const i=new t;return i._integrate(this,null),i}),n=r.constructor;if(t!==Pe&&n!==t)if(n===Pe){const i=new t;i._map=r._map,r._map.forEach(a=>{for(;a!==null;a=a.left)a.parent=i}),i._start=r._start;for(let a=i._start;a!==null;a=a.right)a.parent=i;return i._length=r._length,this.share.set(e,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,en)}getText(e=""){return this.get(e,gn)}getMap(e=""){return this.get(e,vn)}getXmlFragment(e=""){return this.get(e,Or)}toJSON(){const e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){_c(this.subdocs).forEach(t=>t.destroy());const e=this._item;if(e!==null){this._item=null;const t=e.content;t.doc=new Wt({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,pe(e.parent.doc,r=>{const n=t.doc;e.deleted||r.subdocsAdded.add(n),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(e,t){super.on(e,t)}off(e,t){super.off(e,t)}},zc=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return ne(this.restDecoder)}readDsLen(){return ne(this.restDecoder)}},$c=class extends zc{readLeftID(){return ie(ne(this.restDecoder),ne(this.restDecoder))}readRightID(){return ie(ne(this.restDecoder),ne(this.restDecoder))}readClient(){return ne(this.restDecoder)}readInfo(){return Fr(this.restDecoder)}readString(){return ar(this.restDecoder)}readParentInfo(){return ne(this.restDecoder)===1}readTypeRef(){return ne(this.restDecoder)}readLen(){return ne(this.restDecoder)}readAny(){return ln(this.restDecoder)}readBuf(){return pv($e(this.restDecoder))}readJSON(){return JSON.parse(ar(this.restDecoder))}readKey(){return ar(this.restDecoder)}},qv=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=ne(this.restDecoder),this.dsCurrVal}readDsLen(){const e=ne(this.restDecoder)+1;return this.dsCurrVal+=e,e}},Tr=class extends qv{constructor(e){super(e),this.keys=[],ne(e),this.keyClockDecoder=new ta($e(e)),this.clientDecoder=new Hn($e(e)),this.leftClockDecoder=new ta($e(e)),this.rightClockDecoder=new ta($e(e)),this.infoDecoder=new nu($e(e),Fr),this.stringDecoder=new dv($e(e)),this.parentInfoDecoder=new nu($e(e),Fr),this.typeRefDecoder=new Hn($e(e)),this.lenDecoder=new Hn($e(e))}readLeftID(){return new _r(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new _r(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return ln(this.restDecoder)}readBuf(){return $e(this.restDecoder)}readJSON(){return ln(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const t=this.stringDecoder.read();return this.keys.push(t),t}}},Hv=class{constructor(){this.restEncoder=bn()}toUint8Array(){return lt(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){ce(this.restEncoder,e)}writeDsLen(e){ce(this.restEncoder,e)}},Sn=class extends Hv{writeLeftID(e){ce(this.restEncoder,e.client),ce(this.restEncoder,e.clock)}writeRightID(e){ce(this.restEncoder,e.client),ce(this.restEncoder,e.clock)}writeClient(e){ce(this.restEncoder,e)}writeInfo(e){fn(this.restEncoder,e)}writeString(e){sr(this.restEncoder,e)}writeParentInfo(e){ce(this.restEncoder,e?1:0)}writeTypeRef(e){ce(this.restEncoder,e)}writeLen(e){ce(this.restEncoder,e)}writeAny(e){dn(this.restEncoder,e)}writeBuf(e){We(this.restEncoder,e)}writeJSON(e){sr(this.restEncoder,JSON.stringify(e))}writeKey(e){sr(this.restEncoder,e)}},Kv=class{constructor(){this.restEncoder=bn(),this.dsCurrVal=0}toUint8Array(){return lt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,ce(this.restEncoder,t)}writeDsLen(e){e===0&&Qe(),ce(this.restEncoder,e-1),this.dsCurrVal+=e}},lr=class extends Kv{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new ra,this.clientEncoder=new Kn,this.leftClockEncoder=new ra,this.rightClockEncoder=new ra,this.infoEncoder=new au(fn),this.stringEncoder=new Bv,this.parentInfoEncoder=new au(fn),this.typeRefEncoder=new Kn,this.lenEncoder=new Kn}toUint8Array(){const e=bn();return ce(e,0),We(e,this.keyClockEncoder.toUint8Array()),We(e,this.clientEncoder.toUint8Array()),We(e,this.leftClockEncoder.toUint8Array()),We(e,this.rightClockEncoder.toUint8Array()),We(e,lt(this.infoEncoder)),We(e,this.stringEncoder.toUint8Array()),We(e,lt(this.parentInfoEncoder)),We(e,this.typeRefEncoder.toUint8Array()),We(e,this.lenEncoder.toUint8Array()),Ti(e,lt(this.restEncoder)),lt(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){dn(this.restEncoder,e)}writeBuf(e){We(this.restEncoder,e)}writeJSON(e){dn(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},Yv=(e,t,r,n)=>{n=hr(n,t[0].id.clock);const i=mt(t,n);ce(e.restEncoder,t.length-i),e.writeClient(r),ce(e.restEncoder,n);const a=t[i];a.write(e,n-a.id.clock);for(let s=i+1;s<t.length;s++)t[s].write(e,0)},Ps=(e,t,r)=>{const n=new Map;r.forEach((i,a)=>{_e(t,a)>i&&n.set(a,i)}),Is(t).forEach((i,a)=>{r.has(a)||n.set(a,0)}),ce(e.restEncoder,n.size),Array.from(n.entries()).sort((i,a)=>a[0]-i[0]).forEach(([i,a])=>{Yv(e,t.clients.get(i),i,a)})},Jv=(e,t)=>{const r=vt(),n=ne(e.restDecoder);for(let i=0;i<n;i++){const a=ne(e.restDecoder),s=new Array(a),o=e.readClient();let c=ne(e.restDecoder);r.set(o,{i:0,refs:s});for(let u=0;u<a;u++){const l=e.readInfo();switch(Ai&l){case 0:{const d=e.readLen();s[u]=new Xe(ie(o,c),d),c+=d;break}case 10:{const d=ne(e.restDecoder);s[u]=new Ze(ie(o,c),d),c+=d;break}default:{const d=(l&(At|Ve))===0,h=new Se(ie(o,c),null,(l&Ve)===Ve?e.readLeftID():null,null,(l&At)===At?e.readRightID():null,d?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,d&&(l&cn)===cn?e.readString():null,yl(e,l));s[u]=h,c+=h.length}}}}return r},Xv=(e,t,r)=>{const n=[];let i=Array.from(r.keys()).sort((f,g)=>f-g);if(i.length===0)return null;const a=()=>{if(i.length===0)return null;let f=r.get(i[i.length-1]);for(;f.refs.length===f.i;)if(i.pop(),i.length>0)f=r.get(i[i.length-1]);else return null;return f};let s=a();if(s===null&&n.length===0)return null;const o=new Jc,c=new Map,u=(f,g)=>{const y=c.get(f);(y==null||y>g)&&c.set(f,g)};let l=s.refs[s.i++];const d=new Map,h=()=>{for(const f of n){const g=f.id.client,y=r.get(g);y?(y.i--,o.clients.set(g,y.refs.slice(y.i)),r.delete(g),y.i=0,y.refs=[]):o.clients.set(g,[f]),i=i.filter(E=>E!==g)}n.length=0};for(;;){if(l.constructor!==Ze){const g=qt(d,l.id.client,()=>_e(t,l.id.client))-l.id.clock;if(g<0)n.push(l),u(l.id.client,l.id.clock-1),h();else{const y=l.getMissing(e,t);if(y!==null){n.push(l);const E=r.get(y)||{refs:[],i:0};if(E.refs.length===E.i)u(y,_e(t,y)),h();else{l=E.refs[E.i++];continue}}else(g===0||g<l.length)&&(l.integrate(e,g),d.set(l.id.client,l.id.clock+l.length))}}if(n.length>0)l=n.pop();else if(s!==null&&s.i<s.refs.length)l=s.refs[s.i++];else{if(s=a(),s===null)break;l=s.refs[s.i++]}}if(o.clients.size>0){const f=new lr;return Ps(f,o,new Map),ce(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},Zv=(e,t)=>Ps(e,t.doc.store,t.beforeState),Qv=(e,t,r,n=new Tr(e))=>pe(t,i=>{i.local=!1;let a=!1;const s=i.doc,o=s.store,c=Jv(n,s),u=Xv(i,o,c),l=o.pendingStructs;if(l){for(const[h,f]of l.missing)if(f<_e(o,h)){a=!0;break}if(u){for(const[h,f]of u.missing){const g=l.missing.get(h);(g==null||g>f)&&l.missing.set(h,f)}l.update=fi([l.update,u.update])}}else o.pendingStructs=u;const d=lu(n,i,o);if(o.pendingDs){const h=new Tr(pr(o.pendingDs));ne(h.restDecoder);const f=lu(h,i,o);d&&f?o.pendingDs=fi([d,f]):o.pendingDs=d||f}else o.pendingDs=d;if(a){const h=o.pendingStructs.update;o.pendingStructs=null,Wc(i.doc,h)}},r,!1),Wc=(e,t,r,n=Tr)=>{const i=pr(t);Qv(i,e,r,new n(i))},at=(e,t,r)=>Wc(e,t,r,$c),eg=(e,t,r=new Map)=>{Ps(e,t.store,r),Rr(e,Gv(t.store))},tg=(e,t=new Uint8Array([0]),r=new lr)=>{const n=Vc(t);eg(r,e,n);const i=[r.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(Dg(e.store.pendingStructs.update,t)),i.length>1){if(r.constructor===Sn)return yg(i.map((a,s)=>s===0?a:Eg(a)));if(r.constructor===lr)return fi(i)}return i[0]},Ut=(e,t)=>tg(e,t,new Sn),rg=e=>{const t=new Map,r=ne(e.restDecoder);for(let n=0;n<r;n++){const i=ne(e.restDecoder),a=ne(e.restDecoder);t.set(i,a)}return t},Vc=e=>rg(new zc(pr(e))),ng=class{constructor(){this.l=[]}},fu=()=>new ng,du=(e,t)=>e.l.push(t),hu=(e,t)=>{const r=e.l,n=r.length;e.l=r.filter(i=>t!==i),n===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Gc=(e,t,r)=>_s(e.l,[t,r]),_r=class{constructor(e,t){this.client=e,this.clock=t}},In=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,ie=(e,t)=>new _r(e,t),pu=(e,t)=>{ce(e,t.client),ce(e,t.clock)},vu=e=>ie(ne(e),ne(e)),qc=e=>{for(const[t,r]of e.doc.share.entries())if(r===e)return t;throw Qe()},Rs=class{constructor(e,t,r,n=0){this.type=e,this.tname=t,this.item=r,this.assoc=n}},ig=e=>new Rs(e.type==null?null:ie(e.type.client,e.type.clock),e.tname||null,e.item==null?null:ie(e.item.client,e.item.clock),e.assoc==null?0:e.assoc),ag=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},sg=(e,t,r=0)=>new ag(e,t,r),Mn=(e,t,r)=>{let n=null,i=null;return e._item===null?i=qc(e):n=ie(e._item.id.client,e._item.id.clock),new Rs(n,i,t,r)},Hc=(e,t,r=0)=>{let n=e._start;if(r<0){if(t===0)return Mn(e,null,r);t--}for(;n!==null;){if(!n.deleted&&n.countable){if(n.length>t)return Mn(e,ie(n.id.client,n.id.clock+t),r);t-=n.length}if(n.right===null&&r<0)return Mn(e,n.lastId,r);n=n.right}return Mn(e,null,r)},og=(e,t)=>{const{type:r,tname:n,item:i,assoc:a}=t;if(i!==null)ce(e,0),pu(e,i);else if(n!==null)fn(e,1),sr(e,n);else if(r!==null)fn(e,2),pu(e,r);else throw Qe();return Fi(e,a),e},ug=e=>{const t=bn();return og(t,e),lt(t)},cg=e=>{let t=null,r=null,n=null;switch(ne(e)){case 0:n=vu(e);break;case 1:r=ar(e);break;case 2:t=vu(e)}const i=Tc(e)?ki(e):0;return new Rs(t,r,n,i)},Kc=e=>cg(pr(e)),Yc=(e,t)=>{const r=t.store,n=e.item,i=e.type,a=e.tname,s=e.assoc;let o=null,c=0;if(n!==null){if(_e(r,n.client)<=n.clock)return null;const u=Eu(r,n),l=u.item;if(!(l instanceof Se))return null;if(o=l.parent,o._item===null||!o._item.deleted){c=l.deleted||!l.countable?0:u.diff+(s>=0?0:1);let d=l.left;for(;d!==null;)!d.deleted&&d.countable&&(c+=d.length),d=d.left}}else{if(a!==null)o=t.get(a);else if(i!==null){if(_e(r,i.client)<=i.clock)return null;const{item:u}=Eu(r,i);if(u instanceof Se&&u.content instanceof Tt)o=u.content.type;else return null}else throw Qe();s>=0?c=o._length:c=0}return sg(o,c,e.assoc)},lg=class{constructor(e,t){this.ds=e,this.sv=t}},fg=(e,t)=>new lg(e,t);fg(Nc(),new Map);var $r=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Lc(t.ds,e.id),Yn=(e,t)=>{const r=qt(e.meta,Yn,un),n=e.doc.store;r.has(t)||(t.sv.forEach((i,a)=>{i<_e(n,a)&&Vt(e,ie(a,i))}),Ta(e,t.ds,i=>{}),r.add(t))},Jc=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},Is=e=>{const t=new Map;return e.clients.forEach((r,n)=>{const i=r[r.length-1];t.set(n,i.id.clock+i.length)}),t},_e=(e,t)=>{const r=e.clients.get(t);if(r===void 0)return 0;const n=r[r.length-1];return n.id.clock+n.length},Xc=(e,t)=>{let r=e.clients.get(t.id.client);if(r===void 0)r=[],e.clients.set(t.id.client,r);else{const n=r[r.length-1];if(n.id.clock+n.length!==t.id.clock)throw Qe()}r.push(t)},mt=(e,t)=>{let r=0,n=e.length-1,i=e[n],a=i.id.clock;if(a===t)return n;let s=$t(t/(a+i.length-1)*n);for(;r<=n;){if(i=e[s],a=i.id.clock,a<=t){if(t<a+i.length)return s;r=s+1}else n=s-1;s=$t((r+n)/2)}throw Qe()},dg=(e,t)=>{const r=e.clients.get(t.client);return r[mt(r,t.clock)]},Jn=dg,Oa=(e,t,r)=>{const n=mt(t,r),i=t[n];return i.id.clock<r&&i instanceof Se?(t.splice(n+1,0,gi(e,i,r-i.id.clock)),n+1):n},Vt=(e,t)=>{const r=e.doc.store.clients.get(t.client);return r[Oa(e,r,t.clock)]},gu=(e,t,r)=>{const n=t.clients.get(r.client),i=mt(n,r.clock),a=n[i];return r.clock!==a.id.clock+a.length-1&&a.constructor!==Xe&&n.splice(i+1,0,gi(e,a,r.clock-a.id.clock+1)),a},hg=(e,t,r)=>{const n=e.clients.get(t.id.client);n[mt(n,t.id.clock)]=r},Zc=(e,t,r,n,i)=>{if(n===0)return;const a=r+n;let s=Oa(e,t,r),o;do o=t[s++],a<o.id.clock+o.length&&Oa(e,t,a),i(o);while(s<t.length&&t[s].id.clock<a)},pg=class{constructor(e,t,r){this.doc=e,this.deleteSet=new En,this.beforeState=Is(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}},mu=(e,t)=>t.deleteSet.clients.size===0&&!Up(t.afterState,(r,n)=>t.beforeState.get(n)!==r)?!1:(Os(t.deleteSet),Zv(e,t),Rr(e,t.deleteSet),!0),yu=(e,t,r)=>{const n=t._item;(n===null||n.id.clock<(e.beforeState.get(n.id.client)||0)&&!n.deleted)&&qt(e.changed,t,un).add(r)},Xn=(e,t)=>{const r=e[t-1],n=e[t];r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)&&(e.splice(t,1),n instanceof Se&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r))},vg=(e,t,r)=>{for(const[n,i]of e.clients.entries()){const a=t.clients.get(n);for(let s=i.length-1;s>=0;s--){const o=i[s],c=o.clock+o.len;for(let u=mt(a,o.clock),l=a[u];u<a.length&&l.id.clock<c;l=a[++u]){const d=a[u];if(o.clock+o.len<=d.id.clock)break;d instanceof Se&&d.deleted&&!d.keep&&r(d)&&d.gc(t,!1)}}}},gg=(e,t)=>{e.clients.forEach((r,n)=>{const i=t.clients.get(n);for(let a=r.length-1;a>=0;a--){const s=r[a],o=Ac(i.length-1,1+mt(i,s.clock+s.len-1));for(let c=o,u=i[c];c>0&&u.id.clock>=s.clock;u=i[--c])Xn(i,c)}})},Qc=(e,t)=>{if(t<e.length){const r=e[t],n=r.doc,i=n.store,a=r.deleteSet,s=r._mergeStructs;try{Os(a),r.afterState=Is(r.doc.store),n._transaction=null,n.emit("beforeObserverCalls",[r,n]);const o=[];r.changed.forEach((c,u)=>o.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(r,c)})),o.push(()=>{r.changedParentTypes.forEach((c,u)=>o.push(()=>{(u._item===null||!u._item.deleted)&&(c=c.filter(l=>l.target._item===null||!l.target._item.deleted),c.forEach(l=>{l.currentTarget=u}),c.sort((l,d)=>l.path.length-d.path.length),Gc(u._dEH,c,r))})),o.push(()=>n.emit("afterTransaction",[r,n]))}),_s(o,[])}finally{n.gc&&vg(a,i,n.gcFilter),gg(a,i),r.afterState.forEach((l,d)=>{const h=r.beforeState.get(d)||0;if(h!==l){const f=i.clients.get(d),g=hr(mt(f,h),1);for(let y=f.length-1;y>=g;y--)Xn(f,y)}});for(let l=0;l<s.length;l++){const{client:d,clock:h}=s[l].id,f=i.clients.get(d),g=mt(f,h);g+1<f.length&&Xn(f,g+1),g>0&&Xn(f,g)}if(!r.local&&r.afterState.get(n.clientID)!==r.beforeState.get(n.clientID)&&(Uv(Fs,As,"[yjs] ",ws,ks,"Changed the client-id because another client seems to be using it."),n.clientID=Uc()),n.emit("afterTransactionCleanup",[r,n]),n._observers.has("update")){const l=new Sn;mu(l,r)&&n.emit("update",[l.toUint8Array(),r.origin,n,r])}if(n._observers.has("updateV2")){const l=new lr;mu(l,r)&&n.emit("updateV2",[l.toUint8Array(),r.origin,n,r])}const{subdocsAdded:o,subdocsLoaded:c,subdocsRemoved:u}=r;(o.size>0||u.size>0||c.size>0)&&(o.forEach(l=>{l.clientID=n.clientID,l.collectionid==null&&(l.collectionid=n.collectionid),n.subdocs.add(l)}),u.forEach(l=>n.subdocs.delete(l)),n.emit("subdocs",[{loaded:c,added:o,removed:u},n,r]),u.forEach(l=>l.destroy())),e.length<=t+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,e])):Qc(e,t+1)}}},pe=(e,t,r=null,n=!0)=>{const i=e._transactionCleanups;let a=!1;e._transaction===null&&(a=!0,e._transaction=new pg(e,r,n),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{t(e._transaction)}finally{a&&i[0]===e._transaction&&Qc(i,0)}};function*mg(e){const t=ne(e.restDecoder);for(let r=0;r<t;r++){const n=ne(e.restDecoder),i=e.readClient();let a=ne(e.restDecoder);for(let s=0;s<n;s++){const o=e.readInfo();if(o===10){const c=ne(e.restDecoder);yield new Ze(ie(i,a),c),a+=c}else if((Ai&o)!==0){const c=(o&(At|Ve))===0,u=new Se(ie(i,a),null,(o&Ve)===Ve?e.readLeftID():null,null,(o&At)===At?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(o&cn)===cn?e.readString():null,yl(e,o));yield u,a+=u.length}else{const c=e.readLen();yield new Xe(ie(i,a),c),a+=c}}}}var Ms=class{constructor(e,t){this.gen=mg(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Ze);return this.curr}},js=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},yg=e=>fi(e,$c,Sn),Cg=(e,t)=>{if(e.constructor===Xe){const{client:r,clock:n}=e.id;return new Xe(ie(r,n+t),e.length-t)}else if(e.constructor===Ze){const{client:r,clock:n}=e.id;return new Ze(ie(r,n+t),e.length-t)}else{const r=e,{client:n,clock:i}=r.id;return new Se(ie(n,i+t),null,ie(n,i+t-1),null,r.rightOrigin,r.parent,r.parentSub,r.content.splice(t))}},fi=(e,t=Tr,r=lr)=>{if(e.length===1)return e[0];const n=e.map(l=>new t(pr(l)));let i=n.map(l=>new Ms(l,!0)),a=null;const s=new r,o=new js(s);for(;i=i.filter(h=>h.curr!==null),i.sort((h,f)=>{if(h.curr.id.client===f.curr.id.client){const g=h.curr.id.clock-f.curr.id.clock;return g===0?h.curr.constructor===f.curr.constructor?0:h.curr.constructor===Ze?1:-1:g}else return f.curr.id.client-h.curr.id.client}),i.length!==0;){const l=i[0],d=l.curr.id.client;if(a!==null){let h=l.curr,f=!1;for(;h!==null&&h.id.clock+h.length<=a.struct.id.clock+a.struct.length&&h.id.client>=a.struct.id.client;)h=l.next(),f=!0;if(h===null||h.id.client!==d||f&&h.id.clock>a.struct.id.clock+a.struct.length)continue;if(d!==a.struct.id.client)Mt(o,a.struct,a.offset),a={struct:h,offset:0},l.next();else if(a.struct.id.clock+a.struct.length<h.id.clock)if(a.struct.constructor===Ze)a.struct.length=h.id.clock+h.length-a.struct.id.clock;else{Mt(o,a.struct,a.offset);const g=h.id.clock-a.struct.id.clock-a.struct.length;a={struct:new Ze(ie(d,a.struct.id.clock+a.struct.length),g),offset:0}}else{const g=a.struct.id.clock+a.struct.length-h.id.clock;g>0&&(a.struct.constructor===Ze?a.struct.length-=g:h=Cg(h,g)),a.struct.mergeWith(h)||(Mt(o,a.struct,a.offset),a={struct:h,offset:0},l.next())}}else a={struct:l.curr,offset:0},l.next();for(let h=l.curr;h!==null&&h.id.client===d&&h.id.clock===a.struct.id.clock+a.struct.length&&h.constructor!==Ze;h=l.next())Mt(o,a.struct,a.offset),a={struct:h,offset:0}}a!==null&&(Mt(o,a.struct,a.offset),a=null),Ls(o);const c=n.map(l=>xs(l)),u=Vv(c);return Rr(s,u),s.toUint8Array()},Dg=(e,t,r=Tr,n=lr)=>{const i=Vc(t),a=new n,s=new js(a),o=new r(pr(e)),c=new Ms(o,!1);for(;c.curr;){const l=c.curr,d=l.id.client,h=i.get(d)||0;if(c.curr.constructor===Ze){c.next();continue}if(l.id.clock+l.length>h)for(Mt(s,l,hr(h-l.id.clock,0)),c.next();c.curr&&c.curr.id.client===d;)Mt(s,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===d&&c.curr.id.clock+c.curr.length<=h;)c.next()}Ls(s);const u=xs(o);return Rr(a,u),a.toUint8Array()},el=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:lt(e.encoder.restEncoder)}),e.encoder.restEncoder=bn(),e.written=0)},Mt=(e,t,r)=>{e.written>0&&e.currClient!==t.id.client&&el(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),ce(e.encoder.restEncoder,t.id.clock+r)),t.write(e.encoder,r),e.written++},Ls=e=>{el(e);const t=e.encoder.restEncoder;ce(t,e.clientStructs.length);for(let r=0;r<e.clientStructs.length;r++){const n=e.clientStructs[r];ce(t,n.written),Ti(t,n.restEncoder)}},bg=(e,t,r)=>{const n=new t(pr(e)),i=new Ms(n,!1),a=new r,s=new js(a);for(let c=i.curr;c!==null;c=i.next())Mt(s,c,0);Ls(s);const o=xs(n);return Rr(a,o),a.toUint8Array()},Eg=e=>bg(e,Tr,Sn),xi=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null}get path(){return Sg(this.currentTarget,this.target)}deletes(e){return Lc(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){const e=new Map,t=this.target;this.transaction.changed.get(t).forEach(n=>{if(n!==null){const i=t._map.get(n);let a,s;if(this.adds(i)){let o=i.left;for(;o!==null&&this.adds(o);)o=o.left;if(this.deletes(i))if(o!==null&&this.deletes(o))a="delete",s=Zi(o.content.getContent());else return;else o!==null&&this.deletes(o)?(a="update",s=Zi(o.content.getContent())):(a="add",s=void 0)}else if(this.deletes(i))a="delete",s=Zi(i.content.getContent());else return;e.set(n,{action:a,oldValue:s})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){const t=this.target,r=un(),n=un(),i=[];if(e={added:r,deleted:n,delta:i,keys:this.keys},this.transaction.changed.get(t).has(null)){let s=null;const o=()=>{s&&i.push(s)};for(let c=t._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((s===null||s.delete===void 0)&&(o(),s={delete:0}),s.delete+=c.length,n.add(c)):this.adds(c)?((s===null||s.insert===void 0)&&(o(),s={insert:[]}),s.insert=s.insert.concat(c.content.getContent()),r.add(c)):((s===null||s.retain===void 0)&&(o(),s={retain:0}),s.retain+=c.length);s!==null&&s.retain===void 0&&o()}this._changes=e}return e}},Sg=(e,t)=>{const r=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)r.unshift(t._item.parentSub);else{let n=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)i.deleted||n++,i=i.right;r.unshift(n)}t=t._item.parent}return r},tl=80,Ns=0,Bg=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=Ns++}},_g=e=>{e.timestamp=Ns++},rl=(e,t,r)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=r,e.timestamp=Ns++},Ag=(e,t,r)=>{if(e.length>=tl){const n=e.reduce((i,a)=>i.timestamp<a.timestamp?i:a);return rl(n,t,r),n}else{const n=new Bg(t,r);return e.push(n),n}},Pi=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const r=e._searchMarker.length===0?null:e._searchMarker.reduce((a,s)=>qn(t-a.index)<qn(t-s.index)?a:s);let n=e._start,i=0;for(r!==null&&(n=r.p,i=r.index,_g(r));n.right!==null&&i<t;){if(!n.deleted&&n.countable){if(t<i+n.length)break;i+=n.length}n=n.right}for(;n.left!==null&&i>t;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);return r!==null&&qn(r.index-i)<n.parent.length/tl?(rl(r,n,i),r):Ag(e._searchMarker,n,i)},hn=(e,t,r)=>{for(let n=e.length-1;n>=0;n--){const i=e[n];if(r>0){let a=i.p;for(a.marker=!1;a&&(a.deleted||!a.countable);)a=a.left,a&&!a.deleted&&a.countable&&(i.index-=a.length);if(a===null||a.marker===!0){e.splice(n,1);continue}i.p=a,a.marker=!0}(t<i.index||r>0&&t===i.index)&&(i.index=hr(t,i.index+r))}},Ri=(e,t,r)=>{const n=e,i=t.changedParentTypes;for(;qt(i,e,()=>[]).push(r),e._item!==null;)e=e._item.parent;Gc(n._eH,r,t)},Pe=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=fu(),this._dEH=fu(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw gt()}clone(){throw gt()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){du(this._eH,e)}observeDeep(e){du(this._dEH,e)}unobserve(e){hu(this._eH,e)}unobserveDeep(e){hu(this._dEH,e)}toJSON(){}},nl=(e,t,r)=>{t<0&&(t=e._length+t),r<0&&(r=e._length+r);let n=r-t;const i=[];let a=e._start;for(;a!==null&&n>0;){if(a.countable&&!a.deleted){const s=a.content.getContent();if(s.length<=t)t-=s.length;else{for(let o=t;o<s.length&&n>0;o++)i.push(s[o]),n--;t=0}}a=a.right}return i},il=e=>{const t=[];let r=e._start;for(;r!==null;){if(r.countable&&!r.deleted){const n=r.content.getContent();for(let i=0;i<n.length;i++)t.push(n[i])}r=r.right}return t},pn=(e,t)=>{let r=0,n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const i=n.content.getContent();for(let a=0;a<i.length;a++)t(i[a],r++,e)}n=n.right}},al=(e,t)=>{const r=[];return pn(e,(n,i)=>{r.push(t(n,i,e))}),r},wg=e=>{let t=e._start,r=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(r===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};r=t.content.getContent(),n=0,t=t.right}const i=r[n++];return r.length<=n&&(r=null),{done:!1,value:i}}}},sl=(e,t)=>{const r=Pi(e,t);let n=e._start;for(r!==null&&(n=r.p,t-=r.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(t<n.length)return n.content.getContent()[t];t-=n.length}},di=(e,t,r,n)=>{let i=r;const a=e.doc,s=a.clientID,o=a.store,c=r===null?t._start:r.right;let u=[];const l=()=>{u.length>0&&(i=new Se(ie(s,_e(o,s)),i,i&&i.lastId,c,c&&c.id,t,null,new xr(u)),i.integrate(e,0),u=[])};n.forEach(d=>{if(d===null)u.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(d);break;default:switch(l(),d.constructor){case Uint8Array:case ArrayBuffer:i=new Se(ie(s,_e(o,s)),i,i&&i.lastId,c,c&&c.id,t,null,new Ii(new Uint8Array(d))),i.integrate(e,0);break;case Wt:i=new Se(ie(s,_e(o,s)),i,i&&i.lastId,c,c&&c.id,t,null,new Mi(d)),i.integrate(e,0);break;default:if(d instanceof Pe)i=new Se(ie(s,_e(o,s)),i,i&&i.lastId,c,c&&c.id,t,null,new Tt(d)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),l()},ol=Oi("Length exceeded!"),ul=(e,t,r,n)=>{if(r>t._length)throw ol;if(r===0)return t._searchMarker&&hn(t._searchMarker,r,n.length),di(e,t,null,n);const i=r,a=Pi(t,r);let s=t._start;for(a!==null&&(s=a.p,r-=a.index,r===0&&(s=s.prev,r+=s&&s.countable&&!s.deleted?s.length:0));s!==null;s=s.right)if(!s.deleted&&s.countable){if(r<=s.length){r<s.length&&Vt(e,ie(s.id.client,s.id.clock+r));break}r-=s.length}return t._searchMarker&&hn(t._searchMarker,i,n.length),di(e,t,s,n)},kg=(e,t,r)=>{let i=(t._searchMarker||[]).reduce((a,s)=>s.index>a.index?s:a,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return di(e,t,i,r)},cl=(e,t,r,n)=>{if(n===0)return;const i=r,a=n,s=Pi(t,r);let o=t._start;for(s!==null&&(o=s.p,r-=s.index);o!==null&&r>0;o=o.right)!o.deleted&&o.countable&&(r<o.length&&Vt(e,ie(o.id.client,o.id.clock+r)),r-=o.length);for(;n>0&&o!==null;)o.deleted||(n<o.length&&Vt(e,ie(o.id.client,o.id.clock+n)),o.delete(e),n-=o.length),o=o.right;if(n>0)throw ol;t._searchMarker&&hn(t._searchMarker,i,-a+n)},hi=(e,t,r)=>{const n=t._map.get(r);n!==void 0&&n.delete(e)},Us=(e,t,r,n)=>{const i=t._map.get(r)||null,a=e.doc,s=a.clientID;let o;if(n==null)o=new xr([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:o=new xr([n]);break;case Uint8Array:o=new Ii(n);break;case Wt:o=new Mi(n);break;default:if(n instanceof Pe)o=new Tt(n);else throw new Error("Unexpected content type")}new Se(ie(s,_e(a.store,s)),i,i&&i.lastId,null,null,t,r,o).integrate(e,0)},zs=(e,t)=>{const r=e._map.get(t);return r!==void 0&&!r.deleted?r.content.getContent()[r.length-1]:void 0},ll=e=>{const t={};return e._map.forEach((r,n)=>{r.deleted||(t[n]=r.content.getContent()[r.length-1])}),t},fl=(e,t)=>{const r=e._map.get(t);return r!==void 0&&!r.deleted},jn=e=>$v(e.entries(),t=>!t[1].deleted),Fg=class extends xi{constructor(e,t){super(e,t),this._transaction=t}},en=class extends Pe{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const t=new en;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new en}clone(){const e=new en;return e.insert(0,this.toArray().map(t=>t instanceof Pe?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),Ri(this,e,new Fg(this,e))}insert(e,t){this.doc!==null?pe(this.doc,r=>{ul(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?pe(this.doc,t=>{kg(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?pe(this.doc,r=>{cl(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return sl(this,e)}toArray(){return il(this)}slice(e=0,t=this.length){return nl(this,e,t)}toJSON(){return this.map(e=>e instanceof Pe?e.toJSON():e)}map(e){return al(this,e)}forEach(e){pn(this,e)}[Symbol.iterator](){return wg(this)}_write(e){e.writeTypeRef(Xg)}},Tg=e=>new en,Og=class extends xi{constructor(e,t,r){super(e,t),this.keysChanged=r}},vn=class extends Pe{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,n)=>{this.set(n,r)}),this._prelimContent=null}_copy(){return new vn}clone(){const e=new vn;return this.forEach((t,r)=>{e.set(r,t instanceof Pe?t.clone():t)}),e}_callObserver(e,t){Ri(this,e,new Og(this,e,t))}toJSON(){const e={};return this._map.forEach((t,r)=>{if(!t.deleted){const n=t.content.getContent()[t.length-1];e[r]=n instanceof Pe?n.toJSON():n}}),e}get size(){return[...jn(this._map)].length}keys(){return na(jn(this._map),e=>e[0])}values(){return na(jn(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return na(jn(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){const t={};return this._map.forEach((r,n)=>{r.deleted||e(r.content.getContent()[r.length-1],n,this)}),t}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?pe(this.doc,t=>{hi(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?pe(this.doc,r=>{Us(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return zs(this,e)}has(e){return fl(this,e)}clear(){this.doc!==null?pe(this.doc,e=>{this.forEach(function(t,r,n){hi(e,n,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(Zg)}},xg=e=>new vn,jt=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&xv(e,t),xa=class{constructor(e,t,r,n){this.left=e,this.right=t,this.index=r,this.currentAttributes=n}forward(){switch(this.right===null&&Qe(),this.right.content.constructor){case Te:this.right.deleted||Ir(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},Cu=(e,t,r)=>{for(;t.right!==null&&r>0;){switch(t.right.content.constructor){case Te:t.right.deleted||Ir(t.currentAttributes,t.right.content);break;default:t.right.deleted||(r<t.right.length&&Vt(e,ie(t.right.id.client,t.right.id.clock+r)),t.index+=t.right.length,r-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Ln=(e,t,r)=>{const n=new Map,i=Pi(t,r);if(i){const a=new xa(i.p.left,i.p,i.index,n);return Cu(e,a,r-i.index)}else{const a=new xa(null,t._start,0,n);return Cu(e,a,r)}},dl=(e,t,r,n)=>{for(;r.right!==null&&(r.right.deleted===!0||r.right.content.constructor===Te&&jt(n.get(r.right.content.key),r.right.content.value));)r.right.deleted||n.delete(r.right.content.key),r.forward();const i=e.doc,a=i.clientID;n.forEach((s,o)=>{const c=r.left,u=r.right,l=new Se(ie(a,_e(i.store,a)),c,c&&c.lastId,u,u&&u.id,t,null,new Te(o,s));l.integrate(e,0),r.right=l,r.forward()})},Ir=(e,t)=>{const{key:r,value:n}=t;n===null?e.delete(r):e.set(r,n)},hl=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===Te&&jt(t[e.right.content.key]||null,e.right.content.value)))break;e.forward()}},pl=(e,t,r,n)=>{const i=e.doc,a=i.clientID,s=new Map;for(const o in n){const c=n[o],u=r.currentAttributes.get(o)||null;if(!jt(u,c)){s.set(o,u);const{left:l,right:d}=r;r.right=new Se(ie(a,_e(i.store,a)),l,l&&l.lastId,d,d&&d.id,t,null,new Te(o,c)),r.right.integrate(e,0),r.forward()}}return s},ia=(e,t,r,n,i)=>{r.currentAttributes.forEach((h,f)=>{i[f]===void 0&&(i[f]=null)});const a=e.doc,s=a.clientID;hl(r,i);const o=pl(e,t,r,i),c=n.constructor===String?new kt(n):n instanceof Pe?new Tt(n):new Mr(n);let{left:u,right:l,index:d}=r;t._searchMarker&&hn(t._searchMarker,r.index,c.getLength()),l=new Se(ie(s,_e(a.store,s)),u,u&&u.lastId,l,l&&l.id,t,null,c),l.integrate(e,0),r.right=l,r.index=d,r.forward(),dl(e,t,r,o)},Du=(e,t,r,n,i)=>{const a=e.doc,s=a.clientID;hl(r,i);const o=pl(e,t,r,i);e:for(;r.right!==null&&(n>0||o.size>0&&(r.right.deleted||r.right.content.constructor===Te));){if(!r.right.deleted)switch(r.right.content.constructor){case Te:{const{key:c,value:u}=r.right.content,l=i[c];if(l!==void 0){if(jt(l,u))o.delete(c);else{if(n===0)break e;o.set(c,u)}r.right.delete(e)}else r.currentAttributes.set(c,u);break}default:n<r.right.length&&Vt(e,ie(r.right.id.client,r.right.id.clock+n)),n-=r.right.length;break}r.forward()}if(n>0){let c="";for(;n>0;n--)c+=`
`;r.right=new Se(ie(s,_e(a.store,s)),r.left,r.left&&r.left.lastId,r.right,r.right&&r.right.id,t,null,new kt(c)),r.right.integrate(e,0),r.forward()}dl(e,t,r,o)},vl=(e,t,r,n,i)=>{let a=r;const s=ci(i);for(;a&&(!a.countable||a.deleted);)!a.deleted&&a.content.constructor===Te&&Ir(s,a.content),a=a.right;let o=0,c=!1;for(;t!==a;){if(r===t&&(c=!0),!t.deleted){const u=t.content;switch(u.constructor){case Te:{const{key:l,value:d}=u;((s.get(l)||null)!==d||(n.get(l)||null)===d)&&(t.delete(e),o++,!c&&(i.get(l)||null)===d&&(n.get(l)||null)!==d&&i.delete(l));break}}}t=t.right}return o},Pg=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const r=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Te){const n=t.content.key;r.has(n)?t.delete(e):r.add(n)}t=t.left}},Rg=e=>{let t=0;return pe(e.doc,r=>{let n=e._start,i=e._start,a=vt();const s=ci(a);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Te:Ir(s,i.content);break;default:t+=vl(r,n,i,a,s),a=ci(s),n=i;break}i=i.right}}),t},bu=(e,t,r)=>{const n=r,i=ci(t.currentAttributes),a=t.right;for(;r>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Tt:case Mr:case kt:r<t.right.length&&Vt(e,ie(t.right.id.client,t.right.id.clock+r)),r-=t.right.length,t.right.delete(e);break}t.forward()}a&&vl(e,a,t.right,i,t.currentAttributes);const s=(t.left||t.right).parent;return s._searchMarker&&hn(s._searchMarker,t.index,-n+r),t},gl=class extends xi{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(n=>{n===null?this.childListChanged=!0:this.keysChanged.add(n)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,t=[];pe(e,r=>{const n=new Map,i=new Map;let a=this.target._start,s=null;const o={};let c="",u=0,l=0;const d=()=>{if(s!==null){let h;switch(s){case"delete":h={delete:l},l=0;break;case"insert":h={insert:c},n.size>0&&(h.attributes={},n.forEach((f,g)=>{f!==null&&(h.attributes[g]=f)})),c="";break;case"retain":if(h={retain:u},Object.keys(o).length>0){h.attributes={};for(const f in o)h.attributes[f]=o[f]}u=0;break}t.push(h),s=null}};for(;a!==null;){switch(a.content.constructor){case Tt:case Mr:this.adds(a)?this.deletes(a)||(d(),s="insert",c=a.content.getContent()[0],d()):this.deletes(a)?(s!=="delete"&&(d(),s="delete"),l+=1):a.deleted||(s!=="retain"&&(d(),s="retain"),u+=1);break;case kt:this.adds(a)?this.deletes(a)||(s!=="insert"&&(d(),s="insert"),c+=a.content.str):this.deletes(a)?(s!=="delete"&&(d(),s="delete"),l+=a.length):a.deleted||(s!=="retain"&&(d(),s="retain"),u+=a.length);break;case Te:{const{key:h,value:f}=a.content;if(this.adds(a)){if(!this.deletes(a)){const g=n.get(h)||null;jt(g,f)?f!==null&&a.delete(r):(s==="retain"&&d(),jt(f,i.get(h)||null)?delete o[h]:o[h]=f)}}else if(this.deletes(a)){i.set(h,f);const g=n.get(h)||null;jt(g,f)||(s==="retain"&&d(),o[h]=g)}else if(!a.deleted){i.set(h,f);const g=o[h];g!==void 0&&(jt(g,f)?g!==null&&a.delete(r):(s==="retain"&&d(),f===null?delete o[h]:o[h]=f))}a.deleted||(s==="insert"&&d(),Ir(n,a.content));break}}a=a.right}for(d();t.length>0;){const h=t[t.length-1];if(h.retain!==void 0&&h.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},gn=class extends Pe{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new gn}clone(){const e=new gn;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);const r=new gl(this,e,t),n=e.doc;if(Ri(this,e,r),!e.local){let i=!1;for(const[a,s]of e.afterState.entries()){const o=e.beforeState.get(a)||0;if(s!==o&&(Zc(e,n.store.clients.get(a),o,s,c=>{!c.deleted&&c.content.constructor===Te&&(i=!0)}),i))break}i||Ta(e,e.deleteSet,a=>{a instanceof Xe||i||a.parent===this&&a.content.constructor===Te&&(i=!0)}),pe(n,a=>{i?Rg(this):Ta(a,a.deleteSet,s=>{s instanceof Xe||s.parent===this&&Pg(a,s)})})}}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===kt&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?pe(this.doc,r=>{const n=new xa(null,this._start,0,new Map);for(let i=0;i<e.length;i++){const a=e[i];if(a.insert!==void 0){const s=!t&&typeof a.insert=="string"&&i===e.length-1&&n.right===null&&a.insert.slice(-1)===`
`?a.insert.slice(0,-1):a.insert;(typeof s!="string"||s.length>0)&&ia(r,this,n,s,a.attributes||{})}else a.retain!==void 0?Du(r,this,n,a.retain,a.attributes||{}):a.delete!==void 0&&bu(r,n,a.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){const n=[],i=new Map,a=this.doc;let s="",o=this._start;function c(){if(s.length>0){const u={};let l=!1;i.forEach((h,f)=>{l=!0,u[f]=h});const d={insert:s};l&&(d.attributes=u),n.push(d),s=""}}return pe(a,u=>{for(e&&Yn(u,e),t&&Yn(u,t);o!==null;){if($r(o,e)||t!==void 0&&$r(o,t))switch(o.content.constructor){case kt:{const l=i.get("ychange");e!==void 0&&!$r(o,e)?(l===void 0||l.user!==o.id.client||l.state!=="removed")&&(c(),i.set("ychange",r?r("removed",o.id):{type:"removed"})):t!==void 0&&!$r(o,t)?(l===void 0||l.user!==o.id.client||l.state!=="added")&&(c(),i.set("ychange",r?r("added",o.id):{type:"added"})):l!==void 0&&(c(),i.delete("ychange")),s+=o.content.str;break}case Tt:case Mr:{c();const l={insert:o.content.getContent()[0]};if(i.size>0){const d={};l.attributes=d,i.forEach((h,f)=>{d[f]=h})}n.push(l);break}case Te:$r(o,e)&&(c(),Ir(i,o.content));break}o=o.right}c()},Yn),n}insert(e,t,r){if(t.length<=0)return;const n=this.doc;n!==null?pe(n,i=>{const a=Ln(i,this,e);r||(r={},a.currentAttributes.forEach((s,o)=>{r[o]=s})),ia(i,this,a,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r={}){const n=this.doc;n!==null?pe(n,i=>{const a=Ln(i,this,e);ia(i,this,a,t,r)}):this._pending.push(()=>this.insertEmbed(e,t,r))}delete(e,t){if(t===0)return;const r=this.doc;r!==null?pe(r,n=>{bu(n,Ln(n,this,e),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;const n=this.doc;n!==null?pe(n,i=>{const a=Ln(i,this,e);a.right!==null&&Du(i,this,a,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?pe(this.doc,t=>{hi(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?pe(this.doc,r=>{Us(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return zs(this,e)}getAttributes(e){return ll(this)}_write(e){e.writeTypeRef(Qg)}},Ig=e=>new gn,aa=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===pi||t.constructor===Or)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},Or=class extends Pe{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Or}clone(){const e=new Or;return e.insert(0,this.toArray().map(t=>t instanceof Pe?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new aa(this,e)}querySelector(e){e=e.toUpperCase();const r=new aa(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Array.from(new aa(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){Ri(this,e,new Lg(this,t,e))}toString(){return al(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){const n=e.createDocumentFragment();return r!==void 0&&r._createAssociation(n,this),pn(this,i=>{n.insertBefore(i.toDOM(e,t,r),null)}),n}insert(e,t){this.doc!==null?pe(this.doc,r=>{ul(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)pe(this.doc,r=>{const n=e&&e instanceof Pe?e._item:e;di(r,this,n,t)});else{const r=this._prelimContent,n=e===null?0:r.findIndex(i=>i===e)+1;if(n===0&&e!==null)throw Oi("Reference item not found");r.splice(n,0,...t)}}delete(e,t=1){this.doc!==null?pe(this.doc,r=>{cl(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return il(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return sl(this,e)}slice(e=0,t=this.length){return nl(this,e,t)}forEach(e){pn(this,e)}_write(e){e.writeTypeRef(tm)}},Mg=e=>new Or,pi=class extends Or{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,n)=>{this.setAttribute(n,r)}),this._prelimAttrs=null}_copy(){return new pi(this.nodeName)}clone(){const e=new pi(this.nodeName),t=this.getAttributes();for(const r in t)e.setAttribute(r,t[r]);return e.insert(0,this.toArray().map(r=>r instanceof Pe?r.clone():r)),e}toString(){const e=this.getAttributes(),t=[],r=[];for(const s in e)r.push(s);r.sort();const n=r.length;for(let s=0;s<n;s++){const o=r[s];t.push(o+'="'+e[o]+'"')}const i=this.nodeName.toLocaleLowerCase(),a=t.length>0?" "+t.join(" "):"";return`<${i}${a}>${super.toString()}</${i}>`}removeAttribute(e){this.doc!==null?pe(this.doc,t=>{hi(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?pe(this.doc,r=>{Us(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return zs(this,e)}hasAttribute(e){return fl(this,e)}getAttributes(e){return ll(this)}toDOM(e=document,t={},r){const n=e.createElement(this.nodeName),i=this.getAttributes();for(const a in i)n.setAttribute(a,i[a]);return pn(this,a=>{n.appendChild(a.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(em),e.writeKey(this.nodeName)}},jg=e=>new pi(e.readKey()),Lg=class extends xi{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(n=>{n===null?this.childListChanged=!0:this.attributesChanged.add(n)})}},Pa=class extends vn{constructor(e){super(),this.hookName=e}_copy(){return new Pa(this.hookName)}clone(){const e=new Pa(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){const n=t[this.hookName];let i;return n!==void 0?i=n.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(rm),e.writeKey(this.hookName)}},Ng=e=>new Pa(e.readKey()),Oe=class extends gn{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Oe}clone(){const e=new Oe;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){const n=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(n,this),n}toString(){return this.toDelta().map(e=>{const t=[];for(const n in e.attributes){const i=[];for(const a in e.attributes[n])i.push({key:a,value:e.attributes[n][a]});i.sort((a,s)=>a.key<s.key?-1:1),t.push({nodeName:n,attrs:i})}t.sort((n,i)=>n.nodeName<i.nodeName?-1:1);let r="";for(let n=0;n<t.length;n++){const i=t[n];r+=`<${i.nodeName}`;for(let a=0;a<i.attrs.length;a++){const s=i.attrs[a];r+=` ${s.key}="${s.value}"`}r+=">"}r+=e.insert;for(let n=t.length-1;n>=0;n--)r+=`</${t[n].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(nm)}},Ug=e=>new Oe,$s=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw gt()}mergeWith(e){return!1}write(e,t,r){throw gt()}integrate(e,t){throw gt()}},zg=0,Xe=class extends $s{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),Xc(e.doc.store,this)}write(e,t){e.writeInfo(zg),e.writeLen(this.length-t)}getMissing(e,t){return null}},Ii=class{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ii(this.content)}splice(e){throw gt()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},$g=e=>new Ii(e.readBuf()),vi=class{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new vi(this.len)}splice(e){const t=new vi(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){li(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},Wg=e=>new vi(e.readLen()),ml=(e,t)=>new Wt({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1}),Mi=class{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Mi(ml(this.doc.guid,this.opts))}splice(e){throw gt()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},Vg=e=>new Mi(ml(e.readString(),e.readAny())),Mr=class{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Mr(this.embed)}splice(e){throw gt()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},Gg=e=>new Mr(e.readJSON()),Te=class{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Te(this.key,this.value)}splice(e){throw gt()}mergeWith(e){return!1}integrate(e,t){t.parent._searchMarker=null}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},qg=e=>new Te(e.readKey(),e.readJSON()),Ra=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ra(this.arr)}splice(e){const t=new Ra(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){const i=this.arr[n];e.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}},Hg=e=>{const t=e.readLen(),r=[];for(let n=0;n<t;n++){const i=e.readString();i==="undefined"?r.push(void 0):r.push(JSON.parse(i))}return new Ra(r)},xr=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new xr(this.arr)}splice(e){const t=new xr(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){const i=this.arr[n];e.writeAny(i)}}getRef(){return 8}},Kg=e=>{const t=e.readLen(),r=[];for(let n=0;n<t;n++)r.push(e.readAny());return new xr(r)},kt=class{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new kt(this.str)}splice(e){const t=new kt(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},Yg=e=>new kt(e.readString()),Jg=[Tg,xg,Ig,jg,Mg,Ng,Ug],Xg=0,Zg=1,Qg=2,em=3,tm=4,rm=5,nm=6,Tt=class{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Tt(this.type._copy())}splice(e){throw gt()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},im=e=>new Tt(Jg[e.readTypeRef()](e)),Eu=(e,t)=>{let r=t,n=0,i;do n>0&&(r=ie(r.client,r.clock+n)),i=Jn(e,r),n=r.clock-i.id.clock,r=i.redone;while(r!==null&&i instanceof Se);return{item:i,diff:n}},gi=(e,t,r)=>{const{client:n,clock:i}=t.id,a=new Se(ie(n,i+r),t,ie(n,i+r-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(r));return t.deleted&&a.markDeleted(),t.keep&&(a.keep=!0),t.redone!==null&&(a.redone=ie(t.redone.client,t.redone.clock+r)),t.right=a,a.right!==null&&(a.right.left=a),e._mergeStructs.push(a),a.parentSub!==null&&a.right===null&&a.parent._map.set(a.parentSub,a),t.length=r,a},Se=class extends $s{constructor(e,t,r,n,i,a,s,o){super(e,o.getLength()),this.origin=r,this.left=t,this.right=n,this.rightOrigin=i,this.parent=a,this.parentSub=s,this.redone=null,this.content=o,this.info=this.content.isCountable()?ru:0}set marker(e){(this.info&ea)>0!==e&&(this.info^=ea)}get marker(){return(this.info&ea)>0}get keep(){return(this.info&tu)>0}set keep(e){this.keep!==e&&(this.info^=tu)}get countable(){return(this.info&ru)>0}get deleted(){return(this.info&Qi)>0}set deleted(e){this.deleted!==e&&(this.info^=Qi)}markDeleted(){this.info|=Qi}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=_e(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=_e(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===_r&&this.id.client!==this.parent.client&&this.parent.clock>=_e(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=gu(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Vt(e,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===Xe||this.right&&this.right.constructor===Xe)&&(this.parent=null),!this.parent)this.left&&this.left.constructor===Se&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Se&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===_r){const r=Jn(t,this.parent);r.constructor===Xe?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=gu(e,e.doc.store,ie(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,n;if(r!==null)n=r.right;else if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start;const i=new Set,a=new Set;for(;n!==null&&n!==this.right;){if(a.add(n),i.add(n),In(this.origin,n.origin)){if(n.id.client<this.id.client)r=n,i.clear();else if(In(this.rightOrigin,n.rightOrigin))break}else if(n.origin!==null&&a.has(Jn(e.doc.store,n.origin)))i.has(Jn(e.doc.store,n.origin))||(r=n,i.clear());else break;n=n.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Xc(e.doc.store,this),this.content.integrate(e,this),yu(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Xe(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:ie(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&In(e.origin,this.lastId)&&this.right===e&&In(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),li(e.deleteSet,this.id.client,this.id.clock,this.length),yu(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Qe();this.content.gc(e),t?hg(e,this,new Xe(this.id,this.length)):this.content=new vi(this.length)}write(e,t){const r=t>0?ie(this.id.client,this.id.clock+t-1):this.origin,n=this.rightOrigin,i=this.parentSub,a=this.content.getRef()&Ai|(r===null?0:Ve)|(n===null?0:At)|(i===null?0:cn);if(e.writeInfo(a),r!==null&&e.writeLeftID(r),n!==null&&e.writeRightID(n),r===null&&n===null){const s=this.parent;if(s._item!==void 0){const o=s._item;if(o===null){const c=qc(s);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(o.id)}else s.constructor===String?(e.writeParentInfo(!0),e.writeString(s)):s.constructor===_r?(e.writeParentInfo(!1),e.writeLeftID(s)):Qe();i!==null&&e.writeString(i)}this.content.write(e,t)}},yl=(e,t)=>am[t&Ai](e),am=[()=>{Qe()},Wg,Hg,$g,Yg,Gg,qg,im,Kg,Vg,()=>{Qe()}],sm=10,Ze=class extends $s{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){Qe()}write(e,t){e.writeInfo(sm),ce(e.restEncoder,this.length-t)}getMissing(e,t){return null}},Cl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Dl="__ $YJS$ __";Cl[Dl]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Cl[Dl]=!0;var om=Object.defineProperty,um=Object.defineProperties,cm=Object.getOwnPropertyDescriptors,mi=Object.getOwnPropertySymbols,bl=Object.prototype.hasOwnProperty,El=Object.prototype.propertyIsEnumerable,Su=(e,t,r)=>t in e?om(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,et=(e,t)=>{for(var r in t||(t={}))bl.call(t,r)&&Su(e,r,t[r]);if(mi)for(var r of mi(t))El.call(t,r)&&Su(e,r,t[r]);return e},Bn=(e,t)=>um(e,cm(t)),lm=(e,t)=>{var r={};for(var n in e)bl.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&mi)for(var n of mi(e))t.indexOf(n)<0&&El.call(e,n)&&(r[n]=e[n]);return r};function Bu(e){return Object.prototype.toString.call(e)==="[object Object]"}function _u(e){if(!Bu(e))return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(Bu(r)===!1||r.hasOwnProperty("isPrototypeOf")===!1)}function Ws(e,t){for(const r in e){const n=e[r],i=t[r];if(_u(n)&&_u(i)){if(!Ws(n,i))return!1}else if(Array.isArray(n)&&Array.isArray(i)){if(n.length!==i.length)return!1;for(let a=0;a<n.length;a++)if(n[a]!==i[a])return!1}else if(n!==i)return!1}for(const r in t)if(e[r]===void 0&&t[r]!==void 0)return!1;return!0}function fm(e,...t){return Object.fromEntries(Object.entries(e).filter(([r])=>t.includes(r)))}function dm(e,...t){return Object.fromEntries(Object.entries(e).filter(([r])=>!t.includes(r)))}function hm(e){return Object.fromEntries(Object.entries(e).filter(([,t])=>t!==null))}function pm(e){var t,r;const n=[];for(const i of e){if(typeof i.insert=="string"&&i.insert.length===0)continue;const a=n[n.length-1];if(!a||typeof a.insert!="string"||typeof i.insert!="string"){n.push(i);continue}if(a.attributes===i.attributes||!a.attributes==!i.attributes&&Ws((t=a.attributes)!=null?t:{},(r=i.attributes)!=null?r:{})){a.insert+=i.insert;continue}n.push(i)}return n}function Ot(e){return pm(e.toDelta())}function Sl({insert:e}){return typeof e=="string"?e.length:1}function Bl(e){return e.reduce((t,r)=>t+Sl(r),0)}function _l(e,t,r){if(r<1)return[];let n=0;const i=[],a=t+r;for(let s=0;s<e.length&&!(n>=a);s++){const o=e[s],c=Sl(o);if(n+c<=t){n+=c;continue}if(typeof o.insert!="string"){n+=c,i.push(o);continue}const u=Math.max(0,t-n),l=Math.min(c,c-(n+c-a));i.push(Bn(et({},o),{insert:o.insert.slice(u,l)})),n+=c}return i}function Lt(e){return dm(e,G.isText(e)?"text":"children")}function Al(e){const t=Ot(e),r=t.length>0?t.map(Ia):[{text:""}];return Bn(et({},e.getAttributes()),{children:r})}function Ia(e){return typeof e.insert=="string"?Bn(et({},e.attributes),{text:e.insert}):Al(e.insert)}function wl(e){return e.map(t=>G.isText(t)?{insert:t.text,attributes:Lt(t)}:{insert:kl(t)})}function kl(e){var t=e,{children:r}=t,n=lm(t,["children"]);const i=new Oe;return Object.entries(n).forEach(([a,s])=>{i.setAttribute(a,s)}),i.applyDelta(wl(r),{sanitize:!1}),i}function mn(e){return e?G.isText(e)?e.text.length:1:0}function vm(e,t){return e.children.slice(0,t).reduce((r,n)=>r+mn(n),0)}function He(e,t,r){var n;if(r.length===0)throw new Error("Path has to a have a length >= 1");if(G.isText(t))throw new Error("Cannot descent into slate text");const[i,...a]=r,s=vm(t,i),o=t.children[i],c=Ot(e),u=mn(o),l=_l(c,s,u);if(l.length>1)throw new Error("Path doesn't match yText, yTarget spans multiple nodes");const d=(n=l[0])==null?void 0:n.insert;if(a.length>0){if(!(d instanceof Oe))throw new Error("Path doesn't match yText, cannot descent into non-yText");return He(d,o,a)}return{yParent:e,textRange:{start:s,end:s+u},yTarget:d instanceof Oe?d:void 0,slateParent:t,slateTarget:o,targetDelta:l}}function er(e,t,r={}){const{assoc:n=0,insert:i=!1}=r;let a=0,s=0;for(let u=0;u<e.children.length;u++){const l=e.children[u],d=G.isText(l)?l.text.length:1;d>0&&(s=u);const h=a+d;if(d>0&&(n>=0?h>t:h>=t))return[u,t-a];a+=d}if(t>a+(i?1:0))throw new Error("yOffset out of bounds");if(i)return[e.children.length,0];const o=e.children[s],c=G.isText(o)?o.text.length:1;return[s,c]}function Fl(e,t,r){const n=[r];for(;n[0]!==e;){const{parent:a}=n[0];if(!a)throw new Error("yText isn't a descendant of root element");if(!(a instanceof Oe))throw new Error("Unexpected y parent type");n.unshift(a)}if(n.length<2)return[];let i=t;return n.reduce((a,s,o)=>{const c=n[o+1];if(!c)return a;let u=0;const l=Ot(s);for(const h of l){if(h.insert===c)break;u+=typeof h.insert=="string"?h.insert.length:1}if(G.isText(i))throw new Error("Cannot descent into slate text");const[d]=er(i,u);return i=i.children[d],a.concat(d)},[])}function gm(e,t,r){const n=[];let i=r.reduce((a,s)=>"retain"in s?a+s.retain:"delete"in s?a+s.delete:a,0);return r.reverse().forEach(a=>{var s;if("attributes"in a&&"retain"in a){const[o,c]=er(e,i-a.retain),[u,l]=er(e,i,{assoc:-1});for(let d=u;d>=o;d--){const h=e.children[d],f=[...t,d],g=a.attributes,y=fm(e,...Object.keys(a.attributes));if(G.isText(h)&&(d===o||d===u)){const E=d===o?c:0,A=d===u?l:h.text.length;if(A!==h.text.length&&n.push({type:"split_node",path:f,position:A,properties:Lt(h)}),E!==0){n.push({type:"split_node",path:f,position:E,properties:hm(et(et({},Lt(h)),g))});continue}}n.push({type:"set_node",newProperties:g,path:f,properties:y})}}if("retain"in a&&(i-=a.retain),"delete"in a){const[o,c]=er(e,i-a.delete),[u,l]=er(e,i,{assoc:-1});for(let d=l===0?u-1:u;d>=o;d--){const h=e.children[d],f=[...t,d];if(G.isText(h)&&(d===o||d===u)){const g=d===o?c:0,y=d===u?l:h.text.length;n.push({type:"remove_text",offset:g,text:h.text.slice(g,y),path:f}),i-=y-g;continue}n.push({type:"remove_node",node:h,path:f}),i-=mn(h)}return}if("insert"in a){const[o,c]=er(e,i,{insert:!0}),u=e.children[o],l=[...t,o];if(G.isText(u)){if(typeof a.insert=="string"&&Ws((s=a.attributes)!=null?s:{},Lt(u)))return n.push({type:"insert_text",offset:c,text:a.insert,path:l});const d=Ia(a);return c===0?n.push({type:"insert_node",path:l,node:d}):(c<u.text.length&&n.push({type:"split_node",path:l,position:c,properties:Lt(u)}),n.push({type:"insert_node",path:D.next(l),node:d}))}return n.push({type:"insert_node",path:l,node:Ia(a)})}}),n}function mm(e,t,r){const{target:n,changes:i}=r,a=r.delta;if(!(n instanceof Oe))throw new Error("Unexpected target node type");const s=[],o=Fl(e,t,n),c=$.get(t,o);if(G.isText(c))throw new Error("Cannot apply yTextEvent to text node");const u=Array.from(i.keys.entries());if(o.length>0&&u.length>0){const l=Object.fromEntries(u.map(([h,f])=>[h,f.action==="delete"?null:n.getAttribute(h)])),d=Object.fromEntries(u.map(([h])=>[h,c[h]]));s.push({type:"set_node",newProperties:l,properties:d,path:o})}if(a.length>0){if(G.isText(c))throw new Error("Cannot apply delta to slate text");s.push(...gm(c,o,a))}return s}function ym(e,t,r){if(r instanceof gl)return mm(e,t,r);throw new Error("Unexpected Y event type")}function Cm(e,t,r){p.withoutNormalizing(t,()=>{r.forEach(n=>{ym(e,t,n).forEach(i=>{t.apply(i)})})})}function Dm(e,t,r){const{yParent:n,textRange:i}=He(e,t,r.path);if(G.isText(r.node))return n.insert(i.start,r.node.text,Lt(r.node));n.insertEmbed(i.start,kl(r.node))}function ji(e){return e.map(t=>typeof t.insert=="string"?t:Bn(et({},t),{insert:bm(t.insert)}))}function bm(e){const t=new Oe,r=e.getAttributes();return Object.entries(r).forEach(([n,i])=>{t.setAttribute(n,i)}),t.applyDelta(ji(Ot(e)),{sanitize:!1}),t}function Ar(e){if(!e.doc)throw new Error("shared type isn't attached to a document")}var fr="__slateYjsStoredPosition_";function Em(e,t,r){const{yTarget:n,yParent:i,textRange:a}=He(e,t,r.path);if(n)throw new Error("Slate point points to a non-text element inside sharedRoot");return Hc(i,a.start+r.offset,r.offset===a.end?-1:0)}function Sm(e,t,{type:r,index:n,assoc:i}){if(!(r instanceof Oe))throw new Error("Absolute position points to a non-XMLText");const a=Fl(e,t,r),s=$.get(t,a);if(G.isText(s))throw new Error("Absolute position doesn't match slateRoot, cannot descent into text");const[o,c]=er(s,n,{assoc:i}),u=s.children[o];return G.isText(u)?{path:[...a,o],offset:c}:null}function Bm(e,t,r){if(!e.doc)throw new Error("sharedRoot isn't attach to a yDoc");const n=Yc(r,e.doc);return n&&Sm(e,t,n)}function _m(e,t){const r=e.getAttribute(fr+t);return r?Kc(r):null}function Am(e){return Object.fromEntries(Object.entries(e.getAttributes()).filter(([t])=>t.startsWith(fr)).map(([t,r])=>[t.slice(fr.length),ig(r)]))}function wm(e){return Ar(e),Object.fromEntries(Object.entries(e.getAttributes()).filter(([t])=>t.startsWith(fr)).map(([t,r])=>[t.slice(fr.length),Yc(Kc(r),e.doc)]).filter(([,t])=>t))}function km(e,t){e.removeAttribute(fr+t)}function Tl(e,t,r){e.setAttribute(fr+t,ug(r))}function Ol(e,t,r){return Object.fromEntries(Object.entries(e).filter(([,n])=>n.type!==t?!1:r?n.assoc>=0?n.index>=r.start&&n.index<r.end:n.index>r.start&&n.index>=r.end:!0))}function xl(e,t,r=""){const n={[r]:Ol(e,t)};return Ot(t).forEach(({insert:a},s)=>{a instanceof Oe&&Object.assign(n,xl(e,a,r?`${r}.${s}`:s.toString()))}),n}function Vs(e,t,r,n=0){const i=wm(e),a={"":Ol(i,t,{start:n,end:n+Bl(r)})};return r.forEach(({insert:s},o)=>{s instanceof Oe&&Object.assign(a,xl(i,s,o.toString()))}),a}function Li(e,t,r,n,i=0,a=0,s=""){const o=r[s];o&&Object.entries(o).forEach(([c,u])=>{Tl(e,c,Hc(t,u.index-a+i,u.assoc))}),n.forEach(({insert:c},u)=>{c instanceof Oe&&Li(e,c,r,Ot(c),0,0,s?`${s}.${u}`:u.toString())})}function Fm(e,t,r){const n=He(e,t,r.path),i=He(n.yParent,n.slateParent,D.previous(r.path.slice(-1)));if(!n.yTarget!=!i.yTarget)throw new Error("Cannot merge y text with y element");if(!i.yTarget||!n.yTarget){const{yParent:l,textRange:d}=n,h=$.get(t,D.previous(r.path));if(!G.isText(h))throw new Error("Path points to a y text but not a slate node");return l.format(d.start,d.start-d.end,Lt(h))}const a=i.yTarget.length,s=Ot(n.yTarget),o=ji(s),c=Vs(e,n.yTarget,s,a),u=[{retain:a},...o];i.yTarget.applyDelta(u,{sanitize:!1}),n.yParent.delete(n.textRange.start,n.textRange.end-n.textRange.start),Li(e,i.yTarget,c,o,a)}function Tm(e,t,r){const n=D.parent(r.newPath),i=r.newPath[r.newPath.length-1],a=$.get(t,n);if(G.isText(a))throw new Error("Cannot move slate node into text element");const s=[...n,Math.min(i,a.children.length)],o=He(e,t,r.path),c=He(e,t,s),u=ji(o.targetDelta),l=Vs(e,o.yParent,o.targetDelta);o.yParent.delete(o.textRange.start,o.textRange.end-o.textRange.start);const d=Bl(Ot(c.yParent)),h=Math.min(c.textRange.start,d),f=[{retain:h},...u];c.yParent.applyDelta(f,{sanitize:!1}),Li(e,c.yParent,l,u,h,o.textRange.start)}function Om(e,t,r){const{yParent:n,textRange:i}=He(e,t,r.path);n.delete(i.start,i.end-i.start)}function xm(e,t,r){const{yTarget:n,textRange:i,yParent:a}=He(e,t,r.path);if(n)return Object.entries(r.newProperties).forEach(([c,u])=>{if(u===null)return n.removeAttribute(c);n.setAttribute(c,u)}),Object.entries(r.properties).forEach(([c])=>{r.newProperties.hasOwnProperty(c)||n.removeAttribute(c)});const s=Object.fromEntries(Object.keys(r.properties).map(c=>[c,null])),o=et(et({},s),r.newProperties);a.format(i.start,i.end-i.start,o)}function Pm(e,t,r){const n=He(e,t,r.path);if(!n.slateTarget)throw new Error("Y target without corresponding slate node");if(!n.yTarget){if(!G.isText(n.slateTarget))throw new Error("Mismatch node type between y target and slate node");const d={};return n.targetDelta.forEach(h=>{h.attributes&&Object.keys(h.attributes).forEach(f=>{d[f]=null})}),n.yParent.format(n.textRange.start,n.textRange.end-n.textRange.start,et(et({},d),r.properties))}if(G.isText(n.slateTarget))throw new Error("Mismatch node type between y target and slate node");const i=He(n.yTarget,n.slateTarget,[r.position]),a=n.slateTarget.children.slice(0,r.position).reduce((d,h)=>d+mn(h),0),s=n.slateTarget.children.reduce((d,h)=>d+mn(h),0),o=_l(Ot(n.yTarget),a,s-a),c=ji(o),u=Vs(e,n.yTarget,o,a),l=new Oe;l.applyDelta(c,{sanitize:!1}),Object.entries(r.properties).forEach(([d,h])=>{l.setAttribute(d,h)}),n.yTarget.delete(i.textRange.start,n.yTarget.length-i.textRange.start),n.yParent.insertEmbed(n.textRange.end,l),Li(e,l,u,c,0,a)}var Rm={insert_node:Dm,remove_node:Om,set_node:xm,merge_node:Fm,move_node:Tm,split_node:Pm};function Im(e,t,r){const{yParent:n,textRange:i}=He(e,t,r.path),a=$.get(t,r.path);if(!G.isText(a))throw new Error("Cannot insert text into non-text node");n.insert(i.start+r.offset,r.text,Lt(a))}function Mm(e,t,r){const{yParent:n,textRange:i}=He(e,t,r.path);n.delete(i.start+r.offset,r.text.length)}var jm={insert_text:Im,remove_text:Mm},Lm=()=>{},Nm=Bn(et(et({},jm),Rm),{set_selection:Lm});function Um(e,t,r){const n=Nm[r.type];if(!n)throw new Error(`Unknown operation: ${r.type}`);n(e,t,r)}var zm=Symbol("slate-yjs-operation"),$m=Symbol("slate-yjs-position-storage"),sa=new WeakMap,Ma=new WeakMap,ja=new WeakSet,we={isYjsEditor(e){return p.isEditor(e)&&e.sharedRoot instanceof Oe&&"localOrigin"in e&&"positionStorageOrigin"in e&&typeof e.applyRemoteEvents=="function"&&typeof e.storeLocalChange=="function"&&typeof e.flushLocalChanges=="function"&&typeof e.isLocalOrigin=="function"&&typeof e.connect=="function"&&typeof e.disconnect=="function"},localChanges(e){var t;return(t=Ma.get(e))!=null?t:[]},applyRemoteEvents(e,t,r){e.applyRemoteEvents(t,r)},storeLocalChange(e,t){e.storeLocalChange(t)},flushLocalChanges(e){e.flushLocalChanges()},connected(e){return ja.has(e)},connect(e){e.connect()},disconnect(e){e.disconnect()},isLocal(e){return e.isLocalOrigin(we.origin(e))},origin(e){const t=sa.get(e);return t!==void 0?t:e.localOrigin},withOrigin(e,t,r){const n=we.origin(e);sa.set(e,t),r(),sa.set(e,n)},storePosition(e,t,r){const{sharedRoot:n,positionStorageOrigin:i}=e;Ar(n);const a=Em(n,e,r);n.doc.transact(()=>{Tl(n,t,a)},i)},removeStoredPosition(e,t){const{sharedRoot:r,positionStorageOrigin:n}=e;Ar(r),r.doc.transact(()=>{km(r,t)},n)},position(e,t){const r=_m(e.sharedRoot,t);if(!!r)return Bm(e.sharedRoot,e,r)},storedPositionsRelative(e){return Am(e.sharedRoot)}};function Wm(e,t,{localOrigin:r,positionStorageOrigin:n,autoConnect:i=!1}={}){const a=e;a.sharedRoot=t,a.localOrigin=r??zm,a.positionStorageOrigin=n??$m,a.applyRemoteEvents=(l,d)=>{we.flushLocalChanges(a),p.withoutNormalizing(a,()=>{we.withOrigin(a,d,()=>{Cm(a.sharedRoot,a,l)})})},a.isLocalOrigin=l=>l===a.localOrigin;const s=(l,d)=>{a.isLocalOrigin(d.origin)||we.applyRemoteEvents(a,l,d.origin)};let o=null;i&&(o=setTimeout(()=>{o=null,we.connect(a)})),a.connect=()=>{if(we.connected(a))throw new Error("already connected");a.sharedRoot.observeDeep(s);const l=Al(a.sharedRoot);a.children=l.children,ja.add(a),a.onChange()},a.disconnect=()=>{o&&clearTimeout(o),we.flushLocalChanges(a),a.sharedRoot.unobserveDeep(s),ja.delete(a)},a.storeLocalChange=l=>{Ma.set(a,[...we.localChanges(a),{op:l,doc:e.children,origin:we.origin(a)}])},a.flushLocalChanges=()=>{Ar(a.sharedRoot);const l=we.localChanges(a);Ma.delete(a);const d=[];l.forEach(h=>{const f=d[d.length-1];if(f&&f[0].origin===h.origin)return f.push(h);d.push([h])}),d.forEach(h=>{Ar(a.sharedRoot),a.sharedRoot.doc.transact(()=>{h.forEach(f=>{Ar(a.sharedRoot),Um(a.sharedRoot,{children:f.doc},f.op)})},h[0].origin)})};const{apply:c,onChange:u}=a;return a.apply=l=>{we.connected(a)&&we.isLocal(a)&&we.storeLocalChange(a,l),c(l)},a.onChange=()=>{we.connected(a)&&we.flushLocalChanges(a),u()},a}const Vm=e=>{const{normalizeNode:t}=e;return e.normalizeNode=r=>{const[n,i]=r;if(le.isElement(n)){let a=D.hasPrevious(i)&&D.previous(i),s=a?$.get(e,a):!1,o=D.next(i),c=!1;try{c=$.get(e,o)}catch{}let u=n.children.map(d=>d.text).join(""),l=!1;if(n.type!=="empty"&&u.length===0&&(!s||s.type!=="boneyard")&&(O.setNodes(e,{type:"empty",children:[]},{at:i}),l=!0),l||(l=Ym(n,e,i,u,s)),u.length>0&&n.type!=="boneyard"&&(n.type==="empty"&&(O.setNodes(e,{type:"raw"},{at:i}),l=!0),l||(l=qm(n,e,i,u,s)),l||(l=Km(n,e,i,u)),l||(l=Hm(n,e,i,u,s))),l){c&&O.setNodes(e,{edit:!c.edit},{at:o});return}}t(r)},e},Gm=Vm;function qm(e,t,r,n,i){return r.length===1&&r[0]===0&&e.type!=="title_element"&&n.includes(":")?(O.setNodes(t,{type:"title_element",children:[{text:n}]},{at:r}),!0):i&&i.type==="title_element"&&n.length>0&&e.type!=="title_element"?(O.setNodes(t,{type:"title_element",children:[{text:n}]},{at:r}),!0):e.type==="title_element"&&i&&i.type!=="title_element"?(O.setNodes(t,{type:"raw",children:[{text:n}]},{at:r}),!0):!1}function Hm(e,t,r,n,i){return n.length===0||e.type==="transition"||e.type==="scene_header"?!1:(!i||i.type==="empty")&&(n.startsWith("@")||n===n.toUpperCase())&&e.type!=="character"?(O.setNodes(t,{type:"character",children:[{text:n}]},{at:r}),!0):(!i||i.type==="empty")&&n!==n.toUpperCase()&&!n.startsWith("@")&&e.type==="character"?(O.setNodes(t,{type:"raw",children:[{text:n}]},{at:r}),!0):n.startsWith("~")&&i&&(i.type==="character"||i.type==="dialogue"||i.type==="lyrics")&&e.type!=="lyrics"?(O.setNodes(t,{type:"lyrics",children:[{text:n}]},{at:r}),!0):e.type==="lyrics"&&(!i||i.type!=="character"&&i.type!=="dialogue"&&i.type!=="lyrics"||!n.startsWith("~"))?(O.setNodes(t,{type:"raw",children:[{text:n}]},{at:r}),!0):i&&(i.type==="character"||i.type==="dialogue"||i.type==="lyrics")&&e.type!=="dialogue"&&e.type!=="lyrics"?(O.setNodes(t,{type:"dialogue",children:[{text:n}]},{at:r}),!0):e.type==="dialogue"&&(!i||i.type!=="character"&&i.type!=="dialogue"&&i.type!=="lyrics")?(O.setNodes(t,{type:"raw",children:[{text:n}]},{at:r}),!0):!1}const Au=[".","INT","EXT","EST","INT./EXT","INT/EXT","I/E"];function Km(e,t,r,n,i){if(n.length===0)return!1;const a=n.toUpperCase();return e.type!=="scene_header"&&Au.map(s=>a.startsWith(s)).includes(!0)?(O.setNodes(t,{type:"scene_header",children:[{text:n}]},{at:r}),!0):e.type==="scene_header"&&!Au.map(s=>a.startsWith(s)).includes(!0)?(O.setNodes(t,{type:"raw",children:[{text:n}]},{at:r}),!0):e.type!=="transition"&&(n.startsWith(">")&&!n.endsWith("<")||n.endsWith("TO:")&&n===a)?(O.setNodes(t,{type:"transition",children:[{text:n}]},{at:r}),!0):e.type==="transition"&&(!n.startsWith(">")||n.endsWith("<"))&&(!n.endsWith("TO:")||n!==a)?(O.setNodes(t,{type:"raw",children:[{text:n}]},{at:r}),!0):!1}function Ym(e,t,r,n,i){const a=/^===+$/.test(n);return a&&e.type!=="page_break"?(O.setNodes(t,{type:"page_break",children:[{text:n}]},{at:r}),!0):!a&&e.type==="page_break"?(O.setNodes(t,{type:"raw",children:[{text:n}]},{at:r}),!0):n.startsWith("/*")&&n.endsWith("*/")&&e.type!=="boneyard"?(O.setNodes(t,{type:"boneyard",containsStart:!0,containsEnd:!0},{at:r}),!0):n.startsWith("/*")&&e.type!=="boneyard"?(O.setNodes(t,{type:"boneyard",containsStart:!0,containsEnd:!1},{at:r}),!0):n.endsWith("*/")&&(e.type!=="boneyard"||!e.containsEnd)&&i&&i.type==="boneyard"?(O.setNodes(t,{type:"boneyard",containsEnd:!0,containsStart:!1},{at:r}),!0):i&&i.type==="boneyard"&&!i.containsEnd&&e.type!=="boneyard"?(O.setNodes(t,{type:"boneyard",containsStart:!1,containsEnd:!1},{at:r}),!0):e.type==="boneyard"&&e.containsStart&&!n.startsWith("/*")?(O.setNodes(t,{type:"raw",children:[{text:n}]},{at:r}),!0):e.type==="boneyard"&&!e.containsStart&&(!i||i.type!=="boneyard"||i.containsEnd)?(O.setNodes(t,{type:"raw",children:[{text:n}]},{at:r}),!0):!1}const ve={title_page:/^((?:title|credit|author[s]?|source|notes|draft date|date|contact|copyright)\:)/gim,scene_heading:/^((?:\*{0,3}_?)?(?:(?:int|ext|est|i\/e)[. ]).+)|^(?:\.(?!\.+))(.+)/i,scene_number:/( *#(.+)# *)/,transition:/^((?:FADE (?:TO BLACK|OUT)|CUT TO BLACK)\.|.+ TO\:)|^(?:> *)(.+)/,dialogue:/^(?:([A-Z*_][0-9A-Z ._\-']*(?:\(.*\))?[ ]*)|\@([A-Za-z*_][0-9A-Za-z (._\-')]*))(\^?)?(?:\n(?!\n+))([\s\S]+)/,parenthetical:/^(\(.+\))$/,action:/^(.+)/g,centered:/^(?:> *)(.+)(?: *<)(\n.+)*/g,lyrics:/^~(?![ ]).+(?:\n.+)*/,section:/^(#+)(?: *)(.*)/,synopsis:/^(?:\=(?!\=+) *)(.*)/,note:/^(?:\[{2}(?!\[+))(.+)(?:\]{2}(?!\[+))$/,note_inline:/(?:\[{2}(?!\[+))([\s\S]+?)(?:\]{2}(?!\[+))/g,boneyard:/(^\/\*|^\*\/)$/g,page_break:/^\={3,}$/,line_break:/^ {2}$/,emphasis:/(_|\*{1,3}|_\*{1,3}|\*{1,3}_)(.+)(_|\*{1,3}|_\*{1,3}|\*{1,3}_)/g,bold_italic_underline:/(_{1}\*{3}(?=.+\*{3}_{1})|\*{3}_{1}(?=.+_{1}\*{3}))(.+?)(\*{3}_{1}|_{1}\*{3})/g,bold_underline:/(_{1}\*{2}(?=.+\*{2}_{1})|\*{2}_{1}(?=.+_{1}\*{2}))(.+?)(\*{2}_{1}|_{1}\*{2})/g,italic_underline:/(_{1}\*{1}(?=.+\*{1}_{1})|\*{1}_{1}(?=.+_{1}\*{1}))(.+?)(\*{1}_{1}|_{1}\*{1})/g,bold_italic:/(\*{3}(?=.+\*{3}))(.+?)(\*{3})/g,bold:/(\*{2}(?=.+\*{2}))(.+?)(\*{2})/g,italic:/(\*{1}(?=.+\*{1}))(.+?)(\*{1})/g,underline:/(_{1}(?=.+_{1}))(.+?)(_{1})/g,splitter:/\n{2,}/g,cleaner:/^\n+|\n+$/,standardizer:/\r\n|\r/g,whitespacer:/^\t+|^ {3,}/gm};class Pl{reconstruct(t){return t.replace(ve.boneyard,`
$1
`).replace(ve.standardizer,`
`).replace(ve.cleaner,"").replace(ve.whitespacer,"")}}class Jm extends Pl{constructor(){super(...arguments),this.inline={note:"<!-- $1 -->",line_break:"<br />",bold_italic_underline:'<span class="bold italic underline">$2</span>',bold_underline:'<span class="bold underline">$2</span>',italic_underline:'<span class="italic underline">$2</span>',bold_italic:'<span class="bold italic">$2</span>',bold:'<span class="bold">$2</span>',italic:'<span class="italic">$2</span>',underline:'<span class="underline">$2</span>'}}reconstruct(t){if(!t)return;let r;const n=["bold_italic_underline","bold_underline","italic_underline","bold_italic","bold","italic","underline"];t=t.replace(ve.note_inline,this.inline.note).replace(/\\\*/g,"[star]").replace(/\\_/g,"[underline]").replace(/\n/g,this.inline.line_break);for(let i of n)r=ve[i],r.test(t)&&(t=t.replace(r,this.inline[i]));return t.replace(/\[star\]/g,"*").replace(/\[underline\]/g,"_").trim()}}class Xm{constructor(){this.tokens=[]}tokenize(t){const r=new Pl().reconstruct(t).split(ve.splitter).reverse();let n,i,a;for(n of r){if(ve.title_page.test(n)){i=n.replace(ve.title_page,`
$1`).split(ve.splitter).reverse();for(let s of i){let o=s.replace(ve.cleaner,"").split(/\:\n*/);this.tokens.push({type:o[0].trim().toLowerCase().replace(" ","_"),is_title:!0,text:o[1].trim()})}continue}if(i=n.match(ve.scene_heading)){let s=i[1]||i[2],o,c;s.indexOf("  ")!==s.length-2&&((o=s.match(ve.scene_number))&&(c=o[2],s=s.replace(ve.scene_number,"")),this.tokens.push({type:"scene_heading",text:s,scene_number:c||void 0}));continue}if(i=n.match(ve.centered)){this.tokens.push({type:"centered",text:i[0].replace(/>|</g,"")});continue}if(i=n.match(ve.transition)){this.tokens.push({type:"transition",text:i[1]||i[2]});continue}if(i=n.match(ve.dialogue)){let s=i[1]||i[2];if(s.indexOf("  ")!==s.length-2){i[3]&&this.tokens.push({type:"dual_dialogue_end"}),this.tokens.push({type:"dialogue_end"});let o=i[4].split(/(\(.+\))(?:\n+)/).reverse();for(let c of o)c.length>0&&this.tokens.push({type:ve.parenthetical.test(c)?"parenthetical":"dialogue",text:c});this.tokens.push({type:"character",text:s.trim()}),this.tokens.push({type:"dialogue_begin",dual:i[3]?"right":a?"left":void 0}),a&&this.tokens.push({type:"dual_dialogue_begin"}),a=!!i[3];continue}}if(i=n.match(ve.section)){this.tokens.push({type:"section",text:i[2],depth:i[1].length});continue}if(i=n.match(ve.synopsis)){this.tokens.push({type:"synopsis",text:i[1]});continue}if(i=n.match(ve.note)){this.tokens.push({type:"note",text:i[1]});continue}if(i=n.match(ve.boneyard)){this.tokens.push({type:i[0][0]==="/"?"boneyard_begin":"boneyard_end"});continue}if(i=n.match(ve.lyrics)){this.tokens.push({type:"lyrics",text:i[0].replace(/^~(?![ ])/gm,"")});continue}if(ve.page_break.test(n)){this.tokens.push({type:"page_break"});continue}if(ve.line_break.test(n)){this.tokens.push({type:"line_break"});continue}this.tokens.push({type:"action",text:n.replace(/^!(?![ ])/gm,"")})}return this.tokens.reverse()}}class Zm{constructor(){this.scanner=new Xm,this.inlineLex=new Jm}parse(t,r){if(typeof t>"u"||t===null)throw new Error("Script is undefined or null.");if(typeof t!="string")throw new Error(`Script should be \`string\`, input was \`${Object.prototype.toString.call(t)}\`.`);try{this.tokens=this.scanner.tokenize(t);let n=this.tokens.find(i=>i.type==="title");return{title:n?this.inlineLex.reconstruct(n.text).replace("<br />"," ").replace(/<(?:.|\n)*?>/g,""):void 0,html:{title_page:this.tokens.filter(i=>i.is_title).map(i=>this.to_html(i)).join(""),script:this.tokens.filter(i=>!i.is_title).map(i=>this.to_html(i)).join("")},tokens:r?this.tokens:void 0}}catch(n){throw n.message+=`
Please submit an issue to https://github.com/jonnygreenwald/fountain-js/issues`,n}}to_html(t){switch(t.text=this.inlineLex.reconstruct(t.text),t.type){case"title":return"<h1>"+t.text+"</h1>";case"credit":return'<p class="credit">'+t.text+"</p>";case"author":return'<p class="authors">'+t.text+"</p>";case"authors":return'<p class="authors">'+t.text+"</p>";case"source":return'<p class="source">'+t.text+"</p>";case"notes":return'<p class="notes">'+t.text+"</p>";case"draft_date":return'<p class="draft-date">'+t.text+"</p>";case"date":return'<p class="date">'+t.text+"</p>";case"contact":return'<p class="contact">'+t.text+"</p>";case"copyright":return'<p class="copyright">'+t.text+"</p>";case"scene_heading":return"<h3"+(t.scene_number?' id="'+t.scene_number+'">':">")+t.text+"</h3>";case"transition":return"<h2>"+t.text+"</h2>";case"dual_dialogue_begin":return'<div class="dual-dialogue">';case"dialogue_begin":return'<div class="dialogue'+(t.dual?" "+t.dual:"")+'">';case"character":return"<h4>"+t.text+"</h4>";case"parenthetical":return'<p class="parenthetical">'+t.text+"</p>";case"dialogue":return"<p>"+t.text+"</p>";case"dialogue_end":return"</div>";case"dual_dialogue_end":return"</div>";case"section":return'<p class="section" data-depth="'+t.depth+'">'+t.text+"</p>";case"synopsis":return'<p class="synopsis">'+t.text+"</p>";case"note":return"<!-- "+t.text+" -->";case"boneyard_begin":return"<!-- ";case"boneyard_end":return" -->";case"action":return"<p>"+t.text+"</p>";case"centered":return'<p class="centered">'+t.text+"</p>";case"lyrics":return'<p class="lyrics">'+t.text+"</p>";case"page_break":return"<hr />";case"line_break":return"<br />"}}}const oa=dr.useCallback,Qm=dr.useEffect,ua=dr.useMemo,Nn=dr.useState,e0=e=>e.map(t=>$.string(t)).join(`
`);function t0(e){const r=new Zm().parse(e);return`${r.html.title_page}<br/>${r.html.script}`}const r0=1;function n0({listing:e,file:t,renameFile:r,closeFile:n}){const[i,a]=Nn(!1),{content:s}=ua(()=>t.connect(),[t]),[o,c]=Nn(0),[u,l]=Nn(""),d=ua(()=>Lp(Wm(Gm(ud()),s)),[s]);ua(()=>{d.onChange=()=>{c(E=>E+r0),l(t0(e0(d.children)))}},[d]);const[h]=Nn([]);Qm(()=>(we.connect(d),()=>we.disconnect(d)),[d]);const f=oa(({attributes:E,children:A,element:v})=>{let m=`slate-element slate-${v.type} `,b=v.children.map(C=>C.text).join("");switch(b.startsWith(">")&&b.endsWith("<")&&(m+="text-center"),v.type){case"title_element":m+="text-sm text-gray-400";break;case"lyrics":m+="text-left pl-[20%]";break;case"scene_header":break;case"transition":break;case"page_break":m+="text-xs text-gray-400 border-b-2 border-gray-900";break;case"boneyard":m+="text-xs bg-slate-900 pl-2 text-gray-400";break}return ge("p",{className:m,...E,children:A})},[]),g=oa(({attributes:E,children:A,leaf:v})=>{if(v.text.trim()==="&nbsp"||v.text.trim()===";"||v.text.trim()==="&nbsp;")return ge("span",{...E,className:"text-gray-700",children:A});let m="";return v.bold&&(m+=" font-bold"),v.underline&&(m+=" underline"),v.italic&&(m+=" italic"),v.note&&(m+=" bg-slate-900 text-gray-400"),ge("span",{...E,className:m,children:A})},[]),y=oa(([E,A])=>{if(!G.isText(E))return[];const v=[],m=E.text;let b=0,C=0,_={bold:!1,underline:!1,italic:!1,note:!1};function P(S){v.push({..._,anchor:{path:A,offset:b},focus:{path:A,offset:C}}),b=C,_={..._,...S}}for(let S=0;S<m.length;S++)m[S]==="_"&&(_.underline&&(C=S+1),P({underline:!_.underline})),m[S]==="*"&&m[S+1]==="*"&&m[S+2]==="*"&&(C=S+3,P({bold:!_.bold,italic:!_.italic}),S=S+3),m[S]==="*"&&m[S+1]==="*"&&(C=S+1,P({bold:!_.bold}),S=S+1),m[S]==="*"&&(_.italic&&(C=S+1),P({italic:!_.italic})),m[S]==="["&&m[S+1]==="["&&(C=S,P({note:!0}),S=S+1),m[S]==="]"&&m[S-1]==="]"&&(C=S+1,P({note:!1})),C=S;return P({}),v},[]);return ht("div",{className:"flex flex-col items-stretch justify-start",children:[ht("div",{className:"flex flex-row items-center justify-between border-b-2 border-b-slate-900 bg-slate-800 p-2",children:[ge(Lf,{value:e.name,input:r})," ",ht("span",{className:"flex flex-row justify-end gap-2",children:[ge(Er,{label:"Preview",click:()=>a(!i)}),ge(Er,{label:"X",click:n})]})]}),ht("div",{className:"h-0 flex-grow p-2",children:[ge("div",{className:"h-full w-full overflow-y-scroll p-6",style:i?{position:"fixed",bottom:"-200vh"}:{},children:ge(Mp,{editor:d,value:h,children:ge(wp,{renderElement:f,renderLeaf:g,decorate:y})})}),i?ge("div",{className:"script h-full w-full overflow-y-scroll p-6",dangerouslySetInnerHTML:{__html:u}},o):""]})]})}var i0=(e,t)=>t.some(r=>e instanceof r),wu,ku;function a0(){return wu||(wu=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function s0(){return ku||(ku=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Rl=new WeakMap,La=new WeakMap,Il=new WeakMap,ca=new WeakMap,Gs=new WeakMap;function o0(e){const t=new Promise((r,n)=>{const i=()=>{e.removeEventListener("success",a),e.removeEventListener("error",s)},a=()=>{r(zt(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",a),e.addEventListener("error",s)});return t.then(r=>{r instanceof IDBCursor&&Rl.set(r,e)}).catch(()=>{}),Gs.set(t,e),t}function u0(e){if(La.has(e))return;const t=new Promise((r,n)=>{const i=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",s),e.removeEventListener("abort",s)},a=()=>{r(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",a),e.addEventListener("error",s),e.addEventListener("abort",s)});La.set(e,t)}var Na={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return La.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Il.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return zt(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function c0(e){Na=e(Na)}function l0(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...r){const n=e.call(la(this),t,...r);return Il.set(n,t.sort?t.sort():[t]),zt(n)}:s0().includes(e)?function(...t){return e.apply(la(this),t),zt(Rl.get(this))}:function(...t){return zt(e.apply(la(this),t))}}function f0(e){return typeof e=="function"?l0(e):(e instanceof IDBTransaction&&u0(e),i0(e,a0())?new Proxy(e,Na):e)}function zt(e){if(e instanceof IDBRequest)return o0(e);if(ca.has(e))return ca.get(e);const t=f0(e);return t!==e&&(ca.set(e,t),Gs.set(t,e)),t}var la=e=>Gs.get(e);function d0(e,t,{blocked:r,upgrade:n,blocking:i,terminated:a}={}){const s=indexedDB.open(e,t),o=zt(s);return n&&s.addEventListener("upgradeneeded",c=>{n(zt(s.result),c.oldVersion,c.newVersion,zt(s.transaction))}),r&&s.addEventListener("blocked",()=>r()),o.then(c=>{a&&c.addEventListener("close",()=>a()),i&&c.addEventListener("versionchange",()=>i())}).catch(()=>{}),o}var h0=["get","getKey","getAll","getAllKeys","count"],p0=["put","add","delete","clear"],fa=new Map;function Fu(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(fa.get(t))return fa.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,i=p0.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||h0.includes(r)))return;const a=async function(s,...o){const c=this.transaction(s,i?"readwrite":"readonly");let u=c.store;return n&&(u=u.index(o.shift())),(await Promise.all([u[r](...o),i&&c.done]))[0]};return fa.set(t,a),a}c0(e=>({...e,get:(t,r,n)=>Fu(t,r)||e.get(t,r,n),has:(t,r)=>!!Fu(t,r)||e.has(t,r)}));const Un={},v0=2;async function Ml(e){return e in Un||(Un[e]=d0(e,v0,{upgrade(t){t.createObjectStore("fileInfo"),t.createObjectStore("fileContent")}})),Un[e]}async function g0(e){const t=await Ml(e);let r=await t.getAll("fileInfo"),n;return{setCallback(i){n=i},async createFile(i,a,s){const o=s??ts(),c={name:i,key:o,type:a},u=t.transaction(["fileInfo","fileContent"],"readwrite");return u.objectStore("fileInfo").put(c,o),u.objectStore("fileContent").put(new Uint8Array,o),await u.done,r=[...r,c],n&&n(r),o},getCurrentList(){return r},async deleteFile(i){const a=t.transaction(["fileInfo","fileContent"],"readwrite");a.objectStore("fileInfo").delete(i),a.objectStore("fileContent").delete(i),await a.done,r=r.filter(s=>s.key!==i),n&&n(r)},async renameFile(i,a){let s=!1;r=r.map(o=>o.key===i?(s={...o,name:a},s):o),s&&(await t.put("fileInfo",s,i),n&&n(r))}}}const zn={},Tu=2e3;async function m0(e,t){const r=await Ml(t),n=await r.get("fileContent",e),i=new Wt;n&&n.byteLength>0?at(i,n):i.get("content",Oe).applyDelta(wl([{type:"raw",children:[{text:"test"}]}]));let a={},s=!1;return{doc(){return i},connect(){const o=new Wt,c=Ut(i);return at(o,c),o.on("update",u=>{s&&clearTimeout(s),s=setTimeout(()=>{const l=Ut(i);r.put("fileContent",l,e)},Tu),at(i,u);for(const l of Object.keys(a)){const d=a[l];at(d,u)}}),a[o.clientID]=o,{id:o.clientID,content:o.get("content",Oe)}},updateAll(o){s&&clearTimeout(s),s=setTimeout(()=>{const c=Ut(i);r.put("fileContent",c,e)},Tu),at(i,o);for(const c of Object.keys(a)){const u=a[c];at(u,o)}},disconnect(o){const c=o.toString();if(c in a){const u=a[o],l=a;a={};for(const d of Object.keys(l))d!==c&&(a[d]=l[d]);u.destroy()}}}}async function y0(e,t){return e in zn||(zn[e]=m0(e,t)),zn[e]}var Ou=Ce({"node_modules/peerjs-js-binarypack/lib/bufferbuilder.js"(e,t){var r={};r.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),r.useArrayBufferView=!r.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),t.exports.binaryFeatures=r;var n=t.exports.BlobBuilder;typeof window<"u"&&(n=t.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function i(){this._pieces=[],this._parts=[]}i.prototype.append=function(a){typeof a=="number"?this._pieces.push(a):(this.flush(),this._parts.push(a))},i.prototype.flush=function(){if(this._pieces.length>0){var a=new Uint8Array(this._pieces);r.useArrayBufferView||(a=a.buffer),this._parts.push(a),this._pieces=[]}},i.prototype.getBuffer=function(){if(this.flush(),r.useBlobBuilder){for(var a=new n,s=0,o=this._parts.length;s<o;s++)a.append(this._parts[s]);return a.getBlob()}else return new Blob(this._parts)},t.exports.BufferBuilder=i}}),C0=Ce({"node_modules/peerjs-js-binarypack/lib/binarypack.js"(e,t){var r=Ou().BufferBuilder,n=Ou().binaryFeatures,i={unpack:function(u){var l=new a(u);return l.unpack()},pack:function(u){var l=new s;l.pack(u);var d=l.getBuffer();return d}};t.exports=i;function a(u){this.index=0,this.dataBuffer=u,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}a.prototype.unpack=function(){var u=this.unpack_uint8();if(u<128)return u;if((u^224)<32)return(u^224)-32;var l;if((l=u^160)<=15)return this.unpack_raw(l);if((l=u^176)<=15)return this.unpack_string(l);if((l=u^144)<=15)return this.unpack_array(l);if((l=u^128)<=15)return this.unpack_map(l);switch(u){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return l=this.unpack_uint16(),this.unpack_string(l);case 217:return l=this.unpack_uint32(),this.unpack_string(l);case 218:return l=this.unpack_uint16(),this.unpack_raw(l);case 219:return l=this.unpack_uint32(),this.unpack_raw(l);case 220:return l=this.unpack_uint16(),this.unpack_array(l);case 221:return l=this.unpack_uint32(),this.unpack_array(l);case 222:return l=this.unpack_uint16(),this.unpack_map(l);case 223:return l=this.unpack_uint32(),this.unpack_map(l)}},a.prototype.unpack_uint8=function(){var u=this.dataView[this.index]&255;return this.index++,u},a.prototype.unpack_uint16=function(){var u=this.read(2),l=(u[0]&255)*256+(u[1]&255);return this.index+=2,l},a.prototype.unpack_uint32=function(){var u=this.read(4),l=((u[0]*256+u[1])*256+u[2])*256+u[3];return this.index+=4,l},a.prototype.unpack_uint64=function(){var u=this.read(8),l=((((((u[0]*256+u[1])*256+u[2])*256+u[3])*256+u[4])*256+u[5])*256+u[6])*256+u[7];return this.index+=8,l},a.prototype.unpack_int8=function(){var u=this.unpack_uint8();return u<128?u:u-(1<<8)},a.prototype.unpack_int16=function(){var u=this.unpack_uint16();return u<32768?u:u-(1<<16)},a.prototype.unpack_int32=function(){var u=this.unpack_uint32();return u<Math.pow(2,31)?u:u-Math.pow(2,32)},a.prototype.unpack_int64=function(){var u=this.unpack_uint64();return u<Math.pow(2,63)?u:u-Math.pow(2,64)},a.prototype.unpack_raw=function(u){if(this.length<this.index+u)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+u+" "+this.length);var l=this.dataBuffer.slice(this.index,this.index+u);return this.index+=u,l},a.prototype.unpack_string=function(u){for(var l=this.read(u),d=0,h="",f,g;d<u;)f=l[d],f<128?(h+=String.fromCharCode(f),d++):(f^192)<32?(g=(f^192)<<6|l[d+1]&63,h+=String.fromCharCode(g),d+=2):(g=(f&15)<<12|(l[d+1]&63)<<6|l[d+2]&63,h+=String.fromCharCode(g),d+=3);return this.index+=u,h},a.prototype.unpack_array=function(u){for(var l=new Array(u),d=0;d<u;d++)l[d]=this.unpack();return l},a.prototype.unpack_map=function(u){for(var l={},d=0;d<u;d++){var h=this.unpack(),f=this.unpack();l[h]=f}return l},a.prototype.unpack_float=function(){var u=this.unpack_uint32(),l=u>>31,d=(u>>23&255)-127,h=u&8388607|8388608;return(l===0?1:-1)*h*Math.pow(2,d-23)},a.prototype.unpack_double=function(){var u=this.unpack_uint32(),l=this.unpack_uint32(),d=u>>31,h=(u>>20&2047)-1023,f=u&1048575|1048576,g=f*Math.pow(2,h-20)+l*Math.pow(2,h-52);return(d===0?1:-1)*g},a.prototype.read=function(u){var l=this.index;if(l+u<=this.length)return this.dataView.subarray(l,l+u);throw new Error("BinaryPackFailure: read index out of range")};function s(){this.bufferBuilder=new r}s.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},s.prototype.pack=function(u){var l=typeof u;if(l==="string")this.pack_string(u);else if(l==="number")Math.floor(u)===u?this.pack_integer(u):this.pack_double(u);else if(l==="boolean")u===!0?this.bufferBuilder.append(195):u===!1&&this.bufferBuilder.append(194);else if(l==="undefined")this.bufferBuilder.append(192);else if(l==="object")if(u===null)this.bufferBuilder.append(192);else{var d=u.constructor;if(d==Array)this.pack_array(u);else if(d==Blob||d==File||u instanceof Blob||u instanceof File)this.pack_bin(u);else if(d==ArrayBuffer)n.useArrayBufferView?this.pack_bin(new Uint8Array(u)):this.pack_bin(u);else if("BYTES_PER_ELEMENT"in u)n.useArrayBufferView?this.pack_bin(new Uint8Array(u.buffer)):this.pack_bin(u.buffer);else if(d==Object||d.toString().startsWith("class"))this.pack_object(u);else if(d==Date)this.pack_string(u.toString());else if(typeof u.toBinaryPack=="function")this.bufferBuilder.append(u.toBinaryPack());else throw new Error('Type "'+d.toString()+'" not yet supported')}else throw new Error('Type "'+l+'" not yet supported');this.bufferBuilder.flush()},s.prototype.pack_bin=function(u){var l=u.length||u.byteLength||u.size;if(l<=15)this.pack_uint8(160+l);else if(l<=65535)this.bufferBuilder.append(218),this.pack_uint16(l);else if(l<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(l);else throw new Error("Invalid length");this.bufferBuilder.append(u)},s.prototype.pack_string=function(u){var l=c(u);if(l<=15)this.pack_uint8(176+l);else if(l<=65535)this.bufferBuilder.append(216),this.pack_uint16(l);else if(l<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(l);else throw new Error("Invalid length");this.bufferBuilder.append(u)},s.prototype.pack_array=function(u){var l=u.length;if(l<=15)this.pack_uint8(144+l);else if(l<=65535)this.bufferBuilder.append(220),this.pack_uint16(l);else if(l<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(l);else throw new Error("Invalid length");for(var d=0;d<l;d++)this.pack(u[d])},s.prototype.pack_integer=function(u){if(u>=-32&&u<=127)this.bufferBuilder.append(u&255);else if(u>=0&&u<=255)this.bufferBuilder.append(204),this.pack_uint8(u);else if(u>=-128&&u<=127)this.bufferBuilder.append(208),this.pack_int8(u);else if(u>=0&&u<=65535)this.bufferBuilder.append(205),this.pack_uint16(u);else if(u>=-32768&&u<=32767)this.bufferBuilder.append(209),this.pack_int16(u);else if(u>=0&&u<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(u);else if(u>=-2147483648&&u<=2147483647)this.bufferBuilder.append(210),this.pack_int32(u);else if(u>=-9223372036854776e3&&u<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(u);else if(u>=0&&u<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(u);else throw new Error("Invalid integer")},s.prototype.pack_double=function(u){var l=0;u<0&&(l=1,u=-u);var d=Math.floor(Math.log(u)/Math.LN2),h=u/Math.pow(2,d)-1,f=Math.floor(h*Math.pow(2,52)),g=Math.pow(2,32),y=l<<31|d+1023<<20|f/g&1048575,E=f%g;this.bufferBuilder.append(203),this.pack_int32(y),this.pack_int32(E)},s.prototype.pack_object=function(u){var l=Object.keys(u),d=l.length;if(d<=15)this.pack_uint8(128+d);else if(d<=65535)this.bufferBuilder.append(222),this.pack_uint16(d);else if(d<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(d);else throw new Error("Invalid length");for(var h in u)u.hasOwnProperty(h)&&(this.pack(h),this.pack(u[h]))},s.prototype.pack_uint8=function(u){this.bufferBuilder.append(u)},s.prototype.pack_uint16=function(u){this.bufferBuilder.append(u>>8),this.bufferBuilder.append(u&255)},s.prototype.pack_uint32=function(u){var l=u&4294967295;this.bufferBuilder.append((l&4278190080)>>>24),this.bufferBuilder.append((l&16711680)>>>16),this.bufferBuilder.append((l&65280)>>>8),this.bufferBuilder.append(l&255)},s.prototype.pack_uint64=function(u){var l=u/Math.pow(2,32),d=u%Math.pow(2,32);this.bufferBuilder.append((l&4278190080)>>>24),this.bufferBuilder.append((l&16711680)>>>16),this.bufferBuilder.append((l&65280)>>>8),this.bufferBuilder.append(l&255),this.bufferBuilder.append((d&4278190080)>>>24),this.bufferBuilder.append((d&16711680)>>>16),this.bufferBuilder.append((d&65280)>>>8),this.bufferBuilder.append(d&255)},s.prototype.pack_int8=function(u){this.bufferBuilder.append(u&255)},s.prototype.pack_int16=function(u){this.bufferBuilder.append((u&65280)>>8),this.bufferBuilder.append(u&255)},s.prototype.pack_int32=function(u){this.bufferBuilder.append(u>>>24&255),this.bufferBuilder.append((u&16711680)>>>16),this.bufferBuilder.append((u&65280)>>>8),this.bufferBuilder.append(u&255)},s.prototype.pack_int64=function(u){var l=Math.floor(u/Math.pow(2,32)),d=u%Math.pow(2,32);this.bufferBuilder.append((l&4278190080)>>>24),this.bufferBuilder.append((l&16711680)>>>16),this.bufferBuilder.append((l&65280)>>>8),this.bufferBuilder.append(l&255),this.bufferBuilder.append((d&4278190080)>>>24),this.bufferBuilder.append((d&16711680)>>>16),this.bufferBuilder.append((d&65280)>>>8),this.bufferBuilder.append(d&255)};function o(u){var l=u.charCodeAt(0);return l<=2047?"00":l<=65535?"000":l<=2097151?"0000":l<=67108863?"00000":"000000"}function c(u){return u.length>600?new Blob([u]).size:u.replace(/[^\u0000-\u007F]/g,o).length}}}),jl=Ce({"node_modules/sdp/sdp.js"(e,t){var r={};r.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},r.localCName=r.generateIdentifier(),r.splitLines=function(n){return n.trim().split(`
`).map(function(i){return i.trim()})},r.splitSections=function(n){var i=n.split(`
m=`);return i.map(function(a,s){return(s>0?"m="+a:a).trim()+`\r
`})},r.getDescription=function(n){var i=r.splitSections(n);return i&&i[0]},r.getMediaSections=function(n){var i=r.splitSections(n);return i.shift(),i},r.matchPrefix=function(n,i){return r.splitLines(n).filter(function(a){return a.indexOf(i)===0})},r.parseCandidate=function(n){var i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");for(var a={foundation:i[0],component:parseInt(i[1],10),protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]},s=8;s<i.length;s+=2)switch(i[s]){case"raddr":a.relatedAddress=i[s+1];break;case"rport":a.relatedPort=parseInt(i[s+1],10);break;case"tcptype":a.tcpType=i[s+1];break;case"ufrag":a.ufrag=i[s+1],a.usernameFragment=i[s+1];break;default:a[i[s]]=i[s+1];break}return a},r.writeCandidate=function(n){var i=[];i.push(n.foundation),i.push(n.component),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);var a=n.type;return i.push("typ"),i.push(a),a!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},r.parseIceOptions=function(n){return n.substr(14).split(" ")},r.parseRtpMap=function(n){var i=n.substr(9).split(" "),a={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),a.name=i[0],a.clockRate=parseInt(i[1],10),a.channels=i.length===3?parseInt(i[2],10):1,a.numChannels=a.channels,a},r.writeRtpMap=function(n){var i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);var a=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(a!==1?"/"+a:"")+`\r
`},r.parseExtmap=function(n){var i=n.substr(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1]}},r.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+`\r
`},r.parseFmtp=function(n){for(var i={},a,s=n.substr(n.indexOf(" ")+1).split(";"),o=0;o<s.length;o++)a=s[o].trim().split("="),i[a[0].trim()]=a[1];return i},r.writeFmtp=function(n){var i="",a=n.payloadType;if(n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){var s=[];Object.keys(n.parameters).forEach(function(o){n.parameters[o]?s.push(o+"="+n.parameters[o]):s.push(o)}),i+="a=fmtp:"+a+" "+s.join(";")+`\r
`}return i},r.parseRtcpFb=function(n){var i=n.substr(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},r.writeRtcpFb=function(n){var i="",a=n.payloadType;return n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(function(s){i+="a=rtcp-fb:"+a+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},r.parseSsrcMedia=function(n){var i=n.indexOf(" "),a={ssrc:parseInt(n.substr(7,i-7),10)},s=n.indexOf(":",i);return s>-1?(a.attribute=n.substr(i+1,s-i-1),a.value=n.substr(s+1)):a.attribute=n.substr(i+1),a},r.parseSsrcGroup=function(n){var i=n.substr(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(function(a){return parseInt(a,10)})}},r.getMid=function(n){var i=r.matchPrefix(n,"a=mid:")[0];if(i)return i.substr(6)},r.parseFingerprint=function(n){var i=n.substr(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1]}},r.getDtlsParameters=function(n,i){var a=r.matchPrefix(n+i,"a=fingerprint:");return{role:"auto",fingerprints:a.map(r.parseFingerprint)}},r.writeDtlsParameters=function(n,i){var a="a=setup:"+i+`\r
`;return n.fingerprints.forEach(function(s){a+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),a},r.parseCryptoLine=function(n){var i=n.substr(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},r.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?r.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;var i=n.substr(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},r.getCryptoParameters=function(n,i){var a=r.matchPrefix(n+i,"a=crypto:");return a.map(r.parseCryptoLine)},r.getIceParameters=function(n,i){var a=r.matchPrefix(n+i,"a=ice-ufrag:")[0],s=r.matchPrefix(n+i,"a=ice-pwd:")[0];return a&&s?{usernameFragment:a.substr(12),password:s.substr(10)}:null},r.writeIceParameters=function(n){return"a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`},r.parseRtpParameters=function(n){for(var i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},a=r.splitLines(n),s=a[0].split(" "),o=3;o<s.length;o++){var c=s[o],u=r.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(u){var l=r.parseRtpMap(u),d=r.matchPrefix(n,"a=fmtp:"+c+" ");switch(l.parameters=d.length?r.parseFmtp(d[0]):{},l.rtcpFeedback=r.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(r.parseRtcpFb),i.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(l.name.toUpperCase());break}}}return r.matchPrefix(n,"a=extmap:").forEach(function(h){i.headerExtensions.push(r.parseExtmap(h))}),i},r.writeRtpDescription=function(n,i){var a="";a+="m="+n+" ",a+=i.codecs.length>0?"9":"0",a+=" UDP/TLS/RTP/SAVPF ",a+=i.codecs.map(function(o){return o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType}).join(" ")+`\r
`,a+=`c=IN IP4 0.0.0.0\r
`,a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(function(o){a+=r.writeRtpMap(o),a+=r.writeFmtp(o),a+=r.writeRtcpFb(o)});var s=0;return i.codecs.forEach(function(o){o.maxptime>s&&(s=o.maxptime)}),s>0&&(a+="a=maxptime:"+s+`\r
`),a+=`a=rtcp-mux\r
`,i.headerExtensions&&i.headerExtensions.forEach(function(o){a+=r.writeExtmap(o)}),a},r.parseRtpEncodingParameters=function(n){var i=[],a=r.parseRtpParameters(n),s=a.fecMechanisms.indexOf("RED")!==-1,o=a.fecMechanisms.indexOf("ULPFEC")!==-1,c=r.matchPrefix(n,"a=ssrc:").map(function(f){return r.parseSsrcMedia(f)}).filter(function(f){return f.attribute==="cname"}),u=c.length>0&&c[0].ssrc,l,d=r.matchPrefix(n,"a=ssrc-group:FID").map(function(f){var g=f.substr(17).split(" ");return g.map(function(y){return parseInt(y,10)})});d.length>0&&d[0].length>1&&d[0][0]===u&&(l=d[0][1]),a.codecs.forEach(function(f){if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){var g={ssrc:u,codecPayloadType:parseInt(f.parameters.apt,10)};u&&l&&(g.rtx={ssrc:l}),i.push(g),s&&(g=JSON.parse(JSON.stringify(g)),g.fec={ssrc:u,mechanism:o?"red+ulpfec":"red"},i.push(g))}}),i.length===0&&u&&i.push({ssrc:u});var h=r.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substr(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substr(5),10)*1e3*.95-50*40*8:h=void 0,i.forEach(function(f){f.maxBitrate=h})),i},r.parseRtcpParameters=function(n){var i={},a=r.matchPrefix(n,"a=ssrc:").map(function(c){return r.parseSsrcMedia(c)}).filter(function(c){return c.attribute==="cname"})[0];a&&(i.cname=a.value,i.ssrc=a.ssrc);var s=r.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;var o=r.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},r.parseMsid=function(n){var i,a=r.matchPrefix(n,"a=msid:");if(a.length===1)return i=a[0].substr(7).split(" "),{stream:i[0],track:i[1]};var s=r.matchPrefix(n,"a=ssrc:").map(function(o){return r.parseSsrcMedia(o)}).filter(function(o){return o.attribute==="msid"});if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},r.parseSctpDescription=function(n){var i=r.parseMLine(n),a=r.matchPrefix(n,"a=max-message-size:"),s;a.length>0&&(s=parseInt(a[0].substr(19),10)),isNaN(s)&&(s=65536);var o=r.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:i.fmt,maxMessageSize:s};var c=r.matchPrefix(n,"a=sctpmap:");if(c.length>0){var u=r.matchPrefix(n,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:s}}},r.writeSctpDescription=function(n,i){var a=[];return n.protocol!=="DTLS/SCTP"?a=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:a=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&a.push("a=max-message-size:"+i.maxMessageSize+`\r
`),a.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(n,i,a){var s,o=i!==void 0?i:2;n?s=n:s=r.generateSessionId();var c=a||"thisisadapterortc";return`v=0\r
o=`+c+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.writeMediaSection=function(n,i,a,s){var o=r.writeRtpDescription(n.kind,i);if(o+=r.writeIceParameters(n.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),a==="offer"?"actpass":"active"),o+="a=mid:"+n.mid+`\r
`,n.direction?o+="a="+n.direction+`\r
`:n.rtpSender&&n.rtpReceiver?o+=`a=sendrecv\r
`:n.rtpSender?o+=`a=sendonly\r
`:n.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,n.rtpSender){var c="msid:"+s.id+" "+n.rtpSender.track.id+`\r
`;o+="a="+c,o+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+c,n.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+c,o+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+`\r
`),o},r.getDirection=function(n,i){for(var a=r.splitLines(n),s=0;s<a.length;s++)switch(a[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[s].substr(2)}return i?r.getDirection(i):"sendrecv"},r.getKind=function(n){var i=r.splitLines(n),a=i[0].split(" ");return a[0].substr(2)},r.isRejected=function(n){return n.split(" ",2)[1]==="0"},r.parseMLine=function(n){var i=r.splitLines(n),a=i[0].substr(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},r.parseOLine=function(n){var i=r.matchPrefix(n,"o=")[0],a=i.substr(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},r.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;for(var i=r.splitLines(n),a=0;a<i.length;a++)if(i[a].length<2||i[a].charAt(1)!=="=")return!1;return!0},typeof t=="object"&&(t.exports=r)}}),D0=Ce({"node_modules/rtcpeerconnection-shim/rtcpeerconnection.js"(e,t){var r=jl();function n(l){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[l.type]||l.type}function i(l,d,h,f,g){var y=r.writeRtpDescription(l.kind,d);if(y+=r.writeIceParameters(l.iceGatherer.getLocalParameters()),y+=r.writeDtlsParameters(l.dtlsTransport.getLocalParameters(),h==="offer"?"actpass":g||"active"),y+="a=mid:"+l.mid+`\r
`,l.rtpSender&&l.rtpReceiver?y+=`a=sendrecv\r
`:l.rtpSender?y+=`a=sendonly\r
`:l.rtpReceiver?y+=`a=recvonly\r
`:y+=`a=inactive\r
`,l.rtpSender){var E=l.rtpSender._initialTrackId||l.rtpSender.track.id;l.rtpSender._initialTrackId=E;var A="msid:"+(f?f.id:"-")+" "+E+`\r
`;y+="a="+A,y+="a=ssrc:"+l.sendEncodingParameters[0].ssrc+" "+A,l.sendEncodingParameters[0].rtx&&(y+="a=ssrc:"+l.sendEncodingParameters[0].rtx.ssrc+" "+A,y+="a=ssrc-group:FID "+l.sendEncodingParameters[0].ssrc+" "+l.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return y+="a=ssrc:"+l.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+`\r
`,l.rtpSender&&l.sendEncodingParameters[0].rtx&&(y+="a=ssrc:"+l.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+`\r
`),y}function a(l,d){var h=!1;return l=JSON.parse(JSON.stringify(l)),l.filter(function(f){if(f&&(f.urls||f.url)){var g=f.urls||f.url;f.url&&!f.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var y=typeof g=="string";return y&&(g=[g]),g=g.filter(function(E){var A=E.indexOf("turn:")===0&&E.indexOf("transport=udp")!==-1&&E.indexOf("turn:[")===-1&&!h;return A?(h=!0,!0):E.indexOf("stun:")===0&&d>=14393&&E.indexOf("?transport=udp")===-1}),delete f.url,f.urls=y?g[0]:g,!!g.length}})}function s(l,d){var h={codecs:[],headerExtensions:[],fecMechanisms:[]},f=function(y,E){y=parseInt(y,10);for(var A=0;A<E.length;A++)if(E[A].payloadType===y||E[A].preferredPayloadType===y)return E[A]},g=function(y,E,A,v){var m=f(y.parameters.apt,A),b=f(E.parameters.apt,v);return m&&b&&m.name.toLowerCase()===b.name.toLowerCase()};return l.codecs.forEach(function(y){for(var E=0;E<d.codecs.length;E++){var A=d.codecs[E];if(y.name.toLowerCase()===A.name.toLowerCase()&&y.clockRate===A.clockRate){if(y.name.toLowerCase()==="rtx"&&y.parameters&&A.parameters.apt&&!g(y,A,l.codecs,d.codecs))continue;A=JSON.parse(JSON.stringify(A)),A.numChannels=Math.min(y.numChannels,A.numChannels),h.codecs.push(A),A.rtcpFeedback=A.rtcpFeedback.filter(function(v){for(var m=0;m<y.rtcpFeedback.length;m++)if(y.rtcpFeedback[m].type===v.type&&y.rtcpFeedback[m].parameter===v.parameter)return!0;return!1});break}}}),l.headerExtensions.forEach(function(y){for(var E=0;E<d.headerExtensions.length;E++){var A=d.headerExtensions[E];if(y.uri===A.uri){h.headerExtensions.push(A);break}}}),h}function o(l,d,h){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[d][l].indexOf(h)!==-1}function c(l,d){var h=l.getRemoteCandidates().find(function(f){return d.foundation===f.foundation&&d.ip===f.ip&&d.port===f.port&&d.priority===f.priority&&d.protocol===f.protocol&&d.type===f.type});return h||l.addRemoteCandidate(d),!h}function u(l,d){var h=new Error(d);return h.name=l,h.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[l],h}t.exports=function(l,d){function h(v,m){m.addTrack(v),m.dispatchEvent(new l.MediaStreamTrackEvent("addtrack",{track:v}))}function f(v,m){m.removeTrack(v),m.dispatchEvent(new l.MediaStreamTrackEvent("removetrack",{track:v}))}function g(v,m,b,C){var _=new Event("track");_.track=m,_.receiver=b,_.transceiver={receiver:b},_.streams=C,l.setTimeout(function(){v._dispatchEvent("track",_)})}var y=function(v){var m=this,b=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(_){m[_]=b[_].bind(b)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",v=JSON.parse(JSON.stringify(v||{})),this.usingBundle=v.bundlePolicy==="max-bundle",v.rtcpMuxPolicy==="negotiate")throw u("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(v.rtcpMuxPolicy||(v.rtcpMuxPolicy="require"),v.iceTransportPolicy){case"all":case"relay":break;default:v.iceTransportPolicy="all";break}switch(v.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:v.bundlePolicy="balanced";break}if(v.iceServers=a(v.iceServers||[],d),this._iceGatherers=[],v.iceCandidatePoolSize)for(var C=v.iceCandidatePoolSize;C>0;C--)this._iceGatherers.push(new l.RTCIceGatherer({iceServers:v.iceServers,gatherPolicy:v.iceTransportPolicy}));else v.iceCandidatePoolSize=0;this._config=v,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(y.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(y.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),y.prototype.onicecandidate=null,y.prototype.onaddstream=null,y.prototype.ontrack=null,y.prototype.onremovestream=null,y.prototype.onsignalingstatechange=null,y.prototype.oniceconnectionstatechange=null,y.prototype.onconnectionstatechange=null,y.prototype.onicegatheringstatechange=null,y.prototype.onnegotiationneeded=null,y.prototype.ondatachannel=null,y.prototype._dispatchEvent=function(v,m){this._isClosed||(this.dispatchEvent(m),typeof this["on"+v]=="function"&&this["on"+v](m))},y.prototype._emitGatheringStateChange=function(){var v=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",v)},y.prototype.getConfiguration=function(){return this._config},y.prototype.getLocalStreams=function(){return this.localStreams},y.prototype.getRemoteStreams=function(){return this.remoteStreams},y.prototype._createTransceiver=function(v,m){var b=this.transceivers.length>0,C={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:v,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&b)C.iceTransport=this.transceivers[0].iceTransport,C.dtlsTransport=this.transceivers[0].dtlsTransport;else{var _=this._createIceAndDtlsTransports();C.iceTransport=_.iceTransport,C.dtlsTransport=_.dtlsTransport}return m||this.transceivers.push(C),C},y.prototype.addTrack=function(v,m){if(this._isClosed)throw u("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var b=this.transceivers.find(function(P){return P.track===v});if(b)throw u("InvalidAccessError","Track already exists.");for(var C,_=0;_<this.transceivers.length;_++)!this.transceivers[_].track&&this.transceivers[_].kind===v.kind&&(C=this.transceivers[_]);return C||(C=this._createTransceiver(v.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(m)===-1&&this.localStreams.push(m),C.track=v,C.stream=m,C.rtpSender=new l.RTCRtpSender(v,C.dtlsTransport),C.rtpSender},y.prototype.addStream=function(v){var m=this;if(d>=15025)v.getTracks().forEach(function(C){m.addTrack(C,v)});else{var b=v.clone();v.getTracks().forEach(function(C,_){var P=b.getTracks()[_];C.addEventListener("enabled",function(S){P.enabled=S.enabled})}),b.getTracks().forEach(function(C){m.addTrack(C,b)})}},y.prototype.removeTrack=function(v){if(this._isClosed)throw u("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(v instanceof l.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var m=this.transceivers.find(function(_){return _.rtpSender===v});if(!m)throw u("InvalidAccessError","Sender was not created by this connection.");var b=m.stream;m.rtpSender.stop(),m.rtpSender=null,m.track=null,m.stream=null;var C=this.transceivers.map(function(_){return _.stream});C.indexOf(b)===-1&&this.localStreams.indexOf(b)>-1&&this.localStreams.splice(this.localStreams.indexOf(b),1),this._maybeFireNegotiationNeeded()},y.prototype.removeStream=function(v){var m=this;v.getTracks().forEach(function(b){var C=m.getSenders().find(function(_){return _.track===b});C&&m.removeTrack(C)})},y.prototype.getSenders=function(){return this.transceivers.filter(function(v){return!!v.rtpSender}).map(function(v){return v.rtpSender})},y.prototype.getReceivers=function(){return this.transceivers.filter(function(v){return!!v.rtpReceiver}).map(function(v){return v.rtpReceiver})},y.prototype._createIceGatherer=function(v,m){var b=this;if(m&&v>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var C=new l.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(C,"state",{value:"new",writable:!0}),this.transceivers[v].bufferedCandidateEvents=[],this.transceivers[v].bufferCandidates=function(_){var P=!_.candidate||Object.keys(_.candidate).length===0;C.state=P?"completed":"gathering",b.transceivers[v].bufferedCandidateEvents!==null&&b.transceivers[v].bufferedCandidateEvents.push(_)},C.addEventListener("localcandidate",this.transceivers[v].bufferCandidates),C},y.prototype._gather=function(v,m){var b=this,C=this.transceivers[m].iceGatherer;if(!C.onlocalcandidate){var _=this.transceivers[m].bufferedCandidateEvents;this.transceivers[m].bufferedCandidateEvents=null,C.removeEventListener("localcandidate",this.transceivers[m].bufferCandidates),C.onlocalcandidate=function(P){if(!(b.usingBundle&&m>0)){var S=new Event("icecandidate");S.candidate={sdpMid:v,sdpMLineIndex:m};var L=P.candidate,H=!L||Object.keys(L).length===0;if(H)(C.state==="new"||C.state==="gathering")&&(C.state="completed");else{C.state==="new"&&(C.state="gathering"),L.component=1,L.ufrag=C.getLocalParameters().usernameFragment;var j=r.writeCandidate(L);S.candidate=Object.assign(S.candidate,r.parseCandidate(j)),S.candidate.candidate=j,S.candidate.toJSON=function(){return{candidate:S.candidate.candidate,sdpMid:S.candidate.sdpMid,sdpMLineIndex:S.candidate.sdpMLineIndex,usernameFragment:S.candidate.usernameFragment}}}var T=r.getMediaSections(b._localDescription.sdp);H?T[S.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:T[S.candidate.sdpMLineIndex]+="a="+S.candidate.candidate+`\r
`,b._localDescription.sdp=r.getDescription(b._localDescription.sdp)+T.join("");var V=b.transceivers.every(function(W){return W.iceGatherer&&W.iceGatherer.state==="completed"});b.iceGatheringState!=="gathering"&&(b.iceGatheringState="gathering",b._emitGatheringStateChange()),H||b._dispatchEvent("icecandidate",S),V&&(b._dispatchEvent("icecandidate",new Event("icecandidate")),b.iceGatheringState="complete",b._emitGatheringStateChange())}},l.setTimeout(function(){_.forEach(function(P){C.onlocalcandidate(P)})},0)}},y.prototype._createIceAndDtlsTransports=function(){var v=this,m=new l.RTCIceTransport(null);m.onicestatechange=function(){v._updateIceConnectionState(),v._updateConnectionState()};var b=new l.RTCDtlsTransport(m);return b.ondtlsstatechange=function(){v._updateConnectionState()},b.onerror=function(){Object.defineProperty(b,"state",{value:"failed",writable:!0}),v._updateConnectionState()},{iceTransport:m,dtlsTransport:b}},y.prototype._disposeIceAndDtlsTransports=function(v){var m=this.transceivers[v].iceGatherer;m&&(delete m.onlocalcandidate,delete this.transceivers[v].iceGatherer);var b=this.transceivers[v].iceTransport;b&&(delete b.onicestatechange,delete this.transceivers[v].iceTransport);var C=this.transceivers[v].dtlsTransport;C&&(delete C.ondtlsstatechange,delete C.onerror,delete this.transceivers[v].dtlsTransport)},y.prototype._transceive=function(v,m,b){var C=s(v.localCapabilities,v.remoteCapabilities);m&&v.rtpSender&&(C.encodings=v.sendEncodingParameters,C.rtcp={cname:r.localCName,compound:v.rtcpParameters.compound},v.recvEncodingParameters.length&&(C.rtcp.ssrc=v.recvEncodingParameters[0].ssrc),v.rtpSender.send(C)),b&&v.rtpReceiver&&C.codecs.length>0&&(v.kind==="video"&&v.recvEncodingParameters&&d<15019&&v.recvEncodingParameters.forEach(function(_){delete _.rtx}),v.recvEncodingParameters.length?C.encodings=v.recvEncodingParameters:C.encodings=[{}],C.rtcp={compound:v.rtcpParameters.compound},v.rtcpParameters.cname&&(C.rtcp.cname=v.rtcpParameters.cname),v.sendEncodingParameters.length&&(C.rtcp.ssrc=v.sendEncodingParameters[0].ssrc),v.rtpReceiver.receive(C))},y.prototype.setLocalDescription=function(v){var m=this;if(["offer","answer"].indexOf(v.type)===-1)return Promise.reject(u("TypeError",'Unsupported type "'+v.type+'"'));if(!o("setLocalDescription",v.type,m.signalingState)||m._isClosed)return Promise.reject(u("InvalidStateError","Can not set local "+v.type+" in state "+m.signalingState));var b,C;if(v.type==="offer")b=r.splitSections(v.sdp),C=b.shift(),b.forEach(function(P,S){var L=r.parseRtpParameters(P);m.transceivers[S].localCapabilities=L}),m.transceivers.forEach(function(P,S){m._gather(P.mid,S)});else if(v.type==="answer"){b=r.splitSections(m._remoteDescription.sdp),C=b.shift();var _=r.matchPrefix(C,"a=ice-lite").length>0;b.forEach(function(P,S){var L=m.transceivers[S],H=L.iceGatherer,j=L.iceTransport,T=L.dtlsTransport,V=L.localCapabilities,W=L.remoteCapabilities,k=r.isRejected(P)&&r.matchPrefix(P,"a=bundle-only").length===0;if(!k&&!L.rejected){var Y=r.getIceParameters(P,C),B=r.getDtlsParameters(P,C);_&&(B.role="server"),(!m.usingBundle||S===0)&&(m._gather(L.mid,S),j.state==="new"&&j.start(H,Y,_?"controlling":"controlled"),T.state==="new"&&T.start(B));var F=s(V,W);m._transceive(L,F.codecs.length>0,!1)}})}return m._localDescription={type:v.type,sdp:v.sdp},v.type==="offer"?m._updateSignalingState("have-local-offer"):m._updateSignalingState("stable"),Promise.resolve()},y.prototype.setRemoteDescription=function(v){var m=this;if(["offer","answer"].indexOf(v.type)===-1)return Promise.reject(u("TypeError",'Unsupported type "'+v.type+'"'));if(!o("setRemoteDescription",v.type,m.signalingState)||m._isClosed)return Promise.reject(u("InvalidStateError","Can not set remote "+v.type+" in state "+m.signalingState));var b={};m.remoteStreams.forEach(function(j){b[j.id]=j});var C=[],_=r.splitSections(v.sdp),P=_.shift(),S=r.matchPrefix(P,"a=ice-lite").length>0,L=r.matchPrefix(P,"a=group:BUNDLE ").length>0;m.usingBundle=L;var H=r.matchPrefix(P,"a=ice-options:")[0];return H?m.canTrickleIceCandidates=H.substr(14).split(" ").indexOf("trickle")>=0:m.canTrickleIceCandidates=!1,_.forEach(function(j,T){var V=r.splitLines(j),W=r.getKind(j),k=r.isRejected(j)&&r.matchPrefix(j,"a=bundle-only").length===0,Y=V[0].substr(2).split(" ")[2],B=r.getDirection(j,P),F=r.parseMsid(j),R=r.getMid(j)||r.generateIdentifier();if(k||W==="application"&&(Y==="DTLS/SCTP"||Y==="UDP/DTLS/SCTP")){m.transceivers[T]={mid:R,kind:W,protocol:Y,rejected:!0};return}!k&&m.transceivers[T]&&m.transceivers[T].rejected&&(m.transceivers[T]=m._createTransceiver(W,!0));var M,J,ee,X,Z,re,oe,ue,z,x=r.parseRtpParameters(j),N,q;k||(N=r.getIceParameters(j,P),q=r.getDtlsParameters(j,P),q.role="client"),oe=r.parseRtpEncodingParameters(j);var ae=r.parseRtcpParameters(j),Q=r.matchPrefix(j,"a=end-of-candidates",P).length>0,de=r.matchPrefix(j,"a=candidate:").map(function(Be){return r.parseCandidate(Be)}).filter(function(Be){return Be.component===1});if((v.type==="offer"||v.type==="answer")&&!k&&L&&T>0&&m.transceivers[T]&&(m._disposeIceAndDtlsTransports(T),m.transceivers[T].iceGatherer=m.transceivers[0].iceGatherer,m.transceivers[T].iceTransport=m.transceivers[0].iceTransport,m.transceivers[T].dtlsTransport=m.transceivers[0].dtlsTransport,m.transceivers[T].rtpSender&&m.transceivers[T].rtpSender.setTransport(m.transceivers[0].dtlsTransport),m.transceivers[T].rtpReceiver&&m.transceivers[T].rtpReceiver.setTransport(m.transceivers[0].dtlsTransport)),v.type==="offer"&&!k){M=m.transceivers[T]||m._createTransceiver(W),M.mid=R,M.iceGatherer||(M.iceGatherer=m._createIceGatherer(T,L)),de.length&&M.iceTransport.state==="new"&&(Q&&(!L||T===0)?M.iceTransport.setRemoteCandidates(de):de.forEach(function(Be){c(M.iceTransport,Be)})),ue=l.RTCRtpReceiver.getCapabilities(W),d<15019&&(ue.codecs=ue.codecs.filter(function(Be){return Be.name!=="rtx"})),re=M.sendEncodingParameters||[{ssrc:(2*T+2)*1001}];var De=!1;if(B==="sendrecv"||B==="sendonly"){if(De=!M.rtpReceiver,Z=M.rtpReceiver||new l.RTCRtpReceiver(M.dtlsTransport,W),De){var Ae;z=Z.track,F&&F.stream==="-"||(F?(b[F.stream]||(b[F.stream]=new l.MediaStream,Object.defineProperty(b[F.stream],"id",{get:function(){return F.stream}})),Object.defineProperty(z,"id",{get:function(){return F.track}}),Ae=b[F.stream]):(b.default||(b.default=new l.MediaStream),Ae=b.default)),Ae&&(h(z,Ae),M.associatedRemoteMediaStreams.push(Ae)),C.push([z,Z,Ae])}}else M.rtpReceiver&&M.rtpReceiver.track&&(M.associatedRemoteMediaStreams.forEach(function(Be){var xt=Be.getTracks().find(function(Lr){return Lr.id===M.rtpReceiver.track.id});xt&&f(xt,Be)}),M.associatedRemoteMediaStreams=[]);M.localCapabilities=ue,M.remoteCapabilities=x,M.rtpReceiver=Z,M.rtcpParameters=ae,M.sendEncodingParameters=re,M.recvEncodingParameters=oe,m._transceive(m.transceivers[T],!1,De)}else if(v.type==="answer"&&!k){M=m.transceivers[T],J=M.iceGatherer,ee=M.iceTransport,X=M.dtlsTransport,Z=M.rtpReceiver,re=M.sendEncodingParameters,ue=M.localCapabilities,m.transceivers[T].recvEncodingParameters=oe,m.transceivers[T].remoteCapabilities=x,m.transceivers[T].rtcpParameters=ae,de.length&&ee.state==="new"&&((S||Q)&&(!L||T===0)?ee.setRemoteCandidates(de):de.forEach(function(Be){c(M.iceTransport,Be)})),(!L||T===0)&&(ee.state==="new"&&ee.start(J,N,"controlling"),X.state==="new"&&X.start(q));var Ke=s(M.localCapabilities,M.remoteCapabilities),Ht=Ke.codecs.filter(function(Be){return Be.name.toLowerCase()==="rtx"}).length;!Ht&&M.sendEncodingParameters[0].rtx&&delete M.sendEncodingParameters[0].rtx,m._transceive(M,B==="sendrecv"||B==="recvonly",B==="sendrecv"||B==="sendonly"),Z&&(B==="sendrecv"||B==="sendonly")?(z=Z.track,F?(b[F.stream]||(b[F.stream]=new l.MediaStream),h(z,b[F.stream]),C.push([z,Z,b[F.stream]])):(b.default||(b.default=new l.MediaStream),h(z,b.default),C.push([z,Z,b.default]))):delete M.rtpReceiver}}),m._dtlsRole===void 0&&(m._dtlsRole=v.type==="offer"?"active":"passive"),m._remoteDescription={type:v.type,sdp:v.sdp},v.type==="offer"?m._updateSignalingState("have-remote-offer"):m._updateSignalingState("stable"),Object.keys(b).forEach(function(j){var T=b[j];if(T.getTracks().length){if(m.remoteStreams.indexOf(T)===-1){m.remoteStreams.push(T);var V=new Event("addstream");V.stream=T,l.setTimeout(function(){m._dispatchEvent("addstream",V)})}C.forEach(function(W){var k=W[0],Y=W[1];T.id===W[2].id&&g(m,k,Y,[T])})}}),C.forEach(function(j){j[2]||g(m,j[0],j[1],[])}),l.setTimeout(function(){!(m&&m.transceivers)||m.transceivers.forEach(function(j){j.iceTransport&&j.iceTransport.state==="new"&&j.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),j.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},y.prototype.close=function(){this.transceivers.forEach(function(v){v.iceTransport&&v.iceTransport.stop(),v.dtlsTransport&&v.dtlsTransport.stop(),v.rtpSender&&v.rtpSender.stop(),v.rtpReceiver&&v.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},y.prototype._updateSignalingState=function(v){this.signalingState=v;var m=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",m)},y.prototype._maybeFireNegotiationNeeded=function(){var v=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,l.setTimeout(function(){if(v.needNegotiation){v.needNegotiation=!1;var m=new Event("negotiationneeded");v._dispatchEvent("negotiationneeded",m)}},0))},y.prototype._updateIceConnectionState=function(){var v,m={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(C){C.iceTransport&&!C.rejected&&m[C.iceTransport.state]++}),v="new",m.failed>0?v="failed":m.checking>0?v="checking":m.disconnected>0?v="disconnected":m.new>0?v="new":m.connected>0?v="connected":m.completed>0&&(v="completed"),v!==this.iceConnectionState){this.iceConnectionState=v;var b=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",b)}},y.prototype._updateConnectionState=function(){var v,m={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(C){C.iceTransport&&C.dtlsTransport&&!C.rejected&&(m[C.iceTransport.state]++,m[C.dtlsTransport.state]++)}),m.connected+=m.completed,v="new",m.failed>0?v="failed":m.connecting>0?v="connecting":m.disconnected>0?v="disconnected":m.new>0?v="new":m.connected>0&&(v="connected"),v!==this.connectionState){this.connectionState=v;var b=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",b)}},y.prototype.createOffer=function(){var v=this;if(v._isClosed)return Promise.reject(u("InvalidStateError","Can not call createOffer after close"));var m=v.transceivers.filter(function(S){return S.kind==="audio"}).length,b=v.transceivers.filter(function(S){return S.kind==="video"}).length,C=arguments[0];if(C){if(C.mandatory||C.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");C.offerToReceiveAudio!==void 0&&(C.offerToReceiveAudio===!0?m=1:C.offerToReceiveAudio===!1?m=0:m=C.offerToReceiveAudio),C.offerToReceiveVideo!==void 0&&(C.offerToReceiveVideo===!0?b=1:C.offerToReceiveVideo===!1?b=0:b=C.offerToReceiveVideo)}for(v.transceivers.forEach(function(S){S.kind==="audio"?(m--,m<0&&(S.wantReceive=!1)):S.kind==="video"&&(b--,b<0&&(S.wantReceive=!1))});m>0||b>0;)m>0&&(v._createTransceiver("audio"),m--),b>0&&(v._createTransceiver("video"),b--);var _=r.writeSessionBoilerplate(v._sdpSessionId,v._sdpSessionVersion++);v.transceivers.forEach(function(S,L){var H=S.track,j=S.kind,T=S.mid||r.generateIdentifier();S.mid=T,S.iceGatherer||(S.iceGatherer=v._createIceGatherer(L,v.usingBundle));var V=l.RTCRtpSender.getCapabilities(j);d<15019&&(V.codecs=V.codecs.filter(function(k){return k.name!=="rtx"})),V.codecs.forEach(function(k){k.name==="H264"&&k.parameters["level-asymmetry-allowed"]===void 0&&(k.parameters["level-asymmetry-allowed"]="1"),S.remoteCapabilities&&S.remoteCapabilities.codecs&&S.remoteCapabilities.codecs.forEach(function(Y){k.name.toLowerCase()===Y.name.toLowerCase()&&k.clockRate===Y.clockRate&&(k.preferredPayloadType=Y.payloadType)})}),V.headerExtensions.forEach(function(k){var Y=S.remoteCapabilities&&S.remoteCapabilities.headerExtensions||[];Y.forEach(function(B){k.uri===B.uri&&(k.id=B.id)})});var W=S.sendEncodingParameters||[{ssrc:(2*L+1)*1001}];H&&d>=15019&&j==="video"&&!W[0].rtx&&(W[0].rtx={ssrc:W[0].ssrc+1}),S.wantReceive&&(S.rtpReceiver=new l.RTCRtpReceiver(S.dtlsTransport,j)),S.localCapabilities=V,S.sendEncodingParameters=W}),v._config.bundlePolicy!=="max-compat"&&(_+="a=group:BUNDLE "+v.transceivers.map(function(S){return S.mid}).join(" ")+`\r
`),_+=`a=ice-options:trickle\r
`,v.transceivers.forEach(function(S,L){_+=i(S,S.localCapabilities,"offer",S.stream,v._dtlsRole),_+=`a=rtcp-rsize\r
`,S.iceGatherer&&v.iceGatheringState!=="new"&&(L===0||!v.usingBundle)&&(S.iceGatherer.getLocalCandidates().forEach(function(H){H.component=1,_+="a="+r.writeCandidate(H)+`\r
`}),S.iceGatherer.state==="completed"&&(_+=`a=end-of-candidates\r
`))});var P=new l.RTCSessionDescription({type:"offer",sdp:_});return Promise.resolve(P)},y.prototype.createAnswer=function(){var v=this;if(v._isClosed)return Promise.reject(u("InvalidStateError","Can not call createAnswer after close"));if(!(v.signalingState==="have-remote-offer"||v.signalingState==="have-local-pranswer"))return Promise.reject(u("InvalidStateError","Can not call createAnswer in signalingState "+v.signalingState));var m=r.writeSessionBoilerplate(v._sdpSessionId,v._sdpSessionVersion++);v.usingBundle&&(m+="a=group:BUNDLE "+v.transceivers.map(function(_){return _.mid}).join(" ")+`\r
`),m+=`a=ice-options:trickle\r
`;var b=r.getMediaSections(v._remoteDescription.sdp).length;v.transceivers.forEach(function(_,P){if(!(P+1>b)){if(_.rejected){_.kind==="application"?_.protocol==="DTLS/SCTP"?m+=`m=application 0 DTLS/SCTP 5000\r
`:m+="m=application 0 "+_.protocol+` webrtc-datachannel\r
`:_.kind==="audio"?m+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:_.kind==="video"&&(m+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),m+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+_.mid+`\r
`;return}if(_.stream){var S;_.kind==="audio"?S=_.stream.getAudioTracks()[0]:_.kind==="video"&&(S=_.stream.getVideoTracks()[0]),S&&d>=15019&&_.kind==="video"&&!_.sendEncodingParameters[0].rtx&&(_.sendEncodingParameters[0].rtx={ssrc:_.sendEncodingParameters[0].ssrc+1})}var L=s(_.localCapabilities,_.remoteCapabilities),H=L.codecs.filter(function(j){return j.name.toLowerCase()==="rtx"}).length;!H&&_.sendEncodingParameters[0].rtx&&delete _.sendEncodingParameters[0].rtx,m+=i(_,L,"answer",_.stream,v._dtlsRole),_.rtcpParameters&&_.rtcpParameters.reducedSize&&(m+=`a=rtcp-rsize\r
`)}});var C=new l.RTCSessionDescription({type:"answer",sdp:m});return Promise.resolve(C)},y.prototype.addIceCandidate=function(v){var m=this,b;return v&&!(v.sdpMLineIndex!==void 0||v.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(C,_){if(m._remoteDescription)if(!v||v.candidate==="")for(var P=0;P<m.transceivers.length&&!(!m.transceivers[P].rejected&&(m.transceivers[P].iceTransport.addRemoteCandidate({}),b=r.getMediaSections(m._remoteDescription.sdp),b[P]+=`a=end-of-candidates\r
`,m._remoteDescription.sdp=r.getDescription(m._remoteDescription.sdp)+b.join(""),m.usingBundle));P++);else{var S=v.sdpMLineIndex;if(v.sdpMid){for(var L=0;L<m.transceivers.length;L++)if(m.transceivers[L].mid===v.sdpMid){S=L;break}}var H=m.transceivers[S];if(H){if(H.rejected)return C();var j=Object.keys(v.candidate).length>0?r.parseCandidate(v.candidate):{};if(j.protocol==="tcp"&&(j.port===0||j.port===9)||j.component&&j.component!==1)return C();if((S===0||S>0&&H.iceTransport!==m.transceivers[0].iceTransport)&&!c(H.iceTransport,j))return _(u("OperationError","Can not add ICE candidate"));var T=v.candidate.trim();T.indexOf("a=")===0&&(T=T.substr(2)),b=r.getMediaSections(m._remoteDescription.sdp),b[S]+="a="+(j.type?T:"end-of-candidates")+`\r
`,m._remoteDescription.sdp=r.getDescription(m._remoteDescription.sdp)+b.join("")}else return _(u("OperationError","Can not add ICE candidate"))}else return _(u("InvalidStateError","Can not add ICE candidate without a remote description"));C()})},y.prototype.getStats=function(v){if(v&&v instanceof l.MediaStreamTrack){var m=null;if(this.transceivers.forEach(function(C){C.rtpSender&&C.rtpSender.track===v?m=C.rtpSender:C.rtpReceiver&&C.rtpReceiver.track===v&&(m=C.rtpReceiver)}),!m)throw u("InvalidAccessError","Invalid selector.");return m.getStats()}var b=[];return this.transceivers.forEach(function(C){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(_){C[_]&&b.push(C[_].getStats())})}),Promise.all(b).then(function(C){var _=new Map;return C.forEach(function(P){P.forEach(function(S){_.set(S.id,S)})}),_})};var E=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];E.forEach(function(v){var m=l[v];if(m&&m.prototype&&m.prototype.getStats){var b=m.prototype.getStats;m.prototype.getStats=function(){return b.apply(this).then(function(C){var _=new Map;return Object.keys(C).forEach(function(P){C[P].type=n(C[P]),_.set(P,C[P])}),_})}}});var A=["createOffer","createAnswer"];return A.forEach(function(v){var m=y.prototype[v];y.prototype[v]=function(){var b=arguments;return typeof b[0]=="function"||typeof b[1]=="function"?m.apply(this,[arguments[2]]).then(function(C){typeof b[0]=="function"&&b[0].apply(null,[C])},function(C){typeof b[1]=="function"&&b[1].apply(null,[C])}):m.apply(this,arguments)}}),A=["setLocalDescription","setRemoteDescription","addIceCandidate"],A.forEach(function(v){var m=y.prototype[v];y.prototype[v]=function(){var b=arguments;return typeof b[1]=="function"||typeof b[2]=="function"?m.apply(this,arguments).then(function(){typeof b[1]=="function"&&b[1].apply(null)},function(C){typeof b[2]=="function"&&b[2].apply(null,[C])}):m.apply(this,arguments)}}),["getStats"].forEach(function(v){var m=y.prototype[v];y.prototype[v]=function(){var b=arguments;return typeof b[1]=="function"?m.apply(this,arguments).then(function(){typeof b[1]=="function"&&b[1].apply(null)}):m.apply(this,arguments)}}),y}}}),xu=ft(C0(),1),Ll=!0,Nl=!0;function Hr(e,t,r){const n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function jr(e,t,r){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(s,o){if(s!==t)return i.apply(this,arguments);const c=u=>{const l=r(u);l&&(o.handleEvent?o.handleEvent(l):o(l))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(o,c),i.apply(this,[s,c])};const a=n.removeEventListener;n.removeEventListener=function(s,o){if(s!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(o))return a.apply(this,arguments);const c=this._eventMap[t].get(o);return this._eventMap[t].delete(o),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[s,c])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(s){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),s&&this.addEventListener(t,this["_on"+t]=s)},enumerable:!0,configurable:!0})}function b0(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Ll=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function E0(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Nl=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function qs(){if(typeof window=="object"){if(Ll)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Ni(e,t){!Nl||console.warn(e+" is deprecated, please use "+t+" instead.")}function S0(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator)return t.browser="Not a browser.",t;const{navigator:r}=e;if(r.mozGetUserMedia)t.browser="firefox",t.version=Hr(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=Hr(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(r.mediaDevices&&r.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=Hr(r.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(e.RTCPeerConnection&&r.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=Hr(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function Pu(e){return Object.prototype.toString.call(e)==="[object Object]"}function Ul(e){return Pu(e)?Object.keys(e).reduce(function(t,r){const n=Pu(e[r]),i=n?Ul(e[r]):e[r],a=n&&!Object.keys(i).length;return i===void 0||a?t:Object.assign(t,{[r]:i})},{}):e}function Ua(e,t,r){!t||r.has(t.id)||(r.set(t.id,t),Object.keys(t).forEach(n=>{n.endsWith("Id")?Ua(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach(i=>{Ua(e,e.get(i),r)})}))}function Ru(e,t,r){const n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const a=[];return e.forEach(s=>{s.type==="track"&&s.trackIdentifier===t.id&&a.push(s)}),a.forEach(s=>{e.forEach(o=>{o.type===n&&o.trackId===s.id&&Ua(e,o,i)})}),i}var za={};Cn(za,{fixNegotiationNeeded:()=>Yl,shimAddTrackRemoveTrack:()=>Kl,shimAddTrackRemoveTrackWithNative:()=>Hl,shimGetDisplayMedia:()=>B0,shimGetSendersWithDtmf:()=>Vl,shimGetStats:()=>Gl,shimGetUserMedia:()=>zl,shimMediaStream:()=>$l,shimOnTrack:()=>Wl,shimPeerConnection:()=>$a,shimSenderReceiverGetStats:()=>ql});var Iu=qs;function zl(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const n=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const c={};return Object.keys(o).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const l=typeof o[u]=="object"?o[u]:{ideal:o[u]};l.exact!==void 0&&typeof l.exact=="number"&&(l.min=l.max=l.exact);const d=function(h,f){return h?h+f.charAt(0).toUpperCase()+f.slice(1):f==="deviceId"?"sourceId":f};if(l.ideal!==void 0){c.optional=c.optional||[];let h={};typeof l.ideal=="number"?(h[d("min",u)]=l.ideal,c.optional.push(h),h={},h[d("max",u)]=l.ideal,c.optional.push(h)):(h[d("",u)]=l.ideal,c.optional.push(h))}l.exact!==void 0&&typeof l.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[d("",u)]=l.exact):["min","max"].forEach(h=>{l[h]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[d(h,u)]=l[h])})}),o.advanced&&(c.optional=(c.optional||[]).concat(o.advanced)),c},i=function(o,c){if(t.version>=61)return c(o);if(o=JSON.parse(JSON.stringify(o)),o&&typeof o.audio=="object"){const u=function(l,d,h){d in l&&!(h in l)&&(l[h]=l[d],delete l[d])};o=JSON.parse(JSON.stringify(o)),u(o.audio,"autoGainControl","googAutoGainControl"),u(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=n(o.audio)}if(o&&typeof o.video=="object"){let u=o.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const l=t.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(r.mediaDevices.getSupportedConstraints&&r.mediaDevices.getSupportedConstraints().facingMode&&!l)){delete o.video.facingMode;let d;if(u.exact==="environment"||u.ideal==="environment"?d=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(d=["front"]),d)return r.mediaDevices.enumerateDevices().then(h=>{h=h.filter(g=>g.kind==="videoinput");let f=h.find(g=>d.some(y=>g.label.toLowerCase().includes(y)));return!f&&h.length&&d.includes("back")&&(f=h[h.length-1]),f&&(o.video.deviceId=u.exact?{exact:f.deviceId}:{ideal:f.deviceId}),o.video=n(o.video),Iu("chrome: "+JSON.stringify(o)),c(o)})}o.video=n(o.video)}return Iu("chrome: "+JSON.stringify(o)),c(o)},a=function(o){return t.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},s=function(o,c,u){i(o,l=>{r.webkitGetUserMedia(l,c,d=>{u&&u(a(d))})})};if(r.getUserMedia=s.bind(r),r.mediaDevices.getUserMedia){const o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(c){return i(c,u=>o(u).then(l=>{if(u.audio&&!l.getAudioTracks().length||u.video&&!l.getVideoTracks().length)throw l.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return l},l=>Promise.reject(a(l))))}}}function B0(e,t){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&!!e.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(i=>{const a=n.video&&n.video.width,s=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:o||3}},a&&(n.video.mandatory.maxWidth=a),s&&(n.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(n)})}}}function $l(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Wl(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let a;e.RTCPeerConnection.prototype.getReceivers?a=this.getReceivers().find(o=>o.track&&o.track.id===i.track.id):a={track:i.track};const s=new Event("track");s.track=i.track,s.receiver=a,s.transceiver={receiver:a},s.streams=[n.stream],this.dispatchEvent(s)}),n.stream.getTracks().forEach(i=>{let a;e.RTCPeerConnection.prototype.getReceivers?a=this.getReceivers().find(o=>o.track&&o.track.id===i.id):a={track:i};const s=new Event("track");s.track=i,s.receiver=a,s.transceiver={receiver:a},s.streams=[n.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else jr(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Vl(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=i.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,c){let u=i.apply(this,arguments);return u||(u=t(this,o),this._senders.push(u)),u};const a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){a.apply(this,arguments);const c=this._senders.indexOf(o);c!==-1&&this._senders.splice(c,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._senders=this._senders||[],r.apply(this,[a]),a.getTracks().forEach(s=>{this._senders.push(t(this,s))})};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){this._senders=this._senders||[],n.apply(this,[a]),a.getTracks().forEach(s=>{const o=this._senders.find(c=>c.track===s);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Gl(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,i,a]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const s=function(c){const u={};return c.result().forEach(d=>{const h={id:d.id,timestamp:d.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type};d.names().forEach(f=>{h[f]=d.stat(f)}),u[h.id]=h}),u},o=function(c){return new Map(Object.keys(c).map(u=>[u,c[u]]))};if(arguments.length>=2){const c=function(u){i(o(s(u)))};return t.apply(this,[c,n])}return new Promise((c,u)=>{t.apply(this,[function(l){c(o(s(l)))},u])}).then(i,a)}}function ql(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const a=r.apply(this,[]);return a.forEach(s=>s._pc=this),a});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const a=n.apply(this,arguments);return a._pc=this,a}),e.RTCRtpSender.prototype.getStats=function(){const a=this;return this._pc.getStats().then(s=>Ru(s,a.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=r.apply(this,[]);return i.forEach(a=>a._pc=this),i}),jr(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(a=>Ru(a,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let i,a,s;return this.getSenders().forEach(o=>{o.track===n&&(i?s=!0:i=o)}),this.getReceivers().forEach(o=>(o.track===n&&(a?s=!0:a=o),o.track===n)),s||i&&a?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():a?a.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Hl(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,o){if(!o)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=t.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(c)===-1&&this._shimmedLocalStreams[o.id].push(c):this._shimmedLocalStreams[o.id]=[o,c],c};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(u=>{if(this.getSenders().find(d=>d.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();r.apply(this,arguments);const c=this.getSenders().filter(u=>o.indexOf(u)===-1);this._shimmedLocalStreams[s.id]=[s].concat(c)};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],n.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const c=this._shimmedLocalStreams[o].indexOf(s);c!==-1&&this._shimmedLocalStreams[o].splice(c,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),i.apply(this,arguments)}}function Kl(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Hl(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const l=r.apply(this);return this._reverseStreams=this._reverseStreams||{},l.map(d=>this._reverseStreams[d.id])};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.getTracks().forEach(d=>{if(this.getSenders().find(f=>f.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[l.id]){const d=new e.MediaStream(l.getTracks());this._streams[l.id]=d,this._reverseStreams[d.id]=l,l=d}n.apply(this,[l])};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[l.id]||l]),delete this._reverseStreams[this._streams[l.id]?this._streams[l.id].id:l.id],delete this._streams[l.id]},e.RTCPeerConnection.prototype.addTrack=function(l,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(y=>y===l))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(y=>y.track===l))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const g=this._streams[d.id];if(g)g.addTrack(l),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const y=new e.MediaStream([l]);this._streams[d.id]=y,this._reverseStreams[y.id]=d,this.addStream(y)}return this.getSenders().find(y=>y.track===l)};function a(u,l){let d=l.sdp;return Object.keys(u._reverseStreams||[]).forEach(h=>{const f=u._reverseStreams[h],g=u._streams[f.id];d=d.replace(new RegExp(g.id,"g"),f.id)}),new RTCSessionDescription({type:l.type,sdp:d})}function s(u,l){let d=l.sdp;return Object.keys(u._reverseStreams||[]).forEach(h=>{const f=u._reverseStreams[h],g=u._streams[f.id];d=d.replace(new RegExp(f.id,"g"),g.id)}),new RTCSessionDescription({type:l.type,sdp:d})}["createOffer","createAnswer"].forEach(function(u){const l=e.RTCPeerConnection.prototype[u],d={[u](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?l.apply(this,[g=>{const y=a(this,g);h[0].apply(null,[y])},g=>{h[1]&&h[1].apply(null,g)},arguments[2]]):l.apply(this,arguments).then(g=>a(this,g))}};e.RTCPeerConnection.prototype[u]=d[u]});const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?o.apply(this,arguments):(arguments[0]=s(this,arguments[0]),o.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const u=c.get.apply(this);return u.type===""?u:a(this,u)}}),e.RTCPeerConnection.prototype.removeTrack=function(l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!l._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(l._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(f=>{this._streams[f].getTracks().find(y=>l.track===y)&&(h=this._streams[f])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(l.track),this.dispatchEvent(new Event("negotiationneeded")))}}function $a(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!!e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const n=e.RTCPeerConnection.prototype[r],i={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=i[r]})}function Yl(e,t){jr(e,"negotiationneeded",r=>{const n=r.target;if(!((t.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")&&n.signalingState!=="stable"))return r})}var Wa={};Cn(Wa,{shimGetDisplayMedia:()=>Xl,shimGetUserMedia:()=>Jl,shimPeerConnection:()=>Va,shimReplaceTrack:()=>Zl});function _0(e,t){let r=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(n=>{if(n&&(n.urls||n.url)){let i=n.urls||n.url;n.url&&!n.urls&&Ni("RTCIceServer.url","RTCIceServer.urls");const a=typeof i=="string";return a&&(i=[i]),i=i.filter(s=>{if(s.indexOf("stun:")===0)return!1;const o=s.startsWith("turn")&&!s.startsWith("turn:[")&&s.includes("transport=udp");return o&&!r?(r=!0,!0):o&&!r}),delete n.url,n.urls=a?i[0]:i,!!i.length}})}var A0=ft(D0());function Jl(e){const t=e&&e.navigator,r=function(i){return{name:{PermissionDeniedError:"NotAllowedError"}[i.name]||i.name,message:i.message,constraint:i.constraint,toString(){return this.name}}},n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(i){return n(i).catch(a=>Promise.reject(r(a)))}}function Xl(e){"getDisplayMedia"in e.navigator&&(!e.navigator.mediaDevices||e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function Va(e,t){if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(i){return i}),e.RTCSessionDescription||(e.RTCSessionDescription=function(i){return i}),t.version<15025)){const n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set(i){n.set.call(this,i);const a=new Event("enabled");a.enabled=i,this.dispatchEvent(a)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new e.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const r=(0,A0.default)(e,t.version);e.RTCPeerConnection=function(i){return i&&i.iceServers&&(i.iceServers=_0(i.iceServers,t.version),qs("ICE servers after filtering:",i.iceServers)),new r(i)},e.RTCPeerConnection.prototype=r.prototype}function Zl(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}var Ga={};Cn(Ga,{shimAddTransceiver:()=>sf,shimCreateAnswer:()=>cf,shimCreateOffer:()=>uf,shimGetDisplayMedia:()=>w0,shimGetParameters:()=>of,shimGetUserMedia:()=>Ql,shimOnTrack:()=>ef,shimPeerConnection:()=>qa,shimRTCDataChannel:()=>af,shimReceiverGetStats:()=>rf,shimRemoveStream:()=>nf,shimSenderGetStats:()=>tf});function Ql(e,t){const r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(i,a,s){Ni("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(i).then(a,s)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const i=function(s,o,c){o in s&&!(c in s)&&(s[c]=s[o],delete s[o])},a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(s){return typeof s=="object"&&typeof s.audio=="object"&&(s=JSON.parse(JSON.stringify(s)),i(s.audio,"autoGainControl","mozAutoGainControl"),i(s.audio,"noiseSuppression","mozNoiseSuppression")),a(s)},n&&n.prototype.getSettings){const s=n.prototype.getSettings;n.prototype.getSettings=function(){const o=s.apply(this,arguments);return i(o,"mozAutoGainControl","autoGainControl"),i(o,"mozNoiseSuppression","noiseSuppression"),o}}if(n&&n.prototype.applyConstraints){const s=n.prototype.applyConstraints;n.prototype.applyConstraints=function(o){return this.kind==="audio"&&typeof o=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o,"autoGainControl","mozAutoGainControl"),i(o,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[o])}}}}function w0(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||!e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!(n&&n.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function ef(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function qa(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const a=e.RTCPeerConnection.prototype[i],s={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=s[i]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[a,s,o]=arguments;return n.apply(this,[a||null]).then(c=>{if(t.version<53&&!s)try{c.forEach(u=>{u.type=r[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;c.forEach((l,d)=>{c.set(d,Object.assign({},l,{type:r[l.type]||l.type}))})}return c}).then(s,o)}}function tf(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(a=>a._pc=this),i});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function rf(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n}),jr(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function nf(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){Ni("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&r.getTracks().includes(n.track)&&this.removeTrack(n)})})}function af(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function sf(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const n=arguments[1],i=n&&"sendEncodings"in n;i&&n.sendEncodings.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const a=t.apply(this,arguments);if(i){const{sender:s}=a,o=s.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=n.sendEncodings,s.sendEncodings=n.sendEncodings,this.setParametersPromises.push(s.setParameters(o).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return a})}function of(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function uf(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function cf(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var Ha={};Cn(Ha,{shimAudioContext:()=>yf,shimCallbacksAPI:()=>df,shimConstraints:()=>pf,shimCreateOfferLegacy:()=>mf,shimGetUserMedia:()=>hf,shimLocalStreamsAPI:()=>lf,shimRTCIceServerUrls:()=>vf,shimRemoteStreamsAPI:()=>ff,shimTrackEventTransceiver:()=>gf});function lf(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>t.call(this,i,n)),n.getVideoTracks().forEach(i=>t.call(this,i,n))},e.RTCPeerConnection.prototype.addTrack=function(n,...i){return i&&i.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(r);if(n===-1)return;this._localStreams.splice(n,1);const i=r.getTracks();this.getSenders().forEach(a=>{i.includes(a.track)&&this.removeTrack(a)})})}}function ff(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const a=new Event("addstream");a.stream=i,this.dispatchEvent(a)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(a=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(a)>=0)return;n._remoteStreams.push(a);const s=new Event("addstream");s.stream=a,n.dispatchEvent(s)})}),t.apply(n,arguments)}}}function df(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(u,l){const d=arguments.length>=2?arguments[2]:arguments[0],h=r.apply(this,[d]);return l?(h.then(u,l),Promise.resolve()):h},t.createAnswer=function(u,l){const d=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[d]);return l?(h.then(u,l),Promise.resolve()):h};let o=function(c,u,l){const d=i.apply(this,[c]);return l?(d.then(u,l),Promise.resolve()):d};t.setLocalDescription=o,o=function(c,u,l){const d=a.apply(this,[c]);return l?(d.then(u,l),Promise.resolve()):d},t.setRemoteDescription=o,o=function(c,u,l){const d=s.apply(this,[c]);return l?(d.then(u,l),Promise.resolve()):d},t.addIceCandidate=o}function hf(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=i=>n(pf(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(n,i,a){t.mediaDevices.getUserMedia(n).then(i,a)}.bind(t))}function pf(e){return e&&e.video!==void 0?Object.assign({},e,{video:Ul(e.video)}):e}function vf(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const a=[];for(let s=0;s<n.iceServers.length;s++){let o=n.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(Ni("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,a.push(o)):a.push(n.iceServers[s])}n.iceServers=a}return new t(n,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function gf(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function mf(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){typeof n.offerToReceiveAudio<"u"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio"),typeof n.offerToReceiveVideo<"u"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const a=this.getTransceivers().find(s=>s.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):n.offerToReceiveVideo===!0&&!a&&this.addTransceiver("video")}return t.apply(this,arguments)}}function yf(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Cf={};Cn(Cf,{removeExtmapAllowMixed:()=>Ya,shimAddIceCandidateNullOrEmpty:()=>ei,shimConnectionState:()=>Ka,shimMaxMessageSize:()=>Kr,shimRTCIceCandidate:()=>Qn,shimSendThrowTypeError:()=>Yr});var Zn=ft(jl());function Qn(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&(n=JSON.parse(JSON.stringify(n)),n.candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new t(n),a=Zn.default.parseCandidate(n.candidate),s=Object.assign(i,a);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,jr(e,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r))}function Kr(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const r=function(o){if(!o||!o.sdp)return!1;const c=Zn.default.splitSections(o.sdp);return c.shift(),c.some(u=>{const l=Zn.default.parseMLine(u);return l&&l.kind==="application"&&l.protocol.indexOf("SCTP")!==-1})},n=function(o){const c=o.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const u=parseInt(c[1],10);return u!==u?-1:u},i=function(o){let c=65536;return t.browser==="firefox"&&(t.version<57?o===-1?c=16384:c=2147483637:t.version<60?c=t.version===57?65535:65536:c=2147483637),c},a=function(o,c){let u=65536;t.browser==="firefox"&&t.version===57&&(u=65535);const l=Zn.default.matchPrefix(o.sdp,"a=max-message-size:");return l.length>0?u=parseInt(l[0].substr(19),10):t.browser==="firefox"&&c!==-1&&(u=2147483637),u},s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const c=n(arguments[0]),u=i(c),l=a(arguments[0],c);let d;u===0&&l===0?d=Number.POSITIVE_INFINITY:u===0||l===0?d=Math.max(u,l):d=Math.min(u,l);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return d}}),this._sctp=h}return s.apply(this,arguments)}}function Yr(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(n,i){const a=n.send;n.send=function(){const o=arguments[0],c=o.length||o.size||o.byteLength;if(n.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return a.apply(n,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=r.apply(this,arguments);return t(i,this),i},jr(e,"datachannel",n=>(t(n.channel,n.target),n))}function Ka(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const n=t[r];t[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const a=i.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;const s=new Event("connectionstatechange",i);a.dispatchEvent(s)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function Ya(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const a=i.sdp.split(`
`).filter(s=>s.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:a}):i.sdp=a}return r.apply(this,arguments)}}function ei(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const r=e.RTCPeerConnection.prototype.addIceCandidate;!r||r.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function k0({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const r=qs,n=S0(e),i={browserDetails:n,commonShim:Cf,extractVersion:Hr,disableLog:b0,disableWarnings:E0};switch(n.browser){case"chrome":if(!za||!$a||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(n.version===null)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=za,ei(e,n),zl(e,n),$l(e),$a(e,n),Wl(e),Kl(e,n),Vl(e),Gl(e),ql(e),Yl(e,n),Qn(e),Ka(e),Kr(e,n),Yr(e),Ya(e,n);break;case"firefox":if(!Ga||!qa||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=Ga,ei(e,n),Ql(e,n),qa(e,n),ef(e),nf(e),tf(e),rf(e),af(e),sf(e),of(e),uf(e),cf(e),Qn(e),Ka(e),Kr(e,n),Yr(e);break;case"edge":if(!Wa||!Va||!t.shimEdge)return r("MS edge shim is not included in this adapter release."),i;r("adapter.js shimming edge."),i.browserShim=Wa,Jl(e),Xl(e),Va(e,n),Zl(e),Kr(e,n),Yr(e);break;case"safari":if(!Ha||!t.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=Ha,ei(e,n),vf(e),mf(e),df(e),lf(e),ff(e),gf(e),hf(e),yf(e),Qn(e),Kr(e,n),Yr(e),Ya(e,n);break;default:r("Unsupported browser!");break}return i}var F0=k0({window:typeof window>"u"?void 0:window}),Mu=F0;function Ct(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var da=Mu.default||Mu,Wr=new(function(){function e(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return e.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},e.prototype.isBrowserSupported=function(){var t=this.getBrowser(),r=this.getVersion(),n=this.supportedBrowsers.includes(t);return n?t==="chrome"?r>=this.minChromeVersion:t==="firefox"?r>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&r>=this.minSafariVersion:!1:!1},e.prototype.getBrowser=function(){return da.browserDetails.browser},e.prototype.getVersion=function(){return da.browserDetails.version||0},e.prototype.isUnifiedPlanSupported=function(){var t=this.getBrowser(),r=da.browserDetails.version||0;if(t==="chrome"&&r<this.minChromeVersion)return!1;if(t==="firefox"&&r>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var n,i=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),i=!0}catch{}finally{n&&n.close()}return i},e.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},e}()),ju={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},T0=function(){function e(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=ju,this.browser=Wr.getBrowser(),this.browserVersion=Wr.getVersion(),this.supports=function(){var t={browser:Wr.isBrowserSupported(),webRTC:Wr.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;var r;try{r=new RTCPeerConnection(ju),t.audioVideo=!0;var n=void 0;try{n=r.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!n.ordered;try{n.binaryType="blob",t.binaryBlob=!Wr.isIOS}catch{}}catch{}finally{n&&n.close()}}catch{}finally{r&&r.close()}return t}(),this.pack=xu.default.pack,this.unpack=xu.default.unpack,this._dataCount=1}return e.prototype.noop=function(){},e.prototype.validateId=function(t){return!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t)},e.prototype.chunk=function(t){for(var r=[],n=t.size,i=Math.ceil(n/fe.chunkedMTU),a=0,s=0;s<n;){var o=Math.min(n,s+fe.chunkedMTU),c=t.slice(s,o),u={__peerData:this._dataCount,n:a,data:c,total:i};r.push(u),s=o,a++}return this._dataCount++,r},e.prototype.blobToArrayBuffer=function(t,r){var n=new FileReader;return n.onload=function(i){i.target&&r(i.target.result)},n.readAsArrayBuffer(t),n},e.prototype.binaryStringToArrayBuffer=function(t){for(var r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n)&255;return r.buffer},e.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},e.prototype.isSecure=function(){return location.protocol==="https:"},e}(),fe=new T0,Df={};Ct(Df,"Peer",()=>Za,e=>Za=e);var _n={},O0=Object.prototype.hasOwnProperty,je="~";function yn(){}Object.create&&(yn.prototype=Object.create(null),new yn().__proto__||(je=!1));function x0(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function bf(e,t,r,n,i){if(typeof r!="function")throw new TypeError("The listener must be a function");var a=new x0(r,n||e,i),s=je?je+t:t;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],a]:e._events[s].push(a):(e._events[s]=a,e._eventsCount++),e}function ti(e,t){--e._eventsCount===0?e._events=new yn:delete e._events[t]}function Me(){this._events=new yn,this._eventsCount=0}Me.prototype.eventNames=function(){var t=[],r,n;if(this._eventsCount===0)return t;for(n in r=this._events)O0.call(r,n)&&t.push(je?n.slice(1):n);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(r)):t};Me.prototype.listeners=function(t){var r=je?je+t:t,n=this._events[r];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,a=n.length,s=new Array(a);i<a;i++)s[i]=n[i].fn;return s};Me.prototype.listenerCount=function(t){var r=je?je+t:t,n=this._events[r];return n?n.fn?1:n.length:0};Me.prototype.emit=function(t,r,n,i,a,s){var o=je?je+t:t;if(!this._events[o])return!1;var c=this._events[o],u=arguments.length,l,d;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,r),!0;case 3:return c.fn.call(c.context,r,n),!0;case 4:return c.fn.call(c.context,r,n,i),!0;case 5:return c.fn.call(c.context,r,n,i,a),!0;case 6:return c.fn.call(c.context,r,n,i,a,s),!0}for(d=1,l=new Array(u-1);d<u;d++)l[d-1]=arguments[d];c.fn.apply(c.context,l)}else{var h=c.length,f;for(d=0;d<h;d++)switch(c[d].once&&this.removeListener(t,c[d].fn,void 0,!0),u){case 1:c[d].fn.call(c[d].context);break;case 2:c[d].fn.call(c[d].context,r);break;case 3:c[d].fn.call(c[d].context,r,n);break;case 4:c[d].fn.call(c[d].context,r,n,i);break;default:if(!l)for(f=1,l=new Array(u-1);f<u;f++)l[f-1]=arguments[f];c[d].fn.apply(c[d].context,l)}}return!0};Me.prototype.on=function(t,r,n){return bf(this,t,r,n,!1)};Me.prototype.once=function(t,r,n){return bf(this,t,r,n,!0)};Me.prototype.removeListener=function(t,r,n,i){var a=je?je+t:t;if(!this._events[a])return this;if(!r)return ti(this,a),this;var s=this._events[a];if(s.fn)s.fn===r&&(!i||s.once)&&(!n||s.context===n)&&ti(this,a);else{for(var o=0,c=[],u=s.length;o<u;o++)(s[o].fn!==r||i&&!s[o].once||n&&s[o].context!==n)&&c.push(s[o]);c.length?this._events[a]=c.length===1?c[0]:c:ti(this,a)}return this};Me.prototype.removeAllListeners=function(t){var r;return t?(r=je?je+t:t,this._events[r]&&ti(this,r)):(this._events=new yn,this._eventsCount=0),this};Me.prototype.off=Me.prototype.removeListener;Me.prototype.addListener=Me.prototype.on;Me.prefixed=je;Me.EventEmitter=Me;_n=Me;var K={};Ct(K,"LogLevel",()=>Ne,e=>Ne=e);Ct(K,"default",()=>Lu,e=>Lu=e);var Jt=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,a=[],s;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(o){s={error:o}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return a},Xt=function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,a;n<i;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},P0="PeerJS: ",Ne;(function(e){e[e.Disabled=0]="Disabled",e[e.Errors=1]="Errors",e[e.Warnings=2]="Warnings",e[e.All=3]="All"})(Ne||(Ne={}));var R0=function(){function e(){this._logLevel=Ne.Disabled}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){this._logLevel=t},enumerable:!1,configurable:!0}),e.prototype.log=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this._logLevel>=Ne.All&&this._print.apply(this,Xt([Ne.All],Jt(t),!1))},e.prototype.warn=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this._logLevel>=Ne.Warnings&&this._print.apply(this,Xt([Ne.Warnings],Jt(t),!1))},e.prototype.error=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this._logLevel>=Ne.Errors&&this._print.apply(this,Xt([Ne.Errors],Jt(t),!1))},e.prototype.setLogFunction=function(t){this._print=t},e.prototype._print=function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var i=Xt([P0],Jt(r),!1);for(var a in i)i[a]instanceof Error&&(i[a]="("+i[a].name+") "+i[a].message);t>=Ne.All?console.log.apply(console,Xt([],Jt(i),!1)):t>=Ne.Warnings?console.warn.apply(console,Xt(["WARNING"],Jt(i),!1)):t>=Ne.Errors&&console.error.apply(console,Xt(["ERROR"],Jt(i),!1))},e}(),Lu=new R0,Ef={};Ct(Ef,"Socket",()=>Nu,e=>Nu=e);var ot;(function(e){e.Data="data",e.Media="media"})(ot||(ot={}));var Ee;(function(e){e.BrowserIncompatible="browser-incompatible",e.Disconnected="disconnected",e.InvalidID="invalid-id",e.InvalidKey="invalid-key",e.Network="network",e.PeerUnavailable="peer-unavailable",e.SslUnavailable="ssl-unavailable",e.ServerError="server-error",e.SocketError="socket-error",e.SocketClosed="socket-closed",e.UnavailableID="unavailable-id",e.WebRTC="webrtc"})(Ee||(Ee={}));var St;(function(e){e.Binary="binary",e.BinaryUTF8="binary-utf8",e.JSON="json"})(St||(St={}));var _t;(function(e){e.Message="message",e.Disconnected="disconnected",e.Error="error",e.Close="close"})(_t||(_t={}));var xe;(function(e){e.Heartbeat="HEARTBEAT",e.Candidate="CANDIDATE",e.Offer="OFFER",e.Answer="ANSWER",e.Open="OPEN",e.Error="ERROR",e.IdTaken="ID-TAKEN",e.InvalidKey="INVALID-KEY",e.Leave="LEAVE",e.Expire="EXPIRE"})(xe||(xe={}));var Hs={};Hs=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz St\xFCckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","So\u0308ren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var I0=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),M0=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,a=[],s;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(o){s={error:o}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return a},j0=function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,a;n<i;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},L0=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Nu=function(e){I0(t,e);function t(r,n,i,a,s,o){o===void 0&&(o=5e3);var c=e.call(this)||this;c.pingInterval=o,c._disconnected=!0,c._messagesQueue=[];var u=r?"wss://":"ws://";return c._baseUrl=u+n+":"+i+a+"peerjs?key="+s,c}return t.prototype.start=function(r,n){var i=this;this._id=r;var a="".concat(this._baseUrl,"&id=").concat(r,"&token=").concat(n);!!this._socket||!this._disconnected||(this._socket=new WebSocket(a+"&version="+Hs.version),this._disconnected=!1,this._socket.onmessage=function(s){var o;try{o=JSON.parse(s.data),K.default.log("Server message received:",o)}catch{K.default.log("Invalid server message",s.data);return}i.emit(_t.Message,o)},this._socket.onclose=function(s){i._disconnected||(K.default.log("Socket closed.",s),i._cleanup(),i._disconnected=!0,i.emit(_t.Disconnected))},this._socket.onopen=function(){i._disconnected||(i._sendQueuedMessages(),K.default.log("Socket open"),i._scheduleHeartbeat())})},t.prototype._scheduleHeartbeat=function(){var r=this;this._wsPingTimer=setTimeout(function(){r._sendHeartbeat()},this.pingInterval)},t.prototype._sendHeartbeat=function(){if(!this._wsOpen()){K.default.log("Cannot send heartbeat, because socket closed");return}var r=JSON.stringify({type:xe.Heartbeat});this._socket.send(r),this._scheduleHeartbeat()},t.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},t.prototype._sendQueuedMessages=function(){var r,n,i=j0([],M0(this._messagesQueue),!1);this._messagesQueue=[];try{for(var a=L0(i),s=a.next();!s.done;s=a.next()){var o=s.value;this.send(o)}}catch(c){r={error:c}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}},t.prototype.send=function(r){if(!this._disconnected){if(!this._id){this._messagesQueue.push(r);return}if(!r.type){this.emit(_t.Error,"Invalid message");return}if(!!this._wsOpen()){var n=JSON.stringify(r);this._socket.send(n)}}},t.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},t.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},t}(_n.EventEmitter),Ja={};Ct(Ja,"MediaConnection",()=>$u,e=>$u=e);var Ks={};Ct(Ks,"Negotiator",()=>Uu,e=>Uu=e);var yi=function(){return yi=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},yi.apply(this,arguments)},$n=function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function o(l){try{u(n.next(l))}catch(d){s(d)}}function c(l){try{u(n.throw(l))}catch(d){s(d)}}function u(l){l.done?a(l.value):i(l.value).then(o,c)}u((n=n.apply(e,t||[])).next())})},Wn=function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=u[0]&2?i.return:u[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,u[1])).done)return a;switch(i=0,a&&(u=[u[0]&2,a.value]),u[0]){case 0:case 1:a=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!a||u[1]>a[0]&&u[1]<a[3])){r.label=u[1];break}if(u[0]===6&&r.label<a[1]){r.label=a[1],a=u;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(u);break}a[2]&&r.ops.pop(),r.trys.pop();continue}u=t.call(e,r)}catch(l){u=[6,l],i=0}finally{n=a=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},Uu=function(){function e(t){this.connection=t}return e.prototype.startConnection=function(t){var r=this._startPeerConnection();if(this.connection.peerConnection=r,this.connection.type===ot.Media&&t._stream&&this._addTracksToConnection(t._stream,r),t.originator){if(this.connection.type===ot.Data){var n=this.connection,i={ordered:!!t.reliable},a=r.createDataChannel(n.label,i);n.initialize(a)}this._makeOffer()}else this.handleSDP("OFFER",t.sdp)},e.prototype._startPeerConnection=function(){K.default.log("Creating RTCPeerConnection.");var t=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(t),t},e.prototype._setupListeners=function(t){var r=this,n=this.connection.peer,i=this.connection.connectionId,a=this.connection.type,s=this.connection.provider;K.default.log("Listening for ICE candidates."),t.onicecandidate=function(o){!o.candidate||!o.candidate.candidate||(K.default.log("Received ICE candidates for ".concat(n,":"),o.candidate),s.socket.send({type:xe.Candidate,payload:{candidate:o.candidate,type:a,connectionId:i},dst:n}))},t.oniceconnectionstatechange=function(){switch(t.iceConnectionState){case"failed":K.default.log("iceConnectionState is failed, closing connections to "+n),r.connection.emit("error",new Error("Negotiation of connection to "+n+" failed.")),r.connection.close();break;case"closed":K.default.log("iceConnectionState is closed, closing connections to "+n),r.connection.emit("error",new Error("Connection to "+n+" closed.")),r.connection.close();break;case"disconnected":K.default.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":t.onicecandidate=fe.noop;break}r.connection.emit("iceStateChanged",t.iceConnectionState)},K.default.log("Listening for data channel"),t.ondatachannel=function(o){K.default.log("Received data channel");var c=o.channel,u=s.getConnection(n,i);u.initialize(c)},K.default.log("Listening for remote stream"),t.ontrack=function(o){K.default.log("Received remote stream");var c=o.streams[0],u=s.getConnection(n,i);if(u.type===ot.Media){var l=u;r._addStreamToMediaConnection(c,l)}}},e.prototype.cleanup=function(){K.default.log("Cleaning up PeerConnection to "+this.connection.peer);var t=this.connection.peerConnection;if(!!t){this.connection.peerConnection=null,t.onicecandidate=t.oniceconnectionstatechange=t.ondatachannel=t.ontrack=function(){};var r=t.signalingState!=="closed",n=!1;if(this.connection.type===ot.Data){var i=this.connection,a=i.dataChannel;a&&(n=!!a.readyState&&a.readyState!=="closed")}(r||n)&&t.close()}},e.prototype._makeOffer=function(){return $n(this,void 0,Promise,function(){var t,r,n,i,a,s,o;return Wn(this,function(c){switch(c.label){case 0:t=this.connection.peerConnection,r=this.connection.provider,c.label=1;case 1:return c.trys.push([1,7,,8]),[4,t.createOffer(this.connection.options.constraints)];case 2:n=c.sent(),K.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),c.label=3;case 3:return c.trys.push([3,5,,6]),[4,t.setLocalDescription(n)];case 4:return c.sent(),K.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),i={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:fe.browser},this.connection.type===ot.Data&&(a=this.connection,i=yi(yi({},i),{label:a.label,reliable:a.reliable,serialization:a.serialization})),r.socket.send({type:xe.Offer,payload:i,dst:this.connection.peer}),[3,6];case 5:return s=c.sent(),s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(r.emitError(Ee.WebRTC,s),K.default.log("Failed to setLocalDescription, ",s)),[3,6];case 6:return[3,8];case 7:return o=c.sent(),r.emitError(Ee.WebRTC,o),K.default.log("Failed to createOffer, ",o),[3,8];case 8:return[2]}})})},e.prototype._makeAnswer=function(){return $n(this,void 0,Promise,function(){var t,r,n,i,a;return Wn(this,function(s){switch(s.label){case 0:t=this.connection.peerConnection,r=this.connection.provider,s.label=1;case 1:return s.trys.push([1,7,,8]),[4,t.createAnswer()];case 2:n=s.sent(),K.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),s.label=3;case 3:return s.trys.push([3,5,,6]),[4,t.setLocalDescription(n)];case 4:return s.sent(),K.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),r.socket.send({type:xe.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,browser:fe.browser},dst:this.connection.peer}),[3,6];case 5:return i=s.sent(),r.emitError(Ee.WebRTC,i),K.default.log("Failed to setLocalDescription, ",i),[3,6];case 6:return[3,8];case 7:return a=s.sent(),r.emitError(Ee.WebRTC,a),K.default.log("Failed to create answer, ",a),[3,8];case 8:return[2]}})})},e.prototype.handleSDP=function(t,r){return $n(this,void 0,Promise,function(){var n,i,a,s;return Wn(this,function(o){switch(o.label){case 0:r=new RTCSessionDescription(r),n=this.connection.peerConnection,i=this.connection.provider,K.default.log("Setting remote description",r),a=this,o.label=1;case 1:return o.trys.push([1,5,,6]),[4,n.setRemoteDescription(r)];case 2:return o.sent(),K.default.log("Set remoteDescription:".concat(t," for:").concat(this.connection.peer)),t!=="OFFER"?[3,4]:[4,a._makeAnswer()];case 3:o.sent(),o.label=4;case 4:return[3,6];case 5:return s=o.sent(),i.emitError(Ee.WebRTC,s),K.default.log("Failed to setRemoteDescription, ",s),[3,6];case 6:return[2]}})})},e.prototype.handleCandidate=function(t){return $n(this,void 0,Promise,function(){var r,n,i,a,s,o;return Wn(this,function(c){switch(c.label){case 0:K.default.log("handleCandidate:",t),r=t.candidate,n=t.sdpMLineIndex,i=t.sdpMid,a=this.connection.peerConnection,s=this.connection.provider,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,a.addIceCandidate(new RTCIceCandidate({sdpMid:i,sdpMLineIndex:n,candidate:r}))];case 2:return c.sent(),K.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return o=c.sent(),s.emitError(Ee.WebRTC,o),K.default.log("Failed to handleCandidate, ",o),[3,4];case 4:return[2]}})})},e.prototype._addTracksToConnection=function(t,r){if(K.default.log("add tracks from stream ".concat(t.id," to peer connection")),!r.addTrack)return K.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");t.getTracks().forEach(function(n){r.addTrack(n,t)})},e.prototype._addStreamToMediaConnection=function(t,r){K.default.log("add stream ".concat(t.id," to media connection ").concat(r.connectionId)),r.addStream(t)},e}(),Ys={};Ct(Ys,"BaseConnection",()=>zu,e=>zu=e);var N0=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),zu=function(e){N0(t,e);function t(r,n,i){var a=e.call(this)||this;return a.peer=r,a.provider=n,a.options=i,a._open=!1,a.metadata=i.metadata,a}return Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),t}(_n.EventEmitter),U0=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ci=function(){return Ci=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Ci.apply(this,arguments)},z0=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},$u=function(e){U0(t,e);function t(r,n,i){var a=e.call(this,r,n,i)||this;return a._localStream=a.options._stream,a.connectionId=a.options.connectionId||t.ID_PREFIX+fe.randomToken(),a._negotiator=new Ks.Negotiator(a),a._localStream&&a._negotiator.startConnection({_stream:a._localStream,originator:!0}),a}return Object.defineProperty(t.prototype,"type",{get:function(){return ot.Media},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),t.prototype.addStream=function(r){K.default.log("Receiving stream",r),this._remoteStream=r,e.prototype.emit.call(this,"stream",r)},t.prototype.handleMessage=function(r){var n=r.type,i=r.payload;switch(r.type){case xe.Answer:this._negotiator.handleSDP(n,i.sdp),this._open=!0;break;case xe.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:K.default.warn("Unrecognized message type:".concat(n," from peer:").concat(this.peer));break}},t.prototype.answer=function(r,n){var i,a;if(n===void 0&&(n={}),this._localStream){K.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=r,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection(Ci(Ci({},this.options._payload),{_stream:r}));var s=this.provider._getMessages(this.connectionId);try{for(var o=z0(s),c=o.next();!c.done;c=o.next()){var u=c.value;this.handleMessage(u)}}catch(l){i={error:l}}finally{try{c&&!c.done&&(a=o.return)&&a.call(o)}finally{if(i)throw i.error}}this._open=!0},t.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,e.prototype.emit.call(this,"close"))},t.ID_PREFIX="mc_",t}(Ys.BaseConnection),Xa={};Ct(Xa,"DataConnection",()=>Vu,e=>Vu=e);var Sf={};Ct(Sf,"EncodingQueue",()=>Wu,e=>Wu=e);var $0=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Wu=function(e){$0(t,e);function t(){var r=e.call(this)||this;return r.fileReader=new FileReader,r._queue=[],r._processing=!1,r.fileReader.onload=function(n){r._processing=!1,n.target&&r.emit("done",n.target.result),r.doNextTask()},r.fileReader.onerror=function(n){K.default.error("EncodingQueue error:",n),r._processing=!1,r.destroy(),r.emit("error",n)},r}return Object.defineProperty(t.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),t.prototype.enque=function(r){this.queue.push(r),!this.processing&&this.doNextTask()},t.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},t.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},t}(_n.EventEmitter),W0=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),V0=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Vu=function(e){W0(t,e);function t(r,n,i){var a=e.call(this,r,n,i)||this;return a.stringify=JSON.stringify,a.parse=JSON.parse,a._buffer=[],a._bufferSize=0,a._buffering=!1,a._chunkedData={},a._encodingQueue=new Sf.EncodingQueue,a.connectionId=a.options.connectionId||t.ID_PREFIX+fe.randomToken(),a.label=a.options.label||a.connectionId,a.serialization=a.options.serialization||St.Binary,a.reliable=!!a.options.reliable,a._encodingQueue.on("done",function(s){a._bufferedSend(s)}),a._encodingQueue.on("error",function(){K.default.error("DC#".concat(a.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),a.close()}),a._negotiator=new Ks.Negotiator(a),a._negotiator.startConnection(a.options._payload||{originator:!0}),a}return Object.defineProperty(t.prototype,"type",{get:function(){return ot.Data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),t.prototype.initialize=function(r){this._dc=r,this._configureDataChannel()},t.prototype._configureDataChannel=function(){var r=this;(!fe.supports.binaryBlob||fe.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){K.default.log("DC#".concat(r.connectionId," dc connection success")),r._open=!0,r.emit("open")},this.dataChannel.onmessage=function(n){K.default.log("DC#".concat(r.connectionId," dc onmessage:"),n.data),r._handleDataMessage(n)},this.dataChannel.onclose=function(){K.default.log("DC#".concat(r.connectionId," dc closed for:"),r.peer),r.close()}},t.prototype._handleDataMessage=function(r){var n=this,i=r.data,a=i.constructor,s=this.serialization===St.Binary||this.serialization===St.BinaryUTF8,o=i;if(s){if(a===Blob){fe.blobToArrayBuffer(i,function(u){var l=fe.unpack(u);n.emit("data",l)});return}else if(a===ArrayBuffer)o=fe.unpack(i);else if(a===String){var c=fe.binaryStringToArrayBuffer(i);o=fe.unpack(c)}}else this.serialization===St.JSON&&(o=this.parse(i));if(o.__peerData){this._handleChunk(o);return}e.prototype.emit.call(this,"data",o)},t.prototype._handleChunk=function(r){var n=r.__peerData,i=this._chunkedData[n]||{data:[],count:0,total:r.total};if(i.data[r.n]=r.data,i.count++,this._chunkedData[n]=i,i.total===i.count){delete this._chunkedData[n];var a=new Blob(i.data);this._handleDataMessage({data:a})}},t.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,e.prototype.emit.call(this,"close"))},t.prototype.send=function(r,n){if(!this.open){e.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===St.JSON)this._bufferedSend(this.stringify(r));else if(this.serialization===St.Binary||this.serialization===St.BinaryUTF8){var i=fe.pack(r);if(!n&&i.size>fe.chunkedMTU){this._sendChunks(i);return}fe.supports.binaryBlob?this._bufferedSend(i):this._encodingQueue.enque(i)}else this._bufferedSend(r)},t.prototype._bufferedSend=function(r){(this._buffering||!this._trySend(r))&&(this._buffer.push(r),this._bufferSize=this._buffer.length)},t.prototype._trySend=function(r){var n=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>t.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){n._buffering=!1,n._tryBuffer()},50),!1;try{this.dataChannel.send(r)}catch(i){return K.default.error("DC#:".concat(this.connectionId," Error when sending:"),i),this._buffering=!0,this.close(),!1}return!0},t.prototype._tryBuffer=function(){if(!!this.open&&this._buffer.length!==0){var r=this._buffer[0];this._trySend(r)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},t.prototype._sendChunks=function(r){var n,i,a=fe.chunk(r);K.default.log("DC#".concat(this.connectionId," Try to send ").concat(a.length," chunks..."));try{for(var s=V0(a),o=s.next();!o.done;o=s.next()){var c=o.value;this.send(c,!0)}}catch(u){n={error:u}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}},t.prototype.handleMessage=function(r){var n=r.payload;switch(r.type){case xe.Answer:this._negotiator.handleSDP(r.type,n.sdp);break;case xe.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:K.default.warn("Unrecognized message type:",r.type,"from peer:",this.peer);break}},t.ID_PREFIX="dc_",t.MAX_BUFFERED_AMOUNT=8388608,t}(Ys.BaseConnection),Bf={};Ct(Bf,"API",()=>Hu,e=>Hu=e);var Gu=function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function o(l){try{u(n.next(l))}catch(d){s(d)}}function c(l){try{u(n.throw(l))}catch(d){s(d)}}function u(l){l.done?a(l.value):i(l.value).then(o,c)}u((n=n.apply(e,t||[])).next())})},qu=function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=u[0]&2?i.return:u[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,u[1])).done)return a;switch(i=0,a&&(u=[u[0]&2,a.value]),u[0]){case 0:case 1:a=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!a||u[1]>a[0]&&u[1]<a[3])){r.label=u[1];break}if(u[0]===6&&r.label<a[1]){r.label=a[1],a=u;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(u);break}a[2]&&r.ops.pop(),r.trys.pop();continue}u=t.call(e,r)}catch(l){u=[6,l],i=0}finally{n=a=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},Hu=function(){function e(t){this._options=t}return e.prototype._buildRequest=function(t){var r=this._options.secure?"https":"http",n=this._options,i=n.host,a=n.port,s=n.path,o=n.key,c=new URL("".concat(r,"://").concat(i,":").concat(a).concat(s).concat(o,"/").concat(t));return c.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),c.searchParams.set("version",Hs.version),fetch(c.href,{referrerPolicy:this._options.referrerPolicy})},e.prototype.retrieveId=function(){return Gu(this,void 0,Promise,function(){var t,r,n;return qu(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(t=i.sent(),t.status!==200)throw new Error("Error. Status:".concat(t.status));return[2,t.text()];case 2:throw r=i.sent(),K.default.error("Error retrieving ID",r),n="",this._options.path==="/"&&this._options.host!==fe.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n);case 3:return[2]}})})},e.prototype.listAllPeers=function(){return Gu(this,void 0,Promise,function(){var t,r,n;return qu(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(t=i.sent(),t.status!==200)throw t.status===401?(r="",this._options.host===fe.CLOUD_HOST?r="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":r="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+r)):new Error("Error. Status:".concat(t.status));return[2,t.json()];case 2:throw n=i.sent(),K.default.error("Error retrieving list peers",n),new Error("Could not get list peers from the server."+n);case 3:return[2]}})})},e}(),G0=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),tn=function(){return tn=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},tn.apply(this,arguments)},Vr=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},q0=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,a=[],s;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(o){s={error:o}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return a},Za=function(e){G0(t,e);function t(r,n){var i=e.call(this)||this;i._id=null,i._lastServerId=null,i._destroyed=!1,i._disconnected=!1,i._open=!1,i._connections=new Map,i._lostMessages=new Map;var a;return r&&r.constructor==Object?n=r:r&&(a=r.toString()),n=tn({debug:0,host:fe.CLOUD_HOST,port:fe.CLOUD_PORT,path:"/",key:t.DEFAULT_KEY,token:fe.randomToken(),config:fe.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},n),i._options=n,i._options.host==="/"&&(i._options.host=window.location.hostname),i._options.path&&(i._options.path[0]!=="/"&&(i._options.path="/"+i._options.path),i._options.path[i._options.path.length-1]!=="/"&&(i._options.path+="/")),i._options.secure===void 0&&i._options.host!==fe.CLOUD_HOST?i._options.secure=fe.isSecure():i._options.host==fe.CLOUD_HOST&&(i._options.secure=!0),i._options.logFunction&&K.default.setLogFunction(i._options.logFunction),K.default.logLevel=i._options.debug||0,i._api=new Bf.API(n),i._socket=i._createServerConnection(),!fe.supports.audioVideo&&!fe.supports.data?(i._delayedAbort(Ee.BrowserIncompatible,"The current browser does not support WebRTC"),i):!!a&&!fe.validateId(a)?(i._delayedAbort(Ee.InvalidID,'ID "'.concat(a,'" is invalid')),i):(a?i._initialize(a):i._api.retrieveId().then(function(s){return i._initialize(s)}).catch(function(s){return i._abort(Ee.ServerError,s)}),i)}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connections",{get:function(){var r,n,i=Object.create(null);try{for(var a=Vr(this._connections),s=a.next();!s.done;s=a.next()){var o=q0(s.value,2),c=o[0],u=o[1];i[c]=u}}catch(l){r={error:l}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),t.prototype._createServerConnection=function(){var r=this,n=new Ef.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return n.on(_t.Message,function(i){r._handleMessage(i)}),n.on(_t.Error,function(i){r._abort(Ee.SocketError,i)}),n.on(_t.Disconnected,function(){r.disconnected||(r.emitError(Ee.Network,"Lost connection to server."),r.disconnect())}),n.on(_t.Close,function(){r.disconnected||r._abort(Ee.SocketClosed,"Underlying socket is already closed.")}),n},t.prototype._initialize=function(r){this._id=r,this.socket.start(r,this._options.token)},t.prototype._handleMessage=function(r){var n,i,a=r.type,s=r.payload,o=r.src;switch(a){case xe.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case xe.Error:this._abort(Ee.ServerError,s.msg);break;case xe.IdTaken:this._abort(Ee.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case xe.InvalidKey:this._abort(Ee.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case xe.Leave:K.default.log("Received leave message from ".concat(o)),this._cleanupPeer(o),this._connections.delete(o);break;case xe.Expire:this.emitError(Ee.PeerUnavailable,"Could not connect to peer ".concat(o));break;case xe.Offer:var g=s.connectionId,y=this.getConnection(o,g);if(y&&(y.close(),K.default.warn("Offer received for existing Connection ID:".concat(g))),s.type===ot.Media){var c=new Ja.MediaConnection(o,this,{connectionId:g,_payload:s,metadata:s.metadata});y=c,this._addConnection(o,y),this.emit("call",c)}else if(s.type===ot.Data){var u=new Xa.DataConnection(o,this,{connectionId:g,_payload:s,metadata:s.metadata,label:s.label,serialization:s.serialization,reliable:s.reliable});y=u,this._addConnection(o,y),this.emit("connection",u)}else{K.default.warn("Received malformed connection type:".concat(s.type));return}var l=this._getMessages(g);try{for(var d=Vr(l),h=d.next();!h.done;h=d.next()){var f=h.value;y.handleMessage(f)}}catch(E){n={error:E}}finally{try{h&&!h.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}break;default:if(!s){K.default.warn("You received a malformed message from ".concat(o," of type ").concat(a));return}var g=s.connectionId,y=this.getConnection(o,g);y&&y.peerConnection?y.handleMessage(r):g?this._storeMessage(g,r):K.default.warn("You received an unrecognized message:",r);break}},t.prototype._storeMessage=function(r,n){this._lostMessages.has(r)||this._lostMessages.set(r,[]),this._lostMessages.get(r).push(n)},t.prototype._getMessages=function(r){var n=this._lostMessages.get(r);return n?(this._lostMessages.delete(r),n):[]},t.prototype.connect=function(r,n){if(n===void 0&&(n={}),this.disconnected){K.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Ee.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var i=new Xa.DataConnection(r,this,n);return this._addConnection(r,i),i},t.prototype.call=function(r,n,i){if(i===void 0&&(i={}),this.disconnected){K.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Ee.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){K.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var a=new Ja.MediaConnection(r,this,tn(tn({},i),{_stream:n}));return this._addConnection(r,a),a},t.prototype._addConnection=function(r,n){K.default.log("add connection ".concat(n.type,":").concat(n.connectionId," to peerId:").concat(r)),this._connections.has(r)||this._connections.set(r,[]),this._connections.get(r).push(n)},t.prototype._removeConnection=function(r){var n=this._connections.get(r.peer);if(n){var i=n.indexOf(r);i!==-1&&n.splice(i,1)}this._lostMessages.delete(r.connectionId)},t.prototype.getConnection=function(r,n){var i,a,s=this._connections.get(r);if(!s)return null;try{for(var o=Vr(s),c=o.next();!c.done;c=o.next()){var u=c.value;if(u.connectionId===n)return u}}catch(l){i={error:l}}finally{try{c&&!c.done&&(a=o.return)&&a.call(o)}finally{if(i)throw i.error}}return null},t.prototype._delayedAbort=function(r,n){var i=this;setTimeout(function(){i._abort(r,n)},0)},t.prototype._abort=function(r,n){K.default.error("Aborting!"),this.emitError(r,n),this._lastServerId?this.disconnect():this.destroy()},t.prototype.emitError=function(r,n){K.default.error("Error:",n);var i;typeof n=="string"?i=new Error(n):i=n,i.type=r,this.emit("error",i)},t.prototype.destroy=function(){this.destroyed||(K.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},t.prototype._cleanup=function(){var r,n;try{for(var i=Vr(this._connections.keys()),a=i.next();!a.done;a=i.next()){var s=a.value;this._cleanupPeer(s),this._connections.delete(s)}}catch(o){r={error:o}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}this.socket.removeAllListeners()},t.prototype._cleanupPeer=function(r){var n,i,a=this._connections.get(r);if(!!a)try{for(var s=Vr(a),o=s.next();!o.done;o=s.next()){var c=o.value;c.close()}}catch(u){n={error:u}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}},t.prototype.disconnect=function(){if(!this.disconnected){var r=this.id;K.default.log("Disconnect peer with ID:".concat(r)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=r,this._id=null,this.emit("disconnected",r)}},t.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)K.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)K.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},t.prototype.listAllPeers=function(r){var n=this;r===void 0&&(r=function(i){}),this._api.listAllPeers().then(function(i){return r(i)}).catch(function(i){return n._abort(Ee.ServerError,i)})},t.DEFAULT_KEY="peerjs",t}(_n.EventEmitter);Df.Peer;const Ku=1,H0=1e3,K0=6;function Y0(){const e=ts().replaceAll("-","").slice(0,K0),t=`${e}`,r=new Za(t);let n=[],i;const a=[];r.on("connection",o=>{a.push(o),o.on("data",c=>{for(const u of n)u(c)}),o.on("open",()=>{i&&i(o,"open")}),o.on("close",()=>{a.splice(a.indexOf(o),Ku),i&&i(o,"close")}),o.on("error",c=>{i&&i(o,"error",c)})});let s="";return{startHost(){return e},startClient(o){return s===o||(s=o,setTimeout(()=>{const c=r.connect(`${o}`);a.push(c),c.on("data",u=>{for(const l of n)l(u)}),c.on("open",()=>{i&&i(c,"open")}),c.on("close",()=>{a.splice(a.indexOf(c),Ku),i&&i(c,"close")}),c.on("error",u=>{i&&i(c,"error",u)})},H0)),e},sendMessage(o){for(const c of a)c.open&&c.send(o)},connectionEventListener(o){i=o},setListener(o){n.push(o)},removeListener(o){const c=[];for(const u of n)o!==u&&c.push(u);n=c},close(){r.disconnect();for(const o of a)o.close();a.splice(0,a.length)}}}function J0(e,t){return e.setListener(r=>{switch(r.type){case"CreateFile":t.createFile(r.name,r.fileType,r.key);break;case"GetCurrentList":e.sendMessage({type:"CurrentListResult",listings:t.getCurrentList()});break;case"RenameFile":t.renameFile(r.key,r.name);break;case"DeleteFile":t.deleteFile(r.key);break}}),{setCallback(r){t.setCallback(n=>{r(n),e.sendMessage({type:"CurrentListResult",listings:n})})},async createFile(r,n){return t.createFile(r,n)},getCurrentList(){return t.getCurrentList()},async deleteFile(r){t.deleteFile(r)},async renameFile(r,n){t.renameFile(r,n)}}}function X0(e){let t=[],r;return e.setListener(n=>{n.type==="CurrentListResult"&&(t=n.listings,r&&r(t))}),e.sendMessage({type:"GetCurrentList"}),{setCallback(n){r=n},async createFile(n,i){const a=ts(),s={name:n,key:a,type:i};return t=[...t,s],e.sendMessage({type:"CreateFile",name:n,fileType:i,key:a}),r&&r(t),a},getCurrentList(){return t},async deleteFile(n){e.sendMessage({type:"DeleteFile",key:n}),t=t.filter(i=>i.key!==n),r&&r(t)},async renameFile(n,i){let a=!1;t=t.map(s=>s.key===n?(a={...s,name:i},a):s),e.sendMessage({type:"RenameFile",name:i,key:n}),a&&r&&r(t)}}}var Z0=typeof atob=="function",Q0=typeof btoa=="function",Ui=typeof Buffer=="function";typeof TextDecoder=="function"&&new TextDecoder;typeof TextEncoder=="function"&&new TextEncoder;var ey="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Jr=Array.prototype.slice.call(ey),Vn=(e=>{let t={};return e.forEach((r,n)=>t[r]=n),t})(Jr),ty=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,ri=String.fromCharCode.bind(String),Yu=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):(e,t=r=>r)=>new Uint8Array(Array.prototype.slice.call(e,0).map(t)),ry=e=>e.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_"),_f=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),ny=e=>{let t,r,n,i,a="";const s=e.length%3;for(let o=0;o<e.length;){if((r=e.charCodeAt(o++))>255||(n=e.charCodeAt(o++))>255||(i=e.charCodeAt(o++))>255)throw new TypeError("invalid character found");t=r<<16|n<<8|i,a+=Jr[t>>18&63]+Jr[t>>12&63]+Jr[t>>6&63]+Jr[t&63]}return s?a.slice(0,s-3)+"===".substring(s):a},iy=Q0?e=>btoa(e):Ui?e=>Buffer.from(e,"binary").toString("base64"):ny,Ju=Ui?e=>Buffer.from(e).toString("base64"):e=>{let r=[];for(let n=0,i=e.length;n<i;n+=4096)r.push(ri.apply(null,e.subarray(n,n+4096)));return iy(r.join(""))},Di=(e,t=!1)=>t?ry(Ju(e)):Ju(e),ay=e=>{if(e=e.replace(/\s+/g,""),!ty.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let t,r="",n,i;for(let a=0;a<e.length;)t=Vn[e.charAt(a++)]<<18|Vn[e.charAt(a++)]<<12|(n=Vn[e.charAt(a++)])<<6|(i=Vn[e.charAt(a++)]),r+=n===64?ri(t>>16&255):i===64?ri(t>>16&255,t>>8&255):ri(t>>16&255,t>>8&255,t&255);return r},sy=Z0?e=>atob(_f(e)):Ui?e=>Buffer.from(e,"base64").toString("binary"):ay,oy=Ui?e=>Yu(Buffer.from(e,"base64")):e=>Yu(sy(e),t=>t.charCodeAt(0)),Qa=e=>oy(uy(e)),uy=e=>_f(e.replace(/[-_]/g,t=>t=="-"?"+":"/"));let ni;const cy=200,Xr={},Af={};let wf="",rn;function ly(e,t){const r=t.doc();Af[e]=r;let n=!1;return r.on("update",()=>{n&&clearTimeout(n),n=setTimeout(()=>{const i=Di(Ut(r));ni?.sendMessage({type:"FileContentUpdated",key:e,update:i})},cy)}),t}async function es(e){if(e in Xr)return Xr[e];if(!rn)throw new Error("No getter set");return Xr[e]=rn(e,wf).then(t=>ly(e,t)),Xr[e]}function fy(e,t,r){ni=e,wf=t,rn=r,ni.setListener(n=>{switch(n.type){case"FileContentUpdated":rn!==void 0&&es(n.key).then(()=>{Xr[n.key].then(a=>a.updateAll(Qa(n.update)))});break;case"RequestFileState":rn!==void 0&&es(n.key).then(()=>{const i=Af[n.key];ni?.sendMessage({type:"FullFileState",key:n.key,update:Di(Ut(i))})});break}})}const Br={},Xu=200;let nn;function dy(e){nn=e,nn.setListener(t=>{switch(t.type){case"FullFileState":{const r=Br[t.key];r!==void 0&&r.then(n=>n.updateAll(Qa(t.update)))}break;case"FileContentUpdated":{const r=Br[t.key];r!==void 0&&r.then(n=>n.updateAll(Qa(t.update)))}break}})}async function hy(e){nn?.sendMessage({type:"RequestFileState",key:e});const t=new Wt;let r={},n=!1;return{doc(){return t},connect(){const i=new Wt,a=Ut(t);return at(i,a),i.on("update",s=>{n&&clearTimeout(n),n=setTimeout(()=>{const o=Di(Ut(t));nn?.sendMessage({type:"FileContentUpdated",key:e,update:o})},Xu),at(t,s);for(const o of Object.keys(r)){const c=r[o];at(c,s)}}),r[i.clientID]=i,{id:i.clientID,content:i.get("content",Oe)}},updateAll(i){n&&clearTimeout(n),n=setTimeout(()=>{const a=Di(Ut(t));nn?.sendMessage({type:"FileContentUpdated",key:e,update:a})},Xu),at(t,i);for(const a of Object.keys(r)){const s=r[a];at(s,i)}},disconnect(i){const a=i.toString();if(a in r){const s=r[i],o=r;r={};for(const c of Object.keys(o))c!==a&&(r[c]=o[c]);s.destroy()}}}}async function py(e){return e in Br||(Br[e]=hy(e)),Br[e]}const Zu=dr.useMemo,ha=dr.useState,Zt=Y0();function yy({isHost:e}){const[t,r]=ha(),{name:n,project:i,code:a}=jf(),[s,o]=ha({}),[c,u]=ha(!1),l=Zu(()=>e?(u(!0),fy(Zt,i??"",y0),Zt.startHost()):a?(Zt.connectionEventListener((h,f,g)=>{u(f==="error"?g??new Error("Unknown Error"):f==="open")}),dy(Zt),Zt.startClient(a)):"",[e,a,i]);if(Zu(async()=>{if(!!c)if(i){const h=await g0(i),f=J0(Zt,h);r(f)}else{const h=X0(Zt);r(h)}},[i,c]),c!==!0)return ge(eo,{error:c instanceof Error?c:void 0});if(!t)return ge(eo,{});const d=Object.keys(s).map(h=>s[h]).filter(h=>h!==!1);return ht("div",{className:"flex h-screen flex-col items-stretch justify-start",children:[ht("div",{className:"flex flex-row justify-between bg-slate-900 p-2",children:[ge("span",{children:e?"Hosting":"Joining"})," ",ge("span",{className:"flex-grow text-center",children:n}),"\xA0",e?ht("span",{children:["Share Link:\xA0",ge("a",{className:"text-blue-200",target:"_blank",href:`${window.location.toString().split("/host")[0]}/join/${l}`,rel:"noreferrer",children:l})]}):""]}),ht("div",{className:"flex flex-grow flex-row",children:[ge("div",{className:"flex w-56 flex-col justify-start border-r-2 border-r-slate-900 bg-slate-800 p-2",children:ge(Jf,{list:t,selectFile:h=>{if(!(h.key in s)){{const f={...s,[h.key]:!1};o(f)}i?es(h.key).then(f=>{const g={...s,[h.key]:{listing:h,file:f}};o(g)}):py(h.key).then(f=>{const g={...s,[h.key]:{listing:h,file:f}};o(g)})}}})}),ge(Kf,{className:"split flex flex-grow flex-row",children:d.length>0?d.map(({listing:h,file:f})=>ge(n0,{listing:h,file:f,renameFile:g=>{const y={...s,[h.key]:{file:f,listing:{...h,name:g}}};o(y),t.renameFile(h.key,g)},closeFile:()=>{const g={};for(const y of Object.keys(s))y!==h.key&&(g[y]=s[y]);o(g)}},h.key)):ge("div",{children:"No Open Files"})},d.map(h=>h.listing.key).join(":"))]})]})}export{yy as default};
