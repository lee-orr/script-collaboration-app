import{_ as lt,c as Yu,d as me,j as It,a as Se,r as Fr,e as Of,G as Xa,f as Dn,b as xf,L as Js}from"./index.fb481673.js";import{B as Wr}from"./Button.ad77a88b.js";import{I as Pf}from"./Input.3a78fd24.js";var Rf=me({"node_modules/prop-types/lib/ReactPropTypesSecret.js"(e,t){var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";t.exports=r}}),If=me({"node_modules/prop-types/factoryWithThrowingShims.js"(e,t){var r=Rf();function n(){}function i(){}i.resetWarningCache=n,t.exports=function(){function a(c,u,l,d,h,f){if(f!==r){var v=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw v.name="Invariant Violation",v}}a.isRequired=a;function s(){return a}var o={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:s,element:a,elementType:a,instanceOf:s,node:a,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:i,resetWarningCache:n};return o.PropTypes=o,o}}}),Mf=me({"node_modules/prop-types/index.js"(e,t){t.exports=If()()}}),Xs=lt(Yu()),he=lt(Mf()),Ke=typeof window<"u"?window:null,Za=Ke===null,nn=Za?void 0:Ke.document,et="addEventListener",tt="removeEventListener",Ui="getBoundingClientRect",jr="_a",rt="_b",Dt="_c",wn="horizontal",nt=function(){return!1},jf=Za?"calc":["","-webkit-","-moz-","-o-"].filter(function(e){var t=nn.createElement("div");return t.style.cssText="width:"+e+"calc(9px)",!!t.style.length}).shift()+"calc",Ju=function(e){return typeof e=="string"||e instanceof String},Zs=function(e){if(Ju(e)){var t=nn.querySelector(e);if(!t)throw new Error("Selector "+e+" did not match a DOM element");return t}return e},Pe=function(e,t,r){var n=e[t];return n!==void 0?n:r},_n=function(e,t,r,n){if(t){if(n==="end")return 0;if(n==="center")return e/2}else if(r){if(n==="start")return 0;if(n==="center")return e/2}return e},Lf=function(e,t){var r=nn.createElement("div");return r.className="gutter gutter-"+t,r},Nf=function(e,t,r){var n={};return Ju(t)?n[e]=t:n[e]=jf+"("+t+"% - "+r+"px)",n},Uf=function(e,t){var r;return r={},r[e]=t+"px",r},zf=function(e,t){if(t===void 0&&(t={}),Za)return{};var r=e,n,i,a,s,o,c;Array.from&&(r=Array.from(r));var u=Zs(r[0]),l=u.parentNode,d=getComputedStyle?getComputedStyle(l):null,h=d?d.flexDirection:null,f=Pe(t,"sizes")||r.map(function(){return 100/r.length}),v=Pe(t,"minSize",100),m=Array.isArray(v)?v:r.map(function(){return v}),E=Pe(t,"maxSize",1/0),w=Array.isArray(E)?E:r.map(function(){return E}),g=Pe(t,"expandToMin",!1),D=Pe(t,"gutterSize",10),b=Pe(t,"gutterAlign","center"),y=Pe(t,"snapOffset",30),A=Array.isArray(y)?y:r.map(function(){return y}),x=Pe(t,"dragInterval",1),B=Pe(t,"direction",wn),j=Pe(t,"cursor",B===wn?"col-resize":"row-resize"),H=Pe(t,"gutter",Lf),M=Pe(t,"elementStyle",Nf),F=Pe(t,"gutterStyle",Uf);B===wn?(n="width",i="clientX",a="left",s="right",o="clientWidth"):B==="vertical"&&(n="height",i="clientY",a="top",s="bottom",o="clientHeight");function V(z,O,L,q){var ae=M(n,O,L,q);Object.keys(ae).forEach(function(Q){z.style[Q]=ae[Q]})}function W(z,O,L){var q=F(n,O,L);Object.keys(q).forEach(function(ae){z.style[ae]=q[ae]})}function k(){return c.map(function(z){return z.size})}function Y(z){return"touches"in z?z.touches[0][i]:z[i]}function S(z){var O=c[this.a],L=c[this.b],q=O.size+L.size;O.size=z/this.size*q,L.size=q-z/this.size*q,V(O.element,O.size,this[rt],O.i),V(L.element,L.size,this[Dt],L.i)}function T(z){var O,L=c[this.a],q=c[this.b];!this.dragging||(O=Y(z)-this.start+(this[rt]-this.dragOffset),x>1&&(O=Math.round(O/x)*x),O<=L.minSize+L.snapOffset+this[rt]?O=L.minSize+this[rt]:O>=this.size-(q.minSize+q.snapOffset+this[Dt])&&(O=this.size-(q.minSize+this[Dt])),O>=L.maxSize-L.snapOffset+this[rt]?O=L.maxSize+this[rt]:O<=this.size-(q.maxSize-q.snapOffset+this[Dt])&&(O=this.size-(q.maxSize+this[Dt])),S.call(this,O),Pe(t,"onDrag",nt)(k()))}function P(){var z=c[this.a].element,O=c[this.b].element,L=z[Ui](),q=O[Ui]();this.size=L[n]+q[n]+this[rt]+this[Dt],this.start=L[a],this.end=L[s]}function I(z){if(!getComputedStyle)return null;var O=getComputedStyle(z);if(!O)return null;var L=z[o];return L===0?null:(B===wn?L-=parseFloat(O.paddingLeft)+parseFloat(O.paddingRight):L-=parseFloat(O.paddingTop)+parseFloat(O.paddingBottom),L)}function J(z){var O=I(l);if(O===null||m.reduce(function(Q,de){return Q+de},0)>O)return z;var L=0,q=[],ae=z.map(function(Q,de){var De=O*Q/100,Ae=_n(D,de===0,de===z.length-1,b),He=m[de]+Ae;return De<He?(L+=He-De,q.push(0),He):(q.push(De-He),De)});return L===0?z:ae.map(function(Q,de){var De=Q;if(L>0&&q[de]-L>0){var Ae=Math.min(L,q[de]-L);L-=Ae,De=Q-Ae}return De/O*100})}function ee(){var z=this,O=c[z.a].element,L=c[z.b].element;z.dragging&&Pe(t,"onDragEnd",nt)(k()),z.dragging=!1,Ke[tt]("mouseup",z.stop),Ke[tt]("touchend",z.stop),Ke[tt]("touchcancel",z.stop),Ke[tt]("mousemove",z.move),Ke[tt]("touchmove",z.move),z.stop=null,z.move=null,O[tt]("selectstart",nt),O[tt]("dragstart",nt),L[tt]("selectstart",nt),L[tt]("dragstart",nt),O.style.userSelect="",O.style.webkitUserSelect="",O.style.MozUserSelect="",O.style.pointerEvents="",L.style.userSelect="",L.style.webkitUserSelect="",L.style.MozUserSelect="",L.style.pointerEvents="",z.gutter.style.cursor="",z.parent.style.cursor="",nn.body.style.cursor=""}function X(z){if(!("button"in z&&z.button!==0)){var O=this,L=c[O.a].element,q=c[O.b].element;O.dragging||Pe(t,"onDragStart",nt)(k()),z.preventDefault(),O.dragging=!0,O.move=T.bind(O),O.stop=ee.bind(O),Ke[et]("mouseup",O.stop),Ke[et]("touchend",O.stop),Ke[et]("touchcancel",O.stop),Ke[et]("mousemove",O.move),Ke[et]("touchmove",O.move),L[et]("selectstart",nt),L[et]("dragstart",nt),q[et]("selectstart",nt),q[et]("dragstart",nt),L.style.userSelect="none",L.style.webkitUserSelect="none",L.style.MozUserSelect="none",L.style.pointerEvents="none",q.style.userSelect="none",q.style.webkitUserSelect="none",q.style.MozUserSelect="none",q.style.pointerEvents="none",O.gutter.style.cursor=j,O.parent.style.cursor=j,nn.body.style.cursor=j,P.call(O),O.dragOffset=Y(z)-O.end}}f=J(f);var Z=[];c=r.map(function(z,O){var L={element:Zs(z),size:f[O],minSize:m[O],maxSize:w[O],snapOffset:A[O],i:O},q;if(O>0&&(q={a:O-1,b:O,dragging:!1,direction:B,parent:l},q[rt]=_n(D,O-1===0,!1,b),q[Dt]=_n(D,!1,O===r.length-1,b),h==="row-reverse"||h==="column-reverse")){var ae=q.a;q.a=q.b,q.b=ae}if(O>0){var Q=H(O,B,L.element);W(Q,D,O),q[jr]=X.bind(q),Q[et]("mousedown",q[jr]),Q[et]("touchstart",q[jr]),l.insertBefore(Q,L.element),q.gutter=Q}return V(L.element,L.size,_n(D,O===0,O===r.length-1,b),O),O>0&&Z.push(q),L});function re(z){var O=z.i===Z.length,L=O?Z[z.i-1]:Z[z.i];P.call(L);var q=O?L.size-z.minSize-L[Dt]:z.minSize+L[rt];S.call(L,q)}c.forEach(function(z){var O=z.element[Ui]()[n];O<z.minSize&&(g?re(z):z.minSize=O)});function oe(z){var O=J(z);O.forEach(function(L,q){if(q>0){var ae=Z[q-1],Q=c[ae.a],de=c[ae.b];Q.size=O[q-1],de.size=L,V(Q.element,Q.size,ae[rt],Q.i),V(de.element,de.size,ae[Dt],de.i)}})}function ue(z,O){Z.forEach(function(L){if(O!==!0?L.parent.removeChild(L.gutter):(L.gutter[tt]("mousedown",L[jr]),L.gutter[tt]("touchstart",L[jr])),z!==!0){var q=M(n,L.a.size,L[rt]);Object.keys(q).forEach(function(ae){c[L.a].element.style[ae]="",c[L.b].element.style[ae]=""})}})}return{setSizes:oe,getSizes:k,collapse:function(O){re(c[O])},destroy:ue,parent:l,pairs:Z}},Qs=zf;function zi(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)===-1&&(r[n]=e[n]);return r}var Qa=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.componentDidMount=function(){var n=this.props;n.children;var i=n.gutter,a=zi(n,["children","gutter"]),s=a;s.gutter=function(o,c){var u;return i?u=i(o,c):(u=document.createElement("div"),u.className="gutter gutter-"+c),u.__isSplitGutter=!0,u},this.split=Qs(this.parent.children,s)},t.prototype.componentDidUpdate=function(n){var i=this,a=this.props;a.children;var s=a.minSize,o=a.sizes,c=a.collapsed,u=zi(a,["children","minSize","sizes","collapsed"]),l=u,d=n.minSize,h=n.sizes,f=n.collapsed,v=["maxSize","expandToMin","gutterSize","gutterAlign","snapOffset","dragInterval","direction","cursor"],m=v.map(function(g){return i.props[g]!==n[g]}).reduce(function(g,D){return g||D},!1);if(Array.isArray(s)&&Array.isArray(d)){var E=!1;s.forEach(function(g,D){E=E||g!==d[D]}),m=m||E}else Array.isArray(s)||Array.isArray(d)?m=!0:m=m||s!==d;if(m)l.minSize=s,l.sizes=o||this.split.getSizes(),this.split.destroy(!0,!0),l.gutter=function(g,D,b){return b.previousSibling},this.split=Qs(Array.from(this.parent.children).filter(function(g){return!g.__isSplitGutter}),l);else if(o){var w=!1;o.forEach(function(g,D){w=w||g!==h[D]}),w&&this.split.setSizes(this.props.sizes)}Number.isInteger(c)&&(c!==f||m)&&this.split.collapse(c)},t.prototype.componentWillUnmount=function(){this.split.destroy(),delete this.split},t.prototype.render=function(){var n=this,i=this.props;i.sizes,i.minSize,i.maxSize,i.expandToMin,i.gutterSize,i.gutterAlign,i.snapOffset,i.dragInterval,i.direction,i.cursor,i.gutter,i.elementStyle,i.gutterStyle,i.onDrag,i.onDragStart,i.onDragEnd,i.collapsed;var a=i.children,s=zi(i,["sizes","minSize","maxSize","expandToMin","gutterSize","gutterAlign","snapOffset","dragInterval","direction","cursor","gutter","elementStyle","gutterStyle","onDrag","onDragStart","onDragEnd","collapsed","children"]),o=s;return Xs.default.createElement("div",Object.assign({},{ref:function(c){n.parent=c}},o),a)},t}(Xs.default.Component);Qa.propTypes={sizes:he.default.arrayOf(he.default.number),minSize:he.default.oneOfType([he.default.number,he.default.arrayOf(he.default.number)]),maxSize:he.default.oneOfType([he.default.number,he.default.arrayOf(he.default.number)]),expandToMin:he.default.bool,gutterSize:he.default.number,gutterAlign:he.default.string,snapOffset:he.default.oneOfType([he.default.number,he.default.arrayOf(he.default.number)]),dragInterval:he.default.number,direction:he.default.string,cursor:he.default.string,gutter:he.default.func,elementStyle:he.default.func,gutterStyle:he.default.func,onDrag:he.default.func,onDragStart:he.default.func,onDragEnd:he.default.func,collapsed:he.default.number,children:he.default.arrayOf(he.default.element)};Qa.defaultProps={sizes:void 0,minSize:void 0,maxSize:void 0,expandToMin:void 0,gutterSize:void 0,gutterAlign:void 0,snapOffset:void 0,dragInterval:void 0,direction:void 0,cursor:void 0,gutter:void 0,elementStyle:void 0,gutterStyle:void 0,onDrag:void 0,onDragStart:void 0,onDragEnd:void 0,collapsed:void 0,children:void 0};var $f=Qa,Wf=$f;/*
object-assign
(c) Sindre Sorhus
@license MIT
*//** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *//** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var la=(e=>(e.Fountain="fountain",e.Markdown="md",e))(la||{});const Vf=Fr.useState;function Gf({list:e,selectFile:t}){const[r,n]=Vf(e.getCurrentList());return e.setCallback(n),It("div",{className:"flex flex-col justify-start gap-4",children:[It("div",{className:"flex flex-col items-stretch gap-1",children:[Se(Wr,{label:"New Script",click:()=>{e.createFile("untitled script",la.Fountain)}}),Se(Wr,{label:"New Markdown",click:()=>{e.createFile("untitled markdown",la.Markdown)}}),Se(Wr,{label:"Upload File",click:()=>{}})]}),Se("div",{className:"flex flex-grow flex-col items-stretch gap-1",children:r.map(i=>Se(Wr,{label:i.name,click:()=>{t(i)}},i.key))})]})}function eo(e){return Object.prototype.toString.call(e)==="[object Object]"}function Re(e){var t,r;return eo(e)===!1?!1:(t=e.constructor,t===void 0?!0:(r=t.prototype,!(eo(r)===!1||r.hasOwnProperty("isPrototypeOf")===!1)))}function at(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function sr(e){return!!e&&!!e[Ve]}function or(e){return!!e&&(function(t){if(!t||typeof t!="object")return!1;var r=Object.getPrototypeOf(t);if(r===null)return!0;var n=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return n===Object||typeof n=="function"&&Function.toString.call(n)===Qf}(e)||Array.isArray(e)||!!e[uo]||!!e.constructor[uo]||es(e)||ts(e))}function an(e,t,r){r===void 0&&(r=!1),Or(e)===0?(r?Object.keys:ss)(e).forEach(function(n){r&&typeof n=="symbol"||t(n,e[n],e)}):e.forEach(function(n,i){return t(i,n,e)})}function Or(e){var t=e[Ve];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:es(e)?2:ts(e)?3:0}function fa(e,t){return Or(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function qf(e,t){return Or(e)===2?e.get(t):e[t]}function Xu(e,t,r){var n=Or(e);n===2?e.set(t,r):n===3?(e.delete(t),e.add(r)):e[t]=r}function Hf(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function es(e){return Xf&&e instanceof Map}function ts(e){return Zf&&e instanceof Set}function Zt(e){return e.o||e.t}function rs(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=ed(e);delete t[Ve];for(var r=ss(t),n=0;n<r.length;n++){var i=r[n],a=t[i];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[i]})}return Object.create(Object.getPrototypeOf(e),t)}function ns(e,t){return t===void 0&&(t=!1),is(e)||sr(e)||!or(e)||(Or(e)>1&&(e.set=e.add=e.clear=e.delete=Kf),Object.freeze(e),t&&an(e,function(r,n){return ns(n,!0)},!0)),e}function Kf(){at(2)}function is(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function dt(e){var t=td[e];return t||at(18,e),t}function to(){return sn}function $i(e,t){t&&(dt("Patches"),e.u=[],e.s=[],e.v=t)}function ri(e){da(e),e.p.forEach(Yf),e.p=null}function da(e){e===sn&&(sn=e.l)}function ro(e){return sn={p:[],l:sn,h:e,m:!0,_:0}}function Yf(e){var t=e[Ve];t.i===0||t.i===1?t.j():t.O=!0}function Wi(e,t){t._=t.p.length;var r=t.p[0],n=e!==void 0&&e!==r;return t.h.g||dt("ES5").S(t,e,n),n?(r[Ve].P&&(ri(t),at(4)),or(e)&&(e=ni(t,e),t.l||ii(t,e)),t.u&&dt("Patches").M(r[Ve].t,e,t.u,t.s)):e=ni(t,r,[]),ri(t),t.u&&t.v(t.u,t.s),e!==Zu?e:void 0}function ni(e,t,r){if(is(t))return t;var n=t[Ve];if(!n)return an(t,function(a,s){return no(e,n,t,a,s,r)},!0),t;if(n.A!==e)return t;if(!n.P)return ii(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var i=n.i===4||n.i===5?n.o=rs(n.k):n.o;an(n.i===3?new Set(i):i,function(a,s){return no(e,n,i,a,s,r)}),ii(e,i,!1),r&&e.u&&dt("Patches").R(n,r,e.u,e.s)}return n.o}function no(e,t,r,n,i,a){if(sr(i)){var s=ni(e,i,a&&t&&t.i!==3&&!fa(t.D,n)?a.concat(n):void 0);if(Xu(r,n,s),!sr(s))return;e.m=!1}if(or(i)&&!is(i)){if(!e.h.F&&e._<1)return;ni(e,i),t&&t.A.l||ii(e,i)}}function ii(e,t,r){r===void 0&&(r=!1),e.h.F&&e.m&&ns(t,r)}function Vi(e,t){var r=e[Ve];return(r?Zt(r):e)[t]}function io(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function ha(e){e.P||(e.P=!0,e.l&&ha(e.l))}function Gi(e){e.o||(e.o=rs(e.t))}function pa(e,t,r){var n=es(t)?dt("MapSet").N(t,r):ts(t)?dt("MapSet").T(t,r):e.g?function(i,a){var s=Array.isArray(i),o={i:s?1:0,A:a?a.A:to(),P:!1,I:!1,D:{},l:a,t:i,k:null,o:null,j:null,C:!1},c=o,u=va;s&&(c=[o],u=Vr);var l=Proxy.revocable(c,u),d=l.revoke,h=l.proxy;return o.k=h,o.j=d,h}(t,r):dt("ES5").J(t,r);return(r?r.A:to()).p.push(n),n}function Jf(e){return sr(e)||at(22,e),function t(r){if(!or(r))return r;var n,i=r[Ve],a=Or(r);if(i){if(!i.P&&(i.i<4||!dt("ES5").K(i)))return i.t;i.I=!0,n=ao(r,a),i.I=!1}else n=ao(r,a);return an(n,function(s,o){i&&qf(i.t,s)===o||Xu(n,s,t(o))}),a===3?new Set(n):n}(e)}function ao(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return rs(e)}var so,sn,as=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Xf=typeof Map<"u",Zf=typeof Set<"u",oo=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Zu=as?Symbol.for("immer-nothing"):((so={})["immer-nothing"]=!0,so),uo=as?Symbol.for("immer-draftable"):"__$immer_draftable",Ve=as?Symbol.for("immer-state"):"__$immer_state",Qf=""+Object.prototype.constructor,ss=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,ed=Object.getOwnPropertyDescriptors||function(e){var t={};return ss(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},td={},va={get:function(e,t){if(t===Ve)return e;var r=Zt(e);if(!fa(r,t))return function(i,a,s){var o,c=io(a,s);return c?"value"in c?c.value:(o=c.get)===null||o===void 0?void 0:o.call(i.k):void 0}(e,r,t);var n=r[t];return e.I||!or(n)?n:n===Vi(e.t,t)?(Gi(e),e.o[t]=pa(e.A.h,n,e)):n},has:function(e,t){return t in Zt(e)},ownKeys:function(e){return Reflect.ownKeys(Zt(e))},set:function(e,t,r){var n=io(Zt(e),t);if(n?.set)return n.set.call(e.k,r),!0;if(!e.P){var i=Vi(Zt(e),t),a=i?.[Ve];if(a&&a.t===r)return e.o[t]=r,e.D[t]=!1,!0;if(Hf(r,i)&&(r!==void 0||fa(e.t,t)))return!0;Gi(e),ha(e)}return e.o[t]===r&&typeof r!="number"&&(r!==void 0||t in e.o)||(e.o[t]=r,e.D[t]=!0,!0)},deleteProperty:function(e,t){return Vi(e.t,t)!==void 0||t in e.t?(e.D[t]=!1,Gi(e),ha(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=Zt(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty:function(){at(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){at(12)}},Vr={};an(va,function(e,t){Vr[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),Vr.deleteProperty=function(e,t){return Vr.set.call(this,e,t,void 0)},Vr.set=function(e,t,r){return va.set.call(this,e[0],t,r,e[0])};var rd=function(){function e(r){var n=this;this.g=oo,this.F=!0,this.produce=function(i,a,s){if(typeof i=="function"&&typeof a!="function"){var o=a;a=i;var c=n;return function(m){var E=this;m===void 0&&(m=o);for(var w=arguments.length,g=Array(w>1?w-1:0),D=1;D<w;D++)g[D-1]=arguments[D];return c.produce(m,function(b){var y;return(y=a).call.apply(y,[E,b].concat(g))})}}var u;if(typeof a!="function"&&at(6),s!==void 0&&typeof s!="function"&&at(7),or(i)){var l=ro(n),d=pa(n,i,void 0),h=!0;try{u=a(d),h=!1}finally{h?ri(l):da(l)}return typeof Promise<"u"&&u instanceof Promise?u.then(function(m){return $i(l,s),Wi(m,l)},function(m){throw ri(l),m}):($i(l,s),Wi(u,l))}if(!i||typeof i!="object"){if((u=a(i))===void 0&&(u=i),u===Zu&&(u=void 0),n.F&&ns(u,!0),s){var f=[],v=[];dt("Patches").M(i,u,f,v),s(f,v)}return u}at(21,i)},this.produceWithPatches=function(i,a){if(typeof i=="function")return function(u){for(var l=arguments.length,d=Array(l>1?l-1:0),h=1;h<l;h++)d[h-1]=arguments[h];return n.produceWithPatches(u,function(f){return i.apply(void 0,[f].concat(d))})};var s,o,c=n.produce(i,a,function(u,l){s=u,o=l});return typeof Promise<"u"&&c instanceof Promise?c.then(function(u){return[u,s,o]}):[c,s,o]},typeof r?.useProxies=="boolean"&&this.setUseProxies(r.useProxies),typeof r?.autoFreeze=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){or(r)||at(8),sr(r)&&(r=Jf(r));var n=ro(this),i=pa(this,r,void 0);return i[Ve].C=!0,da(n),i},t.finishDraft=function(r,n){var i=r&&r[Ve],a=i.A;return $i(a,n),Wi(void 0,a)},t.setAutoFreeze=function(r){this.F=r},t.setUseProxies=function(r){r&&!oo&&at(20),this.g=r},t.applyPatches=function(r,n){var i;for(i=n.length-1;i>=0;i--){var a=n[i];if(a.path.length===0&&a.op==="replace"){r=a.value;break}}i>-1&&(n=n.slice(i+1));var s=dt("Patches").$;return sr(r)?s(r,n):this.produce(r,function(o){return s(o,n)})},e}(),Ge=new rd,Ci=Ge.produce;Ge.produceWithPatches.bind(Ge);Ge.setAutoFreeze.bind(Ge);Ge.setUseProxies.bind(Ge);Ge.applyPatches.bind(Ge);var co=Ge.createDraft.bind(Ge),lo=Ge.finishDraft.bind(Ge);function gt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ai=new WeakMap,si=new WeakMap,Lr=new WeakMap,fo=new WeakMap,ho=new WeakMap,po=new WeakMap,vo=new WeakMap;function go(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function kn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?go(Object(r),!0).forEach(function(n){gt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):go(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var nd=()=>{var e={children:[],operations:[],selection:null,marks:null,isInline:()=>!1,isVoid:()=>!1,onChange:()=>{},apply:t=>{for(var r of p.pathRefs(e))Pd.transform(r,t);for(var n of p.pointRefs(e))Rd.transform(n,t);for(var i of p.rangeRefs(e))jd.transform(i,t);var a=ai.get(e)||[],s=si.get(e)||new Set,o,c,u=v=>{if(v){var m=v.join(",");c.has(m)||(c.add(m),o.push(v))}};if(C.operationCanTransformPath(t)){o=[],c=new Set;for(var l of a){var d=C.transform(l,t);u(d)}}else o=a,c=s;var h=e.getDirtyPaths(t);for(var f of h)u(f);ai.set(e,o),si.set(e,c),N.transform(e,t),e.operations.push(t),p.normalize(e),t.type==="set_selection"&&(e.marks=null),Lr.get(e)||(Lr.set(e,!0),Promise.resolve().then(()=>{Lr.set(e,!1),e.onChange(),e.operations=[]}))},addMark:(t,r)=>{var{selection:n}=e;if(n)if(_.isExpanded(n))N.setNodes(e,{[t]:r},{match:G.isText,split:!0});else{var i=kn(kn({},p.marks(e)||{}),{},{[t]:r});e.marks=i,Lr.get(e)||e.onChange()}},deleteBackward:t=>{var{selection:r}=e;r&&_.isCollapsed(r)&&N.delete(e,{unit:t,reverse:!0})},deleteForward:t=>{var{selection:r}=e;r&&_.isCollapsed(r)&&N.delete(e,{unit:t})},deleteFragment:t=>{var{selection:r}=e;r&&_.isExpanded(r)&&N.delete(e,{reverse:t==="backward"})},getFragment:()=>{var{selection:t}=e;return t?$.fragment(e,t):[]},insertBreak:()=>{N.splitNodes(e,{always:!0})},insertSoftBreak:()=>{N.splitNodes(e,{always:!0})},insertFragment:t=>{N.insertFragment(e,t)},insertNode:t=>{N.insertNodes(e,t)},insertText:t=>{var{selection:r,marks:n}=e;if(r){if(n){var i=kn({text:t},n);N.insertNodes(e,i)}else N.insertText(e,t);e.marks=null}},normalizeNode:t=>{var[r,n]=t;if(!G.isText(r)){if(fe.isElement(r)&&r.children.length===0){var i={text:""};N.insertNodes(e,i,{at:n.concat(0),voids:!0});return}for(var a=p.isEditor(r)?!1:fe.isElement(r)&&(e.isInline(r)||r.children.length===0||G.isText(r.children[0])||e.isInline(r.children[0])),s=0,o=0;o<r.children.length;o++,s++){var c=$.get(e,n);if(!G.isText(c)){var u=r.children[o],l=c.children[s-1],d=o===r.children.length-1,h=G.isText(u)||fe.isElement(u)&&e.isInline(u);if(h!==a)N.removeNodes(e,{at:n.concat(s),voids:!0}),s--;else if(fe.isElement(u)){if(e.isInline(u)){if(l==null||!G.isText(l)){var f={text:""};N.insertNodes(e,f,{at:n.concat(s),voids:!0}),s++}else if(d){var v={text:""};N.insertNodes(e,v,{at:n.concat(s+1),voids:!0}),s++}}}else l!=null&&G.isText(l)&&(G.equals(u,l,{loose:!0})?(N.mergeNodes(e,{at:n.concat(s),voids:!0}),s--):l.text===""?(N.removeNodes(e,{at:n.concat(s-1),voids:!0}),s--):u.text===""&&(N.removeNodes(e,{at:n.concat(s),voids:!0}),s--))}}}},removeMark:t=>{var{selection:r}=e;if(r)if(_.isExpanded(r))N.unsetNodes(e,t,{match:G.isText,split:!0});else{var n=kn({},p.marks(e)||{});delete n[t],e.marks=n,Lr.get(e)||e.onChange()}},getDirtyPaths:t=>{switch(t.type){case"insert_text":case"remove_text":case"set_node":{var{path:r}=t;return C.levels(r)}case"insert_node":{var{node:n,path:i}=t,a=C.levels(i),s=G.isText(n)?[]:Array.from($.nodes(n),H=>{var[,M]=H;return i.concat(M)});return[...a,...s]}case"merge_node":{var{path:o}=t,c=C.ancestors(o),u=C.previous(o);return[...c,u]}case"move_node":{var{path:l,newPath:d}=t;if(C.equals(l,d))return[];var h=[],f=[];for(var v of C.ancestors(l)){var m=C.transform(v,t);h.push(m)}for(var E of C.ancestors(d)){var w=C.transform(E,t);f.push(w)}var g=f[f.length-1],D=d[d.length-1],b=g.concat(D);return[...h,...f,b]}case"remove_node":{var{path:y}=t,A=C.ancestors(y);return[...A]}case"split_node":{var{path:x}=t,B=C.levels(x),j=C.next(x);return[...B,j]}default:return[]}}};return e};function id(e,t){if(e==null)return{};var r={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}function At(e,t){if(e==null)return{};var r=id(e,t),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(t.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}var os=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=!r,i=r?ld(t):t,a=te.None,s=te.None,o=0,c=null,u=null;for(var l of i){var d=l.codePointAt(0);if(!d)break;var h=Ed(l,d);if([a,s]=n?[s,h]:[h,a],yr(a,te.ZWJ)&&yr(s,te.ExtPict)&&(n?c=mo(t.substring(0,o)):c=mo(t.substring(0,t.length-o)),!c)||yr(a,te.RI)&&yr(s,te.RI)&&(u!==null?u=!u:n?u=!0:u=_d(t.substring(0,t.length-o)),!u)||a!==te.None&&s!==te.None&&Bd(a,s))break;o+=l.length}return o||1},ad=/\s/,sd=/[\u0021-\u0023\u0025-\u002A\u002C-\u002F\u003A\u003B\u003F\u0040\u005B-\u005D\u005F\u007B\u007D\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E3B\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]/,od=/['\u2018\u2019]/,ud=function(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=0,i=!1;t.length>0;){var a=os(t,r),[s,o]=us(t,a,r);if(cd(s,o,r))i=!0,n+=a;else if(!i)n+=a;else break;t=o}return n},us=(e,t,r)=>{if(r){var n=e.length-t;return[e.slice(n,e.length),e.slice(0,n)]}return[e.slice(0,t),e.slice(t)]},cd=function e(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(ad.test(t))return!1;if(od.test(t)){var i=os(r,n),[a,s]=us(r,i,n);if(e(a,s,n))return!0}return!sd.test(t)},ld=function*(t){for(var r=t.length-1,n=0;n<t.length;n++){var i=t.charAt(r-n);if(dd(i.charCodeAt(0))){var a=t.charAt(r-n-1);if(fd(a.charCodeAt(0))){yield a+i,n++;continue}}yield i}},fd=e=>e>=55296&&e<=56319,dd=e=>e>=56320&&e<=57343,te;(function(e){e[e.None=0]="None",e[e.Extend=1]="Extend",e[e.ZWJ=2]="ZWJ",e[e.RI=4]="RI",e[e.Prepend=8]="Prepend",e[e.SpacingMark=16]="SpacingMark",e[e.L=32]="L",e[e.V=64]="V",e[e.T=128]="T",e[e.LV=256]="LV",e[e.LVT=512]="LVT",e[e.ExtPict=1024]="ExtPict",e[e.Any=2048]="Any"})(te||(te={}));var hd=/^(?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0902\u093A\u093C\u0941-\u0948\u094D\u0951-\u0957\u0962\u0963\u0981\u09BC\u09BE\u09C1-\u09C4\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01\u0B3C\u0B3E\u0B3F\u0B41-\u0B44\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE\u0BC0\u0BCD\u0BD7\u0C00\u0C04\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81\u0CBC\u0CBF\u0CC2\u0CC6\u0CCC\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00\u0D01\u0D3B\u0D3C\u0D3E\u0D41-\u0D44\u0D4D\u0D57\u0D62\u0D63\u0D81\u0DCA\u0DCF\u0DD2-\u0DD4\u0DD6\u0DDF\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4\u17B5\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1A17\u1A18\u1A1B\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1AB0-\u1AC0\u1B00-\u1B03\u1B34-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1BAB-\u1BAD\u1BE6\u1BE8\u1BE9\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u200C\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA825\uA826\uA82C\uA8C4\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uA9BD\uA9E5\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAA7C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEC\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFF9E\uFF9F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDF46-\uDF50]|\uD804[\uDC01\uDC38-\uDC46\uDC7F-\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA\uDD00-\uDD02\uDD27-\uDD2B\uDD2D-\uDD34\uDD73\uDD80\uDD81\uDDB6-\uDDBE\uDDC9-\uDDCC\uDDCF\uDE2F-\uDE31\uDE34\uDE36\uDE37\uDE3E\uDEDF\uDEE3-\uDEEA\uDF00\uDF01\uDF3B\uDF3C\uDF3E\uDF40\uDF57\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC38-\uDC3F\uDC42-\uDC44\uDC46\uDC5E\uDCB0\uDCB3-\uDCB8\uDCBA\uDCBD\uDCBF\uDCC0\uDCC2\uDCC3\uDDAF\uDDB2-\uDDB5\uDDBC\uDDBD\uDDBF\uDDC0\uDDDC\uDDDD\uDE33-\uDE3A\uDE3D\uDE3F\uDE40\uDEAB\uDEAD\uDEB0-\uDEB5\uDEB7\uDF1D-\uDF1F\uDF22-\uDF25\uDF27-\uDF2B]|\uD806[\uDC2F-\uDC37\uDC39\uDC3A\uDD30\uDD3B\uDD3C\uDD3E\uDD43\uDDD4-\uDDD7\uDDDA\uDDDB\uDDE0\uDE01-\uDE0A\uDE33-\uDE38\uDE3B-\uDE3E\uDE47\uDE51-\uDE56\uDE59-\uDE5B\uDE8A-\uDE96\uDE98\uDE99]|\uD807[\uDC30-\uDC36\uDC38-\uDC3D\uDC3F\uDC92-\uDCA7\uDCAA-\uDCB0\uDCB2\uDCB3\uDCB5\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD90\uDD91\uDD95\uDD97\uDEF3\uDEF4]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF8F-\uDF92\uDFE4]|\uD82F[\uDC9D\uDC9E]|\uD834[\uDD65\uDD67-\uDD69\uDD6E-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uD83C[\uDFFB-\uDFFF]|\uDB40[\uDC20-\uDC7F\uDD00-\uDDEF])$/,pd=/^(?:[\u0600-\u0605\u06DD\u070F\u0890\u0891\u08E2\u0D4E]|\uD804[\uDCBD\uDCCD\uDDC2\uDDC3]|\uD806[\uDD3F\uDD41\uDE3A\uDE84-\uDE89]|\uD807\uDD46)$/,vd=/^(?:[\u0903\u093B\u093E-\u0940\u0949-\u094C\u094E\u094F\u0982\u0983\u09BF\u09C0\u09C7\u09C8\u09CB\u09CC\u0A03\u0A3E-\u0A40\u0A83\u0ABE-\u0AC0\u0AC9\u0ACB\u0ACC\u0B02\u0B03\u0B40\u0B47\u0B48\u0B4B\u0B4C\u0BBF\u0BC1\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCC\u0C01-\u0C03\u0C41-\u0C44\u0C82\u0C83\u0CBE\u0CC0\u0CC1\u0CC3\u0CC4\u0CC7\u0CC8\u0CCA\u0CCB\u0D02\u0D03\u0D3F\u0D40\u0D46-\u0D48\u0D4A-\u0D4C\u0D82\u0D83\u0DD0\u0DD1\u0DD8-\u0DDE\u0DF2\u0DF3\u0E33\u0EB3\u0F3E\u0F3F\u0F7F\u1031\u103B\u103C\u1056\u1057\u1084\u1715\u1734\u17B6\u17BE-\u17C5\u17C7\u17C8\u1923-\u1926\u1929-\u192B\u1930\u1931\u1933-\u1938\u1A19\u1A1A\u1A55\u1A57\u1A6D-\u1A72\u1B04\u1B3B\u1B3D-\u1B41\u1B43\u1B44\u1B82\u1BA1\u1BA6\u1BA7\u1BAA\u1BE7\u1BEA-\u1BEC\u1BEE\u1BF2\u1BF3\u1C24-\u1C2B\u1C34\u1C35\u1CE1\u1CF7\uA823\uA824\uA827\uA880\uA881\uA8B4-\uA8C3\uA952\uA953\uA983\uA9B4\uA9B5\uA9BA\uA9BB\uA9BE-\uA9C0\uAA2F\uAA30\uAA33\uAA34\uAA4D\uAAEB\uAAEE\uAAEF\uAAF5\uABE3\uABE4\uABE6\uABE7\uABE9\uABEA\uABEC]|\uD804[\uDC00\uDC02\uDC82\uDCB0-\uDCB2\uDCB7\uDCB8\uDD2C\uDD45\uDD46\uDD82\uDDB3-\uDDB5\uDDBF\uDDC0\uDDCE\uDE2C-\uDE2E\uDE32\uDE33\uDE35\uDEE0-\uDEE2\uDF02\uDF03\uDF3F\uDF41-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF62\uDF63]|\uD805[\uDC35-\uDC37\uDC40\uDC41\uDC45\uDCB1\uDCB2\uDCB9\uDCBB\uDCBC\uDCBE\uDCC1\uDDB0\uDDB1\uDDB8-\uDDBB\uDDBE\uDE30-\uDE32\uDE3B\uDE3C\uDE3E\uDEAC\uDEAE\uDEAF\uDEB6\uDF26]|\uD806[\uDC2C-\uDC2E\uDC38\uDD31-\uDD35\uDD37\uDD38\uDD3D\uDD40\uDD42\uDDD1-\uDDD3\uDDDC-\uDDDF\uDDE4\uDE39\uDE57\uDE58\uDE97]|\uD807[\uDC2F\uDC3E\uDCA9\uDCB1\uDCB4\uDD8A-\uDD8E\uDD93\uDD94\uDD96\uDEF5\uDEF6]|\uD81B[\uDF51-\uDF87\uDFF0\uDFF1]|\uD834[\uDD66\uDD6D])$/,gd=/^[\u1100-\u115F\uA960-\uA97C]$/,md=/^[\u1160-\u11A7\uD7B0-\uD7C6]$/,Dd=/^[\u11A8-\u11FF\uD7CB-\uD7FB]$/,Cd=/^[\uAC00\uAC1C\uAC38\uAC54\uAC70\uAC8C\uACA8\uACC4\uACE0\uACFC\uAD18\uAD34\uAD50\uAD6C\uAD88\uADA4\uADC0\uADDC\uADF8\uAE14\uAE30\uAE4C\uAE68\uAE84\uAEA0\uAEBC\uAED8\uAEF4\uAF10\uAF2C\uAF48\uAF64\uAF80\uAF9C\uAFB8\uAFD4\uAFF0\uB00C\uB028\uB044\uB060\uB07C\uB098\uB0B4\uB0D0\uB0EC\uB108\uB124\uB140\uB15C\uB178\uB194\uB1B0\uB1CC\uB1E8\uB204\uB220\uB23C\uB258\uB274\uB290\uB2AC\uB2C8\uB2E4\uB300\uB31C\uB338\uB354\uB370\uB38C\uB3A8\uB3C4\uB3E0\uB3FC\uB418\uB434\uB450\uB46C\uB488\uB4A4\uB4C0\uB4DC\uB4F8\uB514\uB530\uB54C\uB568\uB584\uB5A0\uB5BC\uB5D8\uB5F4\uB610\uB62C\uB648\uB664\uB680\uB69C\uB6B8\uB6D4\uB6F0\uB70C\uB728\uB744\uB760\uB77C\uB798\uB7B4\uB7D0\uB7EC\uB808\uB824\uB840\uB85C\uB878\uB894\uB8B0\uB8CC\uB8E8\uB904\uB920\uB93C\uB958\uB974\uB990\uB9AC\uB9C8\uB9E4\uBA00\uBA1C\uBA38\uBA54\uBA70\uBA8C\uBAA8\uBAC4\uBAE0\uBAFC\uBB18\uBB34\uBB50\uBB6C\uBB88\uBBA4\uBBC0\uBBDC\uBBF8\uBC14\uBC30\uBC4C\uBC68\uBC84\uBCA0\uBCBC\uBCD8\uBCF4\uBD10\uBD2C\uBD48\uBD64\uBD80\uBD9C\uBDB8\uBDD4\uBDF0\uBE0C\uBE28\uBE44\uBE60\uBE7C\uBE98\uBEB4\uBED0\uBEEC\uBF08\uBF24\uBF40\uBF5C\uBF78\uBF94\uBFB0\uBFCC\uBFE8\uC004\uC020\uC03C\uC058\uC074\uC090\uC0AC\uC0C8\uC0E4\uC100\uC11C\uC138\uC154\uC170\uC18C\uC1A8\uC1C4\uC1E0\uC1FC\uC218\uC234\uC250\uC26C\uC288\uC2A4\uC2C0\uC2DC\uC2F8\uC314\uC330\uC34C\uC368\uC384\uC3A0\uC3BC\uC3D8\uC3F4\uC410\uC42C\uC448\uC464\uC480\uC49C\uC4B8\uC4D4\uC4F0\uC50C\uC528\uC544\uC560\uC57C\uC598\uC5B4\uC5D0\uC5EC\uC608\uC624\uC640\uC65C\uC678\uC694\uC6B0\uC6CC\uC6E8\uC704\uC720\uC73C\uC758\uC774\uC790\uC7AC\uC7C8\uC7E4\uC800\uC81C\uC838\uC854\uC870\uC88C\uC8A8\uC8C4\uC8E0\uC8FC\uC918\uC934\uC950\uC96C\uC988\uC9A4\uC9C0\uC9DC\uC9F8\uCA14\uCA30\uCA4C\uCA68\uCA84\uCAA0\uCABC\uCAD8\uCAF4\uCB10\uCB2C\uCB48\uCB64\uCB80\uCB9C\uCBB8\uCBD4\uCBF0\uCC0C\uCC28\uCC44\uCC60\uCC7C\uCC98\uCCB4\uCCD0\uCCEC\uCD08\uCD24\uCD40\uCD5C\uCD78\uCD94\uCDB0\uCDCC\uCDE8\uCE04\uCE20\uCE3C\uCE58\uCE74\uCE90\uCEAC\uCEC8\uCEE4\uCF00\uCF1C\uCF38\uCF54\uCF70\uCF8C\uCFA8\uCFC4\uCFE0\uCFFC\uD018\uD034\uD050\uD06C\uD088\uD0A4\uD0C0\uD0DC\uD0F8\uD114\uD130\uD14C\uD168\uD184\uD1A0\uD1BC\uD1D8\uD1F4\uD210\uD22C\uD248\uD264\uD280\uD29C\uD2B8\uD2D4\uD2F0\uD30C\uD328\uD344\uD360\uD37C\uD398\uD3B4\uD3D0\uD3EC\uD408\uD424\uD440\uD45C\uD478\uD494\uD4B0\uD4CC\uD4E8\uD504\uD520\uD53C\uD558\uD574\uD590\uD5AC\uD5C8\uD5E4\uD600\uD61C\uD638\uD654\uD670\uD68C\uD6A8\uD6C4\uD6E0\uD6FC\uD718\uD734\uD750\uD76C\uD788]$/,yd=/^[\uAC01-\uAC1B\uAC1D-\uAC37\uAC39-\uAC53\uAC55-\uAC6F\uAC71-\uAC8B\uAC8D-\uACA7\uACA9-\uACC3\uACC5-\uACDF\uACE1-\uACFB\uACFD-\uAD17\uAD19-\uAD33\uAD35-\uAD4F\uAD51-\uAD6B\uAD6D-\uAD87\uAD89-\uADA3\uADA5-\uADBF\uADC1-\uADDB\uADDD-\uADF7\uADF9-\uAE13\uAE15-\uAE2F\uAE31-\uAE4B\uAE4D-\uAE67\uAE69-\uAE83\uAE85-\uAE9F\uAEA1-\uAEBB\uAEBD-\uAED7\uAED9-\uAEF3\uAEF5-\uAF0F\uAF11-\uAF2B\uAF2D-\uAF47\uAF49-\uAF63\uAF65-\uAF7F\uAF81-\uAF9B\uAF9D-\uAFB7\uAFB9-\uAFD3\uAFD5-\uAFEF\uAFF1-\uB00B\uB00D-\uB027\uB029-\uB043\uB045-\uB05F\uB061-\uB07B\uB07D-\uB097\uB099-\uB0B3\uB0B5-\uB0CF\uB0D1-\uB0EB\uB0ED-\uB107\uB109-\uB123\uB125-\uB13F\uB141-\uB15B\uB15D-\uB177\uB179-\uB193\uB195-\uB1AF\uB1B1-\uB1CB\uB1CD-\uB1E7\uB1E9-\uB203\uB205-\uB21F\uB221-\uB23B\uB23D-\uB257\uB259-\uB273\uB275-\uB28F\uB291-\uB2AB\uB2AD-\uB2C7\uB2C9-\uB2E3\uB2E5-\uB2FF\uB301-\uB31B\uB31D-\uB337\uB339-\uB353\uB355-\uB36F\uB371-\uB38B\uB38D-\uB3A7\uB3A9-\uB3C3\uB3C5-\uB3DF\uB3E1-\uB3FB\uB3FD-\uB417\uB419-\uB433\uB435-\uB44F\uB451-\uB46B\uB46D-\uB487\uB489-\uB4A3\uB4A5-\uB4BF\uB4C1-\uB4DB\uB4DD-\uB4F7\uB4F9-\uB513\uB515-\uB52F\uB531-\uB54B\uB54D-\uB567\uB569-\uB583\uB585-\uB59F\uB5A1-\uB5BB\uB5BD-\uB5D7\uB5D9-\uB5F3\uB5F5-\uB60F\uB611-\uB62B\uB62D-\uB647\uB649-\uB663\uB665-\uB67F\uB681-\uB69B\uB69D-\uB6B7\uB6B9-\uB6D3\uB6D5-\uB6EF\uB6F1-\uB70B\uB70D-\uB727\uB729-\uB743\uB745-\uB75F\uB761-\uB77B\uB77D-\uB797\uB799-\uB7B3\uB7B5-\uB7CF\uB7D1-\uB7EB\uB7ED-\uB807\uB809-\uB823\uB825-\uB83F\uB841-\uB85B\uB85D-\uB877\uB879-\uB893\uB895-\uB8AF\uB8B1-\uB8CB\uB8CD-\uB8E7\uB8E9-\uB903\uB905-\uB91F\uB921-\uB93B\uB93D-\uB957\uB959-\uB973\uB975-\uB98F\uB991-\uB9AB\uB9AD-\uB9C7\uB9C9-\uB9E3\uB9E5-\uB9FF\uBA01-\uBA1B\uBA1D-\uBA37\uBA39-\uBA53\uBA55-\uBA6F\uBA71-\uBA8B\uBA8D-\uBAA7\uBAA9-\uBAC3\uBAC5-\uBADF\uBAE1-\uBAFB\uBAFD-\uBB17\uBB19-\uBB33\uBB35-\uBB4F\uBB51-\uBB6B\uBB6D-\uBB87\uBB89-\uBBA3\uBBA5-\uBBBF\uBBC1-\uBBDB\uBBDD-\uBBF7\uBBF9-\uBC13\uBC15-\uBC2F\uBC31-\uBC4B\uBC4D-\uBC67\uBC69-\uBC83\uBC85-\uBC9F\uBCA1-\uBCBB\uBCBD-\uBCD7\uBCD9-\uBCF3\uBCF5-\uBD0F\uBD11-\uBD2B\uBD2D-\uBD47\uBD49-\uBD63\uBD65-\uBD7F\uBD81-\uBD9B\uBD9D-\uBDB7\uBDB9-\uBDD3\uBDD5-\uBDEF\uBDF1-\uBE0B\uBE0D-\uBE27\uBE29-\uBE43\uBE45-\uBE5F\uBE61-\uBE7B\uBE7D-\uBE97\uBE99-\uBEB3\uBEB5-\uBECF\uBED1-\uBEEB\uBEED-\uBF07\uBF09-\uBF23\uBF25-\uBF3F\uBF41-\uBF5B\uBF5D-\uBF77\uBF79-\uBF93\uBF95-\uBFAF\uBFB1-\uBFCB\uBFCD-\uBFE7\uBFE9-\uC003\uC005-\uC01F\uC021-\uC03B\uC03D-\uC057\uC059-\uC073\uC075-\uC08F\uC091-\uC0AB\uC0AD-\uC0C7\uC0C9-\uC0E3\uC0E5-\uC0FF\uC101-\uC11B\uC11D-\uC137\uC139-\uC153\uC155-\uC16F\uC171-\uC18B\uC18D-\uC1A7\uC1A9-\uC1C3\uC1C5-\uC1DF\uC1E1-\uC1FB\uC1FD-\uC217\uC219-\uC233\uC235-\uC24F\uC251-\uC26B\uC26D-\uC287\uC289-\uC2A3\uC2A5-\uC2BF\uC2C1-\uC2DB\uC2DD-\uC2F7\uC2F9-\uC313\uC315-\uC32F\uC331-\uC34B\uC34D-\uC367\uC369-\uC383\uC385-\uC39F\uC3A1-\uC3BB\uC3BD-\uC3D7\uC3D9-\uC3F3\uC3F5-\uC40F\uC411-\uC42B\uC42D-\uC447\uC449-\uC463\uC465-\uC47F\uC481-\uC49B\uC49D-\uC4B7\uC4B9-\uC4D3\uC4D5-\uC4EF\uC4F1-\uC50B\uC50D-\uC527\uC529-\uC543\uC545-\uC55F\uC561-\uC57B\uC57D-\uC597\uC599-\uC5B3\uC5B5-\uC5CF\uC5D1-\uC5EB\uC5ED-\uC607\uC609-\uC623\uC625-\uC63F\uC641-\uC65B\uC65D-\uC677\uC679-\uC693\uC695-\uC6AF\uC6B1-\uC6CB\uC6CD-\uC6E7\uC6E9-\uC703\uC705-\uC71F\uC721-\uC73B\uC73D-\uC757\uC759-\uC773\uC775-\uC78F\uC791-\uC7AB\uC7AD-\uC7C7\uC7C9-\uC7E3\uC7E5-\uC7FF\uC801-\uC81B\uC81D-\uC837\uC839-\uC853\uC855-\uC86F\uC871-\uC88B\uC88D-\uC8A7\uC8A9-\uC8C3\uC8C5-\uC8DF\uC8E1-\uC8FB\uC8FD-\uC917\uC919-\uC933\uC935-\uC94F\uC951-\uC96B\uC96D-\uC987\uC989-\uC9A3\uC9A5-\uC9BF\uC9C1-\uC9DB\uC9DD-\uC9F7\uC9F9-\uCA13\uCA15-\uCA2F\uCA31-\uCA4B\uCA4D-\uCA67\uCA69-\uCA83\uCA85-\uCA9F\uCAA1-\uCABB\uCABD-\uCAD7\uCAD9-\uCAF3\uCAF5-\uCB0F\uCB11-\uCB2B\uCB2D-\uCB47\uCB49-\uCB63\uCB65-\uCB7F\uCB81-\uCB9B\uCB9D-\uCBB7\uCBB9-\uCBD3\uCBD5-\uCBEF\uCBF1-\uCC0B\uCC0D-\uCC27\uCC29-\uCC43\uCC45-\uCC5F\uCC61-\uCC7B\uCC7D-\uCC97\uCC99-\uCCB3\uCCB5-\uCCCF\uCCD1-\uCCEB\uCCED-\uCD07\uCD09-\uCD23\uCD25-\uCD3F\uCD41-\uCD5B\uCD5D-\uCD77\uCD79-\uCD93\uCD95-\uCDAF\uCDB1-\uCDCB\uCDCD-\uCDE7\uCDE9-\uCE03\uCE05-\uCE1F\uCE21-\uCE3B\uCE3D-\uCE57\uCE59-\uCE73\uCE75-\uCE8F\uCE91-\uCEAB\uCEAD-\uCEC7\uCEC9-\uCEE3\uCEE5-\uCEFF\uCF01-\uCF1B\uCF1D-\uCF37\uCF39-\uCF53\uCF55-\uCF6F\uCF71-\uCF8B\uCF8D-\uCFA7\uCFA9-\uCFC3\uCFC5-\uCFDF\uCFE1-\uCFFB\uCFFD-\uD017\uD019-\uD033\uD035-\uD04F\uD051-\uD06B\uD06D-\uD087\uD089-\uD0A3\uD0A5-\uD0BF\uD0C1-\uD0DB\uD0DD-\uD0F7\uD0F9-\uD113\uD115-\uD12F\uD131-\uD14B\uD14D-\uD167\uD169-\uD183\uD185-\uD19F\uD1A1-\uD1BB\uD1BD-\uD1D7\uD1D9-\uD1F3\uD1F5-\uD20F\uD211-\uD22B\uD22D-\uD247\uD249-\uD263\uD265-\uD27F\uD281-\uD29B\uD29D-\uD2B7\uD2B9-\uD2D3\uD2D5-\uD2EF\uD2F1-\uD30B\uD30D-\uD327\uD329-\uD343\uD345-\uD35F\uD361-\uD37B\uD37D-\uD397\uD399-\uD3B3\uD3B5-\uD3CF\uD3D1-\uD3EB\uD3ED-\uD407\uD409-\uD423\uD425-\uD43F\uD441-\uD45B\uD45D-\uD477\uD479-\uD493\uD495-\uD4AF\uD4B1-\uD4CB\uD4CD-\uD4E7\uD4E9-\uD503\uD505-\uD51F\uD521-\uD53B\uD53D-\uD557\uD559-\uD573\uD575-\uD58F\uD591-\uD5AB\uD5AD-\uD5C7\uD5C9-\uD5E3\uD5E5-\uD5FF\uD601-\uD61B\uD61D-\uD637\uD639-\uD653\uD655-\uD66F\uD671-\uD68B\uD68D-\uD6A7\uD6A9-\uD6C3\uD6C5-\uD6DF\uD6E1-\uD6FB\uD6FD-\uD717\uD719-\uD733\uD735-\uD74F\uD751-\uD76B\uD76D-\uD787\uD789-\uD7A3]$/,bd=/^(?:[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u2388\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2605\u2607-\u2612\u2614-\u2685\u2690-\u2705\u2708-\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763-\u2767\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC00-\uDCFF\uDD0D-\uDD0F\uDD2F\uDD6C-\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDAD-\uDDE5\uDE01-\uDE0F\uDE1A\uDE2F\uDE32-\uDE3A\uDE3C-\uDE3F\uDE49-\uDFFA]|\uD83D[\uDC00-\uDD3D\uDD46-\uDE4F\uDE80-\uDEFF\uDF74-\uDF7F\uDFD5-\uDFFF]|\uD83E[\uDC0C-\uDC0F\uDC48-\uDC4F\uDC5A-\uDC5F\uDC88-\uDC8F\uDCAE-\uDCFF\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDEFF]|\uD83F[\uDC00-\uDFFD])$/,Ed=(e,t)=>{var r=te.Any;return e.search(hd)!==-1&&(r|=te.Extend),t===8205&&(r|=te.ZWJ),t>=127462&&t<=127487&&(r|=te.RI),e.search(pd)!==-1&&(r|=te.Prepend),e.search(vd)!==-1&&(r|=te.SpacingMark),e.search(gd)!==-1&&(r|=te.L),e.search(md)!==-1&&(r|=te.V),e.search(Dd)!==-1&&(r|=te.T),e.search(Cd)!==-1&&(r|=te.LV),e.search(yd)!==-1&&(r|=te.LVT),e.search(bd)!==-1&&(r|=te.ExtPict),r};function yr(e,t){return(e&t)!==0}var Sd=[[te.L,te.L|te.V|te.LV|te.LVT],[te.LV|te.V,te.V|te.T],[te.LVT|te.T,te.T],[te.Any,te.Extend|te.ZWJ],[te.Any,te.SpacingMark],[te.Prepend,te.Any],[te.ZWJ,te.ExtPict],[te.RI,te.RI]];function Bd(e,t){return Sd.findIndex(r=>yr(e,r[0])&&yr(t,r[1]))===-1}var Ad=/(?:[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u2388\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2605\u2607-\u2612\u2614-\u2685\u2690-\u2705\u2708-\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763-\u2767\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC00-\uDCFF\uDD0D-\uDD0F\uDD2F\uDD6C-\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDAD-\uDDE5\uDE01-\uDE0F\uDE1A\uDE2F\uDE32-\uDE3A\uDE3C-\uDE3F\uDE49-\uDFFA]|\uD83D[\uDC00-\uDD3D\uDD46-\uDE4F\uDE80-\uDEFF\uDF74-\uDF7F\uDFD5-\uDFFF]|\uD83E[\uDC0C-\uDC0F\uDC48-\uDC4F\uDC5A-\uDC5F\uDC88-\uDC8F\uDCAE-\uDCFF\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDEFF]|\uD83F[\uDC00-\uDFFD])(?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0902\u093A\u093C\u0941-\u0948\u094D\u0951-\u0957\u0962\u0963\u0981\u09BC\u09BE\u09C1-\u09C4\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01\u0B3C\u0B3E\u0B3F\u0B41-\u0B44\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE\u0BC0\u0BCD\u0BD7\u0C00\u0C04\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81\u0CBC\u0CBF\u0CC2\u0CC6\u0CCC\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00\u0D01\u0D3B\u0D3C\u0D3E\u0D41-\u0D44\u0D4D\u0D57\u0D62\u0D63\u0D81\u0DCA\u0DCF\u0DD2-\u0DD4\u0DD6\u0DDF\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4\u17B5\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1A17\u1A18\u1A1B\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1AB0-\u1AC0\u1B00-\u1B03\u1B34-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1BAB-\u1BAD\u1BE6\u1BE8\u1BE9\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u200C\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA825\uA826\uA82C\uA8C4\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uA9BD\uA9E5\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAA7C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEC\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFF9E\uFF9F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDF46-\uDF50]|\uD804[\uDC01\uDC38-\uDC46\uDC7F-\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA\uDD00-\uDD02\uDD27-\uDD2B\uDD2D-\uDD34\uDD73\uDD80\uDD81\uDDB6-\uDDBE\uDDC9-\uDDCC\uDDCF\uDE2F-\uDE31\uDE34\uDE36\uDE37\uDE3E\uDEDF\uDEE3-\uDEEA\uDF00\uDF01\uDF3B\uDF3C\uDF3E\uDF40\uDF57\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC38-\uDC3F\uDC42-\uDC44\uDC46\uDC5E\uDCB0\uDCB3-\uDCB8\uDCBA\uDCBD\uDCBF\uDCC0\uDCC2\uDCC3\uDDAF\uDDB2-\uDDB5\uDDBC\uDDBD\uDDBF\uDDC0\uDDDC\uDDDD\uDE33-\uDE3A\uDE3D\uDE3F\uDE40\uDEAB\uDEAD\uDEB0-\uDEB5\uDEB7\uDF1D-\uDF1F\uDF22-\uDF25\uDF27-\uDF2B]|\uD806[\uDC2F-\uDC37\uDC39\uDC3A\uDD30\uDD3B\uDD3C\uDD3E\uDD43\uDDD4-\uDDD7\uDDDA\uDDDB\uDDE0\uDE01-\uDE0A\uDE33-\uDE38\uDE3B-\uDE3E\uDE47\uDE51-\uDE56\uDE59-\uDE5B\uDE8A-\uDE96\uDE98\uDE99]|\uD807[\uDC30-\uDC36\uDC38-\uDC3D\uDC3F\uDC92-\uDCA7\uDCAA-\uDCB0\uDCB2\uDCB3\uDCB5\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD90\uDD91\uDD95\uDD97\uDEF3\uDEF4]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF8F-\uDF92\uDFE4]|\uD82F[\uDC9D\uDC9E]|\uD834[\uDD65\uDD67-\uDD69\uDD6E-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uD83C[\uDFFB-\uDFFF]|\uDB40[\uDC20-\uDC7F\uDD00-\uDDEF])*\u200D$/,mo=e=>e.search(Ad)!==-1,wd=/(?:\uD83C[\uDDE6-\uDDFF])+$/g,_d=e=>{var t=e.match(wd);if(t===null)return!1;var r=t[0].length/2;return r%2===1},Do=e=>Re(e)&&$.isNodeList(e.children)&&!p.isEditor(e),fe={isAncestor(e){return Re(e)&&$.isNodeList(e.children)},isElement:Do,isElementList(e){return Array.isArray(e)&&e.every(t=>fe.isElement(t))},isElementProps(e){return e.children!==void 0},isElementType:function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"type";return Do(t)&&t[n]===r},matches(e,t){for(var r in t)if(r!=="children"&&e[r]!==t[r])return!1;return!0}},kd=["text"],Td=["text"];function Co(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function mr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Co(Object(r),!0).forEach(function(n){gt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Co(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var yo=new WeakMap,p={above(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{voids:r=!1,mode:n="lowest",at:i=e.selection,match:a}=t;if(!!i){var s=p.path(e,i),o=n==="lowest";for(var[c,u]of p.levels(e,{at:s,voids:r,match:a,reverse:o}))if(!G.isText(c)&&!C.equals(s,u))return[c,u]}},addMark(e,t,r){e.addMark(t,r)},after(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=p.point(e,t,{edge:"end"}),i=p.end(e,[]),a={anchor:n,focus:i},{distance:s=1}=r,o=0,c;for(var u of p.positions(e,mr(mr({},r),{},{at:a}))){if(o>s)break;o!==0&&(c=u),o++}return c},before(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=p.start(e,[]),i=p.point(e,t,{edge:"start"}),a={anchor:n,focus:i},{distance:s=1}=r,o=0,c;for(var u of p.positions(e,mr(mr({},r),{},{at:a,reverse:!0}))){if(o>s)break;o!==0&&(c=u),o++}return c},deleteBackward(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{unit:r="character"}=t;e.deleteBackward(r)},deleteForward(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{unit:r="character"}=t;e.deleteForward(r)},deleteFragment(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{direction:r="forward"}=t;e.deleteFragment(r)},edges(e,t){return[p.start(e,t),p.end(e,t)]},end(e,t){return p.point(e,t,{edge:"end"})},first(e,t){var r=p.path(e,t,{edge:"start"});return p.node(e,r)},fragment(e,t){var r=p.range(e,t),n=$.fragment(e,r);return n},hasBlocks(e,t){return t.children.some(r=>p.isBlock(e,r))},hasInlines(e,t){return t.children.some(r=>G.isText(r)||p.isInline(e,r))},hasTexts(e,t){return t.children.every(r=>G.isText(r))},insertBreak(e){e.insertBreak()},insertSoftBreak(e){e.insertSoftBreak()},insertFragment(e,t){e.insertFragment(t)},insertNode(e,t){e.insertNode(t)},insertText(e,t){e.insertText(t)},isBlock(e,t){return fe.isElement(t)&&!e.isInline(t)},isEditor(e){var t=yo.get(e);if(t!==void 0)return t;if(!Re(e))return!1;var r=typeof e.addMark=="function"&&typeof e.apply=="function"&&typeof e.deleteBackward=="function"&&typeof e.deleteForward=="function"&&typeof e.deleteFragment=="function"&&typeof e.insertBreak=="function"&&typeof e.insertSoftBreak=="function"&&typeof e.insertFragment=="function"&&typeof e.insertNode=="function"&&typeof e.insertText=="function"&&typeof e.isInline=="function"&&typeof e.isVoid=="function"&&typeof e.normalizeNode=="function"&&typeof e.onChange=="function"&&typeof e.removeMark=="function"&&typeof e.getDirtyPaths=="function"&&(e.marks===null||Re(e.marks))&&(e.selection===null||_.isRange(e.selection))&&$.isNodeList(e.children)&&Gr.isOperationList(e.operations);return yo.set(e,r),r},isEnd(e,t,r){var n=p.end(e,r);return se.equals(t,n)},isEdge(e,t,r){return p.isStart(e,t,r)||p.isEnd(e,t,r)},isEmpty(e,t){var{children:r}=t,[n]=r;return r.length===0||r.length===1&&G.isText(n)&&n.text===""&&!e.isVoid(t)},isInline(e,t){return fe.isElement(t)&&e.isInline(t)},isNormalizing(e){var t=fo.get(e);return t===void 0?!0:t},isStart(e,t,r){if(t.offset!==0)return!1;var n=p.start(e,r);return se.equals(t,n)},isVoid(e,t){return fe.isElement(t)&&e.isVoid(t)},last(e,t){var r=p.path(e,t,{edge:"end"});return p.node(e,r)},leaf(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=p.path(e,t,r),i=$.leaf(e,n);return[i,n]},*levels(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{at:r=e.selection,reverse:n=!1,voids:i=!1}=t,{match:a}=t;if(a==null&&(a=()=>!0),!!r){var s=[],o=p.path(e,r);for(var[c,u]of $.levels(e,o))if(!!a(c,u)&&(s.push([c,u]),!i&&p.isVoid(e,c)))break;n&&s.reverse(),yield*s}},marks(e){var{marks:t,selection:r}=e;if(!r)return null;if(t)return t;if(_.isExpanded(r)){var[n]=p.nodes(e,{match:G.isText});if(n){var[i]=n,a=At(i,kd);return a}else return{}}var{anchor:s}=r,{path:o}=s,[c]=p.leaf(e,o);if(s.offset===0){var u=p.previous(e,{at:o,match:G.isText}),l=p.above(e,{match:m=>p.isBlock(e,m)});if(u&&l){var[d,h]=u,[,f]=l;C.isAncestor(f,h)&&(c=d)}}var v=At(c,Td);return v},next(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{mode:r="lowest",voids:n=!1}=t,{match:i,at:a=e.selection}=t;if(!!a){var s=p.after(e,a,{voids:n});if(!!s){var[,o]=p.last(e,[]),c=[s.path,o];if(C.isPath(a)&&a.length===0)throw new Error("Cannot get the next node from the root node!");if(i==null)if(C.isPath(a)){var[u]=p.parent(e,a);i=d=>u.children.includes(d)}else i=()=>!0;var[l]=p.nodes(e,{at:c,match:i,mode:r,voids:n});return l}}},node(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=p.path(e,t,r),i=$.get(e,n);return[i,n]},*nodes(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{at:r=e.selection,mode:n="all",universal:i=!1,reverse:a=!1,voids:s=!1}=t,{match:o}=t;if(o||(o=()=>!0),!!r){var c,u;if(Fd.isSpan(r))c=r[0],u=r[1];else{var l=p.path(e,r,{edge:"start"}),d=p.path(e,r,{edge:"end"});c=a?d:l,u=a?l:d}var h=$.nodes(e,{reverse:a,from:c,to:u,pass:D=>{var[b]=D;return s?!1:p.isVoid(e,b)}}),f=[],v;for(var[m,E]of h){var w=v&&C.compare(E,v[1])===0;if(!(n==="highest"&&w)){if(!o(m,E)){if(i&&!w&&G.isText(m))return;continue}if(n==="lowest"&&w){v=[m,E];continue}var g=n==="lowest"?v:[m,E];g&&(i?f.push(g):yield g),v=[m,E]}}n==="lowest"&&v&&(i?f.push(v):yield v),i&&(yield*f)}},normalize(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{force:r=!1}=t,n=c=>ai.get(c)||[],i=c=>si.get(c)||new Set,a=c=>{var u=n(c).pop(),l=u.join(",");return i(c).delete(l),u};if(!!p.isNormalizing(e)){if(r){var s=Array.from($.nodes(e),c=>{var[,u]=c;return u}),o=new Set(s.map(c=>c.join(",")));ai.set(e,s),si.set(e,o)}n(e).length!==0&&p.withoutNormalizing(e,()=>{for(var c of n(e))if($.has(e,c)){var u=p.node(e,c),[l,d]=u;fe.isElement(l)&&l.children.length===0&&e.normalizeNode(u)}for(var h=n(e).length*42,f=0;n(e).length!==0;){if(f>h)throw new Error(`
            Could not completely normalize the editor after `.concat(h,` iterations! This is usually due to incorrect normalization logic that leaves a node in an invalid state.
          `));var v=a(e);if($.has(e,v)){var m=p.node(e,v);e.normalizeNode(m)}f++}})}},parent(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=p.path(e,t,r),i=C.parent(n),a=p.node(e,i);return a},path(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{depth:n,edge:i}=r;if(C.isPath(t)){if(i==="start"){var[,a]=$.first(e,t);t=a}else if(i==="end"){var[,s]=$.last(e,t);t=s}}return _.isRange(t)&&(i==="start"?t=_.start(t):i==="end"?t=_.end(t):t=C.common(t.anchor.path,t.focus.path)),se.isPoint(t)&&(t=t.path),n!=null&&(t=t.slice(0,n)),t},hasPath(e,t){return $.has(e,t)},pathRef(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{affinity:n="forward"}=r,i={current:t,affinity:n,unref(){var{current:s}=i,o=p.pathRefs(e);return o.delete(i),i.current=null,s}},a=p.pathRefs(e);return a.add(i),i},pathRefs(e){var t=ho.get(e);return t||(t=new Set,ho.set(e,t)),t},point(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{edge:n="start"}=r;if(C.isPath(t)){var i;if(n==="end"){var[,a]=$.last(e,t);i=a}else{var[,s]=$.first(e,t);i=s}var o=$.get(e,i);if(!G.isText(o))throw new Error("Cannot get the ".concat(n," point in the node at path [").concat(t,"] because it has no ").concat(n," text node."));return{path:i,offset:n==="end"?o.text.length:0}}if(_.isRange(t)){var[c,u]=_.edges(t);return n==="start"?c:u}return t},pointRef(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{affinity:n="forward"}=r,i={current:t,affinity:n,unref(){var{current:s}=i,o=p.pointRefs(e);return o.delete(i),i.current=null,s}},a=p.pointRefs(e);return a.add(i),i},pointRefs(e){var t=po.get(e);return t||(t=new Set,po.set(e,t)),t},*positions(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{at:r=e.selection,unit:n="offset",reverse:i=!1,voids:a=!1}=t;if(!r)return;var s=p.range(e,r),[o,c]=_.edges(s),u=i?c:o,l=!1,d="",h=0,f=0,v=0;for(var[m,E]of p.nodes(e,{at:r,reverse:i,voids:a})){if(fe.isElement(m)){if(!a&&e.isVoid(m)){yield p.start(e,E);continue}if(e.isInline(m))continue;if(p.hasInlines(e,m)){var w=C.isAncestor(E,c.path)?c:p.end(e,E),g=C.isAncestor(E,o.path)?o:p.start(e,E);d=p.string(e,{anchor:g,focus:w},{voids:a}),l=!0}}if(G.isText(m)){var D=C.equals(E,u.path);for(D?(f=i?u.offset:m.text.length-u.offset,v=u.offset):(f=m.text.length,v=i?f:0),(D||l||n==="offset")&&(yield{path:E,offset:v},l=!1);;){if(h===0){if(d==="")break;h=b(d,n,i),d=us(d,h,i)[1]}if(v=i?v-h:v+h,f=f-h,f<0){h=-f;break}h=0,yield{path:E,offset:v}}}}function b(y,A,x){return A==="character"?os(y,x):A==="word"?ud(y,x):A==="line"||A==="block"?y.length:1}},previous(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{mode:r="lowest",voids:n=!1}=t,{match:i,at:a=e.selection}=t;if(!!a){var s=p.before(e,a,{voids:n});if(!!s){var[,o]=p.first(e,[]),c=[s.path,o];if(C.isPath(a)&&a.length===0)throw new Error("Cannot get the previous node from the root node!");if(i==null)if(C.isPath(a)){var[u]=p.parent(e,a);i=d=>u.children.includes(d)}else i=()=>!0;var[l]=p.nodes(e,{reverse:!0,at:c,match:i,mode:r,voids:n});return l}}},range(e,t,r){if(_.isRange(t)&&!r)return t;var n=p.start(e,t),i=p.end(e,r||t);return{anchor:n,focus:i}},rangeRef(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{affinity:n="forward"}=r,i={current:t,affinity:n,unref(){var{current:s}=i,o=p.rangeRefs(e);return o.delete(i),i.current=null,s}},a=p.rangeRefs(e);return a.add(i),i},rangeRefs(e){var t=vo.get(e);return t||(t=new Set,vo.set(e,t)),t},removeMark(e,t){e.removeMark(t)},setNormalizing(e,t){fo.set(e,t)},start(e,t){return p.point(e,t,{edge:"start"})},string(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{voids:n=!1}=r,i=p.range(e,t),[a,s]=_.edges(i),o="";for(var[c,u]of p.nodes(e,{at:i,match:G.isText,voids:n})){var l=c.text;C.equals(u,s.path)&&(l=l.slice(0,s.offset)),C.equals(u,a.path)&&(l=l.slice(a.offset)),o+=l}return o},unhangRange(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{voids:n=!1}=r,[i,a]=_.edges(t);if(i.offset!==0||a.offset!==0||_.isCollapsed(t))return t;var s=p.above(e,{at:a,match:f=>p.isBlock(e,f)}),o=s?s[1]:[],c=p.start(e,i),u={anchor:c,focus:a},l=!0;for(var[d,h]of p.nodes(e,{at:u,match:G.isText,reverse:!0,voids:n})){if(l){l=!1;continue}if(d.text!==""||C.isBefore(h,o)){a={path:h,offset:d.text.length};break}}return{anchor:i,focus:a}},void(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return p.above(e,mr(mr({},t),{},{match:r=>p.isVoid(e,r)}))},withoutNormalizing(e,t){var r=p.isNormalizing(e);p.setNormalizing(e,!1);try{t()}finally{p.setNormalizing(e,r)}p.normalize(e)}},Fd={isSpan(e){return Array.isArray(e)&&e.length===2&&e.every(C.isPath)}},Od=["children"],xd=["text"],bo=new WeakMap,$={ancestor(e,t){var r=$.get(e,t);if(G.isText(r))throw new Error("Cannot get the ancestor node at path [".concat(t,"] because it refers to a text node instead: ").concat(ke.stringify(r)));return r},*ancestors(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(var n of C.ancestors(t,r)){var i=$.ancestor(e,n),a=[i,n];yield a}},child(e,t){if(G.isText(e))throw new Error("Cannot get the child of a text node: ".concat(ke.stringify(e)));var r=e.children[t];if(r==null)throw new Error("Cannot get child at index `".concat(t,"` in node: ").concat(ke.stringify(e)));return r},*children(e,t){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{reverse:n=!1}=r,i=$.ancestor(e,t),{children:a}=i,s=n?a.length-1:0;n?s>=0:s<a.length;){var o=$.child(i,s),c=t.concat(s);yield[o,c],s=n?s-1:s+1}},common(e,t,r){var n=C.common(t,r),i=$.get(e,n);return[i,n]},descendant(e,t){var r=$.get(e,t);if(p.isEditor(r))throw new Error("Cannot get the descendant node at path [".concat(t,"] because it refers to the root editor node instead: ").concat(ke.stringify(r)));return r},*descendants(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var[r,n]of $.nodes(e,t))n.length!==0&&(yield[r,n])},*elements(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var[r,n]of $.nodes(e,t))fe.isElement(r)&&(yield[r,n])},extractProps(e){if(fe.isAncestor(e)){var t=At(e,Od);return t}else{var t=At(e,xd);return t}},first(e,t){for(var r=t.slice(),n=$.get(e,r);n&&!(G.isText(n)||n.children.length===0);)n=n.children[0],r.push(0);return[n,r]},fragment(e,t){if(G.isText(e))throw new Error("Cannot get a fragment starting from a root text node: ".concat(ke.stringify(e)));var r=Ci({children:e.children},n=>{var[i,a]=_.edges(t),s=$.nodes(n,{reverse:!0,pass:h=>{var[,f]=h;return!_.includes(t,f)}});for(var[,o]of s){if(!_.includes(t,o)){var c=$.parent(n,o),u=o[o.length-1];c.children.splice(u,1)}if(C.equals(o,a.path)){var l=$.leaf(n,o);l.text=l.text.slice(0,a.offset)}if(C.equals(o,i.path)){var d=$.leaf(n,o);d.text=d.text.slice(i.offset)}}p.isEditor(n)&&(n.selection=null)});return r.children},get(e,t){for(var r=e,n=0;n<t.length;n++){var i=t[n];if(G.isText(r)||!r.children[i])throw new Error("Cannot find a descendant at path [".concat(t,"] in node: ").concat(ke.stringify(e)));r=r.children[i]}return r},has(e,t){for(var r=e,n=0;n<t.length;n++){var i=t[n];if(G.isText(r)||!r.children[i])return!1;r=r.children[i]}return!0},isNode(e){return G.isText(e)||fe.isElement(e)||p.isEditor(e)},isNodeList(e){if(!Array.isArray(e))return!1;var t=bo.get(e);if(t!==void 0)return t;var r=e.every(n=>$.isNode(n));return bo.set(e,r),r},last(e,t){for(var r=t.slice(),n=$.get(e,r);n&&!(G.isText(n)||n.children.length===0);){var i=n.children.length-1;n=n.children[i],r.push(i)}return[n,r]},leaf(e,t){var r=$.get(e,t);if(!G.isText(r))throw new Error("Cannot get the leaf node at path [".concat(t,"] because it refers to a non-leaf node: ").concat(ke.stringify(r)));return r},*levels(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(var n of C.levels(t,r)){var i=$.get(e,n);yield[i,n]}},matches(e,t){return fe.isElement(e)&&fe.isElementProps(t)&&fe.matches(e,t)||G.isText(e)&&G.isTextProps(t)&&G.matches(e,t)},*nodes(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{pass:r,reverse:n=!1}=t,{from:i=[],to:a}=t,s=new Set,o=[],c=e;!(a&&(n?C.isBefore(o,a):C.isAfter(o,a)));){if(s.has(c)||(yield[c,o]),!s.has(c)&&!G.isText(c)&&c.children.length!==0&&(r==null||r([c,o])===!1)){s.add(c);var u=n?c.children.length-1:0;C.isAncestor(o,i)&&(u=i[o.length]),o=o.concat(u),c=$.get(e,o);continue}if(o.length===0)break;if(!n){var l=C.next(o);if($.has(e,l)){o=l,c=$.get(e,o);continue}}if(n&&o[o.length-1]!==0){var d=C.previous(o);o=d,c=$.get(e,o);continue}o=C.parent(o),c=$.get(e,o),s.add(c)}},parent(e,t){var r=C.parent(t),n=$.get(e,r);if(G.isText(n))throw new Error("Cannot get the parent of path [".concat(t,"] because it does not exist in the root."));return n},string(e){return G.isText(e)?e.text:e.children.map($.string).join("")},*texts(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var[r,n]of $.nodes(e,t))G.isText(r)&&(yield[r,n])}};function Eo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function ve(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Eo(Object(r),!0).forEach(function(n){gt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Eo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Gr={isNodeOperation(e){return Gr.isOperation(e)&&e.type.endsWith("_node")},isOperation(e){if(!Re(e))return!1;switch(e.type){case"insert_node":return C.isPath(e.path)&&$.isNode(e.node);case"insert_text":return typeof e.offset=="number"&&typeof e.text=="string"&&C.isPath(e.path);case"merge_node":return typeof e.position=="number"&&C.isPath(e.path)&&Re(e.properties);case"move_node":return C.isPath(e.path)&&C.isPath(e.newPath);case"remove_node":return C.isPath(e.path)&&$.isNode(e.node);case"remove_text":return typeof e.offset=="number"&&typeof e.text=="string"&&C.isPath(e.path);case"set_node":return C.isPath(e.path)&&Re(e.properties)&&Re(e.newProperties);case"set_selection":return e.properties===null&&_.isRange(e.newProperties)||e.newProperties===null&&_.isRange(e.properties)||Re(e.properties)&&Re(e.newProperties);case"split_node":return C.isPath(e.path)&&typeof e.position=="number"&&Re(e.properties);default:return!1}},isOperationList(e){return Array.isArray(e)&&e.every(t=>Gr.isOperation(t))},isSelectionOperation(e){return Gr.isOperation(e)&&e.type.endsWith("_selection")},isTextOperation(e){return Gr.isOperation(e)&&e.type.endsWith("_text")},inverse(e){switch(e.type){case"insert_node":return ve(ve({},e),{},{type:"remove_node"});case"insert_text":return ve(ve({},e),{},{type:"remove_text"});case"merge_node":return ve(ve({},e),{},{type:"split_node",path:C.previous(e.path)});case"move_node":{var{newPath:t,path:r}=e;if(C.equals(t,r))return e;if(C.isSibling(r,t))return ve(ve({},e),{},{path:t,newPath:r});var n=C.transform(r,e),i=C.transform(C.next(r),e);return ve(ve({},e),{},{path:n,newPath:i})}case"remove_node":return ve(ve({},e),{},{type:"insert_node"});case"remove_text":return ve(ve({},e),{},{type:"insert_text"});case"set_node":{var{properties:a,newProperties:s}=e;return ve(ve({},e),{},{properties:s,newProperties:a})}case"set_selection":{var{properties:o,newProperties:c}=e;return o==null?ve(ve({},e),{},{properties:c,newProperties:null}):c==null?ve(ve({},e),{},{properties:null,newProperties:o}):ve(ve({},e),{},{properties:c,newProperties:o})}case"split_node":return ve(ve({},e),{},{type:"merge_node",path:C.next(e.path)})}}},C={ancestors(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{reverse:r=!1}=t,n=C.levels(e,t);return r?n=n.slice(1):n=n.slice(0,-1),n},common(e,t){for(var r=[],n=0;n<e.length&&n<t.length;n++){var i=e[n],a=t[n];if(i!==a)break;r.push(i)}return r},compare(e,t){for(var r=Math.min(e.length,t.length),n=0;n<r;n++){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1}return 0},endsAfter(e,t){var r=e.length-1,n=e.slice(0,r),i=t.slice(0,r),a=e[r],s=t[r];return C.equals(n,i)&&a>s},endsAt(e,t){var r=e.length,n=e.slice(0,r),i=t.slice(0,r);return C.equals(n,i)},endsBefore(e,t){var r=e.length-1,n=e.slice(0,r),i=t.slice(0,r),a=e[r],s=t[r];return C.equals(n,i)&&a<s},equals(e,t){return e.length===t.length&&e.every((r,n)=>r===t[n])},hasPrevious(e){return e[e.length-1]>0},isAfter(e,t){return C.compare(e,t)===1},isAncestor(e,t){return e.length<t.length&&C.compare(e,t)===0},isBefore(e,t){return C.compare(e,t)===-1},isChild(e,t){return e.length===t.length+1&&C.compare(e,t)===0},isCommon(e,t){return e.length<=t.length&&C.compare(e,t)===0},isDescendant(e,t){return e.length>t.length&&C.compare(e,t)===0},isParent(e,t){return e.length+1===t.length&&C.compare(e,t)===0},isPath(e){return Array.isArray(e)&&(e.length===0||typeof e[0]=="number")},isSibling(e,t){if(e.length!==t.length)return!1;var r=e.slice(0,-1),n=t.slice(0,-1),i=e[e.length-1],a=t[t.length-1];return i!==a&&C.equals(r,n)},levels(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{reverse:r=!1}=t,n=[],i=0;i<=e.length;i++)n.push(e.slice(0,i));return r&&n.reverse(),n},next(e){if(e.length===0)throw new Error("Cannot get the next path of a root path [".concat(e,"], because it has no next index."));var t=e[e.length-1];return e.slice(0,-1).concat(t+1)},operationCanTransformPath(e){switch(e.type){case"insert_node":case"remove_node":case"merge_node":case"split_node":case"move_node":return!0;default:return!1}},parent(e){if(e.length===0)throw new Error("Cannot get the parent path of the root path [".concat(e,"]."));return e.slice(0,-1)},previous(e){if(e.length===0)throw new Error("Cannot get the previous path of a root path [".concat(e,"], because it has no previous index."));var t=e[e.length-1];if(t<=0)throw new Error("Cannot get the previous path of a first child path [".concat(e,"] because it would result in a negative index."));return e.slice(0,-1).concat(t-1)},relative(e,t){if(!C.isAncestor(t,e)&&!C.equals(e,t))throw new Error("Cannot get the relative path of [".concat(e,"] inside ancestor [").concat(t,"], because it is not above or equal to the path."));return e.slice(t.length)},transform(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Ci(e,n=>{var{affinity:i="forward"}=r;if(!(!e||e?.length===0)){if(n===null)return null;switch(t.type){case"insert_node":{var{path:a}=t;(C.equals(a,n)||C.endsBefore(a,n)||C.isAncestor(a,n))&&(n[a.length-1]+=1);break}case"remove_node":{var{path:s}=t;if(C.equals(s,n)||C.isAncestor(s,n))return null;C.endsBefore(s,n)&&(n[s.length-1]-=1);break}case"merge_node":{var{path:o,position:c}=t;C.equals(o,n)||C.endsBefore(o,n)?n[o.length-1]-=1:C.isAncestor(o,n)&&(n[o.length-1]-=1,n[o.length]+=c);break}case"split_node":{var{path:u,position:l}=t;if(C.equals(u,n)){if(i==="forward")n[n.length-1]+=1;else if(i!=="backward")return null}else C.endsBefore(u,n)?n[u.length-1]+=1:C.isAncestor(u,n)&&e[u.length]>=l&&(n[u.length-1]+=1,n[u.length]-=l);break}case"move_node":{var{path:d,newPath:h}=t;if(C.equals(d,h))return;if(C.isAncestor(d,n)||C.equals(d,n)){var f=h.slice();return C.endsBefore(d,h)&&d.length<h.length&&(f[d.length-1]-=1),f.concat(n.slice(d.length))}else C.isSibling(d,h)&&(C.isAncestor(h,n)||C.equals(h,n))?C.endsBefore(d,n)?n[d.length-1]-=1:n[d.length-1]+=1:C.endsBefore(h,n)||C.equals(h,n)||C.isAncestor(h,n)?(C.endsBefore(d,n)&&(n[d.length-1]-=1),n[h.length-1]+=1):C.endsBefore(d,n)&&(C.equals(h,n)&&(n[h.length-1]+=1),n[d.length-1]-=1);break}}}})}},Pd={transform(e,t){var{current:r,affinity:n}=e;if(r!=null){var i=C.transform(r,t,{affinity:n});e.current=i,i==null&&e.unref()}}};function So(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Bo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?So(Object(r),!0).forEach(function(n){gt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):So(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var se={compare(e,t){var r=C.compare(e.path,t.path);return r===0?e.offset<t.offset?-1:e.offset>t.offset?1:0:r},isAfter(e,t){return se.compare(e,t)===1},isBefore(e,t){return se.compare(e,t)===-1},equals(e,t){return e.offset===t.offset&&C.equals(e.path,t.path)},isPoint(e){return Re(e)&&typeof e.offset=="number"&&C.isPath(e.path)},transform(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Ci(e,n=>{if(n===null)return null;var{affinity:i="forward"}=r,{path:a,offset:s}=n;switch(t.type){case"insert_node":case"move_node":{n.path=C.transform(a,t,r);break}case"insert_text":{C.equals(t.path,a)&&(t.offset<s||t.offset===s&&i==="forward")&&(n.offset+=t.text.length);break}case"merge_node":{C.equals(t.path,a)&&(n.offset+=t.position),n.path=C.transform(a,t,r);break}case"remove_text":{C.equals(t.path,a)&&t.offset<=s&&(n.offset-=Math.min(s-t.offset,t.text.length));break}case"remove_node":{if(C.equals(t.path,a)||C.isAncestor(t.path,a))return null;n.path=C.transform(a,t,r);break}case"split_node":{if(C.equals(t.path,a)){if(t.position===s&&i==null)return null;(t.position<s||t.position===s&&i==="forward")&&(n.offset-=t.position,n.path=C.transform(a,t,Bo(Bo({},r),{},{affinity:"forward"})))}else n.path=C.transform(a,t,r);break}}})}},Rd={transform(e,t){var{current:r,affinity:n}=e;if(r!=null){var i=se.transform(r,t,{affinity:n});e.current=i,i==null&&e.unref()}}},Id=["anchor","focus"];function Ao(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Md(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ao(Object(r),!0).forEach(function(n){gt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ao(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var _={edges(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{reverse:r=!1}=t,{anchor:n,focus:i}=e;return _.isBackward(e)===r?[n,i]:[i,n]},end(e){var[,t]=_.edges(e);return t},equals(e,t){return se.equals(e.anchor,t.anchor)&&se.equals(e.focus,t.focus)},includes(e,t){if(_.isRange(t)){if(_.includes(e,t.anchor)||_.includes(e,t.focus))return!0;var[r,n]=_.edges(e),[i,a]=_.edges(t);return se.isBefore(r,i)&&se.isAfter(n,a)}var[s,o]=_.edges(e),c=!1,u=!1;return se.isPoint(t)?(c=se.compare(t,s)>=0,u=se.compare(t,o)<=0):(c=C.compare(t,s.path)>=0,u=C.compare(t,o.path)<=0),c&&u},intersection(e,t){var r=At(e,Id),[n,i]=_.edges(e),[a,s]=_.edges(t),o=se.isBefore(n,a)?a:n,c=se.isBefore(i,s)?i:s;return se.isBefore(c,o)?null:Md({anchor:o,focus:c},r)},isBackward(e){var{anchor:t,focus:r}=e;return se.isAfter(t,r)},isCollapsed(e){var{anchor:t,focus:r}=e;return se.equals(t,r)},isExpanded(e){return!_.isCollapsed(e)},isForward(e){return!_.isBackward(e)},isRange(e){return Re(e)&&se.isPoint(e.anchor)&&se.isPoint(e.focus)},*points(e){yield[e.anchor,"anchor"],yield[e.focus,"focus"]},start(e){var[t]=_.edges(e);return t},transform(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Ci(e,n=>{if(n===null)return null;var{affinity:i="inward"}=r,a,s;if(i==="inward"){var o=_.isCollapsed(n);_.isForward(n)?(a="forward",s=o?a:"backward"):(a="backward",s=o?a:"forward")}else i==="outward"?_.isForward(n)?(a="backward",s="forward"):(a="forward",s="backward"):(a=i,s=i);var c=se.transform(n.anchor,t,{affinity:a}),u=se.transform(n.focus,t,{affinity:s});if(!c||!u)return null;n.anchor=c,n.focus=u})}},jd={transform(e,t){var{current:r,affinity:n}=e;if(r!=null){var i=_.transform(r,t,{affinity:n});e.current=i,i==null&&e.unref()}}},wo=void 0,ke={setScrubber(e){wo=e},stringify(e){return JSON.stringify(e,wo)}},Qu=(e,t)=>{for(var r in e){var n=e[r],i=t[r];if(Re(n)&&Re(i)){if(!Qu(n,i))return!1}else if(Array.isArray(n)&&Array.isArray(i)){if(n.length!==i.length)return!1;for(var a=0;a<n.length;a++)if(n[a]!==i[a])return!1}else if(n!==i)return!1}for(var s in t)if(e[s]===void 0&&t[s]!==void 0)return!1;return!0},Ld=["text"],Nd=["anchor","focus"];function _o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Ct(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_o(Object(r),!0).forEach(function(n){gt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_o(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var G={equals(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{loose:n=!1}=r;function i(a){var s=At(a,Ld);return s}return Qu(n?i(e):e,n?i(t):t)},isText(e){return Re(e)&&typeof e.text=="string"},isTextList(e){return Array.isArray(e)&&e.every(t=>G.isText(t))},isTextProps(e){return e.text!==void 0},matches(e,t){for(var r in t)if(r!=="text"&&(!e.hasOwnProperty(r)||e[r]!==t[r]))return!1;return!0},decorations(e,t){var r=[Ct({},e)];for(var n of t){var i=At(n,Nd),[a,s]=_.edges(n),o=[],c=0,u=a.offset,l=s.offset;for(var d of r){var{length:h}=d.text,f=c;if(c+=h,u<=f&&c<=l){Object.assign(d,i),o.push(d);continue}if(u!==l&&(u===c||l===f)||u>c||l<f||l===f&&f!==0){o.push(d);continue}var v=d,m=void 0,E=void 0;if(l<c){var w=l-f;E=Ct(Ct({},v),{},{text:v.text.slice(w)}),v=Ct(Ct({},v),{},{text:v.text.slice(0,w)})}if(u>f){var g=u-f;m=Ct(Ct({},v),{},{text:v.text.slice(0,g)}),v=Ct(Ct({},v),{},{text:v.text.slice(g)})}Object.assign(v,i),m&&o.push(m),o.push(v),E&&o.push(E)}r=o}return r}};function ko(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Nr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ko(Object(r),!0).forEach(function(n){gt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ko(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Ud=(e,t,r)=>{switch(r.type){case"insert_node":{var{path:n,node:i}=r,a=$.parent(e,n),s=n[n.length-1];if(s>a.children.length)throw new Error('Cannot apply an "insert_node" operation at path ['.concat(n,"] because the destination is past the end of the node."));if(a.children.splice(s,0,i),t)for(var[o,c]of _.points(t))t[c]=se.transform(o,r);break}case"insert_text":{var{path:u,offset:l,text:d}=r;if(d.length===0)break;var h=$.leaf(e,u),f=h.text.slice(0,l),v=h.text.slice(l);if(h.text=f+d+v,t)for(var[m,E]of _.points(t))t[E]=se.transform(m,r);break}case"merge_node":{var{path:w}=r,g=$.get(e,w),D=C.previous(w),b=$.get(e,D),y=$.parent(e,w),A=w[w.length-1];if(G.isText(g)&&G.isText(b))b.text+=g.text;else if(!G.isText(g)&&!G.isText(b))b.children.push(...g.children);else throw new Error('Cannot apply a "merge_node" operation at path ['.concat(w,"] to nodes of different interfaces: ").concat(ke.stringify(g)," ").concat(ke.stringify(b)));if(y.children.splice(A,1),t)for(var[x,B]of _.points(t))t[B]=se.transform(x,r);break}case"move_node":{var{path:j,newPath:H}=r;if(C.isAncestor(j,H))throw new Error("Cannot move a path [".concat(j,"] to new path [").concat(H,"] because the destination is inside itself."));var M=$.get(e,j),F=$.parent(e,j),V=j[j.length-1];F.children.splice(V,1);var W=C.transform(j,r),k=$.get(e,C.parent(W)),Y=W[W.length-1];if(k.children.splice(Y,0,M),t)for(var[S,T]of _.points(t))t[T]=se.transform(S,r);break}case"remove_node":{var{path:P}=r,I=P[P.length-1],J=$.parent(e,P);if(J.children.splice(I,1),t)for(var[ee,X]of _.points(t)){var Z=se.transform(ee,r);if(t!=null&&Z!=null)t[X]=Z;else{var re=void 0,oe=void 0;for(var[ue,z]of $.texts(e))if(C.compare(z,P)===-1)re=[ue,z];else{oe=[ue,z];break}var O=!1;re&&oe&&(C.equals(oe[1],P)?O=!C.hasPrevious(oe[1]):O=C.common(re[1],P).length<C.common(oe[1],P).length),re&&!O?(ee.path=re[1],ee.offset=re[0].text.length):oe?(ee.path=oe[1],ee.offset=0):t=null}}break}case"remove_text":{var{path:L,offset:q,text:ae}=r;if(ae.length===0)break;var Q=$.leaf(e,L),de=Q.text.slice(0,q),De=Q.text.slice(q+ae.length);if(Q.text=de+De,t)for(var[Ae,He]of _.points(t))t[He]=se.transform(Ae,r);break}case"set_node":{var{path:qt,properties:Ee,newProperties:Ft}=r;if(qt.length===0)throw new Error("Cannot set properties on the root node!");var Mr=$.get(e,qt);for(var pr in Ft){if(pr==="children"||pr==="text")throw new Error('Cannot set the "'.concat(pr,'" property of nodes!'));var qs=Ft[pr];qs==null?delete Mr[pr]:Mr[pr]=qs}for(var Hs in Ee)Ft.hasOwnProperty(Hs)||delete Mr[Hs];break}case"set_selection":{var{newProperties:Ht}=r;if(Ht==null)t=Ht;else{if(t==null){if(!_.isRange(Ht))throw new Error('Cannot apply an incomplete "set_selection" operation properties '.concat(ke.stringify(Ht)," when there is no current selection."));t=Nr({},Ht)}for(var vr in Ht){var Ks=Ht[vr];if(Ks==null){if(vr==="anchor"||vr==="focus")throw new Error('Cannot remove the "'.concat(vr,'" selection property'));delete t[vr]}else t[vr]=Ks}}break}case"split_node":{var{path:gr,position:An,properties:Ys}=r;if(gr.length===0)throw new Error('Cannot apply a "split_node" operation at path ['.concat(gr,"] because the root node cannot be split."));var Kt=$.get(e,gr),Sf=$.parent(e,gr),Bf=gr[gr.length-1],Ni;if(G.isText(Kt)){var Af=Kt.text.slice(0,An),wf=Kt.text.slice(An);Kt.text=Af,Ni=Nr(Nr({},Ys),{},{text:wf})}else{var _f=Kt.children.slice(0,An),kf=Kt.children.slice(An);Kt.children=_f,Ni=Nr(Nr({},Ys),{},{children:kf})}if(Sf.children.splice(Bf+1,0,Ni),t)for(var[Tf,Ff]of _.points(t))t[Ff]=se.transform(Tf,r);break}}return t},zd={transform(e,t){e.children=co(e.children);var r=e.selection&&co(e.selection);try{r=Ud(e,r,t)}finally{e.children=lo(e.children),r?e.selection=sr(r)?lo(r):r:e.selection=null}}},$d=["text"],Wd=["children"];function To(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Fo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?To(Object(r),!0).forEach(function(n){gt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):To(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Vd={insertNodes(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};p.withoutNormalizing(e,()=>{var{hanging:n=!1,voids:i=!1,mode:a="lowest"}=r,{at:s,match:o,select:c}=r;if($.isNode(t)&&(t=[t]),t.length!==0){var[u]=t;if(s||(e.selection?s=e.selection:e.children.length>0?s=p.end(e,[]):s=[0],c=!0),c==null&&(c=!1),_.isRange(s))if(n||(s=p.unhangRange(e,s)),_.isCollapsed(s))s=s.anchor;else{var[,l]=_.edges(s),d=p.pointRef(e,l);N.delete(e,{at:s}),s=d.unref()}if(se.isPoint(s)){o==null&&(G.isText(u)?o=A=>G.isText(A):e.isInline(u)?o=A=>G.isText(A)||p.isInline(e,A):o=A=>p.isBlock(e,A));var[h]=p.nodes(e,{at:s.path,match:o,mode:a,voids:i});if(h){var[,f]=h,v=p.pathRef(e,f),m=p.isEnd(e,s,f);N.splitNodes(e,{at:s,match:o,mode:a,voids:i});var E=v.unref();s=m?C.next(E):E}else return}var w=C.parent(s),g=s[s.length-1];if(!(!i&&p.void(e,{at:w}))){for(var D of t){var b=w.concat(g);g++,e.apply({type:"insert_node",path:b,node:D}),s=C.next(s)}if(s=C.previous(s),c){var y=p.end(e,s);y&&N.select(e,y)}}}})},liftNodes(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};p.withoutNormalizing(e,()=>{var{at:r=e.selection,mode:n="lowest",voids:i=!1}=t,{match:a}=t;if(a==null&&(a=C.isPath(r)?Dr(e,r):D=>p.isBlock(e,D)),!!r){var s=p.nodes(e,{at:r,match:a,mode:n,voids:i}),o=Array.from(s,D=>{var[,b]=D;return p.pathRef(e,b)});for(var c of o){var u=c.unref();if(u.length<2)throw new Error("Cannot lift node at a path [".concat(u,"] because it has a depth of less than `2`."));var l=p.node(e,C.parent(u)),[d,h]=l,f=u[u.length-1],{length:v}=d.children;if(v===1){var m=C.next(h);N.moveNodes(e,{at:u,to:m,voids:i}),N.removeNodes(e,{at:h,voids:i})}else if(f===0)N.moveNodes(e,{at:u,to:h,voids:i});else if(f===v-1){var E=C.next(h);N.moveNodes(e,{at:u,to:E,voids:i})}else{var w=C.next(u),g=C.next(h);N.splitNodes(e,{at:w,voids:i}),N.moveNodes(e,{at:u,to:g,voids:i})}}}})},mergeNodes(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};p.withoutNormalizing(e,()=>{var{match:r,at:n=e.selection}=t,{hanging:i=!1,voids:a=!1,mode:s="lowest"}=t;if(!!n){if(r==null)if(C.isPath(n)){var[o]=p.parent(e,n);r=j=>o.children.includes(j)}else r=j=>p.isBlock(e,j);if(!i&&_.isRange(n)&&(n=p.unhangRange(e,n)),_.isRange(n))if(_.isCollapsed(n))n=n.anchor;else{var[,c]=_.edges(n),u=p.pointRef(e,c);N.delete(e,{at:n}),n=u.unref(),t.at==null&&N.select(e,n)}var[l]=p.nodes(e,{at:n,match:r,voids:a,mode:s}),d=p.previous(e,{at:n,match:r,voids:a,mode:s});if(!(!l||!d)){var[h,f]=l,[v,m]=d;if(!(f.length===0||m.length===0)){var E=C.next(m),w=C.common(f,m),g=C.isSibling(f,m),D=Array.from(p.levels(e,{at:f}),j=>{var[H]=j;return H}).slice(w.length).slice(0,-1),b=p.above(e,{at:f,mode:"highest",match:j=>D.includes(j)&&ec(e,j)}),y=b&&p.pathRef(e,b[1]),A,x;if(G.isText(h)&&G.isText(v)){var B=At(h,$d);x=v.text.length,A=B}else if(fe.isElement(h)&&fe.isElement(v)){var B=At(h,Wd);x=v.children.length,A=B}else throw new Error("Cannot merge the node at path [".concat(f,"] with the previous sibling because it is not the same kind: ").concat(ke.stringify(h)," ").concat(ke.stringify(v)));g||N.moveNodes(e,{at:f,to:E,voids:a}),y&&N.removeNodes(e,{at:y.current,voids:a}),fe.isElement(v)&&p.isEmpty(e,v)||G.isText(v)&&v.text===""&&m[m.length-1]!==0?N.removeNodes(e,{at:m,voids:a}):e.apply({type:"merge_node",path:E,position:x,properties:A}),y&&y.unref()}}}})},moveNodes(e,t){p.withoutNormalizing(e,()=>{var{to:r,at:n=e.selection,mode:i="lowest",voids:a=!1}=t,{match:s}=t;if(!!n){s==null&&(s=C.isPath(n)?Dr(e,n):f=>p.isBlock(e,f));var o=p.pathRef(e,r),c=p.nodes(e,{at:n,match:s,mode:i,voids:a}),u=Array.from(c,f=>{var[,v]=f;return p.pathRef(e,v)});for(var l of u){var d=l.unref(),h=o.current;d.length!==0&&e.apply({type:"move_node",path:d,newPath:h}),o.current&&C.isSibling(h,d)&&C.isAfter(h,d)&&(o.current=C.next(o.current))}o.unref()}})},removeNodes(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};p.withoutNormalizing(e,()=>{var{hanging:r=!1,voids:n=!1,mode:i="lowest"}=t,{at:a=e.selection,match:s}=t;if(!!a){s==null&&(s=C.isPath(a)?Dr(e,a):h=>p.isBlock(e,h)),!r&&_.isRange(a)&&(a=p.unhangRange(e,a));var o=p.nodes(e,{at:a,match:s,mode:i,voids:n}),c=Array.from(o,h=>{var[,f]=h;return p.pathRef(e,f)});for(var u of c){var l=u.unref();if(l){var[d]=p.node(e,l);e.apply({type:"remove_node",path:l,node:d})}}}})},setNodes(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};p.withoutNormalizing(e,()=>{var{match:n,at:i=e.selection,compare:a,merge:s}=r,{hanging:o=!1,mode:c="lowest",split:u=!1,voids:l=!1}=r;if(!!i){if(n==null&&(n=C.isPath(i)?Dr(e,i):x=>p.isBlock(e,x)),!o&&_.isRange(i)&&(i=p.unhangRange(e,i)),u&&_.isRange(i)){if(_.isCollapsed(i)&&p.leaf(e,i.anchor)[0].text.length>0)return;var d=p.rangeRef(e,i,{affinity:"inward"}),[h,f]=_.edges(i),v=c==="lowest"?"lowest":"highest",m=p.isEnd(e,f,f.path);N.splitNodes(e,{at:f,match:n,mode:v,voids:l,always:!m});var E=p.isStart(e,h,h.path);N.splitNodes(e,{at:h,match:n,mode:v,voids:l,always:!E}),i=d.unref(),r.at==null&&N.select(e,i)}a||(a=(x,B)=>x!==B);for(var[w,g]of p.nodes(e,{at:i,match:n,mode:c,voids:l})){var D={},b={};if(g.length!==0){var y=!1;for(var A in t)A==="children"||A==="text"||a(t[A],w[A])&&(y=!0,w.hasOwnProperty(A)&&(D[A]=w[A]),s?t[A]!=null&&(b[A]=s(w[A],t[A])):t[A]!=null&&(b[A]=t[A]));y&&e.apply({type:"set_node",path:g,properties:D,newProperties:b})}}}})},splitNodes(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};p.withoutNormalizing(e,()=>{var{mode:r="lowest",voids:n=!1}=t,{match:i,at:a=e.selection,height:s=0,always:o=!1}=t;if(i==null&&(i=T=>p.isBlock(e,T)),_.isRange(a)&&(a=Gd(e,a)),C.isPath(a)){var c=a,u=p.point(e,c),[l]=p.parent(e,c);i=T=>T===l,s=u.path.length-c.length+1,a=u,o=!0}if(!!a){var d=p.pointRef(e,a,{affinity:"backward"}),h;try{var[f]=p.nodes(e,{at:a,match:i,mode:r,voids:n});if(!f)return;var v=p.void(e,{at:a,mode:"highest"}),m=0;if(!n&&v){var[E,w]=v;if(fe.isElement(E)&&e.isInline(E)){var g=p.after(e,w);if(!g){var D={text:""},b=C.next(w);N.insertNodes(e,D,{at:b,voids:n}),g=p.point(e,b)}a=g,o=!0}var y=a.path.length-w.length;s=y+1,o=!0}h=p.pointRef(e,a);var A=a.path.length-s,[,x]=f,B=a.path.slice(0,A),j=s===0?a.offset:a.path[A]+m;for(var[H,M]of p.levels(e,{at:B,reverse:!0,voids:n})){var F=!1;if(M.length<x.length||M.length===0||!n&&p.isVoid(e,H))break;var V=d.current,W=p.isEnd(e,V,M);if(o||!d||!p.isEdge(e,V,M)){F=!0;var k=$.extractProps(H);e.apply({type:"split_node",path:M,position:j,properties:k})}j=M[M.length-1]+(F||W?1:0)}if(t.at==null){var Y=h.current||p.end(e,[]);N.select(e,Y)}}finally{var S;d.unref(),(S=h)===null||S===void 0||S.unref()}}})},unsetNodes(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Array.isArray(t)||(t=[t]);var n={};for(var i of t)n[i]=null;N.setNodes(e,n,r)},unwrapNodes(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};p.withoutNormalizing(e,()=>{var{mode:r="lowest",split:n=!1,voids:i=!1}=t,{at:a=e.selection,match:s}=t;if(!!a){s==null&&(s=C.isPath(a)?Dr(e,a):h=>p.isBlock(e,h)),C.isPath(a)&&(a=p.range(e,a));var o=_.isRange(a)?p.rangeRef(e,a):null,c=p.nodes(e,{at:a,match:s,mode:r,voids:i}),u=Array.from(c,h=>{var[,f]=h;return p.pathRef(e,f)}).reverse(),l=function(f){var v=f.unref(),[m]=p.node(e,v),E=p.range(e,v);n&&o&&(E=_.intersection(o.current,E)),N.liftNodes(e,{at:E,match:w=>fe.isAncestor(m)&&m.children.includes(w),voids:i})};for(var d of u)l(d);o&&o.unref()}})},wrapNodes(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};p.withoutNormalizing(e,()=>{var{mode:n="lowest",split:i=!1,voids:a=!1}=r,{match:s,at:o=e.selection}=r;if(!!o){if(s==null&&(C.isPath(o)?s=Dr(e,o):e.isInline(t)?s=E=>p.isInline(e,E)||G.isText(E):s=E=>p.isBlock(e,E)),i&&_.isRange(o)){var[c,u]=_.edges(o),l=p.rangeRef(e,o,{affinity:"inward"});N.splitNodes(e,{at:u,match:s,voids:a}),N.splitNodes(e,{at:c,match:s,voids:a}),o=l.unref(),r.at==null&&N.select(e,o)}var d=Array.from(p.nodes(e,{at:o,match:e.isInline(t)?E=>p.isBlock(e,E):E=>p.isEditor(E),mode:"lowest",voids:a}));for(var[,h]of d){var f=_.isRange(o)?_.intersection(o,p.range(e,h)):o;if(!!f){var v=Array.from(p.nodes(e,{at:f,match:s,mode:n,voids:a}));if(v.length>0){var m=function(){var[E]=v,w=v[v.length-1],[,g]=E,[,D]=w;if(g.length===0&&D.length===0)return"continue";var b=C.equals(g,D)?C.parent(g):C.common(g,D),y=p.range(e,g,D),A=p.node(e,b),[x]=A,B=b.length+1,j=C.next(D.slice(0,B)),H=Fo(Fo({},t),{},{children:[]});N.insertNodes(e,H,{at:j,voids:a}),N.moveNodes(e,{at:y,match:M=>fe.isAncestor(x)&&x.children.includes(M),to:j.concat(0),voids:a})}();if(m==="continue")continue}}}}})}},ec=(e,t)=>{if(fe.isElement(t)){var r=t;return p.isVoid(e,t)?!0:r.children.length===1?ec(e,r.children[0]):!1}else return!p.isEditor(t)},Gd=(e,t)=>{if(_.isCollapsed(t))return t.anchor;var[,r]=_.edges(t),n=p.pointRef(e,r);return N.delete(e,{at:t}),n.unref()},Dr=(e,t)=>{var[r]=p.node(e,t);return n=>n===r};function Oo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function xo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Oo(Object(r),!0).forEach(function(n){gt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Oo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var qd={collapse(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{edge:r="anchor"}=t,{selection:n}=e;if(n){if(r==="anchor")N.select(e,n.anchor);else if(r==="focus")N.select(e,n.focus);else if(r==="start"){var[i]=_.edges(n);N.select(e,i)}else if(r==="end"){var[,a]=_.edges(n);N.select(e,a)}}else return},deselect(e){var{selection:t}=e;t&&e.apply({type:"set_selection",properties:t,newProperties:null})},move(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{selection:r}=e,{distance:n=1,unit:i="character",reverse:a=!1}=t,{edge:s=null}=t;if(!!r){s==="start"&&(s=_.isBackward(r)?"focus":"anchor"),s==="end"&&(s=_.isBackward(r)?"anchor":"focus");var{anchor:o,focus:c}=r,u={distance:n,unit:i},l={};if(s==null||s==="anchor"){var d=a?p.before(e,o,u):p.after(e,o,u);d&&(l.anchor=d)}if(s==null||s==="focus"){var h=a?p.before(e,c,u):p.after(e,c,u);h&&(l.focus=h)}N.setSelection(e,l)}},select(e,t){var{selection:r}=e;if(t=p.range(e,t),r){N.setSelection(e,t);return}if(!_.isRange(t))throw new Error("When setting the selection and the current selection is `null` you must provide at least an `anchor` and `focus`, but you passed: ".concat(ke.stringify(t)));e.apply({type:"set_selection",properties:r,newProperties:t})},setPoint(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{selection:n}=e,{edge:i="both"}=r;if(!!n){i==="start"&&(i=_.isBackward(n)?"focus":"anchor"),i==="end"&&(i=_.isBackward(n)?"anchor":"focus");var{anchor:a,focus:s}=n,o=i==="anchor"?a:s;N.setSelection(e,{[i==="anchor"?"anchor":"focus"]:xo(xo({},o),t)})}},setSelection(e,t){var{selection:r}=e,n={},i={};if(!!r){for(var a in t)(a==="anchor"&&t.anchor!=null&&!se.equals(t.anchor,r.anchor)||a==="focus"&&t.focus!=null&&!se.equals(t.focus,r.focus)||a!=="anchor"&&a!=="focus"&&t[a]!==r[a])&&(n[a]=r[a],i[a]=t[a]);Object.keys(n).length>0&&e.apply({type:"set_selection",properties:n,newProperties:i})}}},Hd={delete(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};p.withoutNormalizing(e,()=>{var{reverse:r=!1,unit:n="character",distance:i=1,voids:a=!1}=t,{at:s=e.selection,hanging:o=!1}=t;if(!!s){var c=!1;if(_.isRange(s)&&_.isCollapsed(s)&&(c=!0,s=s.anchor),se.isPoint(s)){var u=p.void(e,{at:s,mode:"highest"});if(!a&&u){var[,l]=u;s=l}else{var d={unit:n,distance:i},h=r?p.before(e,s,d)||p.start(e,[]):p.after(e,s,d)||p.end(e,[]);s={anchor:s,focus:h},o=!0}}if(C.isPath(s)){N.removeNodes(e,{at:s,voids:a});return}if(!_.isCollapsed(s)){if(!o){var[,f]=_.edges(s),v=p.end(e,[]);se.equals(f,v)||(s=p.unhangRange(e,s,{voids:a}))}var[m,E]=_.edges(s),w=p.above(e,{match:Q=>p.isBlock(e,Q),at:m,voids:a}),g=p.above(e,{match:Q=>p.isBlock(e,Q),at:E,voids:a}),D=w&&g&&!C.equals(w[1],g[1]),b=C.equals(m.path,E.path),y=a?null:p.void(e,{at:m,mode:"highest"}),A=a?null:p.void(e,{at:E,mode:"highest"});if(y){var x=p.before(e,m);x&&w&&C.isAncestor(w[1],x.path)&&(m=x)}if(A){var B=p.after(e,E);B&&g&&C.isAncestor(g[1],B.path)&&(E=B)}var j=[],H;for(var M of p.nodes(e,{at:s,voids:a})){var[F,V]=M;H&&C.compare(V,H)===0||(!a&&p.isVoid(e,F)||!C.isCommon(V,m.path)&&!C.isCommon(V,E.path))&&(j.push(M),H=V)}var W=Array.from(j,Q=>{var[,de]=Q;return p.pathRef(e,de)}),k=p.pointRef(e,m),Y=p.pointRef(e,E),S="";if(!b&&!y){var T=k.current,[P]=p.leaf(e,T),{path:I}=T,{offset:J}=m,ee=P.text.slice(J);ee.length>0&&(e.apply({type:"remove_text",path:I,offset:J,text:ee}),S=ee)}for(var X of W){var Z=X.unref();N.removeNodes(e,{at:Z,voids:a})}if(!A){var re=Y.current,[oe]=p.leaf(e,re),{path:ue}=re,z=b?m.offset:0,O=oe.text.slice(z,E.offset);O.length>0&&(e.apply({type:"remove_text",path:ue,offset:z,text:O}),S=O)}!b&&D&&Y.current&&k.current&&N.mergeNodes(e,{at:Y.current,hanging:!0,voids:a}),c&&r&&n==="character"&&S.length>1&&S.match(/[\u0E00-\u0E7F]+/)&&N.insertText(e,S.slice(0,S.length-i));var L=k.unref(),q=Y.unref(),ae=r?L||q:q||L;t.at==null&&ae&&N.select(e,ae)}}})},insertFragment(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};p.withoutNormalizing(e,()=>{var{hanging:n=!1,voids:i=!1}=r,{at:a=e.selection}=r;if(!!t.length){if(a)if(_.isRange(a))if(n||(a=p.unhangRange(e,a)),_.isCollapsed(a))a=a.anchor;else{var[,s]=_.edges(a);if(!i&&p.void(e,{at:s}))return;var o=p.pointRef(e,s);N.delete(e,{at:a}),a=o.unref()}else C.isPath(a)&&(a=p.start(e,a));else return;if(!(!i&&p.void(e,{at:a}))){var c=p.above(e,{at:a,match:X=>p.isInline(e,X),mode:"highest",voids:i});if(c){var[,u]=c;if(p.isEnd(e,a,u)){var l=p.after(e,u);a=l}else if(p.isStart(e,a,u)){var d=p.before(e,u);a=d}}var h=p.above(e,{match:X=>p.isBlock(e,X),at:a,voids:i}),[,f]=h,v=p.isStart(e,a,f),m=p.isEnd(e,a,f),E=v&&m,w=!v||v&&m,g=!m,[,D]=$.first({children:t},[]),[,b]=$.last({children:t},[]),y=[],A=X=>{var[Z,re]=X,oe=re.length===0;return oe?!1:E?!0:!(w&&C.isAncestor(re,D)&&fe.isElement(Z)&&!e.isVoid(Z)&&!e.isInline(Z)||g&&C.isAncestor(re,b)&&fe.isElement(Z)&&!e.isVoid(Z)&&!e.isInline(Z))};for(var x of $.nodes({children:t},{pass:A}))A(x)&&y.push(x);var B=[],j=[],H=[],M=!0,F=!1;for(var[V]of y)fe.isElement(V)&&!e.isInline(V)?(M=!1,F=!0,j.push(V)):M?B.push(V):H.push(V);var[W]=p.nodes(e,{at:a,match:X=>G.isText(X)||p.isInline(e,X),mode:"highest",voids:i}),[,k]=W,Y=p.isStart(e,a,k),S=p.isEnd(e,a,k),T=p.pathRef(e,m&&!H.length?C.next(f):f),P=p.pathRef(e,S?C.next(k):k);N.splitNodes(e,{at:a,match:X=>F?p.isBlock(e,X):G.isText(X)||p.isInline(e,X),mode:F?"lowest":"highest",always:F&&(!v||B.length>0)&&(!m||H.length>0),voids:i});var I=p.pathRef(e,!Y||Y&&S?C.next(k):k);if(N.insertNodes(e,B,{at:I.current,match:X=>G.isText(X)||p.isInline(e,X),mode:"highest",voids:i}),E&&!B.length&&j.length&&!H.length&&N.delete(e,{at:f,voids:i}),N.insertNodes(e,j,{at:T.current,match:X=>p.isBlock(e,X),mode:"lowest",voids:i}),N.insertNodes(e,H,{at:P.current,match:X=>G.isText(X)||p.isInline(e,X),mode:"highest",voids:i}),!r.at){var J;if(H.length>0&&P.current?J=C.previous(P.current):j.length>0&&T.current?J=C.previous(T.current):I.current&&(J=C.previous(I.current)),J){var ee=p.end(e,J);N.select(e,ee)}}I.unref(),T.unref(),P.unref()}}})},insertText(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};p.withoutNormalizing(e,()=>{var{voids:n=!1}=r,{at:i=e.selection}=r;if(!!i){if(C.isPath(i)&&(i=p.range(e,i)),_.isRange(i))if(_.isCollapsed(i))i=i.anchor;else{var a=_.end(i);if(!n&&p.void(e,{at:a}))return;var s=_.start(i),o=p.pointRef(e,s),c=p.pointRef(e,a);N.delete(e,{at:i,voids:n});var u=o.unref(),l=c.unref();i=u||l,N.setSelection(e,{anchor:i,focus:i})}if(!(!n&&p.void(e,{at:i}))){var{path:d,offset:h}=i;t.length>0&&e.apply({type:"insert_text",path:d,offset:h,text:t})}}})}};function Po(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Tn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Po(Object(r),!0).forEach(function(n){gt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Po(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var N=Tn(Tn(Tn(Tn({},zd),Vd),qd),Hd);/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Kd=me({"node_modules/direction/index.js"(e,t){t.exports=s;var r="\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC",n="A-Za-z\xC0-\xD6\xD8-\xF6\xF8-\u02B8\u0300-\u0590\u0800-\u1FFF\u200E\u2C00-\uFB1C\uFE00-\uFE6F\uFEFD-\uFFFF",i=new RegExp("^[^"+n+"]*["+r+"]"),a=new RegExp("^[^"+r+"]*["+n+"]");function s(o){return o=String(o||""),i.test(o)?"rtl":a.test(o)?"ltr":"neutral"}}}),cs=me({"node_modules/lodash/isObject.js"(e,t){function r(n){var i=typeof n;return n!=null&&(i=="object"||i=="function")}t.exports=r}}),Yd=me({"node_modules/lodash/_freeGlobal.js"(e,t){var r=typeof global=="object"&&global&&global.Object===Object&&global;t.exports=r}}),tc=me({"node_modules/lodash/_root.js"(e,t){var r=Yd(),n=typeof self=="object"&&self&&self.Object===Object&&self,i=r||n||Function("return this")();t.exports=i}}),Jd=me({"node_modules/lodash/now.js"(e,t){var r=tc(),n=function(){return r.Date.now()};t.exports=n}}),Xd=me({"node_modules/lodash/_trimmedEndIndex.js"(e,t){var r=/\s/;function n(i){for(var a=i.length;a--&&r.test(i.charAt(a)););return a}t.exports=n}}),Zd=me({"node_modules/lodash/_baseTrim.js"(e,t){var r=Xd(),n=/^\s+/;function i(a){return a&&a.slice(0,r(a)+1).replace(n,"")}t.exports=i}}),rc=me({"node_modules/lodash/_Symbol.js"(e,t){var r=tc(),n=r.Symbol;t.exports=n}}),Qd=me({"node_modules/lodash/_getRawTag.js"(e,t){var r=rc(),n=Object.prototype,i=n.hasOwnProperty,a=n.toString,s=r?r.toStringTag:void 0;function o(c){var u=i.call(c,s),l=c[s];try{c[s]=void 0;var d=!0}catch{}var h=a.call(c);return d&&(u?c[s]=l:delete c[s]),h}t.exports=o}}),eh=me({"node_modules/lodash/_objectToString.js"(e,t){var r=Object.prototype,n=r.toString;function i(a){return n.call(a)}t.exports=i}}),th=me({"node_modules/lodash/_baseGetTag.js"(e,t){var r=rc(),n=Qd(),i=eh(),a="[object Null]",s="[object Undefined]",o=r?r.toStringTag:void 0;function c(u){return u==null?u===void 0?s:a:o&&o in Object(u)?n(u):i(u)}t.exports=c}}),rh=me({"node_modules/lodash/isObjectLike.js"(e,t){function r(n){return n!=null&&typeof n=="object"}t.exports=r}}),nh=me({"node_modules/lodash/isSymbol.js"(e,t){var r=th(),n=rh(),i="[object Symbol]";function a(s){return typeof s=="symbol"||n(s)&&r(s)==i}t.exports=a}}),ih=me({"node_modules/lodash/toNumber.js"(e,t){var r=Zd(),n=cs(),i=nh(),a=0/0,s=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt;function l(d){if(typeof d=="number")return d;if(i(d))return a;if(n(d)){var h=typeof d.valueOf=="function"?d.valueOf():d;d=n(h)?h+"":h}if(typeof d!="string")return d===0?d:+d;d=r(d);var f=o.test(d);return f||c.test(d)?u(d.slice(2),f?2:8):s.test(d)?a:+d}t.exports=l}}),nc=me({"node_modules/lodash/debounce.js"(e,t){var r=cs(),n=Jd(),i=ih(),a="Expected a function",s=Math.max,o=Math.min;function c(u,l,d){var h,f,v,m,E,w,g=0,D=!1,b=!1,y=!0;if(typeof u!="function")throw new TypeError(a);l=i(l)||0,r(d)&&(D=!!d.leading,b="maxWait"in d,v=b?s(i(d.maxWait)||0,l):v,y="trailing"in d?!!d.trailing:y);function A(k){var Y=h,S=f;return h=f=void 0,g=k,m=u.apply(S,Y),m}function x(k){return g=k,E=setTimeout(H,l),D?A(k):m}function B(k){var Y=k-w,S=k-g,T=l-Y;return b?o(T,v-S):T}function j(k){var Y=k-w,S=k-g;return w===void 0||Y>=l||Y<0||b&&S>=v}function H(){var k=n();if(j(k))return M(k);E=setTimeout(H,B(k))}function M(k){return E=void 0,y&&h?A(k):(h=f=void 0,m)}function F(){E!==void 0&&clearTimeout(E),g=0,h=w=f=E=void 0}function V(){return E===void 0?m:M(n())}function W(){var k=n(),Y=j(k);if(h=arguments,f=this,w=k,Y){if(E===void 0)return x(w);if(b)return clearTimeout(E),E=setTimeout(H,l),A(w)}return E===void 0&&(E=setTimeout(H,l)),m}return W.cancel=F,W.flush=V,W}t.exports=c}}),ah=me({"node_modules/lodash/throttle.js"(e,t){var r=nc(),n=cs(),i="Expected a function";function a(s,o,c){var u=!0,l=!0;if(typeof s!="function")throw new TypeError(i);return n(c)&&(u="leading"in c?!!c.leading:u,l="trailing"in c?!!c.trailing:l),r(s,o,{leading:u,maxWait:o,trailing:l})}t.exports=a}}),sh=me({"node_modules/is-hotkey/lib/index.js"(e){Object.defineProperty(e,"__esModule",{value:!0});var t=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),r={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},n={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:t?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},i={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222};for(a=1;a<20;a++)i["f"+a]=111+a;var a;function s(f,v,m){v&&!("byKey"in v)&&(m=v,v=null),Array.isArray(f)||(f=[f]);var E=f.map(function(D){return u(D,v)}),w=function(b){return E.some(function(y){return l(y,b)})},g=m==null?w:w(m);return g}function o(f,v){return s(f,v)}function c(f,v){return s(f,{byKey:!0},v)}function u(f,v){var m=v&&v.byKey,E={};f=f.replace("++","+add");var w=f.split("+"),g=w.length;for(var D in r)E[r[D]]=!1;var b=!0,y=!1,A=void 0;try{for(var x=w[Symbol.iterator](),B;!(b=(B=x.next()).done);b=!0){var j=B.value,H=j.endsWith("?")&&j.length>1;H&&(j=j.slice(0,-1));var M=h(j),F=r[M];(g===1||!F)&&(m?E.key=M:E.which=d(j)),F&&(E[F]=H?null:!0)}}catch(V){y=!0,A=V}finally{try{!b&&x.return&&x.return()}finally{if(y)throw A}}return E}function l(f,v){for(var m in f){var E=f[m],w=void 0;if(E!=null&&(m==="key"&&v.key!=null?w=v.key.toLowerCase():m==="which"?w=E===91&&v.which===93?91:v.which:w=v[m],!(w==null&&E===!1)&&w!==E))return!1}return!0}function d(f){f=h(f);var v=i[f]||f.toUpperCase().charCodeAt(0);return v}function h(f){return f=f.toLowerCase(),f=n[f]||f,f}e.default=s,e.isHotkey=s,e.isCodeHotkey=o,e.isKeyHotkey=c,e.parseHotkey=u,e.compareHotkey=l,e.toKeyCode=d,e.toKeyName=h}}),ic=lt(Kd()),oh=lt(nc()),uh=lt(ah()),R=lt(Yu());function Ro(e){return typeof e=="object"&&e!=null&&e.nodeType===1}function Io(e,t){return(!t||e!=="hidden")&&e!=="visible"&&e!=="clip"}function qi(e,t){if(e.clientHeight<e.scrollHeight||e.clientWidth<e.scrollWidth){var r=getComputedStyle(e,null);return Io(r.overflowY,t)||Io(r.overflowX,t)||function(n){var i=function(a){if(!a.ownerDocument||!a.ownerDocument.defaultView)return null;try{return a.ownerDocument.defaultView.frameElement}catch{return null}}(n);return!!i&&(i.clientHeight<n.scrollHeight||i.clientWidth<n.scrollWidth)}(e)}return!1}function Fn(e,t,r,n,i,a,s,o){return a<e&&s>t||a>e&&s<t?0:a<=e&&o<=r||s>=t&&o>=r?a-e-n:s>t&&o<r||a<e&&o>r?s-t+i:0}function Mo(e,t){var r=window,n=t.scrollMode,i=t.block,a=t.inline,s=t.boundary,o=t.skipOverflowHiddenElements,c=typeof s=="function"?s:function(L){return L!==s};if(!Ro(e))throw new TypeError("Invalid target");for(var u=document.scrollingElement||document.documentElement,l=[],d=e;Ro(d)&&c(d);){if((d=d.parentElement)===u){l.push(d);break}d!=null&&d===document.body&&qi(d)&&!qi(document.documentElement)||d!=null&&qi(d,o)&&l.push(d)}for(var h=r.visualViewport?r.visualViewport.width:innerWidth,f=r.visualViewport?r.visualViewport.height:innerHeight,v=window.scrollX||pageXOffset,m=window.scrollY||pageYOffset,E=e.getBoundingClientRect(),w=E.height,g=E.width,D=E.top,b=E.right,y=E.bottom,A=E.left,x=i==="start"||i==="nearest"?D:i==="end"?y:D+w/2,B=a==="center"?A+g/2:a==="end"?b:A,j=[],H=0;H<l.length;H++){var M=l[H],F=M.getBoundingClientRect(),V=F.height,W=F.width,k=F.top,Y=F.right,S=F.bottom,T=F.left;if(n==="if-needed"&&D>=0&&A>=0&&y<=f&&b<=h&&D>=k&&y<=S&&A>=T&&b<=Y)return j;var P=getComputedStyle(M),I=parseInt(P.borderLeftWidth,10),J=parseInt(P.borderTopWidth,10),ee=parseInt(P.borderRightWidth,10),X=parseInt(P.borderBottomWidth,10),Z=0,re=0,oe="offsetWidth"in M?M.offsetWidth-M.clientWidth-I-ee:0,ue="offsetHeight"in M?M.offsetHeight-M.clientHeight-J-X:0;if(u===M)Z=i==="start"?x:i==="end"?x-f:i==="nearest"?Fn(m,m+f,f,J,X,m+x,m+x+w,w):x-f/2,re=a==="start"?B:a==="center"?B-h/2:a==="end"?B-h:Fn(v,v+h,h,I,ee,v+B,v+B+g,g),Z=Math.max(0,Z+m),re=Math.max(0,re+v);else{Z=i==="start"?x-k-J:i==="end"?x-S+X+ue:i==="nearest"?Fn(k,S,V,J,X+ue,x,x+w,w):x-(k+V/2)+ue/2,re=a==="start"?B-T-I:a==="center"?B-(T+W/2)+oe/2:a==="end"?B-Y+ee+oe:Fn(T,Y,W,I,ee+oe,B,B+g,g);var z=M.scrollLeft,O=M.scrollTop;x+=O-(Z=Math.max(0,Math.min(O+Z,M.scrollHeight-V+ue))),B+=z-(re=Math.max(0,Math.min(z+re,M.scrollWidth-W+oe)))}j.push({el:M,top:Z,left:re})}return j}function ac(e){return e===Object(e)&&Object.keys(e).length!==0}function ch(e,t){t===void 0&&(t="auto");var r="scrollBehavior"in document.body.style;e.forEach(function(n){var i=n.el,a=n.top,s=n.left;i.scroll&&r?i.scroll({top:a,left:s,behavior:t}):(i.scrollTop=a,i.scrollLeft=s)})}function lh(e){return e===!1?{block:"end",inline:"nearest"}:ac(e)?e:{block:"start",inline:"nearest"}}function fh(e,t){var r=e.isConnected||e.ownerDocument.documentElement.contains(e);if(ac(t)&&typeof t.behavior=="function")return t.behavior(r?Mo(e,t):[]);if(!!r){var n=lh(t);return ch(Mo(e,n),n.behavior)}}var dh=fh,Hi=lt(sh()),hh=lt(Of());function yi(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ph(e,t){if(e==null)return{};var r={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}function rr(e,t){if(e==null)return{};var r=ph(e,t),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(t.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}var vh=0,gh=class{constructor(){this.id="".concat(vh++)}},ls=new WeakMap,fs=new WeakMap,sc=new WeakMap,ga=new WeakMap,ma=new WeakMap,bi=new WeakMap,Br=new WeakMap,Da=new WeakMap,Ei=new WeakMap,ds=new WeakMap,er=new WeakMap,tr=new WeakMap,Xr=new WeakMap,Ca=new WeakMap,hs=new WeakMap,ot=new WeakMap,Et=new WeakMap,Ne=new WeakMap,xt=new WeakMap,Pt=new WeakMap,oc=new WeakMap,Ar=Symbol("placeholder"),uc=Symbol("mark-placeholder"),ps=e=>e&&e.ownerDocument&&e.ownerDocument.defaultView||null,mh=e=>ur(e)&&e.nodeType===8,Ye=e=>ur(e)&&e.nodeType===1,ur=e=>{var t=ps(e);return!!t&&e instanceof t.Node},ya=e=>{var t=e&&e.anchorNode&&ps(e.anchorNode);return!!t&&e instanceof t.Selection},cc=e=>ur(e)&&e.nodeType===3,Dh=e=>e.clipboardData&&e.clipboardData.getData("text/plain")!==""&&e.clipboardData.types.length===1,Ch=e=>{var[t,r]=e;if(Ye(t)&&t.childNodes.length){var n=r===t.childNodes.length,i=n?r-1:r;for([t,i]=lc(t,i,n?"backward":"forward"),n=i<r;Ye(t)&&t.childNodes.length;){var a=n?t.childNodes.length-1:0;t=bh(t,a,n?"backward":"forward")}r=n&&t.textContent!=null?t.textContent.length:0}return[t,r]},yh=()=>!!(window.document.activeElement&&window.document.activeElement.shadowRoot),lc=(e,t,r)=>{for(var{childNodes:n}=e,i=n[t],a=t,s=!1,o=!1;(mh(i)||Ye(i)&&i.childNodes.length===0||Ye(i)&&i.getAttribute("contenteditable")==="false")&&!(s&&o);){if(a>=n.length){s=!0,a=t-1,r="backward";continue}if(a<0){o=!0,a=t+1,r="forward";continue}i=n[a],t=a,a+=r==="forward"?1:-1}return[i,t]},bh=(e,t,r)=>{var[n]=lc(e,t,r);return n},fc=e=>{var t="";if(cc(e)&&e.nodeValue)return e.nodeValue;if(Ye(e)){for(var r of Array.from(e.childNodes))t+=fc(r);var n=getComputedStyle(e).getPropertyValue("display");(n==="block"||n==="list"||e.tagName==="BR")&&(t+=`
`)}return t},Eh=/data-slate-fragment="(.+?)"/m,Sh=e=>{var t=e.getData("text/html"),[,r]=t.match(Eh)||[];return r},vs=(e,t,r)=>{var{target:n}=t;if(Ye(n)&&n.matches('[contentEditable="false"]'))return!1;var{document:i}=U.getWindow(e);if(i.contains(n))return U.hasDOMNode(e,n,{editable:!0});var a=r.find(s=>{var{addedNodes:o,removedNodes:c}=s;for(var u of o)if(u===n||u.contains(n))return!0;for(var l of c)if(l===n||l.contains(n))return!0});return!a||a===t?!1:vs(e,a,r)},Bh=parseInt(R.default.version.split(".")[0],10)>=17,Ah=typeof navigator<"u"&&typeof window<"u"&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,jo=typeof navigator<"u"&&/Mac OS X/.test(navigator.userAgent),ut=typeof navigator<"u"&&/Android/.test(navigator.userAgent),ba=typeof navigator<"u"&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),Ki=typeof navigator<"u"&&/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),wh=typeof navigator<"u"&&/Edge?\/(?:[0-6][0-9]|[0-7][0-8])(?:\.)/i.test(navigator.userAgent),dc=typeof navigator<"u"&&/Chrome/i.test(navigator.userAgent),_h=typeof navigator<"u"&&/Chrome?\/(?:[0-7][0-5]|[0-6][0-9])(?:\.)/i.test(navigator.userAgent),kh=typeof navigator<"u"&&/^(?!.*Seamonkey)(?=.*Firefox\/(?:[0-7][0-9]|[0-8][0-6])(?:\.)).*/i.test(navigator.userAgent),Th=typeof navigator<"u"&&/.*QQBrowser/.test(navigator.userAgent),Fh=typeof navigator<"u"&&/.*UCBrowser/.test(navigator.userAgent),Oh=typeof navigator<"u"&&/.*Wechat/.test(navigator.userAgent),Wn=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Ot=!_h&&!wh&&typeof globalThis<"u"&&globalThis.InputEvent&&typeof globalThis.InputEvent.prototype.getTargetRanges=="function",U={isComposing(e){return!!tr.get(e)},getWindow(e){var t=sc.get(e);if(!t)throw new Error("Unable to find a host window element for this editor");return t},findKey(e,t){var r=Da.get(t);return r||(r=new gh,Da.set(t,r)),r},findPath(e,t){for(var r=[],n=t;;){var i=fs.get(n);if(i==null){if(p.isEditor(n))return r;break}var a=ls.get(n);if(a==null)break;r.unshift(a),n=i}throw new Error("Unable to find the path for Slate node: ".concat(ke.stringify(t)))},findDocumentOrShadowRoot(e){var t=U.toDOMNode(e,e),r=t.getRootNode();return(r instanceof Document||r instanceof ShadowRoot)&&r.getSelection!=null?r:t.ownerDocument},isFocused(e){return!!er.get(e)},isReadOnly(e){return!!ds.get(e)},blur(e){var t=U.toDOMNode(e,e),r=U.findDocumentOrShadowRoot(e);er.set(e,!1),r.activeElement===t&&t.blur()},focus(e){var t=U.toDOMNode(e,e),r=U.findDocumentOrShadowRoot(e);er.set(e,!0),r.activeElement!==t&&t.focus({preventScroll:!0})},deselect(e){U.toDOMNode(e,e);var{selection:t}=e,r=U.findDocumentOrShadowRoot(e),n=r.getSelection();n&&n.rangeCount>0&&n.removeAllRanges(),t&&N.deselect(e)},hasDOMNode(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{editable:n=!1}=r,i=U.toDOMNode(e,e),a;try{a=Ye(t)?t:t.parentElement}catch(s){if(!s.message.includes('Permission denied to access property "nodeType"'))throw s}return a?a.closest("[data-slate-editor]")===i&&(!n||a.isContentEditable?!0:typeof a.isContentEditable=="boolean"&&a.closest('[contenteditable="false"]')===i||!!a.getAttribute("data-slate-zero-width")):!1},insertData(e,t){e.insertData(t)},insertFragmentData(e,t){return e.insertFragmentData(t)},insertTextData(e,t){return e.insertTextData(t)},setFragmentData(e,t,r){e.setFragmentData(t,r)},toDOMNode(e,t){var r=Ei.get(e),n=p.isEditor(t)?ga.get(e):r?.get(U.findKey(e,t));if(!n)throw new Error("Cannot resolve a DOM node from Slate node: ".concat(ke.stringify(t)));return n},toDOMPoint(e,t){var[r]=p.node(e,t.path),n=U.toDOMNode(e,r),i;p.void(e,{at:t})&&(t={path:t.path,offset:0});for(var a="[data-slate-string], [data-slate-zero-width]",s=Array.from(n.querySelectorAll(a)),o=0,c=0;c<s.length;c++){var u=s[c],l=u.childNodes[0];if(!(l==null||l.textContent==null)){var{length:d}=l.textContent,h=u.getAttribute("data-slate-length"),f=h==null?d:parseInt(h,10),v=o+f,m=s[c+1];if(t.offset===v&&m!==null&&m!==void 0&&m.hasAttribute("data-slate-mark-placeholder")){var E;i=[m,(E=m.textContent)!==null&&E!==void 0&&E.startsWith("\uFEFF")?1:0];break}if(t.offset<=v){var w=Math.min(d,Math.max(0,t.offset-o));i=[l,w];break}o=v}}if(!i)throw new Error("Cannot resolve a DOM point from Slate point: ".concat(ke.stringify(t)));return i},toDOMRange(e,t){var{anchor:r,focus:n}=t,i=_.isBackward(t),a=U.toDOMPoint(e,r),s=_.isCollapsed(t)?a:U.toDOMPoint(e,n),o=U.getWindow(e),c=o.document.createRange(),[u,l]=i?s:a,[d,h]=i?a:s,f=Ye(u)?u:u.parentElement,v=!!f.getAttribute("data-slate-zero-width"),m=Ye(d)?d:d.parentElement,E=!!m.getAttribute("data-slate-zero-width");return c.setStart(u,v?1:l),c.setEnd(d,E?1:h),c},toSlateNode(e,t){var r=Ye(t)?t:t.parentElement;r&&!r.hasAttribute("data-slate-node")&&(r=r.closest("[data-slate-node]"));var n=r?bi.get(r):null;if(!n)throw new Error("Cannot resolve a Slate node from DOM node: ".concat(r));return n},findEventRange(e,t){"nativeEvent"in t&&(t=t.nativeEvent);var{clientX:r,clientY:n,target:i}=t;if(r==null||n==null)throw new Error("Cannot resolve a Slate range from a DOM event: ".concat(t));var a=U.toSlateNode(e,t.target),s=U.findPath(e,a);if(p.isVoid(e,a)){var o=i.getBoundingClientRect(),c=e.isInline(a)?r-o.left<o.left+o.width-r:n-o.top<o.top+o.height-n,u=p.point(e,s,{edge:c?"start":"end"}),l=c?p.before(e,u):p.after(e,u);if(l){var d=p.range(e,l);return d}}var h,{document:f}=U.getWindow(e);if(f.caretRangeFromPoint)h=f.caretRangeFromPoint(r,n);else{var v=f.caretPositionFromPoint(r,n);v&&(h=f.createRange(),h.setStart(v.offsetNode,v.offset),h.setEnd(v.offsetNode,v.offset))}if(!h)throw new Error("Cannot resolve a Slate range from a DOM event: ".concat(t));var m=U.toSlateRange(e,h,{exactMatch:!1,suppressThrow:!1});return m},toSlatePoint(e,t,r){var{exactMatch:n,suppressThrow:i}=r,[a,s]=n?t:Ch(t),o=a.parentNode,c=null,u=0;if(o){var l,d,h=U.toDOMNode(e,e),f=o.closest('[data-slate-void="true"]'),v=f&&h.contains(f)?f:null,m=o.closest("[data-slate-leaf]"),E=null;if(m){if(c=m.closest('[data-slate-node="text"]'),c){var w=U.getWindow(e),g=w.document.createRange();g.setStart(c,0),g.setEnd(a,s);var D=g.cloneContents(),b=[...Array.prototype.slice.call(D.querySelectorAll("[data-slate-zero-width]")),...Array.prototype.slice.call(D.querySelectorAll("[contenteditable=false]"))];b.forEach(W=>{if(ut&&!n&&W.hasAttribute("data-slate-zero-width")&&W.textContent.length>0&&W.textContext!=="\uFEFF"){W.textContent.startsWith("\uFEFF")&&(W.textContent=W.textContent.slice(1));return}W.parentNode.removeChild(W)}),u=D.textContent.length,E=c}}else if(v){for(var y=v.querySelectorAll("[data-slate-leaf]"),A=0;A<y.length;A++){var x=y[A];if(U.hasDOMNode(e,x)){m=x;break}}m?(c=m.closest('[data-slate-node="text"]'),E=m,u=E.textContent.length,E.querySelectorAll("[data-slate-zero-width]").forEach(W=>{u-=W.textContent.length})):u=1}E&&u===E.textContent.length&&ut&&E.getAttribute("data-slate-zero-width")==="z"&&(l=E.textContent)!==null&&l!==void 0&&l.startsWith("\uFEFF")&&(o.hasAttribute("data-slate-zero-width")||ba&&(d=E.textContent)!==null&&d!==void 0&&d.endsWith(`

`))&&u--}if(ut&&!c&&!n){var B=o.hasAttribute("data-slate-node")?o:o.closest("[data-slate-node]");if(B&&U.hasDOMNode(e,B,{editable:!0})){var j=U.toSlateNode(e,B),{path:H,offset:M}=p.start(e,U.findPath(e,j));return B.querySelector("[data-slate-leaf]")||(M=s),{path:H,offset:M}}}if(!c){if(i)return null;throw new Error("Cannot resolve a Slate point from DOM point: ".concat(t))}var F=U.toSlateNode(e,c),V=U.findPath(e,F);return{path:V,offset:u}},toSlateRange(e,t,r){var{exactMatch:n,suppressThrow:i}=r,a=ya(t)?t.anchorNode:t.startContainer,s,o,c,u,l;if(a&&(ya(t)?(s=t.anchorNode,o=t.anchorOffset,c=t.focusNode,u=t.focusOffset,dc&&yh()?l=t.anchorNode===t.focusNode&&t.anchorOffset===t.focusOffset:l=t.isCollapsed):(s=t.startContainer,o=t.startOffset,c=t.endContainer,u=t.endOffset,l=t.collapsed)),s==null||c==null||o==null||u==null)throw new Error("Cannot resolve a Slate range from DOM range: ".concat(t));var d=U.toSlatePoint(e,[s,o],{exactMatch:n,suppressThrow:i});if(!d)return null;var h=l?d:U.toSlatePoint(e,[c,u],{exactMatch:n,suppressThrow:i});if(!h)return null;var f={anchor:d,focus:h};return _.isExpanded(f)&&_.isForward(f)&&Ye(c)&&p.void(e,{at:f.focus,mode:"highest"})&&(f=p.unhangRange(e,f,{voids:!0})),f},hasRange(e,t){var{anchor:r,focus:n}=t;return p.hasPath(e,r.path)&&p.hasPath(e,n.path)},androidScheduleFlush(e){var t;(t=hs.get(e))===null||t===void 0||t()},androidPendingDiffs(e){return Ne.get(e)}},Lt=Wn?R.useLayoutEffect:R.useEffect,xh=["anchor","focus"],Ph=["anchor","focus"],Rh=(e,t)=>Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(r=>t.hasOwnProperty(r)&&e[r]===t[r]),hc=(e,t)=>{if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++){var n=e[r],i=t[r],a=rr(n,xh),s=rr(i,Ph);if(!_.equals(n,i)||n[Ar]!==i[Ar]||!Rh(a,s))return!1}return!0},Ih=e=>{var{isLast:t,leaf:r,parent:n,text:i}=e,a=Vt(),s=U.findPath(a,i),o=C.parent(s),c=r[uc]===!0;return a.isVoid(n)?R.default.createElement(Yi,{length:$.string(n).length}):r.text===""&&n.children[n.children.length-1]===i&&!a.isInline(n)&&p.string(a,o)===""?R.default.createElement(Yi,{isLineBreak:!0,isMarkPlaceholder:c}):r.text===""?R.default.createElement(Yi,{isMarkPlaceholder:c}):t&&r.text.slice(-1)===`
`?R.default.createElement(Lo,{isTrailing:!0,text:r.text}):R.default.createElement(Lo,{text:r.text})},Lo=e=>{var{text:t,isTrailing:r=!1}=e,n=(0,R.useRef)(null),i=()=>"".concat(t??"").concat(r?`
`:"");return Lt(()=>{var a=i();n.current&&n.current.textContent!==a&&(n.current.textContent=a)}),n.current?R.default.createElement("span",{"data-slate-string":!0,ref:n}):R.default.createElement("span",{"data-slate-string":!0,ref:n},i())},Yi=e=>{var{length:t=0,isLineBreak:r=!1,isMarkPlaceholder:n=!1}=e,i={"data-slate-zero-width":r?"n":"z","data-slate-length":t};return n&&(i["data-slate-mark-placeholder"]=!0),R.default.createElement("span",Object.assign({},i),!ut||!r?"\uFEFF":null,r?R.default.createElement("br",null):null)},gs=(0,R.createContext)(null),Vt=()=>{var e=(0,R.useContext)(gs);if(!e)throw new Error("The `useSlateStatic` hook must be used inside the <Slate> component's context.");return e},Mh=e=>{var{leaf:t,isLast:r,text:n,parent:i,renderPlaceholder:a,renderLeaf:s=h=>R.default.createElement(Lh,Object.assign({},h))}=e,o=(0,R.useRef)(null),c=Vt();(0,R.useEffect)(()=>{var h=o?.current,f=document.querySelector('[data-slate-editor="true"]');if(!(!h||!f))return f.style.minHeight="".concat(h.clientHeight,"px"),ma.set(c,h),()=>{f.style.minHeight="auto",ma.delete(c)}},[o,t]);var u=R.default.createElement(Ih,{isLast:r,leaf:t,parent:i,text:n});if(t[Ar]){var l={children:t.placeholder,attributes:{"data-slate-placeholder":!0,style:{position:"absolute",pointerEvents:"none",width:"100%",maxWidth:"100%",display:"block",opacity:"0.333",userSelect:"none",textDecoration:"none"},contentEditable:!1,ref:o}};u=R.default.createElement(R.default.Fragment,null,a(l),u)}var d={"data-slate-leaf":!0};return s({attributes:d,children:u,leaf:t,text:n})},jh=R.default.memo(Mh,(e,t)=>t.parent===e.parent&&t.isLast===e.isLast&&t.renderLeaf===e.renderLeaf&&t.renderPlaceholder===e.renderPlaceholder&&t.text===e.text&&G.equals(t.leaf,e.leaf)&&t.leaf[Ar]===e.leaf[Ar]),Lh=e=>{var{attributes:t,children:r}=e;return R.default.createElement("span",Object.assign({},t),r)},Nh=e=>{for(var{decorations:t,isLast:r,parent:n,renderPlaceholder:i,renderLeaf:a,text:s}=e,o=Vt(),c=(0,R.useRef)(null),u=G.decorations(s,t),l=U.findKey(o,s),d=[],h=0;h<u.length;h++){var f=u[h];d.push(R.default.createElement(jh,{isLast:r&&h===u.length-1,key:"".concat(l.id,"-").concat(h),renderPlaceholder:i,leaf:f,text:s,parent:n,renderLeaf:a}))}return Lt(()=>{var v=Ei.get(o);c.current?(v?.set(l,c.current),Br.set(s,c.current),bi.set(c.current,s)):(v?.delete(l),Br.delete(s))}),R.default.createElement("span",{"data-slate-node":"text",ref:c},d)},pc=R.default.memo(Nh,(e,t)=>t.parent===e.parent&&t.isLast===e.isLast&&t.renderLeaf===e.renderLeaf&&t.text===e.text&&hc(t.decorations,e.decorations)),Uh=e=>{var{decorations:t,element:r,renderElement:n=g=>R.default.createElement($h,Object.assign({},g)),renderPlaceholder:i,renderLeaf:a,selection:s}=e,o=(0,R.useRef)(null),c=Vt(),u=Gh(),l=c.isInline(r),d=U.findKey(c,r),h=gc({decorations:t,node:r,renderElement:n,renderPlaceholder:i,renderLeaf:a,selection:s}),f={"data-slate-node":"element",ref:o};if(l&&(f["data-slate-inline"]=!0),!l&&p.hasInlines(c,r)){var v=$.string(r),m=(0,ic.default)(v);m==="rtl"&&(f.dir=m)}if(p.isVoid(c,r)){f["data-slate-void"]=!0,!u&&l&&(f.contentEditable=!1);var E=l?"span":"div",[[w]]=$.texts(r);h=R.default.createElement(E,{"data-slate-spacer":!0,style:{height:"0",color:"transparent",outline:"none",position:"absolute"}},R.default.createElement(pc,{renderPlaceholder:i,decorations:[],isLast:!1,parent:r,text:w})),ls.set(w,0),fs.set(w,r)}return Lt(()=>{var g=Ei.get(c);o.current?(g?.set(d,o.current),Br.set(r,o.current),bi.set(o.current,r)):(g?.delete(d),Br.delete(r))}),n({attributes:f,children:h,element:r})},zh=R.default.memo(Uh,(e,t)=>e.element===t.element&&e.renderElement===t.renderElement&&e.renderLeaf===t.renderLeaf&&hc(e.decorations,t.decorations)&&(e.selection===t.selection||!!e.selection&&!!t.selection&&_.equals(e.selection,t.selection))),$h=e=>{var{attributes:t,children:r,element:n}=e,i=Vt(),a=i.isInline(n)?"span":"div";return R.default.createElement(a,Object.assign({},t,{style:{position:"relative"}}),r)},vc=(0,R.createContext)(()=>[]),Wh=()=>(0,R.useContext)(vc),Vh=(0,R.createContext)(!1),gc=e=>{for(var{decorations:t,node:r,renderElement:n,renderPlaceholder:i,renderLeaf:a,selection:s}=e,o=Wh(),c=Vt(),u=U.findPath(c,r),l=[],d=fe.isElement(r)&&!c.isInline(r)&&p.hasInlines(c,r),h=0;h<r.children.length;h++){var f=u.concat(h),v=r.children[h],m=U.findKey(c,v),E=p.range(c,f),w=s&&_.intersection(E,s),g=o([v,f]);for(var D of t){var b=_.intersection(D,E);b&&g.push(b)}fe.isElement(v)?l.push(R.default.createElement(Vh.Provider,{key:"provider-".concat(m.id),value:!!w},R.default.createElement(zh,{decorations:g,element:v,key:m.id,renderElement:n,renderPlaceholder:i,renderLeaf:a,selection:w}))):l.push(R.default.createElement(pc,{decorations:g,key:m.id,isLast:d&&h===r.children.length-1,parent:r,renderPlaceholder:i,renderLeaf:a,text:v})),ls.set(v,h),fs.set(v,r)}return l},mc=(0,R.createContext)(!1),Gh=()=>(0,R.useContext)(mc),Dc=(0,R.createContext)(null),qh=()=>{var e=(0,R.useContext)(Dc);if(!e)throw new Error("The `useSlate` hook must be used inside the <Slate> component's context.");var{editor:t}=e;return t},Hh=3,Kh={bold:"mod+b",compose:["down","left","right","up","backspace","enter"],moveBackward:"left",moveForward:"right",moveWordBackward:"ctrl+left",moveWordForward:"ctrl+right",deleteBackward:"shift?+backspace",deleteForward:"shift?+delete",extendBackward:"shift+left",extendForward:"shift+right",italic:"mod+i",insertSoftBreak:"shift+enter",splitBlock:"enter",undo:"mod+z"},Yh={moveLineBackward:"opt+up",moveLineForward:"opt+down",moveWordBackward:"opt+left",moveWordForward:"opt+right",deleteBackward:["ctrl+backspace","ctrl+h"],deleteForward:["ctrl+delete","ctrl+d"],deleteLineBackward:"cmd+shift?+backspace",deleteLineForward:["cmd+shift?+delete","ctrl+k"],deleteWordBackward:"opt+shift?+backspace",deleteWordForward:"opt+shift?+delete",extendLineBackward:"opt+shift+up",extendLineForward:"opt+shift+down",redo:"cmd+shift+z",transposeCharacter:"ctrl+t"},Jh={deleteWordBackward:"ctrl+shift?+backspace",deleteWordForward:"ctrl+shift?+delete",redo:["ctrl+y","ctrl+shift+z"]},ge=e=>{var t=Kh[e],r=Yh[e],n=Jh[e],i=t&&(0,Hi.isKeyHotkey)(t),a=r&&(0,Hi.isKeyHotkey)(r),s=n&&(0,Hi.isKeyHotkey)(n);return o=>!!(i&&i(o)||jo&&a&&a(o)||!jo&&s&&s(o))},Ce={isBold:ge("bold"),isCompose:ge("compose"),isMoveBackward:ge("moveBackward"),isMoveForward:ge("moveForward"),isDeleteBackward:ge("deleteBackward"),isDeleteForward:ge("deleteForward"),isDeleteLineBackward:ge("deleteLineBackward"),isDeleteLineForward:ge("deleteLineForward"),isDeleteWordBackward:ge("deleteWordBackward"),isDeleteWordForward:ge("deleteWordForward"),isExtendBackward:ge("extendBackward"),isExtendForward:ge("extendForward"),isExtendLineBackward:ge("extendLineBackward"),isExtendLineForward:ge("extendLineForward"),isItalic:ge("italic"),isMoveLineBackward:ge("moveLineBackward"),isMoveLineForward:ge("moveLineForward"),isMoveWordBackward:ge("moveWordBackward"),isMoveWordForward:ge("moveWordForward"),isRedo:ge("redo"),isSoftBreak:ge("insertSoftBreak"),isSplitBlock:ge("splitBlock"),isTransposeCharacter:ge("transposeCharacter"),isUndo:ge("undo")},Xh=(e,t)=>{var r=[],n=()=>{r=[]},i=s=>{if(!!t.current){var o=s.filter(c=>vs(e,c,s));r.push(...o)}};function a(){r.reverse().forEach(s=>{if(s.type==="characterData"){s.target.textContent=s.oldValue;return}s.removedNodes.forEach(o=>{s.target.insertBefore(o,s.nextSibling)}),s.addedNodes.forEach(o=>{s.target.removeChild(o)})}),n()}return{registerMutations:i,restoreDOM:a,clear:n}},Zh={subtree:!0,childList:!0,characterData:!0,characterDataOldValue:!0},Cc=class extends R.Component{constructor(){super(...arguments),this.context=null,this.manager=null,this.mutationObserver=null}observe(){var e,{node:t}=this.props;if(!t.current)throw new Error("Failed to attach MutationObserver, `node` is undefined");(e=this.mutationObserver)===null||e===void 0||e.observe(t.current,Zh)}componentDidMount(){var{receivedUserInput:e}=this.props,t=this.context;this.manager=Xh(t,e),this.mutationObserver=new MutationObserver(this.manager.registerMutations),this.observe()}getSnapshotBeforeUpdate(){var e,t,r,n=(e=this.mutationObserver)===null||e===void 0?void 0:e.takeRecords();if(n!=null&&n.length){var i;(i=this.manager)===null||i===void 0||i.registerMutations(n)}return(t=this.mutationObserver)===null||t===void 0||t.disconnect(),(r=this.manager)===null||r===void 0||r.restoreDOM(),null}componentDidUpdate(){var e;(e=this.manager)===null||e===void 0||e.clear(),this.observe()}componentWillUnmount(){var e;(e=this.mutationObserver)===null||e===void 0||e.disconnect()}render(){return this.props.children}};Cc.contextType=gs;var Qh=ut?Cc:e=>{var{children:t}=e;return R.default.createElement(R.default.Fragment,null,t)};function ep(e,t){var{path:r,diff:n}=t;if(!p.hasPath(e,r))return!1;var i=$.get(e,r);if(!G.isText(i))return!1;if(n.start!==i.text.length||n.text.length===0)return i.text.slice(n.start,n.start+n.text.length)===n.text;var a=C.next(r);if(!p.hasPath(e,a))return!1;var s=$.get(e,a);return G.isText(s)&&s.text.startsWith(n.text)}function tp(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return r.reduce((i,a)=>i.slice(0,a.start)+a.text+i.slice(a.end),e)}function rp(e,t){for(var r=Math.min(e.length,t.length),n=0;n<r;n++)if(e.charAt(n)!==t.charAt(n))return n;return r}function np(e,t,r){for(var n=Math.min(e.length,t.length,r),i=0;i<n;i++)if(e.charAt(e.length-i-1)!==t.charAt(t.length-i-1))return i;return n}function yc(e,t){var{start:r,end:n,text:i}=t,a=e.slice(r,n),s=rp(a,i),o=Math.min(a.length-s,i.length-s),c=np(a,i,o),u={start:r+s,end:n-c,text:i.slice(s,i.length-c)};return u.start===u.end&&u.text.length===0?null:u}function ip(e,t,r){var n=Math.min(t.start,r.start),i=Math.max(0,Math.min(t.start+t.text.length,r.end)-r.start),a=tp(e,t,r),s=Math.max(r.start+r.text.length,t.start+t.text.length+(t.start+t.text.length>r.start?r.text.length:0)-i),o=a.slice(n,s),c=Math.max(t.end,r.end-t.text.length+(t.end-t.start));return yc(e,{start:n,end:c,text:o})}function ap(e){var{path:t,diff:r}=e;return{anchor:{path:t,offset:r.start},focus:{path:t,offset:r.end}}}function Ea(e,t){var{path:r,offset:n}=t;if(!p.hasPath(e,r))return null;var i=$.get(e,r);if(!G.isText(i))return null;var a=p.above(e,{match:o=>p.isBlock(e,o),at:r});if(!a)return null;for(;n>i.text.length;){var s=p.next(e,{at:r,match:G.isText});if(!s||!C.isDescendant(s[1],a[1]))return null;n-=i.text.length,i=s[0],r=s[1]}return{path:r,offset:n}}function No(e,t){var r=Ea(e,t.anchor);if(!r)return null;if(_.isCollapsed(t))return{anchor:r,focus:r};var n=Ea(e,t.focus);return n?{anchor:r,focus:n}:null}function Sa(e,t,r){var n=Ne.get(e),i=n?.find(l=>{var{path:d}=l;return C.equals(d,t.path)});if(!i||t.offset<=i.diff.start)return se.transform(t,r,{affinity:"backward"});var{diff:a}=i;if(t.offset<=a.start+a.text.length){var s={path:t.path,offset:a.start},o=se.transform(s,r,{affinity:"backward"});return o?{path:o.path,offset:o.offset+t.offset-a.start}:null}var c={path:t.path,offset:t.offset-a.text.length+a.end-a.start},u=se.transform(c,r,{affinity:"backward"});return u?r.type==="split_node"&&C.equals(r.path,t.path)&&c.offset<r.position&&a.start<r.position?u:{path:u.path,offset:u.offset+a.text.length-a.end+a.start}:null}function Uo(e,t,r){var n=Sa(e,t.anchor,r);if(!n)return null;if(_.isCollapsed(t))return{anchor:n,focus:n};var i=Sa(e,t.focus,r);return i?{anchor:n,focus:i}:null}function sp(e,t){var{path:r,diff:n,id:i}=e;switch(t.type){case"insert_text":return!C.equals(t.path,r)||t.offset>=n.end?e:t.offset<=n.start?{diff:{start:t.text.length+n.start,end:t.text.length+n.end,text:n.text},id:i,path:r}:{diff:{start:n.start,end:n.end+t.text.length,text:n.text},id:i,path:r};case"remove_text":return!C.equals(t.path,r)||t.offset>=n.end?e:t.offset+t.text.length<=n.start?{diff:{start:n.start-t.text.length,end:n.end-t.text.length,text:n.text},id:i,path:r}:{diff:{start:n.start,end:n.end-t.text.length,text:n.text},id:i,path:r};case"split_node":return!C.equals(t.path,r)||t.position>=n.end?{diff:n,id:i,path:C.transform(r,t,{affinity:"backward"})}:t.position>n.start?{diff:{start:n.start,end:Math.min(t.position,n.end),text:n.text},id:i,path:r}:{diff:{start:n.start-t.position,end:n.end-t.position,text:n.text},id:i,path:C.transform(r,t,{affinity:"forward"})};case"merge_node":return C.equals(t.path,r)?{diff:{start:n.start+t.position,end:n.end+t.position,text:n.text},id:i,path:C.transform(r,t)}:{diff:n,id:i,path:C.transform(r,t)}}var a=C.transform(r,t);return a?{diff:n,path:a,id:i}:null}function zo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function On(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?zo(Object(r),!0).forEach(function(n){yi(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var op=25,up=200,cp=function(){};function lp(e){var{editor:t,scheduleOnDOMSelectionChange:r,onDOMSelectionChange:n}=e,i=!1,a=null,s=null,o=null,c=0,u=!1,l=()=>{var F=Pt.get(t);if(Pt.delete(t),F){var{selection:V}=t,W=No(t,F);W&&(!V||!_.equals(W,V))&&N.select(t,W)}},d=()=>{var F=xt.get(t);if(xt.delete(t),!!F){if(F.at){var V=se.isPoint(F.at)?Ea(t,F.at):No(t,F.at);if(!V)return;var W=p.range(t,V);(!t.selection||!_.equals(t.selection,W))&&N.select(t,V)}F.run()}},h=()=>{var F;if(s&&(clearTimeout(s),s=null),o&&(clearTimeout(o),o=null),!b()&&!D()){l();return}i||(i=!0,setTimeout(()=>i=!1)),D()&&(i="action");var V=t.selection&&p.rangeRef(t,t.selection,{affinity:"forward"});Et.set(t,t.marks),cp("flush",xt.get(t),Ne.get(t));for(var W=!!((F=Ne.get(t))!==null&&F!==void 0&&F.length),k;k=(Y=Ne.get(t))===null||Y===void 0?void 0:Y[0];){var Y,S,T=ot.get(t);T!==void 0&&(ot.delete(t),t.marks=T),T&&u===!1&&(u=null);var P=ap(k);(!t.selection||!_.equals(t.selection,P))&&N.select(t,P),k.diff.text?p.insertText(t,k.diff.text):p.deleteFragment(t),Ne.set(t,(S=Ne.get(t))===null||S===void 0?void 0:S.filter(ee=>{var{id:X}=ee;return X!==k.id})),ep(t,k)||(W=!1,xt.delete(t),Et.delete(t),i="action",Pt.delete(t),r.cancel(),n.cancel(),V?.unref())}var I=V?.unref();if(I&&!Pt.get(t)&&(!t.selection||!_.equals(I,t.selection))&&N.select(t,I),D()){d();return}W&&r(),r.flush(),n.flush(),l();var J=Et.get(t);Et.delete(t),J!==void 0&&(t.marks=J,t.onChange())},f=F=>{a&&clearTimeout(a),a=setTimeout(()=>{tr.set(t,!1),h()},op)},v=F=>{tr.set(t,!0),a&&(clearTimeout(a),a=null)},m=function(){var V=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,W=ma.get(t);if(!!W){if(b()||V){W.style.display="none";return}W.style.removeProperty("display")}},E=(F,V)=>{var W,k=(W=Ne.get(t))!==null&&W!==void 0?W:[];Ne.set(t,k);var Y=$.leaf(t,F),S=k.findIndex(I=>C.equals(I.path,F));if(S<0){var T=yc(Y.text,V);T&&k.push({path:F,diff:V,id:c++}),m();return}var P=ip(Y.text,k[S].diff,V);if(!P){k.splice(S,1),m();return}k[S]=On(On({},k[S]),{},{diff:P})},w=function(V){var{at:W}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};u=!1,Pt.delete(t),r.cancel(),n.cancel(),D()&&h(),xt.set(t,{at:W,run:V}),o=setTimeout(h)},g=F=>{var V;s&&(clearTimeout(s),s=null);var{inputType:W}=F,k=null,Y=F.dataTransfer||F.data||void 0;u!==!1&&W!=="insertText"&&W!=="insertCompositionText"&&(u=!1);var[S]=F.getTargetRanges();S&&(k=U.toSlateRange(t,S,{exactMatch:!1,suppressThrow:!0}));var T=U.getWindow(t),P=T.getSelection();if(!k&&P&&(S=P,k=U.toSlateRange(t,P,{exactMatch:!1,suppressThrow:!0})),k=(V=k)!==null&&V!==void 0?V:t.selection,!!k){if(_.isExpanded(k)&&W.startsWith("delete")){var[I,J]=_.edges(k),ee=$.leaf(t,I.path);if(ee.text.length===I.offset&&J.offset===0){var X=p.next(t,{at:I.path,match:G.isText});X&&C.equals(X[1],J.path)&&(k={anchor:J,focus:J})}}if(_.isExpanded(k)&&W.startsWith("delete")){if(C.equals(k.anchor.path,k.focus.path)){var[Z,re]=_.edges(k);return E(k.anchor.path,{text:"",end:re.offset,start:Z.offset})}var oe=W.endsWith("Backward")?"backward":"forward";return w(()=>p.deleteFragment(t,{direction:oe}),{at:k})}switch(W){case"deleteByComposition":case"deleteByCut":case"deleteByDrag":return w(()=>p.deleteFragment(t),{at:k});case"deleteContent":case"deleteContentForward":{var{anchor:ue}=k;if(_.isCollapsed(k)){var z=$.leaf(t,ue.path);if(ue.offset<z.text.length)return E(ue.path,{text:"",start:ue.offset,end:ue.offset+1})}return w(()=>p.deleteForward(t),{at:k})}case"deleteContentBackward":{var O,{anchor:L}=k,q=ya(S)?S.isCollapsed:!!((O=S)!==null&&O!==void 0&&O.collapsed);return q&&_.isCollapsed(k)&&L.offset>0?E(L.path,{text:"",start:L.offset-1,end:L.offset}):w(()=>p.deleteBackward(t),{at:k})}case"deleteEntireSoftLine":return w(()=>{p.deleteBackward(t,{unit:"line"}),p.deleteForward(t,{unit:"line"})},{at:k});case"deleteHardLineBackward":return w(()=>p.deleteBackward(t,{unit:"block"}),{at:k});case"deleteSoftLineBackward":return w(()=>p.deleteBackward(t,{unit:"line"}),{at:k});case"deleteHardLineForward":return w(()=>p.deleteForward(t,{unit:"block"}),{at:k});case"deleteSoftLineForward":return w(()=>p.deleteForward(t,{unit:"line"}),{at:k});case"deleteWordBackward":return w(()=>p.deleteBackward(t,{unit:"word"}),{at:k});case"deleteWordForward":return w(()=>p.deleteForward(t,{unit:"word"}),{at:k});case"insertLineBreak":return w(()=>p.insertSoftBreak(t),{at:k});case"insertParagraph":return w(()=>p.insertBreak(t),{at:k});case"insertCompositionText":case"deleteCompositionText":case"insertFromComposition":case"insertFromDrop":case"insertFromPaste":case"insertFromYank":case"insertReplacementText":case"insertText":{if(Y?.constructor.name==="DataTransfer")return w(()=>U.insertData(t,Y),{at:k});if(typeof Y=="string"&&Y.includes(`
`))return w(()=>p.insertSoftBreak(t),{at:_.end(k)});var ae=Y??"";if(ot.get(t)&&(ae=ae.replace("\uFEFF","")),C.equals(k.anchor.path,k.focus.path)){var[Q,de]=_.edges(k),De={start:Q.offset,end:de.offset,text:ae};if(ae&&u&&W==="insertCompositionText"){var Ae=u.start+u.text.search(/\S|$/),He=De.start+De.text.search(/\S|$/);He===Ae+1&&De.end===u.start+u.text.length?(De.start-=1,u=null,H()):u=!1}else W==="insertText"?u===null?u=De:u&&_.isCollapsed(k)&&u.end+u.text.length===Q.offset?u=On(On({},u),{},{text:u.text+ae}):u=!1:u=!1;E(Q.path,De);return}return w(()=>p.insertText(t,ae),{at:k})}}}},D=()=>!!xt.get(t),b=()=>{var F;return!!((F=Ne.get(t))!==null&&F!==void 0&&F.length)},y=()=>D()||b(),A=()=>i,x=F=>{Pt.set(t,F),s&&(clearTimeout(s),s=null);var{selection:V}=t;if(!!F){var W=!V||!C.equals(V.anchor.path,F.anchor.path),k=!V||!C.equals(V.anchor.path.slice(0,-1),F.anchor.path.slice(0,-1));(W&&u||k)&&(u=!1),(W||!b())&&(s=setTimeout(h,up))}},B=()=>{(D()||!b())&&h()},j=F=>{b()||(m(!0),setTimeout(m))},H=()=>{D()||(o=setTimeout(h))},M=F=>{if(!(b()||D())&&F.some(W=>vs(t,W,F))){var V;(V=oc.get(t))===null||V===void 0||V()}};return{flush:h,scheduleFlush:H,hasPendingDiffs:b,hasPendingAction:D,hasPendingChanges:y,isFlushing:A,handleUserSelect:x,handleCompositionEnd:f,handleCompositionStart:v,handleDOMBeforeInput:g,handleKeyDown:j,handleDomMutations:M,handleInput:B}}function fp(){var e=(0,R.useRef)(!1);return(0,R.useEffect)(()=>(e.current=!0,()=>{e.current=!1}),[]),e.current}function dp(e,t,r){var[n]=(0,R.useState)(()=>new MutationObserver(t));Lt(()=>{n.takeRecords()}),(0,R.useEffect)(()=>{if(!e.current)throw new Error("Failed to attach MutationObserver, `node` is undefined");return n.observe(e.current,r),()=>n.disconnect()},[])}var hp=["node"];function $o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function pp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$o(Object(r),!0).forEach(function(n){yi(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$o(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var vp={subtree:!0,childList:!0,characterData:!0};function gp(e){var{node:t}=e,r=rr(e,hp);if(!ut)return null;var n=Vt(),i=fp(),[a]=(0,R.useState)(()=>lp(pp({editor:n},r)));return dp(t,a.handleDomMutations,vp),hs.set(n,a.scheduleFlush),i&&a.flush(),a}function mp(){var e=Vt(),t=(0,R.useRef)(!1),r=(0,R.useRef)(0),n=(0,R.useCallback)(()=>{if(!t.current){t.current=!0;var i=U.getWindow(e);i.cancelAnimationFrame(r.current),r.current=i.requestAnimationFrame(()=>{t.current=!1})}},[]);return(0,R.useEffect)(()=>()=>cancelAnimationFrame(r.current),[]),{receivedUserInput:t,onUserInput:n}}var Dp=["autoFocus","decorate","onDOMBeforeInput","placeholder","readOnly","renderElement","renderLeaf","renderPlaceholder","scrollSelectionIntoView","style","as"],Cp=["text"],yp=["text"];function Wo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function xn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Wo(Object(r),!0).forEach(function(n){yi(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var bp=e=>R.default.createElement(R.default.Fragment,null,gc(e)),Ep=e=>{var{autoFocus:t,decorate:r=Bp,onDOMBeforeInput:n,placeholder:i,readOnly:a=!1,renderElement:s,renderLeaf:o,renderPlaceholder:c=S=>R.default.createElement(Sp,Object.assign({},S)),scrollSelectionIntoView:u=Ap,style:l={},as:d="div"}=e,h=rr(e,Dp),f=qh(),[v,m]=(0,R.useState)(!1),E=(0,R.useRef)(null),w=(0,R.useRef)([]),{onUserInput:g,receivedUserInput:D}=mp(),[,b]=(0,R.useReducer)(S=>S+1,0);oc.set(f,b),ds.set(f,a);var y=(0,R.useMemo)(()=>({isDraggingInternally:!1,isUpdatingSelection:!1,latestElement:null,hasMarkPlaceholder:!1}),[]);(0,R.useEffect)(()=>{E.current&&t&&E.current.focus()},[t]);var A=(0,R.useCallback)((0,uh.default)(()=>{if((ut||!U.isComposing(f))&&(!y.isUpdatingSelection||B!=null&&B.isFlushing())&&!y.isDraggingInternally){var S=U.findDocumentOrShadowRoot(f),{activeElement:T}=S,P=U.toDOMNode(f,f),I=S.getSelection();if(T===P?(y.latestElement=T,er.set(f,!0)):er.delete(f),!I)return N.deselect(f);var{anchorNode:J,focusNode:ee}=I,X=Ue(f,J)||Vo(f,J),Z=Ue(f,ee)||Vo(f,ee);if(X&&Z){var re=U.toSlateRange(f,I,{exactMatch:!1,suppressThrow:!0});re&&(!U.isComposing(f)&&!(B!=null&&B.hasPendingChanges())&&!(B!=null&&B.isFlushing())?N.select(f,re):B?.handleUserSelect(re))}}},100),[a]),x=(0,R.useMemo)(()=>(0,oh.default)(A,0),[A]),B=gp({node:E,onDOMSelectionChange:A,scheduleOnDOMSelectionChange:x});Lt(()=>{var S;E.current&&(S=ps(E.current))?(sc.set(f,S),ga.set(f,E.current),Br.set(f,E.current),bi.set(E.current,f)):Br.delete(f);var{selection:T}=f,P=U.findDocumentOrShadowRoot(f),I=P.getSelection();if(!(!I||!U.isFocused(f)||B!=null&&B.hasPendingAction())){var J=oe=>{var ue=I.type!=="None";if(!(!T&&!ue)){var z=ga.get(f),O=!1;if(z.contains(I.anchorNode)&&z.contains(I.focusNode)&&(O=!0),ue&&O&&T&&!oe){var L=U.toSlateRange(f,I,{exactMatch:!0,suppressThrow:!0});if(L&&_.equals(L,T)){var q;if(!y.hasMarkPlaceholder)return;var{anchorNode:ae}=I;if(ae!=null&&(q=ae.parentElement)!==null&&q!==void 0&&q.hasAttribute("data-slate-mark-placeholder"))return}}if(T&&!U.hasRange(f,T)){f.selection=U.toSlateRange(f,I,{exactMatch:!1,suppressThrow:!0});return}y.isUpdatingSelection=!0;var Q=T&&U.toDOMRange(f,T);return Q?(_.isBackward(T)?I.setBaseAndExtent(Q.endContainer,Q.endOffset,Q.startContainer,Q.startOffset):I.setBaseAndExtent(Q.startContainer,Q.startOffset,Q.endContainer,Q.endOffset),u(f,Q)):I.removeAllRanges(),Q}},ee=J(),X=B?.isFlushing()==="action";if(!ut||!X){setTimeout(()=>{if(ee&&ba){var oe=U.toDOMNode(f,f);oe.focus()}y.isUpdatingSelection=!1});return}var Z=null,re=requestAnimationFrame(()=>{if(X){var oe=ue=>{try{var z=U.toDOMNode(f,f);z.focus(),J(ue)}catch{}};oe(),Z=setTimeout(()=>{oe(!0),y.isUpdatingSelection=!1})}});return()=>{cancelAnimationFrame(re),Z&&clearTimeout(Z)}}});var j=(0,R.useCallback)(S=>{if(g(),!a&&Ue(f,S.target)&&!wp(S,n)){var T;if(B)return B.handleDOMBeforeInput(S);x.flush(),A.flush();var{selection:P}=f,{inputType:I}=S,J=S.dataTransfer||S.data||void 0,ee=I==="insertCompositionText"||I==="deleteCompositionText";if(ee&&U.isComposing(f))return;var X=!1;if(I==="insertText"&&P&&_.isCollapsed(P)&&S.data&&S.data.length===1&&/[a-z ]/i.test(S.data)&&P.anchor.offset!==0){var Z,re;X=!0,f.marks&&(X=!1);var{anchor:oe}=P,[ue,z]=U.toDOMPoint(f,oe),O=(Z=ue.parentElement)===null||Z===void 0?void 0:Z.closest("a"),L=U.getWindow(f);if(X&&O&&U.hasDOMNode(f,O)){var q,ae=L?.document.createTreeWalker(O,NodeFilter.SHOW_TEXT).lastChild();ae===ue&&((q=ae.textContent)===null||q===void 0?void 0:q.length)===z&&(X=!1)}if(X&&ue.parentElement&&(L==null||(re=L.getComputedStyle(ue.parentElement))===null||re===void 0?void 0:re.whiteSpace)==="pre"){var Q=p.above(f,{at:oe.path,match:Ft=>p.isBlock(f,Ft)});Q&&$.string(Q[0]).includes("	")&&(X=!1)}}if(!I.startsWith("delete")||I.startsWith("deleteBy")){var[de]=S.getTargetRanges();if(de){var De=U.toSlateRange(f,de,{exactMatch:!1,suppressThrow:!1});if(!P||!_.equals(P,De)){X=!1;var Ae=!ee&&f.selection&&p.rangeRef(f,f.selection);N.select(f,De),Ae&&Xr.set(f,Ae)}}}if(ee)return;if(X||S.preventDefault(),P&&_.isExpanded(P)&&I.startsWith("delete")){var He=I.endsWith("Backward")?"backward":"forward";p.deleteFragment(f,{direction:He});return}switch(I){case"deleteByComposition":case"deleteByCut":case"deleteByDrag":{p.deleteFragment(f);break}case"deleteContent":case"deleteContentForward":{p.deleteForward(f);break}case"deleteContentBackward":{p.deleteBackward(f);break}case"deleteEntireSoftLine":{p.deleteBackward(f,{unit:"line"}),p.deleteForward(f,{unit:"line"});break}case"deleteHardLineBackward":{p.deleteBackward(f,{unit:"block"});break}case"deleteSoftLineBackward":{p.deleteBackward(f,{unit:"line"});break}case"deleteHardLineForward":{p.deleteForward(f,{unit:"block"});break}case"deleteSoftLineForward":{p.deleteForward(f,{unit:"line"});break}case"deleteWordBackward":{p.deleteBackward(f,{unit:"word"});break}case"deleteWordForward":{p.deleteForward(f,{unit:"word"});break}case"insertLineBreak":p.insertSoftBreak(f);break;case"insertParagraph":{p.insertBreak(f);break}case"insertFromComposition":case"insertFromDrop":case"insertFromPaste":case"insertFromYank":case"insertReplacementText":case"insertText":{var{selection:qt}=f;qt&&_.isExpanded(qt)&&p.deleteFragment(f),I==="insertFromComposition"&&U.isComposing(f)&&(m(!1),tr.set(f,!1)),J?.constructor.name==="DataTransfer"?U.insertData(f,J):typeof J=="string"&&(X?w.current.push(()=>p.insertText(f,J)):p.insertText(f,J));break}}var Ee=(T=Xr.get(f))===null||T===void 0?void 0:T.unref();Xr.delete(f),Ee&&(!f.selection||!_.equals(f.selection,Ee))&&N.select(f,Ee)}},[a,n]);Lt(()=>(E.current&&Ot&&E.current.addEventListener("beforeinput",j),()=>{E.current&&Ot&&E.current.removeEventListener("beforeinput",j)}),[j]),Lt(()=>{var S=U.getWindow(f);return S.document.addEventListener("selectionchange",x),()=>{S.document.removeEventListener("selectionchange",x)}},[x]);var H=r([f,[]]);if(i&&f.children.length===1&&Array.from($.texts(f)).length===1&&$.string(f)===""&&!v){var M=p.start(f,[]);H.push({[Ar]:!0,placeholder:i,anchor:M,focus:M})}var{marks:F}=f;if(y.hasMarkPlaceholder=!1,f.selection&&_.isCollapsed(f.selection)&&F){var{anchor:V}=f.selection,W=$.leaf(f,V.path),k=rr(W,Cp);if(!G.equals(k,F,{loose:!0})){y.hasMarkPlaceholder=!0;var Y=Object.fromEntries(Object.keys(k).map(S=>[S,null]));H.push(xn(xn(xn({[uc]:!0},Y),F),{},{anchor:V,focus:V}))}}return(0,R.useEffect)(()=>{setTimeout(()=>{var{selection:S}=f;if(S){var{anchor:T}=S,P=$.leaf(f,T.path),I=rr(P,yp);if(!G.equals(I,F,{loose:!0})){ot.set(f,F);return}}ot.delete(f)})}),R.default.createElement(mc.Provider,{value:a},R.default.createElement(vc.Provider,{value:r},R.default.createElement(Qh,{node:E,receivedUserInput:D},R.default.createElement(d,Object.assign({role:a?void 0:"textbox"},h,{spellCheck:Ot||!Wn?h.spellCheck:!1,autoCorrect:Ot||!Wn?h.autoCorrect:"false",autoCapitalize:Ot||!Wn?h.autoCapitalize:"false","data-slate-editor":!0,"data-slate-node":"value",contentEditable:!a,zindex:-1,suppressContentEditableWarning:!0,ref:E,style:xn({position:"relative",outline:"none",whiteSpace:"pre-wrap",wordWrap:"break-word"},l),onBeforeInput:(0,R.useCallback)(S=>{if(!Ot&&!a&&!je(S,h.onBeforeInput)&&Ue(f,S.target)&&(S.preventDefault(),!U.isComposing(f))){var T=S.data;p.insertText(f,T)}},[a]),onInput:(0,R.useCallback)(S=>{if(B){B.handleInput();return}for(var T of w.current)T();w.current=[]},[]),onBlur:(0,R.useCallback)(S=>{if(!(a||y.isUpdatingSelection||!Ue(f,S.target)||je(S,h.onBlur))){var T=U.findDocumentOrShadowRoot(f);if(y.latestElement!==T.activeElement){var{relatedTarget:P}=S,I=U.toDOMNode(f,f);if(P!==I&&!(Ye(P)&&P.hasAttribute("data-slate-spacer"))){if(P!=null&&ur(P)&&U.hasDOMNode(f,P)){var J=U.toSlateNode(f,P);if(fe.isElement(J)&&!f.isVoid(J))return}if(Ki){var ee=T.getSelection();ee?.removeAllRanges()}er.delete(f)}}}},[a,h.onBlur]),onClick:(0,R.useCallback)(S=>{if(Cr(f,S.target)&&!je(S,h.onClick)&&ur(S.target)){var T=U.toSlateNode(f,S.target),P=U.findPath(f,T);if(!p.hasPath(f,P)||$.get(f,P)!==T)return;if(S.detail===Hh&&P.length>=1){var I=P;if(!p.isBlock(f,T)){var J,ee=p.above(f,{match:O=>p.isBlock(f,O),at:P});I=(J=ee?.[1])!==null&&J!==void 0?J:P.slice(0,1)}var X=p.range(f,I);N.select(f,X);return}if(a)return;var Z=p.start(f,P),re=p.end(f,P),oe=p.void(f,{at:Z}),ue=p.void(f,{at:re});if(oe&&ue&&C.equals(oe[1],ue[1])){var z=p.range(f,Z);N.select(f,z)}}},[a,h.onClick]),onCompositionEnd:(0,R.useCallback)(S=>{if(Ue(f,S.target)){if(U.isComposing(f)&&(m(!1),tr.set(f,!1)),B?.handleCompositionEnd(S),je(S,h.onCompositionEnd)||ut)return;if(!Ki&&!kh&&!Ah&&!Th&&!Oh&&!Fh&&S.data){var T=ot.get(f);ot.delete(f),T!==void 0&&(Et.set(f,f.marks),f.marks=T),p.insertText(f,S.data);var P=Et.get(f);Et.delete(f),P!==void 0&&(f.marks=P)}}},[h.onCompositionEnd]),onCompositionUpdate:(0,R.useCallback)(S=>{Ue(f,S.target)&&!je(S,h.onCompositionUpdate)&&(U.isComposing(f)||(m(!0),tr.set(f,!0)))},[h.onCompositionUpdate]),onCompositionStart:(0,R.useCallback)(S=>{if(Ue(f,S.target)){if(B?.handleCompositionStart(S),je(S,h.onCompositionStart)||ut)return;m(!0);var{selection:T}=f;if(T){if(_.isExpanded(T)){p.deleteFragment(f);return}var P=p.above(f,{match:ee=>p.isInline(f,ee),mode:"highest"});if(P){var[,I]=P;if(p.isEnd(f,T.anchor,I)){var J=p.after(f,I);N.setSelection(f,{anchor:J,focus:J})}}}}},[h.onCompositionStart]),onCopy:(0,R.useCallback)(S=>{Ue(f,S.target)&&!je(S,h.onCopy)&&(S.preventDefault(),U.setFragmentData(f,S.clipboardData,"copy"))},[h.onCopy]),onCut:(0,R.useCallback)(S=>{if(!a&&Ue(f,S.target)&&!je(S,h.onCut)){S.preventDefault(),U.setFragmentData(f,S.clipboardData,"cut");var{selection:T}=f;if(T)if(_.isExpanded(T))p.deleteFragment(f);else{var P=$.parent(f,T.anchor.path);p.isVoid(f,P)&&N.delete(f)}}},[a,h.onCut]),onDragOver:(0,R.useCallback)(S=>{if(Cr(f,S.target)&&!je(S,h.onDragOver)){var T=U.toSlateNode(f,S.target);p.isVoid(f,T)&&S.preventDefault()}},[h.onDragOver]),onDragStart:(0,R.useCallback)(S=>{if(!a&&Cr(f,S.target)&&!je(S,h.onDragStart)){var T=U.toSlateNode(f,S.target),P=U.findPath(f,T),I=p.isVoid(f,T)||p.void(f,{at:P,voids:!0});if(I){var J=p.range(f,P);N.select(f,J)}y.isDraggingInternally=!0,U.setFragmentData(f,S.dataTransfer,"drag")}},[a,h.onDragStart]),onDrop:(0,R.useCallback)(S=>{if(!a&&Cr(f,S.target)&&!je(S,h.onDrop)){S.preventDefault();var T=f.selection,P=U.findEventRange(f,S),I=S.dataTransfer;N.select(f,P),y.isDraggingInternally&&T&&!_.equals(T,P)&&!p.void(f,{at:P,voids:!0})&&N.delete(f,{at:T}),U.insertData(f,I),U.isFocused(f)||U.focus(f)}y.isDraggingInternally=!1},[a,h.onDrop]),onDragEnd:(0,R.useCallback)(S=>{!a&&y.isDraggingInternally&&h.onDragEnd&&Cr(f,S.target)&&h.onDragEnd(S),y.isDraggingInternally=!1},[a,h.onDragEnd]),onFocus:(0,R.useCallback)(S=>{if(!a&&!y.isUpdatingSelection&&Ue(f,S.target)&&!je(S,h.onFocus)){var T=U.toDOMNode(f,f),P=U.findDocumentOrShadowRoot(f);if(y.latestElement=P.activeElement,ba&&S.target!==T){T.focus();return}er.set(f,!0)}},[a,h.onFocus]),onKeyDown:(0,R.useCallback)(S=>{if(!a&&Ue(f,S.target)){B?.handleKeyDown(S);var{nativeEvent:T}=S;if(U.isComposing(f)&&T.isComposing===!1&&(tr.set(f,!1),m(!1)),je(S,h.onKeyDown)||U.isComposing(f))return;var{selection:P}=f,I=f.children[P!==null?P.focus.path[0]:0],J=(0,ic.default)($.string(I))==="rtl";if(Ce.isRedo(T)){S.preventDefault();var ee=f;typeof ee.redo=="function"&&ee.redo();return}if(Ce.isUndo(T)){S.preventDefault();var X=f;typeof X.undo=="function"&&X.undo();return}if(Ce.isMoveLineBackward(T)){S.preventDefault(),N.move(f,{unit:"line",reverse:!0});return}if(Ce.isMoveLineForward(T)){S.preventDefault(),N.move(f,{unit:"line"});return}if(Ce.isExtendLineBackward(T)){S.preventDefault(),N.move(f,{unit:"line",edge:"focus",reverse:!0});return}if(Ce.isExtendLineForward(T)){S.preventDefault(),N.move(f,{unit:"line",edge:"focus"});return}if(Ce.isMoveBackward(T)){S.preventDefault(),P&&_.isCollapsed(P)?N.move(f,{reverse:!J}):N.collapse(f,{edge:"start"});return}if(Ce.isMoveForward(T)){S.preventDefault(),P&&_.isCollapsed(P)?N.move(f,{reverse:J}):N.collapse(f,{edge:"end"});return}if(Ce.isMoveWordBackward(T)){S.preventDefault(),P&&_.isExpanded(P)&&N.collapse(f,{edge:"focus"}),N.move(f,{unit:"word",reverse:!J});return}if(Ce.isMoveWordForward(T)){S.preventDefault(),P&&_.isExpanded(P)&&N.collapse(f,{edge:"focus"}),N.move(f,{unit:"word",reverse:J});return}if(Ot){if((dc||Ki)&&P&&(Ce.isDeleteBackward(T)||Ce.isDeleteForward(T))&&_.isCollapsed(P)){var Z=$.parent(f,P.anchor.path);if(fe.isElement(Z)&&p.isVoid(f,Z)&&p.isInline(f,Z)){S.preventDefault(),p.deleteBackward(f,{unit:"block"});return}}}else{if(Ce.isBold(T)||Ce.isItalic(T)||Ce.isTransposeCharacter(T)){S.preventDefault();return}if(Ce.isSoftBreak(T)){S.preventDefault(),p.insertSoftBreak(f);return}if(Ce.isSplitBlock(T)){S.preventDefault(),p.insertBreak(f);return}if(Ce.isDeleteBackward(T)){S.preventDefault(),P&&_.isExpanded(P)?p.deleteFragment(f,{direction:"backward"}):p.deleteBackward(f);return}if(Ce.isDeleteForward(T)){S.preventDefault(),P&&_.isExpanded(P)?p.deleteFragment(f,{direction:"forward"}):p.deleteForward(f);return}if(Ce.isDeleteLineBackward(T)){S.preventDefault(),P&&_.isExpanded(P)?p.deleteFragment(f,{direction:"backward"}):p.deleteBackward(f,{unit:"line"});return}if(Ce.isDeleteLineForward(T)){S.preventDefault(),P&&_.isExpanded(P)?p.deleteFragment(f,{direction:"forward"}):p.deleteForward(f,{unit:"line"});return}if(Ce.isDeleteWordBackward(T)){S.preventDefault(),P&&_.isExpanded(P)?p.deleteFragment(f,{direction:"backward"}):p.deleteBackward(f,{unit:"word"});return}if(Ce.isDeleteWordForward(T)){S.preventDefault(),P&&_.isExpanded(P)?p.deleteFragment(f,{direction:"forward"}):p.deleteForward(f,{unit:"word"});return}}}},[a,h.onKeyDown]),onPaste:(0,R.useCallback)(S=>{!a&&Ue(f,S.target)&&!je(S,h.onPaste)&&(!Ot||Dh(S.nativeEvent))&&(S.preventDefault(),U.insertData(f,S.clipboardData))},[a,h.onPaste])}),R.default.createElement(bp,{decorations:H,node:f,renderElement:s,renderPlaceholder:c,renderLeaf:o,selection:f.selection})))))},Sp=e=>{var{attributes:t,children:r}=e;return R.default.createElement("span",Object.assign({},t),r,ut&&R.default.createElement("br",null))},Bp=()=>[],Ap=(e,t)=>{if(!e.selection||e.selection&&_.isCollapsed(e.selection)){var r=t.startContainer.parentElement;r.getBoundingClientRect=t.getBoundingClientRect.bind(t),dh(r,{scrollMode:"if-needed"}),delete r.getBoundingClientRect}},Cr=(e,t)=>ur(t)&&U.hasDOMNode(e,t),Ue=(e,t)=>ur(t)&&U.hasDOMNode(e,t,{editable:!0}),Vo=(e,t)=>{if(ds.get(e))return!1;var r=Cr(e,t)&&U.toSlateNode(e,t);return p.isVoid(e,r)},je=(e,t)=>{if(!t)return!1;var r=t(e);return r??(e.isDefaultPrevented()||e.isPropagationStopped())},wp=(e,t)=>{if(!t)return!1;var r=t(e);return r??e.defaultPrevented},_p=(0,R.createContext)(!1),kp=(0,R.createContext)({});function Tp(e){var t=(0,R.useRef)([]).current,r=(0,R.useRef)({editor:e}).current,n=(0,R.useCallback)(a=>{r.editor=a,t.forEach(s=>s(a))},[]),i=(0,R.useMemo)(()=>({getSlate:()=>r.editor,addEventListener:a=>(t.push(a),()=>{t.splice(t.indexOf(a),1)})}),[t,r]);return{selectorContext:i,onChange:n}}var Fp=["editor","children","onChange","value"],Op=e=>{var{editor:t,children:r,onChange:n,value:i}=e,a=rr(e,Fp),s=(0,R.useRef)(!1),[o,c]=R.default.useState(()=>{if(!$.isNodeList(i))throw new Error("[Slate] value is invalid! Expected a list of elements"+"but got: ".concat(ke.stringify(i)));if(!p.isEditor(t))throw new Error("[Slate] editor is invalid! you passed:"+"".concat(ke.stringify(t)));return t.children=i,Object.assign(t,a),{v:0,editor:t}}),{selectorContext:u,onChange:l}=Tp(t),d=(0,R.useCallback)(()=>{n&&n(t.children),c(v=>({v:v.v+1,editor:t})),l(t)},[n]);Ca.set(t,d),(0,R.useEffect)(()=>()=>{Ca.set(t,()=>{}),s.current=!0},[]);var[h,f]=(0,R.useState)(U.isFocused(t));return(0,R.useEffect)(()=>{f(U.isFocused(t))}),Lt(()=>{var v=()=>f(U.isFocused(t));return Bh?(document.addEventListener("focusin",v),document.addEventListener("focusout",v),()=>{document.removeEventListener("focusin",v),document.removeEventListener("focusout",v)}):(document.addEventListener("focus",v,!0),document.addEventListener("blur",v,!0),()=>{document.removeEventListener("focus",v,!0),document.removeEventListener("blur",v,!0)})},[]),R.default.createElement(kp.Provider,{value:u},R.default.createElement(Dc.Provider,{value:o},R.default.createElement(gs.Provider,{value:o.editor},R.default.createElement(_p.Provider,{value:h},r))))},Go=(e,t)=>{var r=(t.top+t.bottom)/2;return e.top<=r&&e.bottom>=r},qo=(e,t,r)=>{var n=U.toDOMRange(e,t).getBoundingClientRect(),i=U.toDOMRange(e,r).getBoundingClientRect();return Go(n,i)&&Go(i,n)},xp=(e,t)=>{var r=p.range(e,_.end(t)),n=Array.from(p.positions(e,{at:t})),i=0,a=n.length,s=Math.floor(a/2);if(qo(e,p.range(e,n[i]),r))return p.range(e,n[i],r);if(n.length<2)return p.range(e,n[n.length-1],r);for(;s!==n.length&&s!==i;)qo(e,p.range(e,n[s]),r)?a=s:i=s,s=Math.floor((i+a)/2);return p.range(e,n[a],r)};function Ho(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Ko(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ho(Object(r),!0).forEach(function(n){yi(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ho(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Pp=e=>{var t=e,{apply:r,onChange:n,deleteBackward:i,addMark:a,removeMark:s}=t;return Ei.set(t,new WeakMap),t.addMark=(o,c)=>{var u,l;(u=hs.get(t))===null||u===void 0||u(),!ot.get(t)&&(l=Ne.get(t))!==null&&l!==void 0&&l.length&&ot.set(t,null),Et.delete(t),a(o,c)},t.removeMark=o=>{var c;!ot.get(t)&&(c=Ne.get(t))!==null&&c!==void 0&&c.length&&ot.set(t,null),Et.delete(t),s(o)},t.deleteBackward=o=>{if(o!=="line")return i(o);if(t.selection&&_.isCollapsed(t.selection)){var c=p.above(t,{match:h=>p.isBlock(t,h),at:t.selection});if(c){var[,u]=c,l=p.range(t,u,t.selection.anchor),d=xp(t,l);_.isCollapsed(d)||N.delete(t,{at:d})}}},t.apply=o=>{var c=[],u=Ne.get(t);if(u!=null&&u.length){var l=u.map(b=>sp(b,o)).filter(Boolean);Ne.set(t,l)}var d=Pt.get(t);d&&Pt.set(t,Uo(t,d,o));var h=xt.get(t);if(h!=null&&h.at){var f=se.isPoint(h?.at)?Sa(t,h.at,o):Uo(t,h.at,o);xt.set(t,f?Ko(Ko({},h),{},{at:f}):null)}switch(o.type){case"insert_text":case"remove_text":case"set_node":case"split_node":{c.push(...Pn(t,o.path));break}case"set_selection":{var v;(v=Xr.get(t))===null||v===void 0||v.unref(),Xr.delete(t);break}case"insert_node":case"remove_node":{c.push(...Pn(t,C.parent(o.path)));break}case"merge_node":{var m=C.previous(o.path);c.push(...Pn(t,m));break}case"move_node":{var E=C.common(C.parent(o.path),C.parent(o.newPath));c.push(...Pn(t,E));break}}r(o);for(var[w,g]of c){var[D]=p.node(t,w);Da.set(D,g)}},t.setFragmentData=o=>{var{selection:c}=t;if(!!c){var[u,l]=_.edges(c),d=p.void(t,{at:u.path}),h=p.void(t,{at:l.path});if(!(_.isCollapsed(c)&&!d)){var f=U.toDOMRange(t,c),v=f.cloneContents(),m=v.childNodes[0];if(v.childNodes.forEach(B=>{B.textContent&&B.textContent.trim()!==""&&(m=B)}),h){var[E]=h,w=f.cloneRange(),g=U.toDOMNode(t,E);w.setEndAfter(g),v=w.cloneContents()}if(d&&(m=v.querySelector("[data-slate-spacer]")),Array.from(v.querySelectorAll("[data-slate-zero-width]")).forEach(B=>{var j=B.getAttribute("data-slate-zero-width")==="n";B.textContent=j?`
`:""}),cc(m)){var D=m.ownerDocument.createElement("span");D.style.whiteSpace="pre",D.appendChild(m),v.appendChild(D),m=D}var b=t.getFragment(),y=JSON.stringify(b),A=window.btoa(encodeURIComponent(y));m.setAttribute("data-slate-fragment",A),o.setData("application/x-slate-fragment",A);var x=v.ownerDocument.createElement("div");return x.appendChild(v),x.setAttribute("hidden","true"),v.ownerDocument.body.appendChild(x),o.setData("text/html",x.innerHTML),o.setData("text/plain",fc(x)),v.ownerDocument.body.removeChild(x),o}}},t.insertData=o=>{t.insertFragmentData(o)||t.insertTextData(o)},t.insertFragmentData=o=>{var c=o.getData("application/x-slate-fragment")||Sh(o);if(c){var u=decodeURIComponent(window.atob(c)),l=JSON.parse(u);return t.insertFragment(l),!0}return!1},t.insertTextData=o=>{var c=o.getData("text/plain");if(c){var u=c.split(/\r\n|\r|\n/),l=!1;for(var d of u)l&&N.splitNodes(t,{always:!0}),t.insertText(d),l=!0;return!0}return!1},t.onChange=()=>{hh.default.unstable_batchedUpdates(()=>{var o=Ca.get(t);o&&o(),n()})},t},Pn=(e,t)=>{var r=[];for(var[n,i]of p.levels(e,{at:t})){var a=U.findKey(e,n);r.push([i,a])}return r},ht=()=>new Map,oi=e=>{const t=ht();return e.forEach((r,n)=>{t.set(n,r)}),t},Gt=(e,t,r)=>{let n=e.get(t);return n===void 0&&e.set(t,n=r()),n},Rp=(e,t)=>{const r=[];for(const[n,i]of e)r.push(t(i,n));return r},Ip=(e,t)=>{for(const[r,n]of e)if(t(n,r))return!0;return!1},on=()=>new Set,Ji=e=>e[e.length-1],Mp=(e,t)=>{for(let r=0;r<t.length;r++)e.push(t[r])},bc=Array.from,jp=class{constructor(){this._observers=ht()}on(e,t){Gt(this._observers,e,on).add(t)}once(e,t){const r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){const r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return bc((this._observers.get(e)||ht()).values()).forEach(r=>r(...t))}destroy(){this._observers=ht()}},zt=Math.floor,Vn=Math.abs,Ec=(e,t)=>e<t?e:t,fr=(e,t)=>e>t?e:t,Sc=e=>e!==0?e<0:1/e<0,Lp=e=>e.toLowerCase(),Np=/^\s*/g,Up=e=>e.replace(Np,""),zp=/([A-Z])/g,Yo=(e,t)=>Up(e.replace(zp,r=>`${t}${Lp(r)}`)),$p=e=>{const t=unescape(encodeURIComponent(e)),r=t.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=t.codePointAt(i);return n},Si=typeof TextEncoder<"u"?new TextEncoder:null,Wp=e=>Si.encode(e),Vp=Si?Wp:$p,Zr=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Zr&&Zr.decode(new Uint8Array).length===1&&(Zr=null);var Jo=e=>e===void 0?null:e,Gp=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},Bc=new Gp,qp=!0;try{typeof localStorage<"u"&&(Bc=localStorage,qp=!1)}catch{}var Hp=Bc,ms=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name);typeof navigator<"u"&&/Mac/.test(navigator.platform);var ft,Kp=()=>{if(ft===void 0)if(ms){ft=ht();const e=process.argv;let t=null;for(let r=0;r<e.length;r++){const n=e[r];n[0]==="-"?(t!==null&&ft.set(t,""),t=n):t!==null&&(ft.set(t,n),t=null)}t!==null&&ft.set(t,"")}else typeof location=="object"?(ft=ht(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,r]=e.split("=");ft.set(`--${Yo(t,"-")}`,r),ft.set(`-${Yo(t,"-")}`,r)}})):ft=ht();return ft},Yp=e=>Kp().has(e),Jp=e=>Jo(ms?process.env[e.toUpperCase()]:Hp.getItem(e)),Xp=e=>Yp("--"+e)||Jp(e)!==null;Xp("production");var Xo=1,Zo=2,Xi=4,Zi=8,un=32,Bt=64,We=128,Bi=31,Ba=63,nr=127,Zp=2147483647,Ac=Number.MAX_SAFE_INTEGER,Qp=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&zt(e)===e),Ai=class{constructor(e){this.arr=e,this.pos=0}},dr=e=>new Ai(e),wc=e=>e.pos!==e.arr.length,ev=(e,t)=>{const r=Cs(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,r},ze=e=>ev(e,ne(e)),wr=e=>e.arr[e.pos++],ne=e=>{let t=0,r=1;for(;;){const n=e.arr[e.pos++];if(t=t+(n&nr)*r,r*=128,n<We)return t;if(t>Ac)throw new Error("Integer out of range!")}},wi=e=>{let t=e.arr[e.pos++],r=t&Ba,n=64;const i=(t&Bt)>0?-1:1;if((t&We)===0)return i*r;for(;;){if(t=e.arr[e.pos++],r=r+(t&nr)*n,n*=128,t<We)return i*r;if(r>Ac)throw new Error("Integer out of range!")}},tv=e=>{let t=ne(e);if(t===0)return"";{let r=String.fromCodePoint(wr(e));if(--t<100)for(;t--;)r+=String.fromCodePoint(wr(e));else for(;t>0;){const n=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+n);e.pos+=n,r+=String.fromCodePoint.apply(null,i),t-=n}return decodeURIComponent(escape(r))}},rv=e=>Zr.decode(ze(e)),ir=Zr?rv:tv,Ds=(e,t)=>{const r=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,r},nv=e=>Ds(e,4).getFloat32(0,!1),iv=e=>Ds(e,8).getFloat64(0,!1),av=e=>Ds(e,8).getBigInt64(0,!1),sv=[e=>{},e=>null,wi,nv,iv,av,e=>!1,e=>!0,ir,e=>{const t=ne(e),r={};for(let n=0;n<t;n++){const i=ir(e);r[i]=cn(e)}return r},e=>{const t=ne(e),r=[];for(let n=0;n<t;n++)r.push(cn(e));return r},ze],cn=e=>sv[127-wr(e)](e),Qo=class extends Ai{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),wc(this)?this.count=ne(this)+1:this.count=-1),this.count--,this.s}},Gn=class extends Ai{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=wi(this);const e=Sc(this.s);this.count=1,e&&(this.s=-this.s,this.count=ne(this)+2)}return this.count--,this.s}},Qi=class extends Ai{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=wi(this),t=e&1;this.diff=zt(e/2),this.count=1,t&&(this.count=ne(this)+2)}return this.s+=this.diff,this.count--,this.s}},ov=class{constructor(e){this.decoder=new Gn(e),this.str=ir(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}},uv=e=>new Uint8Array(e),Cs=(e,t,r)=>new Uint8Array(e,t,r),cv=e=>{const t=uv(e.byteLength);return t.set(e),t},Cn=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},yn=()=>new Cn,lv=e=>{let t=e.cpos;for(let r=0;r<e.bufs.length;r++)t+=e.bufs[r].length;return t},ct=e=>{const t=new Uint8Array(lv(e));let r=0;for(let n=0;n<e.bufs.length;n++){const i=e.bufs[n];t.set(i,r),r+=i.length}return t.set(Cs(e.cbuf.buffer,0,e.cpos),r),t},fv=(e,t)=>{const r=e.cbuf.length;r-e.cpos<t&&(e.bufs.push(Cs(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(fr(r,t)*2),e.cpos=0)},_e=(e,t)=>{const r=e.cbuf.length;e.cpos===r&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(r*2),e.cpos=0),e.cbuf[e.cpos++]=t},ln=_e,ce=(e,t)=>{for(;t>nr;)_e(e,We|nr&t),t=zt(t/128);_e(e,nr&t)},_i=(e,t)=>{const r=Sc(t);for(r&&(t=-t),_e(e,(t>Ba?We:0)|(r?Bt:0)|Ba&t),t=zt(t/64);t>0;)_e(e,(t>nr?We:0)|nr&t),t=zt(t/128)},Aa=new Uint8Array(3e4),dv=Aa.length/3,hv=(e,t)=>{if(t.length<dv){const r=Si.encodeInto(t,Aa).written||0;ce(e,r);for(let n=0;n<r;n++)_e(e,Aa[n])}else $e(e,Vp(t))},pv=(e,t)=>{const r=unescape(encodeURIComponent(t)),n=r.length;ce(e,n);for(let i=0;i<n;i++)_e(e,r.codePointAt(i))},ar=Si?hv:pv,ki=(e,t)=>{const r=e.cbuf.length,n=e.cpos,i=Ec(r-n,t.length),a=t.length-i;e.cbuf.set(t.subarray(0,i),n),e.cpos+=i,a>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(fr(r*2,a)),e.cbuf.set(t.subarray(i)),e.cpos=a)},$e=(e,t)=>{ce(e,t.byteLength),ki(e,t)},ys=(e,t)=>{fv(e,t);const r=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,r},vv=(e,t)=>ys(e,4).setFloat32(0,t,!1),gv=(e,t)=>ys(e,8).setFloat64(0,t,!1),mv=(e,t)=>ys(e,8).setBigInt64(0,t,!1),eu=new DataView(new ArrayBuffer(4)),Dv=e=>(eu.setFloat32(0,e),eu.getFloat32(0)===e),fn=(e,t)=>{switch(typeof t){case"string":_e(e,119),ar(e,t);break;case"number":Qp(t)&&Vn(t)<=Zp?(_e(e,125),_i(e,t)):Dv(t)?(_e(e,124),vv(e,t)):(_e(e,123),gv(e,t));break;case"bigint":_e(e,122),mv(e,t);break;case"object":if(t===null)_e(e,126);else if(t instanceof Array){_e(e,117),ce(e,t.length);for(let r=0;r<t.length;r++)fn(e,t[r])}else if(t instanceof Uint8Array)_e(e,116),$e(e,t);else{_e(e,118);const r=Object.keys(t);ce(e,r.length);for(let n=0;n<r.length;n++){const i=r[n];ar(e,i),fn(e,t[i])}}break;case"boolean":_e(e,t?120:121);break;default:_e(e,127)}},tu=class extends Cn{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&ce(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}},ru=e=>{e.count>0&&(_i(e.encoder,e.count===1?e.s:-e.s),e.count>1&&ce(e.encoder,e.count-2))},qn=class{constructor(){this.encoder=new Cn,this.s=0,this.count=0}write(e){this.s===e?this.count++:(ru(this),this.count=1,this.s=e)}toUint8Array(){return ru(this),ct(this.encoder)}},nu=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);_i(e.encoder,t),e.count>1&&ce(e.encoder,e.count-2)}},ea=class{constructor(){this.encoder=new Cn,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(nu(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return nu(this),ct(this.encoder)}},Cv=class{constructor(){this.sarr=[],this.s="",this.lensE=new qn}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Cn;return this.sarr.push(this.s),this.s="",ar(e,this.sarr.join("")),ki(e,this.lensE.toUint8Array()),ct(e)}},iu=typeof crypto>"u"?null:crypto,yv=iu!==null?e=>{const t=new ArrayBuffer(e),r=new Uint8Array(t);return iu.getRandomValues(r),t}:e=>{const t=new ArrayBuffer(e),r=new Uint8Array(t);for(let n=0;n<e;n++)r[n]=Math.ceil(Math.random()*4294967295>>>0);return t},_c=()=>new Uint32Array(yv(4))[0],bv=[1e7]+-1e3+-4e3+-8e3+-1e11,Ev=()=>bv.replace(/[018]/g,e=>(e^_c()&15>>e/4).toString(16)),Sv=e=>new Promise(e),Ti=e=>new Error(e),pt=()=>{throw Ti("Method unimplemented")},Ze=()=>{throw Ti("Unexpected case")},Bv=Object.keys,au=e=>Bv(e).length,Av=(e,t)=>{for(const r in e)if(!t(e[r],r))return!1;return!0},wv=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),_v=(e,t)=>e===t||au(e)===au(t)&&Av(e,(r,n)=>(r!==void 0||wv(t,n))&&t[n]===r),bs=(e,t,r=0)=>{try{for(;r<e.length;r++)e[r](...t)}finally{r<e.length&&bs(e,t,r+1)}},_t=Symbol,kv=class{constructor(e,t){this.left=e,this.right=t}},yt=(e,t)=>new kv(e,t),hr=typeof document<"u"?document:{};typeof DOMParser<"u"&&new DOMParser;var Tv=e=>Rp(e,(t,r)=>`${r}:${t};`).join("");hr.ELEMENT_NODE;hr.TEXT_NODE;hr.CDATA_SECTION_NODE;hr.COMMENT_NODE;hr.DOCUMENT_NODE;hr.DOCUMENT_TYPE_NODE;hr.DOCUMENT_FRAGMENT_NODE;var Es=_t(),Ss=_t(),kc=_t(),Tc=_t(),Fc=_t(),Bs=_t(),Oc=_t(),As=_t(),xc=_t(),Fv={[Es]:yt("font-weight","bold"),[Ss]:yt("font-weight","normal"),[kc]:yt("color","blue"),[Fc]:yt("color","green"),[Tc]:yt("color","grey"),[Bs]:yt("color","red"),[Oc]:yt("color","purple"),[As]:yt("color","orange"),[xc]:yt("color","black")},Ov={[Es]:"\x1B[1m",[Ss]:"\x1B[2m",[kc]:"\x1B[34m",[Fc]:"\x1B[32m",[Tc]:"\x1B[37m",[Bs]:"\x1B[31m",[Oc]:"\x1B[35m",[As]:"\x1B[38;5;208m",[xc]:"\x1B[0m"},xv=e=>{const t=[],r=[],n=ht();let i=[],a=0;for(;a<e.length;a++){const s=e[a],o=Fv[s];if(o!==void 0)n.set(o.left,o.right);else if(s.constructor===String||s.constructor===Number){const c=Tv(n);a>0||c.length>0?(t.push("%c"+s),r.push(c)):t.push(s)}else break}for(a>0&&(i=r,i.unshift(t.join("")));a<e.length;a++){const s=e[a];s instanceof Symbol||i.push(s)}return i},Pv=e=>{const t=[],r=[];let n=0;for(;n<e.length;n++){const i=e[n],a=Ov[i];if(a!==void 0)t.push(a);else if(i.constructor===String||i.constructor===Number)t.push(i);else break}for(n>0&&(t.push("\x1B[0m"),r.push(t.join("")));n<e.length;n++){const i=e[n];i instanceof Symbol||r.push(i)}return r},Rv=ms?Pv:xv,Iv=(...e)=>{console.log(...Rv(e)),Mv.forEach(t=>t.print(e))},Mv=new Set,Pc=e=>({[Symbol.iterator](){return this},next:e}),jv=(e,t)=>Pc(()=>{let r;do r=e.next();while(!r.done&&!t(r.value));return r}),ta=(e,t)=>Pc(()=>{const{done:r,value:n}=e.next();return{done:r,value:r?void 0:t(n)}}),ws=class{constructor(e,t){this.clock=e,this.len=t}},bn=class{constructor(){this.clients=new Map}},wa=(e,t,r)=>t.clients.forEach((n,i)=>{const a=e.doc.store.clients.get(i);for(let s=0;s<n.length;s++){const o=n[s];Kc(e,a,o.clock,o.len,r)}}),Lv=(e,t)=>{let r=0,n=e.length-1;for(;r<=n;){const i=zt((r+n)/2),a=e[i],s=a.clock;if(s<=t){if(t<s+a.len)return i;r=i+1}else n=i-1}return null},Rc=(e,t)=>{const r=e.clients.get(t.client);return r!==void 0&&Lv(r,t.clock)!==null},_s=e=>{e.clients.forEach(t=>{t.sort((i,a)=>i.clock-a.clock);let r,n;for(r=1,n=1;r<t.length;r++){const i=t[n-1],a=t[r];i.clock+i.len>=a.clock?i.len=fr(i.len,a.clock+a.len-i.clock):(n<r&&(t[n]=a),n++)}t.length=n})},Nv=e=>{const t=new bn;for(let r=0;r<e.length;r++)e[r].clients.forEach((n,i)=>{if(!t.clients.has(i)){const a=n.slice();for(let s=r+1;s<e.length;s++)Mp(a,e[s].clients.get(i)||[]);t.clients.set(i,a)}});return _s(t),t},ui=(e,t,r,n)=>{Gt(e.clients,t,()=>[]).push(new ws(r,n))},Ic=()=>new bn,Uv=e=>{const t=Ic();return e.clients.forEach((r,n)=>{const i=[];for(let a=0;a<r.length;a++){const s=r[a];if(s.deleted){const o=s.id.clock;let c=s.length;if(a+1<r.length)for(let u=r[a+1];a+1<r.length&&u.deleted;u=r[++a+1])c+=u.length;i.push(new ws(o,c))}}i.length>0&&t.clients.set(n,i)}),t},xr=(e,t)=>{ce(e.restEncoder,t.clients.size),t.clients.forEach((r,n)=>{e.resetDsCurVal(),ce(e.restEncoder,n);const i=r.length;ce(e.restEncoder,i);for(let a=0;a<i;a++){const s=r[a];e.writeDsClock(s.clock),e.writeDsLen(s.len)}})},ks=e=>{const t=new bn,r=ne(e.restDecoder);for(let n=0;n<r;n++){e.resetDsCurVal();const i=ne(e.restDecoder),a=ne(e.restDecoder);if(a>0){const s=Gt(t.clients,i,()=>[]);for(let o=0;o<a;o++)s.push(new ws(e.readDsClock(),e.readDsLen()))}}return t},su=(e,t,r)=>{const n=new bn,i=ne(e.restDecoder);for(let a=0;a<i;a++){e.resetDsCurVal();const s=ne(e.restDecoder),o=ne(e.restDecoder),c=r.clients.get(s)||[],u=Be(r,s);for(let l=0;l<o;l++){const d=e.readDsClock(),h=d+e.readDsLen();if(d<u){u<h&&ui(n,s,u,h-u);let f=vt(c,d),v=c[f];for(!v.deleted&&v.id.clock<d&&(c.splice(f+1,0,pi(t,v,d-v.id.clock)),f++);f<c.length&&(v=c[f++],v.id.clock<h);)v.deleted||(h<v.id.clock+v.length&&c.splice(f,0,pi(t,v,h-v.id.clock)),v.delete(t))}else ui(n,s,d,h-d)}}if(n.clients.size>0){const a=new cr;return ce(a.restEncoder,0),xr(a,n),a.toUint8Array()}return null},Mc=_c,$t=class extends jp{constructor({guid:e=Ev(),collectionid:t=null,gc:r=!0,gcFilter:n=()=>!0,meta:i=null,autoLoad:a=!1,shouldLoad:s=!0}={}){super(),this.gc=r,this.gcFilter=n,this.clientID=Mc(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new qc,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=s,this.autoLoad=a,this.meta=i,this.isLoaded=!1,this.whenLoaded=Sv(o=>{this.on("load",()=>{this.isLoaded=!0,o(this)})})}load(){const e=this._item;e!==null&&!this.shouldLoad&&pe(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Array.from(this.subdocs).map(e=>e.guid))}transact(e,t=null){pe(this,e,t)}get(e,t=xe){const r=Gt(this.share,e,()=>{const i=new t;return i._integrate(this,null),i}),n=r.constructor;if(t!==xe&&n!==t)if(n===xe){const i=new t;i._map=r._map,r._map.forEach(a=>{for(;a!==null;a=a.left)a.parent=i}),i._start=r._start;for(let a=i._start;a!==null;a=a.right)a.parent=i;return i._length=r._length,this.share.set(e,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Qr)}getText(e=""){return this.get(e,vn)}getMap(e=""){return this.get(e,pn)}getXmlFragment(e=""){return this.get(e,kr)}toJSON(){const e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){bc(this.subdocs).forEach(t=>t.destroy());const e=this._item;if(e!==null){this._item=null;const t=e.content;t.doc=new $t({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,pe(e.parent.doc,r=>{const n=t.doc;e.deleted||r.subdocsAdded.add(n),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(e,t){super.on(e,t)}off(e,t){super.off(e,t)}},jc=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return ne(this.restDecoder)}readDsLen(){return ne(this.restDecoder)}},Lc=class extends jc{readLeftID(){return ie(ne(this.restDecoder),ne(this.restDecoder))}readRightID(){return ie(ne(this.restDecoder),ne(this.restDecoder))}readClient(){return ne(this.restDecoder)}readInfo(){return wr(this.restDecoder)}readString(){return ir(this.restDecoder)}readParentInfo(){return ne(this.restDecoder)===1}readTypeRef(){return ne(this.restDecoder)}readLen(){return ne(this.restDecoder)}readAny(){return cn(this.restDecoder)}readBuf(){return cv(ze(this.restDecoder))}readJSON(){return JSON.parse(ir(this.restDecoder))}readKey(){return ir(this.restDecoder)}},zv=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=ne(this.restDecoder),this.dsCurrVal}readDsLen(){const e=ne(this.restDecoder)+1;return this.dsCurrVal+=e,e}},_r=class extends zv{constructor(e){super(e),this.keys=[],ne(e),this.keyClockDecoder=new Qi(ze(e)),this.clientDecoder=new Gn(ze(e)),this.leftClockDecoder=new Qi(ze(e)),this.rightClockDecoder=new Qi(ze(e)),this.infoDecoder=new Qo(ze(e),wr),this.stringDecoder=new ov(ze(e)),this.parentInfoDecoder=new Qo(ze(e),wr),this.typeRefDecoder=new Gn(ze(e)),this.lenDecoder=new Gn(ze(e))}readLeftID(){return new Er(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Er(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return cn(this.restDecoder)}readBuf(){return ze(this.restDecoder)}readJSON(){return cn(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const t=this.stringDecoder.read();return this.keys.push(t),t}}},$v=class{constructor(){this.restEncoder=yn()}toUint8Array(){return ct(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){ce(this.restEncoder,e)}writeDsLen(e){ce(this.restEncoder,e)}},En=class extends $v{writeLeftID(e){ce(this.restEncoder,e.client),ce(this.restEncoder,e.clock)}writeRightID(e){ce(this.restEncoder,e.client),ce(this.restEncoder,e.clock)}writeClient(e){ce(this.restEncoder,e)}writeInfo(e){ln(this.restEncoder,e)}writeString(e){ar(this.restEncoder,e)}writeParentInfo(e){ce(this.restEncoder,e?1:0)}writeTypeRef(e){ce(this.restEncoder,e)}writeLen(e){ce(this.restEncoder,e)}writeAny(e){fn(this.restEncoder,e)}writeBuf(e){$e(this.restEncoder,e)}writeJSON(e){ar(this.restEncoder,JSON.stringify(e))}writeKey(e){ar(this.restEncoder,e)}},Wv=class{constructor(){this.restEncoder=yn(),this.dsCurrVal=0}toUint8Array(){return ct(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,ce(this.restEncoder,t)}writeDsLen(e){e===0&&Ze(),ce(this.restEncoder,e-1),this.dsCurrVal+=e}},cr=class extends Wv{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new ea,this.clientEncoder=new qn,this.leftClockEncoder=new ea,this.rightClockEncoder=new ea,this.infoEncoder=new tu(ln),this.stringEncoder=new Cv,this.parentInfoEncoder=new tu(ln),this.typeRefEncoder=new qn,this.lenEncoder=new qn}toUint8Array(){const e=yn();return ce(e,0),$e(e,this.keyClockEncoder.toUint8Array()),$e(e,this.clientEncoder.toUint8Array()),$e(e,this.leftClockEncoder.toUint8Array()),$e(e,this.rightClockEncoder.toUint8Array()),$e(e,ct(this.infoEncoder)),$e(e,this.stringEncoder.toUint8Array()),$e(e,ct(this.parentInfoEncoder)),$e(e,this.typeRefEncoder.toUint8Array()),$e(e,this.lenEncoder.toUint8Array()),ki(e,ct(this.restEncoder)),ct(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){fn(this.restEncoder,e)}writeBuf(e){$e(this.restEncoder,e)}writeJSON(e){fn(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},Vv=(e,t,r,n)=>{n=fr(n,t[0].id.clock);const i=vt(t,n);ce(e.restEncoder,t.length-i),e.writeClient(r),ce(e.restEncoder,n);const a=t[i];a.write(e,n-a.id.clock);for(let s=i+1;s<t.length;s++)t[s].write(e,0)},Ts=(e,t,r)=>{const n=new Map;r.forEach((i,a)=>{Be(t,a)>i&&n.set(a,i)}),Os(t).forEach((i,a)=>{r.has(a)||n.set(a,0)}),ce(e.restEncoder,n.size),Array.from(n.entries()).sort((i,a)=>a[0]-i[0]).forEach(([i,a])=>{Vv(e,t.clients.get(i),i,a)})},Gv=(e,t)=>{const r=ht(),n=ne(e.restDecoder);for(let i=0;i<n;i++){const a=ne(e.restDecoder),s=new Array(a),o=e.readClient();let c=ne(e.restDecoder);r.set(o,{i:0,refs:s});for(let u=0;u<a;u++){const l=e.readInfo();switch(Bi&l){case 0:{const d=e.readLen();s[u]=new Je(ie(o,c),d),c+=d;break}case 10:{const d=ne(e.restDecoder);s[u]=new Xe(ie(o,c),d),c+=d;break}default:{const d=(l&(Bt|We))===0,h=new be(ie(o,c),null,(l&We)===We?e.readLeftID():null,null,(l&Bt)===Bt?e.readRightID():null,d?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,d&&(l&un)===un?e.readString():null,pl(e,l));s[u]=h,c+=h.length}}}}return r},qv=(e,t,r)=>{const n=[];let i=Array.from(r.keys()).sort((f,v)=>f-v);if(i.length===0)return null;const a=()=>{if(i.length===0)return null;let f=r.get(i[i.length-1]);for(;f.refs.length===f.i;)if(i.pop(),i.length>0)f=r.get(i[i.length-1]);else return null;return f};let s=a();if(s===null&&n.length===0)return null;const o=new qc,c=new Map,u=(f,v)=>{const m=c.get(f);(m==null||m>v)&&c.set(f,v)};let l=s.refs[s.i++];const d=new Map,h=()=>{for(const f of n){const v=f.id.client,m=r.get(v);m?(m.i--,o.clients.set(v,m.refs.slice(m.i)),r.delete(v),m.i=0,m.refs=[]):o.clients.set(v,[f]),i=i.filter(E=>E!==v)}n.length=0};for(;;){if(l.constructor!==Xe){const v=Gt(d,l.id.client,()=>Be(t,l.id.client))-l.id.clock;if(v<0)n.push(l),u(l.id.client,l.id.clock-1),h();else{const m=l.getMissing(e,t);if(m!==null){n.push(l);const E=r.get(m)||{refs:[],i:0};if(E.refs.length===E.i)u(m,Be(t,m)),h();else{l=E.refs[E.i++];continue}}else(v===0||v<l.length)&&(l.integrate(e,v),d.set(l.id.client,l.id.clock+l.length))}}if(n.length>0)l=n.pop();else if(s!==null&&s.i<s.refs.length)l=s.refs[s.i++];else{if(s=a(),s===null)break;l=s.refs[s.i++]}}if(o.clients.size>0){const f=new cr;return Ts(f,o,new Map),ce(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},Hv=(e,t)=>Ts(e,t.doc.store,t.beforeState),Kv=(e,t,r,n=new _r(e))=>pe(t,i=>{i.local=!1;let a=!1;const s=i.doc,o=s.store,c=Gv(n,s),u=qv(i,o,c),l=o.pendingStructs;if(l){for(const[h,f]of l.missing)if(f<Be(o,h)){a=!0;break}if(u){for(const[h,f]of u.missing){const v=l.missing.get(h);(v==null||v>f)&&l.missing.set(h,f)}l.update=ci([l.update,u.update])}}else o.pendingStructs=u;const d=su(n,i,o);if(o.pendingDs){const h=new _r(dr(o.pendingDs));ne(h.restDecoder);const f=su(h,i,o);d&&f?o.pendingDs=ci([d,f]):o.pendingDs=d||f}else o.pendingDs=d;if(a){const h=o.pendingStructs.update;o.pendingStructs=null,Nc(i.doc,h)}},r,!1),Nc=(e,t,r,n=_r)=>{const i=dr(t);Kv(i,e,r,new n(i))},it=(e,t,r)=>Nc(e,t,r,Lc),Yv=(e,t,r=new Map)=>{Ts(e,t.store,r),xr(e,Uv(t.store))},Jv=(e,t=new Uint8Array([0]),r=new cr)=>{const n=Uc(t);Yv(r,e,n);const i=[r.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(vg(e.store.pendingStructs.update,t)),i.length>1){if(r.constructor===En)return hg(i.map((a,s)=>s===0?a:mg(a)));if(r.constructor===cr)return ci(i)}return i[0]},Nt=(e,t)=>Jv(e,t,new En),Xv=e=>{const t=new Map,r=ne(e.restDecoder);for(let n=0;n<r;n++){const i=ne(e.restDecoder),a=ne(e.restDecoder);t.set(i,a)}return t},Uc=e=>Xv(new jc(dr(e))),Zv=class{constructor(){this.l=[]}},ou=()=>new Zv,uu=(e,t)=>e.l.push(t),cu=(e,t)=>{const r=e.l,n=r.length;e.l=r.filter(i=>t!==i),n===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},zc=(e,t,r)=>bs(e.l,[t,r]),Er=class{constructor(e,t){this.client=e,this.clock=t}},Rn=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,ie=(e,t)=>new Er(e,t),lu=(e,t)=>{ce(e,t.client),ce(e,t.clock)},fu=e=>ie(ne(e),ne(e)),$c=e=>{for(const[t,r]of e.doc.share.entries())if(r===e)return t;throw Ze()},Fs=class{constructor(e,t,r,n=0){this.type=e,this.tname=t,this.item=r,this.assoc=n}},Qv=e=>new Fs(e.type==null?null:ie(e.type.client,e.type.clock),e.tname||null,e.item==null?null:ie(e.item.client,e.item.clock),e.assoc==null?0:e.assoc),eg=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},tg=(e,t,r=0)=>new eg(e,t,r),In=(e,t,r)=>{let n=null,i=null;return e._item===null?i=$c(e):n=ie(e._item.id.client,e._item.id.clock),new Fs(n,i,t,r)},Wc=(e,t,r=0)=>{let n=e._start;if(r<0){if(t===0)return In(e,null,r);t--}for(;n!==null;){if(!n.deleted&&n.countable){if(n.length>t)return In(e,ie(n.id.client,n.id.clock+t),r);t-=n.length}if(n.right===null&&r<0)return In(e,n.lastId,r);n=n.right}return In(e,null,r)},rg=(e,t)=>{const{type:r,tname:n,item:i,assoc:a}=t;if(i!==null)ce(e,0),lu(e,i);else if(n!==null)ln(e,1),ar(e,n);else if(r!==null)ln(e,2),lu(e,r);else throw Ze();return _i(e,a),e},ng=e=>{const t=yn();return rg(t,e),ct(t)},ig=e=>{let t=null,r=null,n=null;switch(ne(e)){case 0:n=fu(e);break;case 1:r=ir(e);break;case 2:t=fu(e)}const i=wc(e)?wi(e):0;return new Fs(t,r,n,i)},Vc=e=>ig(dr(e)),Gc=(e,t)=>{const r=t.store,n=e.item,i=e.type,a=e.tname,s=e.assoc;let o=null,c=0;if(n!==null){if(Be(r,n.client)<=n.clock)return null;const u=Du(r,n),l=u.item;if(!(l instanceof be))return null;if(o=l.parent,o._item===null||!o._item.deleted){c=l.deleted||!l.countable?0:u.diff+(s>=0?0:1);let d=l.left;for(;d!==null;)!d.deleted&&d.countable&&(c+=d.length),d=d.left}}else{if(a!==null)o=t.get(a);else if(i!==null){if(Be(r,i.client)<=i.clock)return null;const{item:u}=Du(r,i);if(u instanceof be&&u.content instanceof kt)o=u.content.type;else return null}else throw Ze();s>=0?c=o._length:c=0}return tg(o,c,e.assoc)},ag=class{constructor(e,t){this.ds=e,this.sv=t}},sg=(e,t)=>new ag(e,t);sg(Ic(),new Map);var Ur=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Rc(t.ds,e.id),Hn=(e,t)=>{const r=Gt(e.meta,Hn,on),n=e.doc.store;r.has(t)||(t.sv.forEach((i,a)=>{i<Be(n,a)&&Wt(e,ie(a,i))}),wa(e,t.ds,i=>{}),r.add(t))},qc=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},Os=e=>{const t=new Map;return e.clients.forEach((r,n)=>{const i=r[r.length-1];t.set(n,i.id.clock+i.length)}),t},Be=(e,t)=>{const r=e.clients.get(t);if(r===void 0)return 0;const n=r[r.length-1];return n.id.clock+n.length},Hc=(e,t)=>{let r=e.clients.get(t.id.client);if(r===void 0)r=[],e.clients.set(t.id.client,r);else{const n=r[r.length-1];if(n.id.clock+n.length!==t.id.clock)throw Ze()}r.push(t)},vt=(e,t)=>{let r=0,n=e.length-1,i=e[n],a=i.id.clock;if(a===t)return n;let s=zt(t/(a+i.length-1)*n);for(;r<=n;){if(i=e[s],a=i.id.clock,a<=t){if(t<a+i.length)return s;r=s+1}else n=s-1;s=zt((r+n)/2)}throw Ze()},og=(e,t)=>{const r=e.clients.get(t.client);return r[vt(r,t.clock)]},Kn=og,_a=(e,t,r)=>{const n=vt(t,r),i=t[n];return i.id.clock<r&&i instanceof be?(t.splice(n+1,0,pi(e,i,r-i.id.clock)),n+1):n},Wt=(e,t)=>{const r=e.doc.store.clients.get(t.client);return r[_a(e,r,t.clock)]},du=(e,t,r)=>{const n=t.clients.get(r.client),i=vt(n,r.clock),a=n[i];return r.clock!==a.id.clock+a.length-1&&a.constructor!==Je&&n.splice(i+1,0,pi(e,a,r.clock-a.id.clock+1)),a},ug=(e,t,r)=>{const n=e.clients.get(t.id.client);n[vt(n,t.id.clock)]=r},Kc=(e,t,r,n,i)=>{if(n===0)return;const a=r+n;let s=_a(e,t,r),o;do o=t[s++],a<o.id.clock+o.length&&_a(e,t,a),i(o);while(s<t.length&&t[s].id.clock<a)},cg=class{constructor(e,t,r){this.doc=e,this.deleteSet=new bn,this.beforeState=Os(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}},hu=(e,t)=>t.deleteSet.clients.size===0&&!Ip(t.afterState,(r,n)=>t.beforeState.get(n)!==r)?!1:(_s(t.deleteSet),Hv(e,t),xr(e,t.deleteSet),!0),pu=(e,t,r)=>{const n=t._item;(n===null||n.id.clock<(e.beforeState.get(n.id.client)||0)&&!n.deleted)&&Gt(e.changed,t,on).add(r)},Yn=(e,t)=>{const r=e[t-1],n=e[t];r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)&&(e.splice(t,1),n instanceof be&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r))},lg=(e,t,r)=>{for(const[n,i]of e.clients.entries()){const a=t.clients.get(n);for(let s=i.length-1;s>=0;s--){const o=i[s],c=o.clock+o.len;for(let u=vt(a,o.clock),l=a[u];u<a.length&&l.id.clock<c;l=a[++u]){const d=a[u];if(o.clock+o.len<=d.id.clock)break;d instanceof be&&d.deleted&&!d.keep&&r(d)&&d.gc(t,!1)}}}},fg=(e,t)=>{e.clients.forEach((r,n)=>{const i=t.clients.get(n);for(let a=r.length-1;a>=0;a--){const s=r[a],o=Ec(i.length-1,1+vt(i,s.clock+s.len-1));for(let c=o,u=i[c];c>0&&u.id.clock>=s.clock;u=i[--c])Yn(i,c)}})},Yc=(e,t)=>{if(t<e.length){const r=e[t],n=r.doc,i=n.store,a=r.deleteSet,s=r._mergeStructs;try{_s(a),r.afterState=Os(r.doc.store),n._transaction=null,n.emit("beforeObserverCalls",[r,n]);const o=[];r.changed.forEach((c,u)=>o.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(r,c)})),o.push(()=>{r.changedParentTypes.forEach((c,u)=>o.push(()=>{(u._item===null||!u._item.deleted)&&(c=c.filter(l=>l.target._item===null||!l.target._item.deleted),c.forEach(l=>{l.currentTarget=u}),c.sort((l,d)=>l.path.length-d.path.length),zc(u._dEH,c,r))})),o.push(()=>n.emit("afterTransaction",[r,n]))}),bs(o,[])}finally{n.gc&&lg(a,i,n.gcFilter),fg(a,i),r.afterState.forEach((l,d)=>{const h=r.beforeState.get(d)||0;if(h!==l){const f=i.clients.get(d),v=fr(vt(f,h),1);for(let m=f.length-1;m>=v;m--)Yn(f,m)}});for(let l=0;l<s.length;l++){const{client:d,clock:h}=s[l].id,f=i.clients.get(d),v=vt(f,h);v+1<f.length&&Yn(f,v+1),v>0&&Yn(f,v)}if(!r.local&&r.afterState.get(n.clientID)!==r.beforeState.get(n.clientID)&&(Iv(As,Es,"[yjs] ",Ss,Bs,"Changed the client-id because another client seems to be using it."),n.clientID=Mc()),n.emit("afterTransactionCleanup",[r,n]),n._observers.has("update")){const l=new En;hu(l,r)&&n.emit("update",[l.toUint8Array(),r.origin,n,r])}if(n._observers.has("updateV2")){const l=new cr;hu(l,r)&&n.emit("updateV2",[l.toUint8Array(),r.origin,n,r])}const{subdocsAdded:o,subdocsLoaded:c,subdocsRemoved:u}=r;(o.size>0||u.size>0||c.size>0)&&(o.forEach(l=>{l.clientID=n.clientID,l.collectionid==null&&(l.collectionid=n.collectionid),n.subdocs.add(l)}),u.forEach(l=>n.subdocs.delete(l)),n.emit("subdocs",[{loaded:c,added:o,removed:u},n,r]),u.forEach(l=>l.destroy())),e.length<=t+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,e])):Yc(e,t+1)}}},pe=(e,t,r=null,n=!0)=>{const i=e._transactionCleanups;let a=!1;e._transaction===null&&(a=!0,e._transaction=new cg(e,r,n),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{t(e._transaction)}finally{a&&i[0]===e._transaction&&Yc(i,0)}};function*dg(e){const t=ne(e.restDecoder);for(let r=0;r<t;r++){const n=ne(e.restDecoder),i=e.readClient();let a=ne(e.restDecoder);for(let s=0;s<n;s++){const o=e.readInfo();if(o===10){const c=ne(e.restDecoder);yield new Xe(ie(i,a),c),a+=c}else if((Bi&o)!==0){const c=(o&(Bt|We))===0,u=new be(ie(i,a),null,(o&We)===We?e.readLeftID():null,null,(o&Bt)===Bt?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(o&un)===un?e.readString():null,pl(e,o));yield u,a+=u.length}else{const c=e.readLen();yield new Je(ie(i,a),c),a+=c}}}}var xs=class{constructor(e,t){this.gen=dg(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Xe);return this.curr}},Ps=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},hg=e=>ci(e,Lc,En),pg=(e,t)=>{if(e.constructor===Je){const{client:r,clock:n}=e.id;return new Je(ie(r,n+t),e.length-t)}else if(e.constructor===Xe){const{client:r,clock:n}=e.id;return new Xe(ie(r,n+t),e.length-t)}else{const r=e,{client:n,clock:i}=r.id;return new be(ie(n,i+t),null,ie(n,i+t-1),null,r.rightOrigin,r.parent,r.parentSub,r.content.splice(t))}},ci=(e,t=_r,r=cr)=>{if(e.length===1)return e[0];const n=e.map(l=>new t(dr(l)));let i=n.map(l=>new xs(l,!0)),a=null;const s=new r,o=new Ps(s);for(;i=i.filter(h=>h.curr!==null),i.sort((h,f)=>{if(h.curr.id.client===f.curr.id.client){const v=h.curr.id.clock-f.curr.id.clock;return v===0?h.curr.constructor===f.curr.constructor?0:h.curr.constructor===Xe?1:-1:v}else return f.curr.id.client-h.curr.id.client}),i.length!==0;){const l=i[0],d=l.curr.id.client;if(a!==null){let h=l.curr,f=!1;for(;h!==null&&h.id.clock+h.length<=a.struct.id.clock+a.struct.length&&h.id.client>=a.struct.id.client;)h=l.next(),f=!0;if(h===null||h.id.client!==d||f&&h.id.clock>a.struct.id.clock+a.struct.length)continue;if(d!==a.struct.id.client)Rt(o,a.struct,a.offset),a={struct:h,offset:0},l.next();else if(a.struct.id.clock+a.struct.length<h.id.clock)if(a.struct.constructor===Xe)a.struct.length=h.id.clock+h.length-a.struct.id.clock;else{Rt(o,a.struct,a.offset);const v=h.id.clock-a.struct.id.clock-a.struct.length;a={struct:new Xe(ie(d,a.struct.id.clock+a.struct.length),v),offset:0}}else{const v=a.struct.id.clock+a.struct.length-h.id.clock;v>0&&(a.struct.constructor===Xe?a.struct.length-=v:h=pg(h,v)),a.struct.mergeWith(h)||(Rt(o,a.struct,a.offset),a={struct:h,offset:0},l.next())}}else a={struct:l.curr,offset:0},l.next();for(let h=l.curr;h!==null&&h.id.client===d&&h.id.clock===a.struct.id.clock+a.struct.length&&h.constructor!==Xe;h=l.next())Rt(o,a.struct,a.offset),a={struct:h,offset:0}}a!==null&&(Rt(o,a.struct,a.offset),a=null),Rs(o);const c=n.map(l=>ks(l)),u=Nv(c);return xr(s,u),s.toUint8Array()},vg=(e,t,r=_r,n=cr)=>{const i=Uc(t),a=new n,s=new Ps(a),o=new r(dr(e)),c=new xs(o,!1);for(;c.curr;){const l=c.curr,d=l.id.client,h=i.get(d)||0;if(c.curr.constructor===Xe){c.next();continue}if(l.id.clock+l.length>h)for(Rt(s,l,fr(h-l.id.clock,0)),c.next();c.curr&&c.curr.id.client===d;)Rt(s,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===d&&c.curr.id.clock+c.curr.length<=h;)c.next()}Rs(s);const u=ks(o);return xr(a,u),a.toUint8Array()},Jc=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:ct(e.encoder.restEncoder)}),e.encoder.restEncoder=yn(),e.written=0)},Rt=(e,t,r)=>{e.written>0&&e.currClient!==t.id.client&&Jc(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),ce(e.encoder.restEncoder,t.id.clock+r)),t.write(e.encoder,r),e.written++},Rs=e=>{Jc(e);const t=e.encoder.restEncoder;ce(t,e.clientStructs.length);for(let r=0;r<e.clientStructs.length;r++){const n=e.clientStructs[r];ce(t,n.written),ki(t,n.restEncoder)}},gg=(e,t,r)=>{const n=new t(dr(e)),i=new xs(n,!1),a=new r,s=new Ps(a);for(let c=i.curr;c!==null;c=i.next())Rt(s,c,0);Rs(s);const o=ks(n);return xr(a,o),a.toUint8Array()},mg=e=>gg(e,_r,En),Fi=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null}get path(){return Dg(this.currentTarget,this.target)}deletes(e){return Rc(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){const e=new Map,t=this.target;this.transaction.changed.get(t).forEach(n=>{if(n!==null){const i=t._map.get(n);let a,s;if(this.adds(i)){let o=i.left;for(;o!==null&&this.adds(o);)o=o.left;if(this.deletes(i))if(o!==null&&this.deletes(o))a="delete",s=Ji(o.content.getContent());else return;else o!==null&&this.deletes(o)?(a="update",s=Ji(o.content.getContent())):(a="add",s=void 0)}else if(this.deletes(i))a="delete",s=Ji(i.content.getContent());else return;e.set(n,{action:a,oldValue:s})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){const t=this.target,r=on(),n=on(),i=[];if(e={added:r,deleted:n,delta:i,keys:this.keys},this.transaction.changed.get(t).has(null)){let s=null;const o=()=>{s&&i.push(s)};for(let c=t._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((s===null||s.delete===void 0)&&(o(),s={delete:0}),s.delete+=c.length,n.add(c)):this.adds(c)?((s===null||s.insert===void 0)&&(o(),s={insert:[]}),s.insert=s.insert.concat(c.content.getContent()),r.add(c)):((s===null||s.retain===void 0)&&(o(),s={retain:0}),s.retain+=c.length);s!==null&&s.retain===void 0&&o()}this._changes=e}return e}},Dg=(e,t)=>{const r=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)r.unshift(t._item.parentSub);else{let n=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)i.deleted||n++,i=i.right;r.unshift(n)}t=t._item.parent}return r},Xc=80,Is=0,Cg=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=Is++}},yg=e=>{e.timestamp=Is++},Zc=(e,t,r)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=r,e.timestamp=Is++},bg=(e,t,r)=>{if(e.length>=Xc){const n=e.reduce((i,a)=>i.timestamp<a.timestamp?i:a);return Zc(n,t,r),n}else{const n=new Cg(t,r);return e.push(n),n}},Oi=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const r=e._searchMarker.length===0?null:e._searchMarker.reduce((a,s)=>Vn(t-a.index)<Vn(t-s.index)?a:s);let n=e._start,i=0;for(r!==null&&(n=r.p,i=r.index,yg(r));n.right!==null&&i<t;){if(!n.deleted&&n.countable){if(t<i+n.length)break;i+=n.length}n=n.right}for(;n.left!==null&&i>t;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);return r!==null&&Vn(r.index-i)<n.parent.length/Xc?(Zc(r,n,i),r):bg(e._searchMarker,n,i)},dn=(e,t,r)=>{for(let n=e.length-1;n>=0;n--){const i=e[n];if(r>0){let a=i.p;for(a.marker=!1;a&&(a.deleted||!a.countable);)a=a.left,a&&!a.deleted&&a.countable&&(i.index-=a.length);if(a===null||a.marker===!0){e.splice(n,1);continue}i.p=a,a.marker=!0}(t<i.index||r>0&&t===i.index)&&(i.index=fr(t,i.index+r))}},xi=(e,t,r)=>{const n=e,i=t.changedParentTypes;for(;Gt(i,e,()=>[]).push(r),e._item!==null;)e=e._item.parent;zc(n._eH,r,t)},xe=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=ou(),this._dEH=ou(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw pt()}clone(){throw pt()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){uu(this._eH,e)}observeDeep(e){uu(this._dEH,e)}unobserve(e){cu(this._eH,e)}unobserveDeep(e){cu(this._dEH,e)}toJSON(){}},Qc=(e,t,r)=>{t<0&&(t=e._length+t),r<0&&(r=e._length+r);let n=r-t;const i=[];let a=e._start;for(;a!==null&&n>0;){if(a.countable&&!a.deleted){const s=a.content.getContent();if(s.length<=t)t-=s.length;else{for(let o=t;o<s.length&&n>0;o++)i.push(s[o]),n--;t=0}}a=a.right}return i},el=e=>{const t=[];let r=e._start;for(;r!==null;){if(r.countable&&!r.deleted){const n=r.content.getContent();for(let i=0;i<n.length;i++)t.push(n[i])}r=r.right}return t},hn=(e,t)=>{let r=0,n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const i=n.content.getContent();for(let a=0;a<i.length;a++)t(i[a],r++,e)}n=n.right}},tl=(e,t)=>{const r=[];return hn(e,(n,i)=>{r.push(t(n,i,e))}),r},Eg=e=>{let t=e._start,r=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(r===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};r=t.content.getContent(),n=0,t=t.right}const i=r[n++];return r.length<=n&&(r=null),{done:!1,value:i}}}},rl=(e,t)=>{const r=Oi(e,t);let n=e._start;for(r!==null&&(n=r.p,t-=r.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(t<n.length)return n.content.getContent()[t];t-=n.length}},li=(e,t,r,n)=>{let i=r;const a=e.doc,s=a.clientID,o=a.store,c=r===null?t._start:r.right;let u=[];const l=()=>{u.length>0&&(i=new be(ie(s,Be(o,s)),i,i&&i.lastId,c,c&&c.id,t,null,new Tr(u)),i.integrate(e,0),u=[])};n.forEach(d=>{if(d===null)u.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(d);break;default:switch(l(),d.constructor){case Uint8Array:case ArrayBuffer:i=new be(ie(s,Be(o,s)),i,i&&i.lastId,c,c&&c.id,t,null,new Pi(new Uint8Array(d))),i.integrate(e,0);break;case $t:i=new be(ie(s,Be(o,s)),i,i&&i.lastId,c,c&&c.id,t,null,new Ri(d)),i.integrate(e,0);break;default:if(d instanceof xe)i=new be(ie(s,Be(o,s)),i,i&&i.lastId,c,c&&c.id,t,null,new kt(d)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),l()},nl=Ti("Length exceeded!"),il=(e,t,r,n)=>{if(r>t._length)throw nl;if(r===0)return t._searchMarker&&dn(t._searchMarker,r,n.length),li(e,t,null,n);const i=r,a=Oi(t,r);let s=t._start;for(a!==null&&(s=a.p,r-=a.index,r===0&&(s=s.prev,r+=s&&s.countable&&!s.deleted?s.length:0));s!==null;s=s.right)if(!s.deleted&&s.countable){if(r<=s.length){r<s.length&&Wt(e,ie(s.id.client,s.id.clock+r));break}r-=s.length}return t._searchMarker&&dn(t._searchMarker,i,n.length),li(e,t,s,n)},Sg=(e,t,r)=>{let i=(t._searchMarker||[]).reduce((a,s)=>s.index>a.index?s:a,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return li(e,t,i,r)},al=(e,t,r,n)=>{if(n===0)return;const i=r,a=n,s=Oi(t,r);let o=t._start;for(s!==null&&(o=s.p,r-=s.index);o!==null&&r>0;o=o.right)!o.deleted&&o.countable&&(r<o.length&&Wt(e,ie(o.id.client,o.id.clock+r)),r-=o.length);for(;n>0&&o!==null;)o.deleted||(n<o.length&&Wt(e,ie(o.id.client,o.id.clock+n)),o.delete(e),n-=o.length),o=o.right;if(n>0)throw nl;t._searchMarker&&dn(t._searchMarker,i,-a+n)},fi=(e,t,r)=>{const n=t._map.get(r);n!==void 0&&n.delete(e)},Ms=(e,t,r,n)=>{const i=t._map.get(r)||null,a=e.doc,s=a.clientID;let o;if(n==null)o=new Tr([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:o=new Tr([n]);break;case Uint8Array:o=new Pi(n);break;case $t:o=new Ri(n);break;default:if(n instanceof xe)o=new kt(n);else throw new Error("Unexpected content type")}new be(ie(s,Be(a.store,s)),i,i&&i.lastId,null,null,t,r,o).integrate(e,0)},js=(e,t)=>{const r=e._map.get(t);return r!==void 0&&!r.deleted?r.content.getContent()[r.length-1]:void 0},sl=e=>{const t={};return e._map.forEach((r,n)=>{r.deleted||(t[n]=r.content.getContent()[r.length-1])}),t},ol=(e,t)=>{const r=e._map.get(t);return r!==void 0&&!r.deleted},Mn=e=>jv(e.entries(),t=>!t[1].deleted),Bg=class extends Fi{constructor(e,t){super(e,t),this._transaction=t}},Qr=class extends xe{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const t=new Qr;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Qr}clone(){const e=new Qr;return e.insert(0,this.toArray().map(t=>t instanceof xe?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),xi(this,e,new Bg(this,e))}insert(e,t){this.doc!==null?pe(this.doc,r=>{il(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?pe(this.doc,t=>{Sg(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?pe(this.doc,r=>{al(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return rl(this,e)}toArray(){return el(this)}slice(e=0,t=this.length){return Qc(this,e,t)}toJSON(){return this.map(e=>e instanceof xe?e.toJSON():e)}map(e){return tl(this,e)}forEach(e){hn(this,e)}[Symbol.iterator](){return Eg(this)}_write(e){e.writeTypeRef(qg)}},Ag=e=>new Qr,wg=class extends Fi{constructor(e,t,r){super(e,t),this.keysChanged=r}},pn=class extends xe{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,n)=>{this.set(n,r)}),this._prelimContent=null}_copy(){return new pn}clone(){const e=new pn;return this.forEach((t,r)=>{e.set(r,t instanceof xe?t.clone():t)}),e}_callObserver(e,t){xi(this,e,new wg(this,e,t))}toJSON(){const e={};return this._map.forEach((t,r)=>{if(!t.deleted){const n=t.content.getContent()[t.length-1];e[r]=n instanceof xe?n.toJSON():n}}),e}get size(){return[...Mn(this._map)].length}keys(){return ta(Mn(this._map),e=>e[0])}values(){return ta(Mn(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return ta(Mn(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){const t={};return this._map.forEach((r,n)=>{r.deleted||e(r.content.getContent()[r.length-1],n,this)}),t}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?pe(this.doc,t=>{fi(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?pe(this.doc,r=>{Ms(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return js(this,e)}has(e){return ol(this,e)}clear(){this.doc!==null?pe(this.doc,e=>{this.forEach(function(t,r,n){fi(e,n,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(Hg)}},_g=e=>new pn,Mt=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&_v(e,t),ka=class{constructor(e,t,r,n){this.left=e,this.right=t,this.index=r,this.currentAttributes=n}forward(){switch(this.right===null&&Ze(),this.right.content.constructor){case Te:this.right.deleted||Pr(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},vu=(e,t,r)=>{for(;t.right!==null&&r>0;){switch(t.right.content.constructor){case Te:t.right.deleted||Pr(t.currentAttributes,t.right.content);break;default:t.right.deleted||(r<t.right.length&&Wt(e,ie(t.right.id.client,t.right.id.clock+r)),t.index+=t.right.length,r-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},jn=(e,t,r)=>{const n=new Map,i=Oi(t,r);if(i){const a=new ka(i.p.left,i.p,i.index,n);return vu(e,a,r-i.index)}else{const a=new ka(null,t._start,0,n);return vu(e,a,r)}},ul=(e,t,r,n)=>{for(;r.right!==null&&(r.right.deleted===!0||r.right.content.constructor===Te&&Mt(n.get(r.right.content.key),r.right.content.value));)r.right.deleted||n.delete(r.right.content.key),r.forward();const i=e.doc,a=i.clientID;n.forEach((s,o)=>{const c=r.left,u=r.right,l=new be(ie(a,Be(i.store,a)),c,c&&c.lastId,u,u&&u.id,t,null,new Te(o,s));l.integrate(e,0),r.right=l,r.forward()})},Pr=(e,t)=>{const{key:r,value:n}=t;n===null?e.delete(r):e.set(r,n)},cl=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===Te&&Mt(t[e.right.content.key]||null,e.right.content.value)))break;e.forward()}},ll=(e,t,r,n)=>{const i=e.doc,a=i.clientID,s=new Map;for(const o in n){const c=n[o],u=r.currentAttributes.get(o)||null;if(!Mt(u,c)){s.set(o,u);const{left:l,right:d}=r;r.right=new be(ie(a,Be(i.store,a)),l,l&&l.lastId,d,d&&d.id,t,null,new Te(o,c)),r.right.integrate(e,0),r.forward()}}return s},ra=(e,t,r,n,i)=>{r.currentAttributes.forEach((h,f)=>{i[f]===void 0&&(i[f]=null)});const a=e.doc,s=a.clientID;cl(r,i);const o=ll(e,t,r,i),c=n.constructor===String?new wt(n):n instanceof xe?new kt(n):new Rr(n);let{left:u,right:l,index:d}=r;t._searchMarker&&dn(t._searchMarker,r.index,c.getLength()),l=new be(ie(s,Be(a.store,s)),u,u&&u.lastId,l,l&&l.id,t,null,c),l.integrate(e,0),r.right=l,r.index=d,r.forward(),ul(e,t,r,o)},gu=(e,t,r,n,i)=>{const a=e.doc,s=a.clientID;cl(r,i);const o=ll(e,t,r,i);e:for(;r.right!==null&&(n>0||o.size>0&&(r.right.deleted||r.right.content.constructor===Te));){if(!r.right.deleted)switch(r.right.content.constructor){case Te:{const{key:c,value:u}=r.right.content,l=i[c];if(l!==void 0){if(Mt(l,u))o.delete(c);else{if(n===0)break e;o.set(c,u)}r.right.delete(e)}else r.currentAttributes.set(c,u);break}default:n<r.right.length&&Wt(e,ie(r.right.id.client,r.right.id.clock+n)),n-=r.right.length;break}r.forward()}if(n>0){let c="";for(;n>0;n--)c+=`
`;r.right=new be(ie(s,Be(a.store,s)),r.left,r.left&&r.left.lastId,r.right,r.right&&r.right.id,t,null,new wt(c)),r.right.integrate(e,0),r.forward()}ul(e,t,r,o)},fl=(e,t,r,n,i)=>{let a=r;const s=oi(i);for(;a&&(!a.countable||a.deleted);)!a.deleted&&a.content.constructor===Te&&Pr(s,a.content),a=a.right;let o=0,c=!1;for(;t!==a;){if(r===t&&(c=!0),!t.deleted){const u=t.content;switch(u.constructor){case Te:{const{key:l,value:d}=u;((s.get(l)||null)!==d||(n.get(l)||null)===d)&&(t.delete(e),o++,!c&&(i.get(l)||null)===d&&(n.get(l)||null)!==d&&i.delete(l));break}}}t=t.right}return o},kg=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const r=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Te){const n=t.content.key;r.has(n)?t.delete(e):r.add(n)}t=t.left}},Tg=e=>{let t=0;return pe(e.doc,r=>{let n=e._start,i=e._start,a=ht();const s=oi(a);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Te:Pr(s,i.content);break;default:t+=fl(r,n,i,a,s),a=oi(s),n=i;break}i=i.right}}),t},mu=(e,t,r)=>{const n=r,i=oi(t.currentAttributes),a=t.right;for(;r>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case kt:case Rr:case wt:r<t.right.length&&Wt(e,ie(t.right.id.client,t.right.id.clock+r)),r-=t.right.length,t.right.delete(e);break}t.forward()}a&&fl(e,a,t.right,i,t.currentAttributes);const s=(t.left||t.right).parent;return s._searchMarker&&dn(s._searchMarker,t.index,-n+r),t},dl=class extends Fi{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(n=>{n===null?this.childListChanged=!0:this.keysChanged.add(n)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,t=[];pe(e,r=>{const n=new Map,i=new Map;let a=this.target._start,s=null;const o={};let c="",u=0,l=0;const d=()=>{if(s!==null){let h;switch(s){case"delete":h={delete:l},l=0;break;case"insert":h={insert:c},n.size>0&&(h.attributes={},n.forEach((f,v)=>{f!==null&&(h.attributes[v]=f)})),c="";break;case"retain":if(h={retain:u},Object.keys(o).length>0){h.attributes={};for(const f in o)h.attributes[f]=o[f]}u=0;break}t.push(h),s=null}};for(;a!==null;){switch(a.content.constructor){case kt:case Rr:this.adds(a)?this.deletes(a)||(d(),s="insert",c=a.content.getContent()[0],d()):this.deletes(a)?(s!=="delete"&&(d(),s="delete"),l+=1):a.deleted||(s!=="retain"&&(d(),s="retain"),u+=1);break;case wt:this.adds(a)?this.deletes(a)||(s!=="insert"&&(d(),s="insert"),c+=a.content.str):this.deletes(a)?(s!=="delete"&&(d(),s="delete"),l+=a.length):a.deleted||(s!=="retain"&&(d(),s="retain"),u+=a.length);break;case Te:{const{key:h,value:f}=a.content;if(this.adds(a)){if(!this.deletes(a)){const v=n.get(h)||null;Mt(v,f)?f!==null&&a.delete(r):(s==="retain"&&d(),Mt(f,i.get(h)||null)?delete o[h]:o[h]=f)}}else if(this.deletes(a)){i.set(h,f);const v=n.get(h)||null;Mt(v,f)||(s==="retain"&&d(),o[h]=v)}else if(!a.deleted){i.set(h,f);const v=o[h];v!==void 0&&(Mt(v,f)?v!==null&&a.delete(r):(s==="retain"&&d(),f===null?delete o[h]:o[h]=f))}a.deleted||(s==="insert"&&d(),Pr(n,a.content));break}}a=a.right}for(d();t.length>0;){const h=t[t.length-1];if(h.retain!==void 0&&h.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},vn=class extends xe{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new vn}clone(){const e=new vn;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);const r=new dl(this,e,t),n=e.doc;if(xi(this,e,r),!e.local){let i=!1;for(const[a,s]of e.afterState.entries()){const o=e.beforeState.get(a)||0;if(s!==o&&(Kc(e,n.store.clients.get(a),o,s,c=>{!c.deleted&&c.content.constructor===Te&&(i=!0)}),i))break}i||wa(e,e.deleteSet,a=>{a instanceof Je||i||a.parent===this&&a.content.constructor===Te&&(i=!0)}),pe(n,a=>{i?Tg(this):wa(a,a.deleteSet,s=>{s instanceof Je||s.parent===this&&kg(a,s)})})}}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===wt&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?pe(this.doc,r=>{const n=new ka(null,this._start,0,new Map);for(let i=0;i<e.length;i++){const a=e[i];if(a.insert!==void 0){const s=!t&&typeof a.insert=="string"&&i===e.length-1&&n.right===null&&a.insert.slice(-1)===`
`?a.insert.slice(0,-1):a.insert;(typeof s!="string"||s.length>0)&&ra(r,this,n,s,a.attributes||{})}else a.retain!==void 0?gu(r,this,n,a.retain,a.attributes||{}):a.delete!==void 0&&mu(r,n,a.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){const n=[],i=new Map,a=this.doc;let s="",o=this._start;function c(){if(s.length>0){const u={};let l=!1;i.forEach((h,f)=>{l=!0,u[f]=h});const d={insert:s};l&&(d.attributes=u),n.push(d),s=""}}return pe(a,u=>{for(e&&Hn(u,e),t&&Hn(u,t);o!==null;){if(Ur(o,e)||t!==void 0&&Ur(o,t))switch(o.content.constructor){case wt:{const l=i.get("ychange");e!==void 0&&!Ur(o,e)?(l===void 0||l.user!==o.id.client||l.state!=="removed")&&(c(),i.set("ychange",r?r("removed",o.id):{type:"removed"})):t!==void 0&&!Ur(o,t)?(l===void 0||l.user!==o.id.client||l.state!=="added")&&(c(),i.set("ychange",r?r("added",o.id):{type:"added"})):l!==void 0&&(c(),i.delete("ychange")),s+=o.content.str;break}case kt:case Rr:{c();const l={insert:o.content.getContent()[0]};if(i.size>0){const d={};l.attributes=d,i.forEach((h,f)=>{d[f]=h})}n.push(l);break}case Te:Ur(o,e)&&(c(),Pr(i,o.content));break}o=o.right}c()},Hn),n}insert(e,t,r){if(t.length<=0)return;const n=this.doc;n!==null?pe(n,i=>{const a=jn(i,this,e);r||(r={},a.currentAttributes.forEach((s,o)=>{r[o]=s})),ra(i,this,a,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r={}){const n=this.doc;n!==null?pe(n,i=>{const a=jn(i,this,e);ra(i,this,a,t,r)}):this._pending.push(()=>this.insertEmbed(e,t,r))}delete(e,t){if(t===0)return;const r=this.doc;r!==null?pe(r,n=>{mu(n,jn(n,this,e),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;const n=this.doc;n!==null?pe(n,i=>{const a=jn(i,this,e);a.right!==null&&gu(i,this,a,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?pe(this.doc,t=>{fi(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?pe(this.doc,r=>{Ms(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return js(this,e)}getAttributes(e){return sl(this)}_write(e){e.writeTypeRef(Kg)}},Fg=e=>new vn,na=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===di||t.constructor===kr)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},kr=class extends xe{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new kr}clone(){const e=new kr;return e.insert(0,this.toArray().map(t=>t instanceof xe?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new na(this,e)}querySelector(e){e=e.toUpperCase();const r=new na(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Array.from(new na(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){xi(this,e,new Pg(this,t,e))}toString(){return tl(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){const n=e.createDocumentFragment();return r!==void 0&&r._createAssociation(n,this),hn(this,i=>{n.insertBefore(i.toDOM(e,t,r),null)}),n}insert(e,t){this.doc!==null?pe(this.doc,r=>{il(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)pe(this.doc,r=>{const n=e&&e instanceof xe?e._item:e;li(r,this,n,t)});else{const r=this._prelimContent,n=e===null?0:r.findIndex(i=>i===e)+1;if(n===0&&e!==null)throw Ti("Reference item not found");r.splice(n,0,...t)}}delete(e,t=1){this.doc!==null?pe(this.doc,r=>{al(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return el(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return rl(this,e)}slice(e=0,t=this.length){return Qc(this,e,t)}forEach(e){hn(this,e)}_write(e){e.writeTypeRef(Jg)}},Og=e=>new kr,di=class extends kr{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,n)=>{this.setAttribute(n,r)}),this._prelimAttrs=null}_copy(){return new di(this.nodeName)}clone(){const e=new di(this.nodeName),t=this.getAttributes();for(const r in t)e.setAttribute(r,t[r]);return e.insert(0,this.toArray().map(r=>r instanceof xe?r.clone():r)),e}toString(){const e=this.getAttributes(),t=[],r=[];for(const s in e)r.push(s);r.sort();const n=r.length;for(let s=0;s<n;s++){const o=r[s];t.push(o+'="'+e[o]+'"')}const i=this.nodeName.toLocaleLowerCase(),a=t.length>0?" "+t.join(" "):"";return`<${i}${a}>${super.toString()}</${i}>`}removeAttribute(e){this.doc!==null?pe(this.doc,t=>{fi(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?pe(this.doc,r=>{Ms(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return js(this,e)}hasAttribute(e){return ol(this,e)}getAttributes(e){return sl(this)}toDOM(e=document,t={},r){const n=e.createElement(this.nodeName),i=this.getAttributes();for(const a in i)n.setAttribute(a,i[a]);return hn(this,a=>{n.appendChild(a.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(Yg),e.writeKey(this.nodeName)}},xg=e=>new di(e.readKey()),Pg=class extends Fi{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(n=>{n===null?this.childListChanged=!0:this.attributesChanged.add(n)})}},Ta=class extends pn{constructor(e){super(),this.hookName=e}_copy(){return new Ta(this.hookName)}clone(){const e=new Ta(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){const n=t[this.hookName];let i;return n!==void 0?i=n.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(Xg),e.writeKey(this.hookName)}},Rg=e=>new Ta(e.readKey()),Fe=class extends vn{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Fe}clone(){const e=new Fe;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){const n=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(n,this),n}toString(){return this.toDelta().map(e=>{const t=[];for(const n in e.attributes){const i=[];for(const a in e.attributes[n])i.push({key:a,value:e.attributes[n][a]});i.sort((a,s)=>a.key<s.key?-1:1),t.push({nodeName:n,attrs:i})}t.sort((n,i)=>n.nodeName<i.nodeName?-1:1);let r="";for(let n=0;n<t.length;n++){const i=t[n];r+=`<${i.nodeName}`;for(let a=0;a<i.attrs.length;a++){const s=i.attrs[a];r+=` ${s.key}="${s.value}"`}r+=">"}r+=e.insert;for(let n=t.length-1;n>=0;n--)r+=`</${t[n].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(Zg)}},Ig=e=>new Fe,Ls=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw pt()}mergeWith(e){return!1}write(e,t,r){throw pt()}integrate(e,t){throw pt()}},Mg=0,Je=class extends Ls{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),Hc(e.doc.store,this)}write(e,t){e.writeInfo(Mg),e.writeLen(this.length-t)}getMissing(e,t){return null}},Pi=class{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Pi(this.content)}splice(e){throw pt()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},jg=e=>new Pi(e.readBuf()),hi=class{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new hi(this.len)}splice(e){const t=new hi(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){ui(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},Lg=e=>new hi(e.readLen()),hl=(e,t)=>new $t({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1}),Ri=class{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Ri(hl(this.doc.guid,this.opts))}splice(e){throw pt()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},Ng=e=>new Ri(hl(e.readString(),e.readAny())),Rr=class{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Rr(this.embed)}splice(e){throw pt()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},Ug=e=>new Rr(e.readJSON()),Te=class{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Te(this.key,this.value)}splice(e){throw pt()}mergeWith(e){return!1}integrate(e,t){t.parent._searchMarker=null}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},zg=e=>new Te(e.readKey(),e.readJSON()),Fa=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Fa(this.arr)}splice(e){const t=new Fa(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){const i=this.arr[n];e.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}},$g=e=>{const t=e.readLen(),r=[];for(let n=0;n<t;n++){const i=e.readString();i==="undefined"?r.push(void 0):r.push(JSON.parse(i))}return new Fa(r)},Tr=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Tr(this.arr)}splice(e){const t=new Tr(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){const i=this.arr[n];e.writeAny(i)}}getRef(){return 8}},Wg=e=>{const t=e.readLen(),r=[];for(let n=0;n<t;n++)r.push(e.readAny());return new Tr(r)},wt=class{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new wt(this.str)}splice(e){const t=new wt(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},Vg=e=>new wt(e.readString()),Gg=[Ag,_g,Fg,xg,Og,Rg,Ig],qg=0,Hg=1,Kg=2,Yg=3,Jg=4,Xg=5,Zg=6,kt=class{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new kt(this.type._copy())}splice(e){throw pt()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},Qg=e=>new kt(Gg[e.readTypeRef()](e)),Du=(e,t)=>{let r=t,n=0,i;do n>0&&(r=ie(r.client,r.clock+n)),i=Kn(e,r),n=r.clock-i.id.clock,r=i.redone;while(r!==null&&i instanceof be);return{item:i,diff:n}},pi=(e,t,r)=>{const{client:n,clock:i}=t.id,a=new be(ie(n,i+r),t,ie(n,i+r-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(r));return t.deleted&&a.markDeleted(),t.keep&&(a.keep=!0),t.redone!==null&&(a.redone=ie(t.redone.client,t.redone.clock+r)),t.right=a,a.right!==null&&(a.right.left=a),e._mergeStructs.push(a),a.parentSub!==null&&a.right===null&&a.parent._map.set(a.parentSub,a),t.length=r,a},be=class extends Ls{constructor(e,t,r,n,i,a,s,o){super(e,o.getLength()),this.origin=r,this.left=t,this.right=n,this.rightOrigin=i,this.parent=a,this.parentSub=s,this.redone=null,this.content=o,this.info=this.content.isCountable()?Zo:0}set marker(e){(this.info&Zi)>0!==e&&(this.info^=Zi)}get marker(){return(this.info&Zi)>0}get keep(){return(this.info&Xo)>0}set keep(e){this.keep!==e&&(this.info^=Xo)}get countable(){return(this.info&Zo)>0}get deleted(){return(this.info&Xi)>0}set deleted(e){this.deleted!==e&&(this.info^=Xi)}markDeleted(){this.info|=Xi}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Be(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Be(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Er&&this.id.client!==this.parent.client&&this.parent.clock>=Be(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=du(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Wt(e,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===Je||this.right&&this.right.constructor===Je)&&(this.parent=null),!this.parent)this.left&&this.left.constructor===be&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===be&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Er){const r=Kn(t,this.parent);r.constructor===Je?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=du(e,e.doc.store,ie(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,n;if(r!==null)n=r.right;else if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start;const i=new Set,a=new Set;for(;n!==null&&n!==this.right;){if(a.add(n),i.add(n),Rn(this.origin,n.origin)){if(n.id.client<this.id.client)r=n,i.clear();else if(Rn(this.rightOrigin,n.rightOrigin))break}else if(n.origin!==null&&a.has(Kn(e.doc.store,n.origin)))i.has(Kn(e.doc.store,n.origin))||(r=n,i.clear());else break;n=n.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Hc(e.doc.store,this),this.content.integrate(e,this),pu(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Je(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:ie(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Rn(e.origin,this.lastId)&&this.right===e&&Rn(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),ui(e.deleteSet,this.id.client,this.id.clock,this.length),pu(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Ze();this.content.gc(e),t?ug(e,this,new Je(this.id,this.length)):this.content=new hi(this.length)}write(e,t){const r=t>0?ie(this.id.client,this.id.clock+t-1):this.origin,n=this.rightOrigin,i=this.parentSub,a=this.content.getRef()&Bi|(r===null?0:We)|(n===null?0:Bt)|(i===null?0:un);if(e.writeInfo(a),r!==null&&e.writeLeftID(r),n!==null&&e.writeRightID(n),r===null&&n===null){const s=this.parent;if(s._item!==void 0){const o=s._item;if(o===null){const c=$c(s);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(o.id)}else s.constructor===String?(e.writeParentInfo(!0),e.writeString(s)):s.constructor===Er?(e.writeParentInfo(!1),e.writeLeftID(s)):Ze();i!==null&&e.writeString(i)}this.content.write(e,t)}},pl=(e,t)=>em[t&Bi](e),em=[()=>{Ze()},Lg,$g,jg,Vg,Ug,zg,Qg,Wg,Ng,()=>{Ze()}],tm=10,Xe=class extends Ls{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){Ze()}write(e,t){e.writeInfo(tm),ce(e.restEncoder,this.length-t)}getMissing(e,t){return null}},vl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},gl="__ $YJS$ __";vl[gl]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");vl[gl]=!0;var rm=Object.defineProperty,nm=Object.defineProperties,im=Object.getOwnPropertyDescriptors,vi=Object.getOwnPropertySymbols,ml=Object.prototype.hasOwnProperty,Dl=Object.prototype.propertyIsEnumerable,Cu=(e,t,r)=>t in e?rm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Qe=(e,t)=>{for(var r in t||(t={}))ml.call(t,r)&&Cu(e,r,t[r]);if(vi)for(var r of vi(t))Dl.call(t,r)&&Cu(e,r,t[r]);return e},Sn=(e,t)=>nm(e,im(t)),am=(e,t)=>{var r={};for(var n in e)ml.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&vi)for(var n of vi(e))t.indexOf(n)<0&&Dl.call(e,n)&&(r[n]=e[n]);return r};function yu(e){return Object.prototype.toString.call(e)==="[object Object]"}function bu(e){if(!yu(e))return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(yu(r)===!1||r.hasOwnProperty("isPrototypeOf")===!1)}function Ns(e,t){for(const r in e){const n=e[r],i=t[r];if(bu(n)&&bu(i)){if(!Ns(n,i))return!1}else if(Array.isArray(n)&&Array.isArray(i)){if(n.length!==i.length)return!1;for(let a=0;a<n.length;a++)if(n[a]!==i[a])return!1}else if(n!==i)return!1}for(const r in t)if(e[r]===void 0&&t[r]!==void 0)return!1;return!0}function sm(e,...t){return Object.fromEntries(Object.entries(e).filter(([r])=>t.includes(r)))}function om(e,...t){return Object.fromEntries(Object.entries(e).filter(([r])=>!t.includes(r)))}function um(e){return Object.fromEntries(Object.entries(e).filter(([,t])=>t!==null))}function cm(e){var t,r;const n=[];for(const i of e){if(typeof i.insert=="string"&&i.insert.length===0)continue;const a=n[n.length-1];if(!a||typeof a.insert!="string"||typeof i.insert!="string"){n.push(i);continue}if(a.attributes===i.attributes||!a.attributes==!i.attributes&&Ns((t=a.attributes)!=null?t:{},(r=i.attributes)!=null?r:{})){a.insert+=i.insert;continue}n.push(i)}return n}function Tt(e){return cm(e.toDelta())}function Cl({insert:e}){return typeof e=="string"?e.length:1}function yl(e){return e.reduce((t,r)=>t+Cl(r),0)}function bl(e,t,r){if(r<1)return[];let n=0;const i=[],a=t+r;for(let s=0;s<e.length&&!(n>=a);s++){const o=e[s],c=Cl(o);if(n+c<=t){n+=c;continue}if(typeof o.insert!="string"){n+=c,i.push(o);continue}const u=Math.max(0,t-n),l=Math.min(c,c-(n+c-a));i.push(Sn(Qe({},o),{insert:o.insert.slice(u,l)})),n+=c}return i}function jt(e){return om(e,G.isText(e)?"text":"children")}function El(e){const t=Tt(e),r=t.length>0?t.map(Oa):[{text:""}];return Sn(Qe({},e.getAttributes()),{children:r})}function Oa(e){return typeof e.insert=="string"?Sn(Qe({},e.attributes),{text:e.insert}):El(e.insert)}function Sl(e){return e.map(t=>G.isText(t)?{insert:t.text,attributes:jt(t)}:{insert:Bl(t)})}function Bl(e){var t=e,{children:r}=t,n=am(t,["children"]);const i=new Fe;return Object.entries(n).forEach(([a,s])=>{i.setAttribute(a,s)}),i.applyDelta(Sl(r),{sanitize:!1}),i}function gn(e){return e?G.isText(e)?e.text.length:1:0}function lm(e,t){return e.children.slice(0,t).reduce((r,n)=>r+gn(n),0)}function qe(e,t,r){var n;if(r.length===0)throw new Error("Path has to a have a length >= 1");if(G.isText(t))throw new Error("Cannot descent into slate text");const[i,...a]=r,s=lm(t,i),o=t.children[i],c=Tt(e),u=gn(o),l=bl(c,s,u);if(l.length>1)throw new Error("Path doesn't match yText, yTarget spans multiple nodes");const d=(n=l[0])==null?void 0:n.insert;if(a.length>0){if(!(d instanceof Fe))throw new Error("Path doesn't match yText, cannot descent into non-yText");return qe(d,o,a)}return{yParent:e,textRange:{start:s,end:s+u},yTarget:d instanceof Fe?d:void 0,slateParent:t,slateTarget:o,targetDelta:l}}function Qt(e,t,r={}){const{assoc:n=0,insert:i=!1}=r;let a=0,s=0;for(let u=0;u<e.children.length;u++){const l=e.children[u],d=G.isText(l)?l.text.length:1;d>0&&(s=u);const h=a+d;if(d>0&&(n>=0?h>t:h>=t))return[u,t-a];a+=d}if(t>a+(i?1:0))throw new Error("yOffset out of bounds");if(i)return[e.children.length,0];const o=e.children[s],c=G.isText(o)?o.text.length:1;return[s,c]}function Al(e,t,r){const n=[r];for(;n[0]!==e;){const{parent:a}=n[0];if(!a)throw new Error("yText isn't a descendant of root element");if(!(a instanceof Fe))throw new Error("Unexpected y parent type");n.unshift(a)}if(n.length<2)return[];let i=t;return n.reduce((a,s,o)=>{const c=n[o+1];if(!c)return a;let u=0;const l=Tt(s);for(const h of l){if(h.insert===c)break;u+=typeof h.insert=="string"?h.insert.length:1}if(G.isText(i))throw new Error("Cannot descent into slate text");const[d]=Qt(i,u);return i=i.children[d],a.concat(d)},[])}function fm(e,t,r){const n=[];let i=r.reduce((a,s)=>"retain"in s?a+s.retain:"delete"in s?a+s.delete:a,0);return r.reverse().forEach(a=>{var s;if("attributes"in a&&"retain"in a){const[o,c]=Qt(e,i-a.retain),[u,l]=Qt(e,i,{assoc:-1});for(let d=u;d>=o;d--){const h=e.children[d],f=[...t,d],v=a.attributes,m=sm(e,...Object.keys(a.attributes));if(G.isText(h)&&(d===o||d===u)){const E=d===o?c:0,w=d===u?l:h.text.length;if(w!==h.text.length&&n.push({type:"split_node",path:f,position:w,properties:jt(h)}),E!==0){n.push({type:"split_node",path:f,position:E,properties:um(Qe(Qe({},jt(h)),v))});continue}}n.push({type:"set_node",newProperties:v,path:f,properties:m})}}if("retain"in a&&(i-=a.retain),"delete"in a){const[o,c]=Qt(e,i-a.delete),[u,l]=Qt(e,i,{assoc:-1});for(let d=l===0?u-1:u;d>=o;d--){const h=e.children[d],f=[...t,d];if(G.isText(h)&&(d===o||d===u)){const v=d===o?c:0,m=d===u?l:h.text.length;n.push({type:"remove_text",offset:v,text:h.text.slice(v,m),path:f}),i-=m-v;continue}n.push({type:"remove_node",node:h,path:f}),i-=gn(h)}return}if("insert"in a){const[o,c]=Qt(e,i,{insert:!0}),u=e.children[o],l=[...t,o];if(G.isText(u)){if(typeof a.insert=="string"&&Ns((s=a.attributes)!=null?s:{},jt(u)))return n.push({type:"insert_text",offset:c,text:a.insert,path:l});const d=Oa(a);return c===0?n.push({type:"insert_node",path:l,node:d}):(c<u.text.length&&n.push({type:"split_node",path:l,position:c,properties:jt(u)}),n.push({type:"insert_node",path:C.next(l),node:d}))}return n.push({type:"insert_node",path:l,node:Oa(a)})}}),n}function dm(e,t,r){const{target:n,changes:i}=r,a=r.delta;if(!(n instanceof Fe))throw new Error("Unexpected target node type");const s=[],o=Al(e,t,n),c=$.get(t,o);if(G.isText(c))throw new Error("Cannot apply yTextEvent to text node");const u=Array.from(i.keys.entries());if(o.length>0&&u.length>0){const l=Object.fromEntries(u.map(([h,f])=>[h,f.action==="delete"?null:n.getAttribute(h)])),d=Object.fromEntries(u.map(([h])=>[h,c[h]]));s.push({type:"set_node",newProperties:l,properties:d,path:o})}if(a.length>0){if(G.isText(c))throw new Error("Cannot apply delta to slate text");s.push(...fm(c,o,a))}return s}function hm(e,t,r){if(r instanceof dl)return dm(e,t,r);throw new Error("Unexpected Y event type")}function pm(e,t,r){p.withoutNormalizing(t,()=>{r.forEach(n=>{hm(e,t,n).forEach(i=>{t.apply(i)})})})}function vm(e,t,r){const{yParent:n,textRange:i}=qe(e,t,r.path);if(G.isText(r.node))return n.insert(i.start,r.node.text,jt(r.node));n.insertEmbed(i.start,Bl(r.node))}function Ii(e){return e.map(t=>typeof t.insert=="string"?t:Sn(Qe({},t),{insert:gm(t.insert)}))}function gm(e){const t=new Fe,r=e.getAttributes();return Object.entries(r).forEach(([n,i])=>{t.setAttribute(n,i)}),t.applyDelta(Ii(Tt(e)),{sanitize:!1}),t}function Sr(e){if(!e.doc)throw new Error("shared type isn't attached to a document")}var lr="__slateYjsStoredPosition_";function mm(e,t,r){const{yTarget:n,yParent:i,textRange:a}=qe(e,t,r.path);if(n)throw new Error("Slate point points to a non-text element inside sharedRoot");return Wc(i,a.start+r.offset,r.offset===a.end?-1:0)}function Dm(e,t,{type:r,index:n,assoc:i}){if(!(r instanceof Fe))throw new Error("Absolute position points to a non-XMLText");const a=Al(e,t,r),s=$.get(t,a);if(G.isText(s))throw new Error("Absolute position doesn't match slateRoot, cannot descent into text");const[o,c]=Qt(s,n,{assoc:i}),u=s.children[o];return G.isText(u)?{path:[...a,o],offset:c}:null}function Cm(e,t,r){if(!e.doc)throw new Error("sharedRoot isn't attach to a yDoc");const n=Gc(r,e.doc);return n&&Dm(e,t,n)}function ym(e,t){const r=e.getAttribute(lr+t);return r?Vc(r):null}function bm(e){return Object.fromEntries(Object.entries(e.getAttributes()).filter(([t])=>t.startsWith(lr)).map(([t,r])=>[t.slice(lr.length),Qv(r)]))}function Em(e){return Sr(e),Object.fromEntries(Object.entries(e.getAttributes()).filter(([t])=>t.startsWith(lr)).map(([t,r])=>[t.slice(lr.length),Gc(Vc(r),e.doc)]).filter(([,t])=>t))}function Sm(e,t){e.removeAttribute(lr+t)}function wl(e,t,r){e.setAttribute(lr+t,ng(r))}function _l(e,t,r){return Object.fromEntries(Object.entries(e).filter(([,n])=>n.type!==t?!1:r?n.assoc>=0?n.index>=r.start&&n.index<r.end:n.index>r.start&&n.index>=r.end:!0))}function kl(e,t,r=""){const n={[r]:_l(e,t)};return Tt(t).forEach(({insert:a},s)=>{a instanceof Fe&&Object.assign(n,kl(e,a,r?`${r}.${s}`:s.toString()))}),n}function Us(e,t,r,n=0){const i=Em(e),a={"":_l(i,t,{start:n,end:n+yl(r)})};return r.forEach(({insert:s},o)=>{s instanceof Fe&&Object.assign(a,kl(i,s,o.toString()))}),a}function Mi(e,t,r,n,i=0,a=0,s=""){const o=r[s];o&&Object.entries(o).forEach(([c,u])=>{wl(e,c,Wc(t,u.index-a+i,u.assoc))}),n.forEach(({insert:c},u)=>{c instanceof Fe&&Mi(e,c,r,Tt(c),0,0,s?`${s}.${u}`:u.toString())})}function Bm(e,t,r){const n=qe(e,t,r.path),i=qe(n.yParent,n.slateParent,C.previous(r.path.slice(-1)));if(!n.yTarget!=!i.yTarget)throw new Error("Cannot merge y text with y element");if(!i.yTarget||!n.yTarget){const{yParent:l,textRange:d}=n,h=$.get(t,C.previous(r.path));if(!G.isText(h))throw new Error("Path points to a y text but not a slate node");return l.format(d.start,d.start-d.end,jt(h))}const a=i.yTarget.length,s=Tt(n.yTarget),o=Ii(s),c=Us(e,n.yTarget,s,a),u=[{retain:a},...o];i.yTarget.applyDelta(u,{sanitize:!1}),n.yParent.delete(n.textRange.start,n.textRange.end-n.textRange.start),Mi(e,i.yTarget,c,o,a)}function Am(e,t,r){const n=C.parent(r.newPath),i=r.newPath[r.newPath.length-1],a=$.get(t,n);if(G.isText(a))throw new Error("Cannot move slate node into text element");const s=[...n,Math.min(i,a.children.length)],o=qe(e,t,r.path),c=qe(e,t,s),u=Ii(o.targetDelta),l=Us(e,o.yParent,o.targetDelta);o.yParent.delete(o.textRange.start,o.textRange.end-o.textRange.start);const d=yl(Tt(c.yParent)),h=Math.min(c.textRange.start,d),f=[{retain:h},...u];c.yParent.applyDelta(f,{sanitize:!1}),Mi(e,c.yParent,l,u,h,o.textRange.start)}function wm(e,t,r){const{yParent:n,textRange:i}=qe(e,t,r.path);n.delete(i.start,i.end-i.start)}function _m(e,t,r){const{yTarget:n,textRange:i,yParent:a}=qe(e,t,r.path);if(n)return Object.entries(r.newProperties).forEach(([c,u])=>{if(u===null)return n.removeAttribute(c);n.setAttribute(c,u)}),Object.entries(r.properties).forEach(([c])=>{r.newProperties.hasOwnProperty(c)||n.removeAttribute(c)});const s=Object.fromEntries(Object.keys(r.properties).map(c=>[c,null])),o=Qe(Qe({},s),r.newProperties);a.format(i.start,i.end-i.start,o)}function km(e,t,r){const n=qe(e,t,r.path);if(!n.slateTarget)throw new Error("Y target without corresponding slate node");if(!n.yTarget){if(!G.isText(n.slateTarget))throw new Error("Mismatch node type between y target and slate node");const d={};return n.targetDelta.forEach(h=>{h.attributes&&Object.keys(h.attributes).forEach(f=>{d[f]=null})}),n.yParent.format(n.textRange.start,n.textRange.end-n.textRange.start,Qe(Qe({},d),r.properties))}if(G.isText(n.slateTarget))throw new Error("Mismatch node type between y target and slate node");const i=qe(n.yTarget,n.slateTarget,[r.position]),a=n.slateTarget.children.slice(0,r.position).reduce((d,h)=>d+gn(h),0),s=n.slateTarget.children.reduce((d,h)=>d+gn(h),0),o=bl(Tt(n.yTarget),a,s-a),c=Ii(o),u=Us(e,n.yTarget,o,a),l=new Fe;l.applyDelta(c,{sanitize:!1}),Object.entries(r.properties).forEach(([d,h])=>{l.setAttribute(d,h)}),n.yTarget.delete(i.textRange.start,n.yTarget.length-i.textRange.start),n.yParent.insertEmbed(n.textRange.end,l),Mi(e,l,u,c,0,a)}var Tm={insert_node:vm,remove_node:wm,set_node:_m,merge_node:Bm,move_node:Am,split_node:km};function Fm(e,t,r){const{yParent:n,textRange:i}=qe(e,t,r.path),a=$.get(t,r.path);if(!G.isText(a))throw new Error("Cannot insert text into non-text node");n.insert(i.start+r.offset,r.text,jt(a))}function Om(e,t,r){const{yParent:n,textRange:i}=qe(e,t,r.path);n.delete(i.start+r.offset,r.text.length)}var xm={insert_text:Fm,remove_text:Om},Pm=()=>{},Rm=Sn(Qe(Qe({},xm),Tm),{set_selection:Pm});function Im(e,t,r){const n=Rm[r.type];if(!n)throw new Error(`Unknown operation: ${r.type}`);n(e,t,r)}var Mm=Symbol("slate-yjs-operation"),jm=Symbol("slate-yjs-position-storage"),ia=new WeakMap,xa=new WeakMap,Pa=new WeakSet,we={isYjsEditor(e){return p.isEditor(e)&&e.sharedRoot instanceof Fe&&"localOrigin"in e&&"positionStorageOrigin"in e&&typeof e.applyRemoteEvents=="function"&&typeof e.storeLocalChange=="function"&&typeof e.flushLocalChanges=="function"&&typeof e.isLocalOrigin=="function"&&typeof e.connect=="function"&&typeof e.disconnect=="function"},localChanges(e){var t;return(t=xa.get(e))!=null?t:[]},applyRemoteEvents(e,t,r){e.applyRemoteEvents(t,r)},storeLocalChange(e,t){e.storeLocalChange(t)},flushLocalChanges(e){e.flushLocalChanges()},connected(e){return Pa.has(e)},connect(e){e.connect()},disconnect(e){e.disconnect()},isLocal(e){return e.isLocalOrigin(we.origin(e))},origin(e){const t=ia.get(e);return t!==void 0?t:e.localOrigin},withOrigin(e,t,r){const n=we.origin(e);ia.set(e,t),r(),ia.set(e,n)},storePosition(e,t,r){const{sharedRoot:n,positionStorageOrigin:i}=e;Sr(n);const a=mm(n,e,r);n.doc.transact(()=>{wl(n,t,a)},i)},removeStoredPosition(e,t){const{sharedRoot:r,positionStorageOrigin:n}=e;Sr(r),r.doc.transact(()=>{Sm(r,t)},n)},position(e,t){const r=ym(e.sharedRoot,t);if(!!r)return Cm(e.sharedRoot,e,r)},storedPositionsRelative(e){return bm(e.sharedRoot)}};function Lm(e,t,{localOrigin:r,positionStorageOrigin:n,autoConnect:i=!1}={}){const a=e;a.sharedRoot=t,a.localOrigin=r??Mm,a.positionStorageOrigin=n??jm,a.applyRemoteEvents=(l,d)=>{we.flushLocalChanges(a),p.withoutNormalizing(a,()=>{we.withOrigin(a,d,()=>{pm(a.sharedRoot,a,l)})})},a.isLocalOrigin=l=>l===a.localOrigin;const s=(l,d)=>{a.isLocalOrigin(d.origin)||we.applyRemoteEvents(a,l,d.origin)};let o=null;i&&(o=setTimeout(()=>{o=null,we.connect(a)})),a.connect=()=>{if(we.connected(a))throw new Error("already connected");a.sharedRoot.observeDeep(s);const l=El(a.sharedRoot);a.children=l.children,Pa.add(a),a.onChange()},a.disconnect=()=>{o&&clearTimeout(o),we.flushLocalChanges(a),a.sharedRoot.unobserveDeep(s),Pa.delete(a)},a.storeLocalChange=l=>{xa.set(a,[...we.localChanges(a),{op:l,doc:e.children,origin:we.origin(a)}])},a.flushLocalChanges=()=>{Sr(a.sharedRoot);const l=we.localChanges(a);xa.delete(a);const d=[];l.forEach(h=>{const f=d[d.length-1];if(f&&f[0].origin===h.origin)return f.push(h);d.push([h])}),d.forEach(h=>{Sr(a.sharedRoot),a.sharedRoot.doc.transact(()=>{h.forEach(f=>{Sr(a.sharedRoot),Im(a.sharedRoot,{children:f.doc},f.op)})},h[0].origin)})};const{apply:c,onChange:u}=a;return a.apply=l=>{we.connected(a)&&we.isLocal(a)&&we.storeLocalChange(a,l),c(l)},a.onChange=()=>{we.connected(a)&&we.flushLocalChanges(a),u()},a}const Nm=Fr.useEffect,Eu=Fr.useMemo,Um=Fr.useState;function zm({listing:e,file:t,renameFile:r,closeFile:n}){const{content:i}=Eu(()=>t.connect(),[t]),a=Eu(()=>Pp(Lm(nd(),i)),[i]),[s]=Um([]);return Nm(()=>(we.connect(a),()=>we.disconnect(a)),[a]),It("div",{className:"flex flex-col items-stretch justify-start",children:[It("div",{className:"flex flex-row items-center justify-between border-b-2 border-b-slate-900 bg-slate-800 p-2",children:[Se(Pf,{value:e.name,input:r})," ",Se(Wr,{label:"X",click:n})]}),Se("div",{className:"flex-grow p-2",children:Se(Op,{editor:a,value:s,children:Se(Ep,{})})})]})}var $m=(e,t)=>t.some(r=>e instanceof r),Su,Bu;function Wm(){return Su||(Su=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Vm(){return Bu||(Bu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Tl=new WeakMap,Ra=new WeakMap,Fl=new WeakMap,aa=new WeakMap,zs=new WeakMap;function Gm(e){const t=new Promise((r,n)=>{const i=()=>{e.removeEventListener("success",a),e.removeEventListener("error",s)},a=()=>{r(Ut(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",a),e.addEventListener("error",s)});return t.then(r=>{r instanceof IDBCursor&&Tl.set(r,e)}).catch(()=>{}),zs.set(t,e),t}function qm(e){if(Ra.has(e))return;const t=new Promise((r,n)=>{const i=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",s),e.removeEventListener("abort",s)},a=()=>{r(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",a),e.addEventListener("error",s),e.addEventListener("abort",s)});Ra.set(e,t)}var Ia={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return Ra.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Fl.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Ut(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Hm(e){Ia=e(Ia)}function Km(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...r){const n=e.call(sa(this),t,...r);return Fl.set(n,t.sort?t.sort():[t]),Ut(n)}:Vm().includes(e)?function(...t){return e.apply(sa(this),t),Ut(Tl.get(this))}:function(...t){return Ut(e.apply(sa(this),t))}}function Ym(e){return typeof e=="function"?Km(e):(e instanceof IDBTransaction&&qm(e),$m(e,Wm())?new Proxy(e,Ia):e)}function Ut(e){if(e instanceof IDBRequest)return Gm(e);if(aa.has(e))return aa.get(e);const t=Ym(e);return t!==e&&(aa.set(e,t),zs.set(t,e)),t}var sa=e=>zs.get(e);function Jm(e,t,{blocked:r,upgrade:n,blocking:i,terminated:a}={}){const s=indexedDB.open(e,t),o=Ut(s);return n&&s.addEventListener("upgradeneeded",c=>{n(Ut(s.result),c.oldVersion,c.newVersion,Ut(s.transaction))}),r&&s.addEventListener("blocked",()=>r()),o.then(c=>{a&&c.addEventListener("close",()=>a()),i&&c.addEventListener("versionchange",()=>i())}).catch(()=>{}),o}var Xm=["get","getKey","getAll","getAllKeys","count"],Zm=["put","add","delete","clear"],oa=new Map;function Au(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(oa.get(t))return oa.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,i=Zm.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||Xm.includes(r)))return;const a=async function(s,...o){const c=this.transaction(s,i?"readwrite":"readonly");let u=c.store;return n&&(u=u.index(o.shift())),(await Promise.all([u[r](...o),i&&c.done]))[0]};return oa.set(t,a),a}Hm(e=>({...e,get:(t,r,n)=>Au(t,r)||e.get(t,r,n),has:(t,r)=>!!Au(t,r)||e.has(t,r)}));const Ln={},Qm=2;async function Ol(e){return e in Ln||(Ln[e]=Jm(e,Qm,{upgrade(t){t.createObjectStore("fileInfo"),t.createObjectStore("fileContent")}})),Ln[e]}async function e0(e){const t=await Ol(e);let r=await t.getAll("fileInfo"),n;return{setCallback(i){n=i},async createFile(i,a,s){const o=s??Xa(),c={name:i,key:o,type:a},u=t.transaction(["fileInfo","fileContent"],"readwrite");return u.objectStore("fileInfo").put(c,o),u.objectStore("fileContent").put(new Uint8Array,o),await u.done,r=[...r,c],n&&n(r),o},getCurrentList(){return r},async deleteFile(i){const a=t.transaction(["fileInfo","fileContent"],"readwrite");a.objectStore("fileInfo").delete(i),a.objectStore("fileContent").delete(i),await a.done,r=r.filter(s=>s.key!==i),n&&n(r)},async renameFile(i,a){let s=!1;r=r.map(o=>o.key===i?(s={...o,name:a},s):o),s&&(await t.put("fileInfo",s,i),n&&n(r))}}}const Nn={},wu=2e3;async function t0(e,t){const r=await Ol(t),n=await r.get("fileContent",e),i=new $t;n&&n.byteLength>0?it(i,n):i.get("content",Fe).applyDelta(Sl([{type:"raw",children:[{text:"test"}]}]));let a={},s=!1;return{doc(){return i},connect(){const o=new $t,c=Nt(i);return it(o,c),o.on("update",u=>{s&&clearTimeout(s),s=setTimeout(()=>{const l=Nt(i);r.put("fileContent",l,e)},wu),it(i,u);for(const l of Object.keys(a)){const d=a[l];it(d,u)}}),a[o.clientID]=o,{id:o.clientID,content:o.get("content",Fe)}},updateAll(o){s&&clearTimeout(s),s=setTimeout(()=>{const c=Nt(i);r.put("fileContent",c,e)},wu),it(i,o);for(const c of Object.keys(a)){const u=a[c];it(u,o)}},disconnect(o){const c=o.toString();if(c in a){const u=a[o],l=a;a={};for(const d of Object.keys(l))d!==c&&(a[d]=l[d]);u.destroy()}}}}async function r0(e,t){return e in Nn||(Nn[e]=t0(e,t)),Nn[e]}var _u=me({"node_modules/peerjs-js-binarypack/lib/bufferbuilder.js"(e,t){var r={};r.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),r.useArrayBufferView=!r.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),t.exports.binaryFeatures=r;var n=t.exports.BlobBuilder;typeof window<"u"&&(n=t.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function i(){this._pieces=[],this._parts=[]}i.prototype.append=function(a){typeof a=="number"?this._pieces.push(a):(this.flush(),this._parts.push(a))},i.prototype.flush=function(){if(this._pieces.length>0){var a=new Uint8Array(this._pieces);r.useArrayBufferView||(a=a.buffer),this._parts.push(a),this._pieces=[]}},i.prototype.getBuffer=function(){if(this.flush(),r.useBlobBuilder){for(var a=new n,s=0,o=this._parts.length;s<o;s++)a.append(this._parts[s]);return a.getBlob()}else return new Blob(this._parts)},t.exports.BufferBuilder=i}}),n0=me({"node_modules/peerjs-js-binarypack/lib/binarypack.js"(e,t){var r=_u().BufferBuilder,n=_u().binaryFeatures,i={unpack:function(u){var l=new a(u);return l.unpack()},pack:function(u){var l=new s;l.pack(u);var d=l.getBuffer();return d}};t.exports=i;function a(u){this.index=0,this.dataBuffer=u,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}a.prototype.unpack=function(){var u=this.unpack_uint8();if(u<128)return u;if((u^224)<32)return(u^224)-32;var l;if((l=u^160)<=15)return this.unpack_raw(l);if((l=u^176)<=15)return this.unpack_string(l);if((l=u^144)<=15)return this.unpack_array(l);if((l=u^128)<=15)return this.unpack_map(l);switch(u){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return l=this.unpack_uint16(),this.unpack_string(l);case 217:return l=this.unpack_uint32(),this.unpack_string(l);case 218:return l=this.unpack_uint16(),this.unpack_raw(l);case 219:return l=this.unpack_uint32(),this.unpack_raw(l);case 220:return l=this.unpack_uint16(),this.unpack_array(l);case 221:return l=this.unpack_uint32(),this.unpack_array(l);case 222:return l=this.unpack_uint16(),this.unpack_map(l);case 223:return l=this.unpack_uint32(),this.unpack_map(l)}},a.prototype.unpack_uint8=function(){var u=this.dataView[this.index]&255;return this.index++,u},a.prototype.unpack_uint16=function(){var u=this.read(2),l=(u[0]&255)*256+(u[1]&255);return this.index+=2,l},a.prototype.unpack_uint32=function(){var u=this.read(4),l=((u[0]*256+u[1])*256+u[2])*256+u[3];return this.index+=4,l},a.prototype.unpack_uint64=function(){var u=this.read(8),l=((((((u[0]*256+u[1])*256+u[2])*256+u[3])*256+u[4])*256+u[5])*256+u[6])*256+u[7];return this.index+=8,l},a.prototype.unpack_int8=function(){var u=this.unpack_uint8();return u<128?u:u-(1<<8)},a.prototype.unpack_int16=function(){var u=this.unpack_uint16();return u<32768?u:u-(1<<16)},a.prototype.unpack_int32=function(){var u=this.unpack_uint32();return u<Math.pow(2,31)?u:u-Math.pow(2,32)},a.prototype.unpack_int64=function(){var u=this.unpack_uint64();return u<Math.pow(2,63)?u:u-Math.pow(2,64)},a.prototype.unpack_raw=function(u){if(this.length<this.index+u)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+u+" "+this.length);var l=this.dataBuffer.slice(this.index,this.index+u);return this.index+=u,l},a.prototype.unpack_string=function(u){for(var l=this.read(u),d=0,h="",f,v;d<u;)f=l[d],f<128?(h+=String.fromCharCode(f),d++):(f^192)<32?(v=(f^192)<<6|l[d+1]&63,h+=String.fromCharCode(v),d+=2):(v=(f&15)<<12|(l[d+1]&63)<<6|l[d+2]&63,h+=String.fromCharCode(v),d+=3);return this.index+=u,h},a.prototype.unpack_array=function(u){for(var l=new Array(u),d=0;d<u;d++)l[d]=this.unpack();return l},a.prototype.unpack_map=function(u){for(var l={},d=0;d<u;d++){var h=this.unpack(),f=this.unpack();l[h]=f}return l},a.prototype.unpack_float=function(){var u=this.unpack_uint32(),l=u>>31,d=(u>>23&255)-127,h=u&8388607|8388608;return(l===0?1:-1)*h*Math.pow(2,d-23)},a.prototype.unpack_double=function(){var u=this.unpack_uint32(),l=this.unpack_uint32(),d=u>>31,h=(u>>20&2047)-1023,f=u&1048575|1048576,v=f*Math.pow(2,h-20)+l*Math.pow(2,h-52);return(d===0?1:-1)*v},a.prototype.read=function(u){var l=this.index;if(l+u<=this.length)return this.dataView.subarray(l,l+u);throw new Error("BinaryPackFailure: read index out of range")};function s(){this.bufferBuilder=new r}s.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},s.prototype.pack=function(u){var l=typeof u;if(l==="string")this.pack_string(u);else if(l==="number")Math.floor(u)===u?this.pack_integer(u):this.pack_double(u);else if(l==="boolean")u===!0?this.bufferBuilder.append(195):u===!1&&this.bufferBuilder.append(194);else if(l==="undefined")this.bufferBuilder.append(192);else if(l==="object")if(u===null)this.bufferBuilder.append(192);else{var d=u.constructor;if(d==Array)this.pack_array(u);else if(d==Blob||d==File||u instanceof Blob||u instanceof File)this.pack_bin(u);else if(d==ArrayBuffer)n.useArrayBufferView?this.pack_bin(new Uint8Array(u)):this.pack_bin(u);else if("BYTES_PER_ELEMENT"in u)n.useArrayBufferView?this.pack_bin(new Uint8Array(u.buffer)):this.pack_bin(u.buffer);else if(d==Object||d.toString().startsWith("class"))this.pack_object(u);else if(d==Date)this.pack_string(u.toString());else if(typeof u.toBinaryPack=="function")this.bufferBuilder.append(u.toBinaryPack());else throw new Error('Type "'+d.toString()+'" not yet supported')}else throw new Error('Type "'+l+'" not yet supported');this.bufferBuilder.flush()},s.prototype.pack_bin=function(u){var l=u.length||u.byteLength||u.size;if(l<=15)this.pack_uint8(160+l);else if(l<=65535)this.bufferBuilder.append(218),this.pack_uint16(l);else if(l<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(l);else throw new Error("Invalid length");this.bufferBuilder.append(u)},s.prototype.pack_string=function(u){var l=c(u);if(l<=15)this.pack_uint8(176+l);else if(l<=65535)this.bufferBuilder.append(216),this.pack_uint16(l);else if(l<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(l);else throw new Error("Invalid length");this.bufferBuilder.append(u)},s.prototype.pack_array=function(u){var l=u.length;if(l<=15)this.pack_uint8(144+l);else if(l<=65535)this.bufferBuilder.append(220),this.pack_uint16(l);else if(l<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(l);else throw new Error("Invalid length");for(var d=0;d<l;d++)this.pack(u[d])},s.prototype.pack_integer=function(u){if(u>=-32&&u<=127)this.bufferBuilder.append(u&255);else if(u>=0&&u<=255)this.bufferBuilder.append(204),this.pack_uint8(u);else if(u>=-128&&u<=127)this.bufferBuilder.append(208),this.pack_int8(u);else if(u>=0&&u<=65535)this.bufferBuilder.append(205),this.pack_uint16(u);else if(u>=-32768&&u<=32767)this.bufferBuilder.append(209),this.pack_int16(u);else if(u>=0&&u<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(u);else if(u>=-2147483648&&u<=2147483647)this.bufferBuilder.append(210),this.pack_int32(u);else if(u>=-9223372036854776e3&&u<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(u);else if(u>=0&&u<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(u);else throw new Error("Invalid integer")},s.prototype.pack_double=function(u){var l=0;u<0&&(l=1,u=-u);var d=Math.floor(Math.log(u)/Math.LN2),h=u/Math.pow(2,d)-1,f=Math.floor(h*Math.pow(2,52)),v=Math.pow(2,32),m=l<<31|d+1023<<20|f/v&1048575,E=f%v;this.bufferBuilder.append(203),this.pack_int32(m),this.pack_int32(E)},s.prototype.pack_object=function(u){var l=Object.keys(u),d=l.length;if(d<=15)this.pack_uint8(128+d);else if(d<=65535)this.bufferBuilder.append(222),this.pack_uint16(d);else if(d<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(d);else throw new Error("Invalid length");for(var h in u)u.hasOwnProperty(h)&&(this.pack(h),this.pack(u[h]))},s.prototype.pack_uint8=function(u){this.bufferBuilder.append(u)},s.prototype.pack_uint16=function(u){this.bufferBuilder.append(u>>8),this.bufferBuilder.append(u&255)},s.prototype.pack_uint32=function(u){var l=u&4294967295;this.bufferBuilder.append((l&4278190080)>>>24),this.bufferBuilder.append((l&16711680)>>>16),this.bufferBuilder.append((l&65280)>>>8),this.bufferBuilder.append(l&255)},s.prototype.pack_uint64=function(u){var l=u/Math.pow(2,32),d=u%Math.pow(2,32);this.bufferBuilder.append((l&4278190080)>>>24),this.bufferBuilder.append((l&16711680)>>>16),this.bufferBuilder.append((l&65280)>>>8),this.bufferBuilder.append(l&255),this.bufferBuilder.append((d&4278190080)>>>24),this.bufferBuilder.append((d&16711680)>>>16),this.bufferBuilder.append((d&65280)>>>8),this.bufferBuilder.append(d&255)},s.prototype.pack_int8=function(u){this.bufferBuilder.append(u&255)},s.prototype.pack_int16=function(u){this.bufferBuilder.append((u&65280)>>8),this.bufferBuilder.append(u&255)},s.prototype.pack_int32=function(u){this.bufferBuilder.append(u>>>24&255),this.bufferBuilder.append((u&16711680)>>>16),this.bufferBuilder.append((u&65280)>>>8),this.bufferBuilder.append(u&255)},s.prototype.pack_int64=function(u){var l=Math.floor(u/Math.pow(2,32)),d=u%Math.pow(2,32);this.bufferBuilder.append((l&4278190080)>>>24),this.bufferBuilder.append((l&16711680)>>>16),this.bufferBuilder.append((l&65280)>>>8),this.bufferBuilder.append(l&255),this.bufferBuilder.append((d&4278190080)>>>24),this.bufferBuilder.append((d&16711680)>>>16),this.bufferBuilder.append((d&65280)>>>8),this.bufferBuilder.append(d&255)};function o(u){var l=u.charCodeAt(0);return l<=2047?"00":l<=65535?"000":l<=2097151?"0000":l<=67108863?"00000":"000000"}function c(u){return u.length>600?new Blob([u]).size:u.replace(/[^\u0000-\u007F]/g,o).length}}}),xl=me({"node_modules/sdp/sdp.js"(e,t){var r={};r.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},r.localCName=r.generateIdentifier(),r.splitLines=function(n){return n.trim().split(`
`).map(function(i){return i.trim()})},r.splitSections=function(n){var i=n.split(`
m=`);return i.map(function(a,s){return(s>0?"m="+a:a).trim()+`\r
`})},r.getDescription=function(n){var i=r.splitSections(n);return i&&i[0]},r.getMediaSections=function(n){var i=r.splitSections(n);return i.shift(),i},r.matchPrefix=function(n,i){return r.splitLines(n).filter(function(a){return a.indexOf(i)===0})},r.parseCandidate=function(n){var i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");for(var a={foundation:i[0],component:parseInt(i[1],10),protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]},s=8;s<i.length;s+=2)switch(i[s]){case"raddr":a.relatedAddress=i[s+1];break;case"rport":a.relatedPort=parseInt(i[s+1],10);break;case"tcptype":a.tcpType=i[s+1];break;case"ufrag":a.ufrag=i[s+1],a.usernameFragment=i[s+1];break;default:a[i[s]]=i[s+1];break}return a},r.writeCandidate=function(n){var i=[];i.push(n.foundation),i.push(n.component),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);var a=n.type;return i.push("typ"),i.push(a),a!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},r.parseIceOptions=function(n){return n.substr(14).split(" ")},r.parseRtpMap=function(n){var i=n.substr(9).split(" "),a={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),a.name=i[0],a.clockRate=parseInt(i[1],10),a.channels=i.length===3?parseInt(i[2],10):1,a.numChannels=a.channels,a},r.writeRtpMap=function(n){var i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);var a=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(a!==1?"/"+a:"")+`\r
`},r.parseExtmap=function(n){var i=n.substr(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1]}},r.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+`\r
`},r.parseFmtp=function(n){for(var i={},a,s=n.substr(n.indexOf(" ")+1).split(";"),o=0;o<s.length;o++)a=s[o].trim().split("="),i[a[0].trim()]=a[1];return i},r.writeFmtp=function(n){var i="",a=n.payloadType;if(n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){var s=[];Object.keys(n.parameters).forEach(function(o){n.parameters[o]?s.push(o+"="+n.parameters[o]):s.push(o)}),i+="a=fmtp:"+a+" "+s.join(";")+`\r
`}return i},r.parseRtcpFb=function(n){var i=n.substr(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},r.writeRtcpFb=function(n){var i="",a=n.payloadType;return n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(function(s){i+="a=rtcp-fb:"+a+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},r.parseSsrcMedia=function(n){var i=n.indexOf(" "),a={ssrc:parseInt(n.substr(7,i-7),10)},s=n.indexOf(":",i);return s>-1?(a.attribute=n.substr(i+1,s-i-1),a.value=n.substr(s+1)):a.attribute=n.substr(i+1),a},r.parseSsrcGroup=function(n){var i=n.substr(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(function(a){return parseInt(a,10)})}},r.getMid=function(n){var i=r.matchPrefix(n,"a=mid:")[0];if(i)return i.substr(6)},r.parseFingerprint=function(n){var i=n.substr(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1]}},r.getDtlsParameters=function(n,i){var a=r.matchPrefix(n+i,"a=fingerprint:");return{role:"auto",fingerprints:a.map(r.parseFingerprint)}},r.writeDtlsParameters=function(n,i){var a="a=setup:"+i+`\r
`;return n.fingerprints.forEach(function(s){a+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),a},r.parseCryptoLine=function(n){var i=n.substr(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},r.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?r.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;var i=n.substr(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},r.getCryptoParameters=function(n,i){var a=r.matchPrefix(n+i,"a=crypto:");return a.map(r.parseCryptoLine)},r.getIceParameters=function(n,i){var a=r.matchPrefix(n+i,"a=ice-ufrag:")[0],s=r.matchPrefix(n+i,"a=ice-pwd:")[0];return a&&s?{usernameFragment:a.substr(12),password:s.substr(10)}:null},r.writeIceParameters=function(n){return"a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`},r.parseRtpParameters=function(n){for(var i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},a=r.splitLines(n),s=a[0].split(" "),o=3;o<s.length;o++){var c=s[o],u=r.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(u){var l=r.parseRtpMap(u),d=r.matchPrefix(n,"a=fmtp:"+c+" ");switch(l.parameters=d.length?r.parseFmtp(d[0]):{},l.rtcpFeedback=r.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(r.parseRtcpFb),i.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(l.name.toUpperCase());break}}}return r.matchPrefix(n,"a=extmap:").forEach(function(h){i.headerExtensions.push(r.parseExtmap(h))}),i},r.writeRtpDescription=function(n,i){var a="";a+="m="+n+" ",a+=i.codecs.length>0?"9":"0",a+=" UDP/TLS/RTP/SAVPF ",a+=i.codecs.map(function(o){return o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType}).join(" ")+`\r
`,a+=`c=IN IP4 0.0.0.0\r
`,a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(function(o){a+=r.writeRtpMap(o),a+=r.writeFmtp(o),a+=r.writeRtcpFb(o)});var s=0;return i.codecs.forEach(function(o){o.maxptime>s&&(s=o.maxptime)}),s>0&&(a+="a=maxptime:"+s+`\r
`),a+=`a=rtcp-mux\r
`,i.headerExtensions&&i.headerExtensions.forEach(function(o){a+=r.writeExtmap(o)}),a},r.parseRtpEncodingParameters=function(n){var i=[],a=r.parseRtpParameters(n),s=a.fecMechanisms.indexOf("RED")!==-1,o=a.fecMechanisms.indexOf("ULPFEC")!==-1,c=r.matchPrefix(n,"a=ssrc:").map(function(f){return r.parseSsrcMedia(f)}).filter(function(f){return f.attribute==="cname"}),u=c.length>0&&c[0].ssrc,l,d=r.matchPrefix(n,"a=ssrc-group:FID").map(function(f){var v=f.substr(17).split(" ");return v.map(function(m){return parseInt(m,10)})});d.length>0&&d[0].length>1&&d[0][0]===u&&(l=d[0][1]),a.codecs.forEach(function(f){if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){var v={ssrc:u,codecPayloadType:parseInt(f.parameters.apt,10)};u&&l&&(v.rtx={ssrc:l}),i.push(v),s&&(v=JSON.parse(JSON.stringify(v)),v.fec={ssrc:u,mechanism:o?"red+ulpfec":"red"},i.push(v))}}),i.length===0&&u&&i.push({ssrc:u});var h=r.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substr(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substr(5),10)*1e3*.95-50*40*8:h=void 0,i.forEach(function(f){f.maxBitrate=h})),i},r.parseRtcpParameters=function(n){var i={},a=r.matchPrefix(n,"a=ssrc:").map(function(c){return r.parseSsrcMedia(c)}).filter(function(c){return c.attribute==="cname"})[0];a&&(i.cname=a.value,i.ssrc=a.ssrc);var s=r.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;var o=r.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},r.parseMsid=function(n){var i,a=r.matchPrefix(n,"a=msid:");if(a.length===1)return i=a[0].substr(7).split(" "),{stream:i[0],track:i[1]};var s=r.matchPrefix(n,"a=ssrc:").map(function(o){return r.parseSsrcMedia(o)}).filter(function(o){return o.attribute==="msid"});if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},r.parseSctpDescription=function(n){var i=r.parseMLine(n),a=r.matchPrefix(n,"a=max-message-size:"),s;a.length>0&&(s=parseInt(a[0].substr(19),10)),isNaN(s)&&(s=65536);var o=r.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:i.fmt,maxMessageSize:s};var c=r.matchPrefix(n,"a=sctpmap:");if(c.length>0){var u=r.matchPrefix(n,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:s}}},r.writeSctpDescription=function(n,i){var a=[];return n.protocol!=="DTLS/SCTP"?a=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:a=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&a.push("a=max-message-size:"+i.maxMessageSize+`\r
`),a.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(n,i,a){var s,o=i!==void 0?i:2;n?s=n:s=r.generateSessionId();var c=a||"thisisadapterortc";return`v=0\r
o=`+c+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.writeMediaSection=function(n,i,a,s){var o=r.writeRtpDescription(n.kind,i);if(o+=r.writeIceParameters(n.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),a==="offer"?"actpass":"active"),o+="a=mid:"+n.mid+`\r
`,n.direction?o+="a="+n.direction+`\r
`:n.rtpSender&&n.rtpReceiver?o+=`a=sendrecv\r
`:n.rtpSender?o+=`a=sendonly\r
`:n.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,n.rtpSender){var c="msid:"+s.id+" "+n.rtpSender.track.id+`\r
`;o+="a="+c,o+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+c,n.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+c,o+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+`\r
`),o},r.getDirection=function(n,i){for(var a=r.splitLines(n),s=0;s<a.length;s++)switch(a[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[s].substr(2)}return i?r.getDirection(i):"sendrecv"},r.getKind=function(n){var i=r.splitLines(n),a=i[0].split(" ");return a[0].substr(2)},r.isRejected=function(n){return n.split(" ",2)[1]==="0"},r.parseMLine=function(n){var i=r.splitLines(n),a=i[0].substr(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},r.parseOLine=function(n){var i=r.matchPrefix(n,"o=")[0],a=i.substr(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},r.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;for(var i=r.splitLines(n),a=0;a<i.length;a++)if(i[a].length<2||i[a].charAt(1)!=="=")return!1;return!0},typeof t=="object"&&(t.exports=r)}}),i0=me({"node_modules/rtcpeerconnection-shim/rtcpeerconnection.js"(e,t){var r=xl();function n(l){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[l.type]||l.type}function i(l,d,h,f,v){var m=r.writeRtpDescription(l.kind,d);if(m+=r.writeIceParameters(l.iceGatherer.getLocalParameters()),m+=r.writeDtlsParameters(l.dtlsTransport.getLocalParameters(),h==="offer"?"actpass":v||"active"),m+="a=mid:"+l.mid+`\r
`,l.rtpSender&&l.rtpReceiver?m+=`a=sendrecv\r
`:l.rtpSender?m+=`a=sendonly\r
`:l.rtpReceiver?m+=`a=recvonly\r
`:m+=`a=inactive\r
`,l.rtpSender){var E=l.rtpSender._initialTrackId||l.rtpSender.track.id;l.rtpSender._initialTrackId=E;var w="msid:"+(f?f.id:"-")+" "+E+`\r
`;m+="a="+w,m+="a=ssrc:"+l.sendEncodingParameters[0].ssrc+" "+w,l.sendEncodingParameters[0].rtx&&(m+="a=ssrc:"+l.sendEncodingParameters[0].rtx.ssrc+" "+w,m+="a=ssrc-group:FID "+l.sendEncodingParameters[0].ssrc+" "+l.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return m+="a=ssrc:"+l.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+`\r
`,l.rtpSender&&l.sendEncodingParameters[0].rtx&&(m+="a=ssrc:"+l.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+`\r
`),m}function a(l,d){var h=!1;return l=JSON.parse(JSON.stringify(l)),l.filter(function(f){if(f&&(f.urls||f.url)){var v=f.urls||f.url;f.url&&!f.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var m=typeof v=="string";return m&&(v=[v]),v=v.filter(function(E){var w=E.indexOf("turn:")===0&&E.indexOf("transport=udp")!==-1&&E.indexOf("turn:[")===-1&&!h;return w?(h=!0,!0):E.indexOf("stun:")===0&&d>=14393&&E.indexOf("?transport=udp")===-1}),delete f.url,f.urls=m?v[0]:v,!!v.length}})}function s(l,d){var h={codecs:[],headerExtensions:[],fecMechanisms:[]},f=function(m,E){m=parseInt(m,10);for(var w=0;w<E.length;w++)if(E[w].payloadType===m||E[w].preferredPayloadType===m)return E[w]},v=function(m,E,w,g){var D=f(m.parameters.apt,w),b=f(E.parameters.apt,g);return D&&b&&D.name.toLowerCase()===b.name.toLowerCase()};return l.codecs.forEach(function(m){for(var E=0;E<d.codecs.length;E++){var w=d.codecs[E];if(m.name.toLowerCase()===w.name.toLowerCase()&&m.clockRate===w.clockRate){if(m.name.toLowerCase()==="rtx"&&m.parameters&&w.parameters.apt&&!v(m,w,l.codecs,d.codecs))continue;w=JSON.parse(JSON.stringify(w)),w.numChannels=Math.min(m.numChannels,w.numChannels),h.codecs.push(w),w.rtcpFeedback=w.rtcpFeedback.filter(function(g){for(var D=0;D<m.rtcpFeedback.length;D++)if(m.rtcpFeedback[D].type===g.type&&m.rtcpFeedback[D].parameter===g.parameter)return!0;return!1});break}}}),l.headerExtensions.forEach(function(m){for(var E=0;E<d.headerExtensions.length;E++){var w=d.headerExtensions[E];if(m.uri===w.uri){h.headerExtensions.push(w);break}}}),h}function o(l,d,h){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[d][l].indexOf(h)!==-1}function c(l,d){var h=l.getRemoteCandidates().find(function(f){return d.foundation===f.foundation&&d.ip===f.ip&&d.port===f.port&&d.priority===f.priority&&d.protocol===f.protocol&&d.type===f.type});return h||l.addRemoteCandidate(d),!h}function u(l,d){var h=new Error(d);return h.name=l,h.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[l],h}t.exports=function(l,d){function h(g,D){D.addTrack(g),D.dispatchEvent(new l.MediaStreamTrackEvent("addtrack",{track:g}))}function f(g,D){D.removeTrack(g),D.dispatchEvent(new l.MediaStreamTrackEvent("removetrack",{track:g}))}function v(g,D,b,y){var A=new Event("track");A.track=D,A.receiver=b,A.transceiver={receiver:b},A.streams=y,l.setTimeout(function(){g._dispatchEvent("track",A)})}var m=function(g){var D=this,b=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(A){D[A]=b[A].bind(b)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",g=JSON.parse(JSON.stringify(g||{})),this.usingBundle=g.bundlePolicy==="max-bundle",g.rtcpMuxPolicy==="negotiate")throw u("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(g.rtcpMuxPolicy||(g.rtcpMuxPolicy="require"),g.iceTransportPolicy){case"all":case"relay":break;default:g.iceTransportPolicy="all";break}switch(g.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:g.bundlePolicy="balanced";break}if(g.iceServers=a(g.iceServers||[],d),this._iceGatherers=[],g.iceCandidatePoolSize)for(var y=g.iceCandidatePoolSize;y>0;y--)this._iceGatherers.push(new l.RTCIceGatherer({iceServers:g.iceServers,gatherPolicy:g.iceTransportPolicy}));else g.iceCandidatePoolSize=0;this._config=g,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(m.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(m.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),m.prototype.onicecandidate=null,m.prototype.onaddstream=null,m.prototype.ontrack=null,m.prototype.onremovestream=null,m.prototype.onsignalingstatechange=null,m.prototype.oniceconnectionstatechange=null,m.prototype.onconnectionstatechange=null,m.prototype.onicegatheringstatechange=null,m.prototype.onnegotiationneeded=null,m.prototype.ondatachannel=null,m.prototype._dispatchEvent=function(g,D){this._isClosed||(this.dispatchEvent(D),typeof this["on"+g]=="function"&&this["on"+g](D))},m.prototype._emitGatheringStateChange=function(){var g=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",g)},m.prototype.getConfiguration=function(){return this._config},m.prototype.getLocalStreams=function(){return this.localStreams},m.prototype.getRemoteStreams=function(){return this.remoteStreams},m.prototype._createTransceiver=function(g,D){var b=this.transceivers.length>0,y={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:g,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&b)y.iceTransport=this.transceivers[0].iceTransport,y.dtlsTransport=this.transceivers[0].dtlsTransport;else{var A=this._createIceAndDtlsTransports();y.iceTransport=A.iceTransport,y.dtlsTransport=A.dtlsTransport}return D||this.transceivers.push(y),y},m.prototype.addTrack=function(g,D){if(this._isClosed)throw u("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var b=this.transceivers.find(function(x){return x.track===g});if(b)throw u("InvalidAccessError","Track already exists.");for(var y,A=0;A<this.transceivers.length;A++)!this.transceivers[A].track&&this.transceivers[A].kind===g.kind&&(y=this.transceivers[A]);return y||(y=this._createTransceiver(g.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(D)===-1&&this.localStreams.push(D),y.track=g,y.stream=D,y.rtpSender=new l.RTCRtpSender(g,y.dtlsTransport),y.rtpSender},m.prototype.addStream=function(g){var D=this;if(d>=15025)g.getTracks().forEach(function(y){D.addTrack(y,g)});else{var b=g.clone();g.getTracks().forEach(function(y,A){var x=b.getTracks()[A];y.addEventListener("enabled",function(B){x.enabled=B.enabled})}),b.getTracks().forEach(function(y){D.addTrack(y,b)})}},m.prototype.removeTrack=function(g){if(this._isClosed)throw u("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(g instanceof l.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var D=this.transceivers.find(function(A){return A.rtpSender===g});if(!D)throw u("InvalidAccessError","Sender was not created by this connection.");var b=D.stream;D.rtpSender.stop(),D.rtpSender=null,D.track=null,D.stream=null;var y=this.transceivers.map(function(A){return A.stream});y.indexOf(b)===-1&&this.localStreams.indexOf(b)>-1&&this.localStreams.splice(this.localStreams.indexOf(b),1),this._maybeFireNegotiationNeeded()},m.prototype.removeStream=function(g){var D=this;g.getTracks().forEach(function(b){var y=D.getSenders().find(function(A){return A.track===b});y&&D.removeTrack(y)})},m.prototype.getSenders=function(){return this.transceivers.filter(function(g){return!!g.rtpSender}).map(function(g){return g.rtpSender})},m.prototype.getReceivers=function(){return this.transceivers.filter(function(g){return!!g.rtpReceiver}).map(function(g){return g.rtpReceiver})},m.prototype._createIceGatherer=function(g,D){var b=this;if(D&&g>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var y=new l.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(y,"state",{value:"new",writable:!0}),this.transceivers[g].bufferedCandidateEvents=[],this.transceivers[g].bufferCandidates=function(A){var x=!A.candidate||Object.keys(A.candidate).length===0;y.state=x?"completed":"gathering",b.transceivers[g].bufferedCandidateEvents!==null&&b.transceivers[g].bufferedCandidateEvents.push(A)},y.addEventListener("localcandidate",this.transceivers[g].bufferCandidates),y},m.prototype._gather=function(g,D){var b=this,y=this.transceivers[D].iceGatherer;if(!y.onlocalcandidate){var A=this.transceivers[D].bufferedCandidateEvents;this.transceivers[D].bufferedCandidateEvents=null,y.removeEventListener("localcandidate",this.transceivers[D].bufferCandidates),y.onlocalcandidate=function(x){if(!(b.usingBundle&&D>0)){var B=new Event("icecandidate");B.candidate={sdpMid:g,sdpMLineIndex:D};var j=x.candidate,H=!j||Object.keys(j).length===0;if(H)(y.state==="new"||y.state==="gathering")&&(y.state="completed");else{y.state==="new"&&(y.state="gathering"),j.component=1,j.ufrag=y.getLocalParameters().usernameFragment;var M=r.writeCandidate(j);B.candidate=Object.assign(B.candidate,r.parseCandidate(M)),B.candidate.candidate=M,B.candidate.toJSON=function(){return{candidate:B.candidate.candidate,sdpMid:B.candidate.sdpMid,sdpMLineIndex:B.candidate.sdpMLineIndex,usernameFragment:B.candidate.usernameFragment}}}var F=r.getMediaSections(b._localDescription.sdp);H?F[B.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:F[B.candidate.sdpMLineIndex]+="a="+B.candidate.candidate+`\r
`,b._localDescription.sdp=r.getDescription(b._localDescription.sdp)+F.join("");var V=b.transceivers.every(function(W){return W.iceGatherer&&W.iceGatherer.state==="completed"});b.iceGatheringState!=="gathering"&&(b.iceGatheringState="gathering",b._emitGatheringStateChange()),H||b._dispatchEvent("icecandidate",B),V&&(b._dispatchEvent("icecandidate",new Event("icecandidate")),b.iceGatheringState="complete",b._emitGatheringStateChange())}},l.setTimeout(function(){A.forEach(function(x){y.onlocalcandidate(x)})},0)}},m.prototype._createIceAndDtlsTransports=function(){var g=this,D=new l.RTCIceTransport(null);D.onicestatechange=function(){g._updateIceConnectionState(),g._updateConnectionState()};var b=new l.RTCDtlsTransport(D);return b.ondtlsstatechange=function(){g._updateConnectionState()},b.onerror=function(){Object.defineProperty(b,"state",{value:"failed",writable:!0}),g._updateConnectionState()},{iceTransport:D,dtlsTransport:b}},m.prototype._disposeIceAndDtlsTransports=function(g){var D=this.transceivers[g].iceGatherer;D&&(delete D.onlocalcandidate,delete this.transceivers[g].iceGatherer);var b=this.transceivers[g].iceTransport;b&&(delete b.onicestatechange,delete this.transceivers[g].iceTransport);var y=this.transceivers[g].dtlsTransport;y&&(delete y.ondtlsstatechange,delete y.onerror,delete this.transceivers[g].dtlsTransport)},m.prototype._transceive=function(g,D,b){var y=s(g.localCapabilities,g.remoteCapabilities);D&&g.rtpSender&&(y.encodings=g.sendEncodingParameters,y.rtcp={cname:r.localCName,compound:g.rtcpParameters.compound},g.recvEncodingParameters.length&&(y.rtcp.ssrc=g.recvEncodingParameters[0].ssrc),g.rtpSender.send(y)),b&&g.rtpReceiver&&y.codecs.length>0&&(g.kind==="video"&&g.recvEncodingParameters&&d<15019&&g.recvEncodingParameters.forEach(function(A){delete A.rtx}),g.recvEncodingParameters.length?y.encodings=g.recvEncodingParameters:y.encodings=[{}],y.rtcp={compound:g.rtcpParameters.compound},g.rtcpParameters.cname&&(y.rtcp.cname=g.rtcpParameters.cname),g.sendEncodingParameters.length&&(y.rtcp.ssrc=g.sendEncodingParameters[0].ssrc),g.rtpReceiver.receive(y))},m.prototype.setLocalDescription=function(g){var D=this;if(["offer","answer"].indexOf(g.type)===-1)return Promise.reject(u("TypeError",'Unsupported type "'+g.type+'"'));if(!o("setLocalDescription",g.type,D.signalingState)||D._isClosed)return Promise.reject(u("InvalidStateError","Can not set local "+g.type+" in state "+D.signalingState));var b,y;if(g.type==="offer")b=r.splitSections(g.sdp),y=b.shift(),b.forEach(function(x,B){var j=r.parseRtpParameters(x);D.transceivers[B].localCapabilities=j}),D.transceivers.forEach(function(x,B){D._gather(x.mid,B)});else if(g.type==="answer"){b=r.splitSections(D._remoteDescription.sdp),y=b.shift();var A=r.matchPrefix(y,"a=ice-lite").length>0;b.forEach(function(x,B){var j=D.transceivers[B],H=j.iceGatherer,M=j.iceTransport,F=j.dtlsTransport,V=j.localCapabilities,W=j.remoteCapabilities,k=r.isRejected(x)&&r.matchPrefix(x,"a=bundle-only").length===0;if(!k&&!j.rejected){var Y=r.getIceParameters(x,y),S=r.getDtlsParameters(x,y);A&&(S.role="server"),(!D.usingBundle||B===0)&&(D._gather(j.mid,B),M.state==="new"&&M.start(H,Y,A?"controlling":"controlled"),F.state==="new"&&F.start(S));var T=s(V,W);D._transceive(j,T.codecs.length>0,!1)}})}return D._localDescription={type:g.type,sdp:g.sdp},g.type==="offer"?D._updateSignalingState("have-local-offer"):D._updateSignalingState("stable"),Promise.resolve()},m.prototype.setRemoteDescription=function(g){var D=this;if(["offer","answer"].indexOf(g.type)===-1)return Promise.reject(u("TypeError",'Unsupported type "'+g.type+'"'));if(!o("setRemoteDescription",g.type,D.signalingState)||D._isClosed)return Promise.reject(u("InvalidStateError","Can not set remote "+g.type+" in state "+D.signalingState));var b={};D.remoteStreams.forEach(function(M){b[M.id]=M});var y=[],A=r.splitSections(g.sdp),x=A.shift(),B=r.matchPrefix(x,"a=ice-lite").length>0,j=r.matchPrefix(x,"a=group:BUNDLE ").length>0;D.usingBundle=j;var H=r.matchPrefix(x,"a=ice-options:")[0];return H?D.canTrickleIceCandidates=H.substr(14).split(" ").indexOf("trickle")>=0:D.canTrickleIceCandidates=!1,A.forEach(function(M,F){var V=r.splitLines(M),W=r.getKind(M),k=r.isRejected(M)&&r.matchPrefix(M,"a=bundle-only").length===0,Y=V[0].substr(2).split(" ")[2],S=r.getDirection(M,x),T=r.parseMsid(M),P=r.getMid(M)||r.generateIdentifier();if(k||W==="application"&&(Y==="DTLS/SCTP"||Y==="UDP/DTLS/SCTP")){D.transceivers[F]={mid:P,kind:W,protocol:Y,rejected:!0};return}!k&&D.transceivers[F]&&D.transceivers[F].rejected&&(D.transceivers[F]=D._createTransceiver(W,!0));var I,J,ee,X,Z,re,oe,ue,z,O=r.parseRtpParameters(M),L,q;k||(L=r.getIceParameters(M,x),q=r.getDtlsParameters(M,x),q.role="client"),oe=r.parseRtpEncodingParameters(M);var ae=r.parseRtcpParameters(M),Q=r.matchPrefix(M,"a=end-of-candidates",x).length>0,de=r.matchPrefix(M,"a=candidate:").map(function(Ee){return r.parseCandidate(Ee)}).filter(function(Ee){return Ee.component===1});if((g.type==="offer"||g.type==="answer")&&!k&&j&&F>0&&D.transceivers[F]&&(D._disposeIceAndDtlsTransports(F),D.transceivers[F].iceGatherer=D.transceivers[0].iceGatherer,D.transceivers[F].iceTransport=D.transceivers[0].iceTransport,D.transceivers[F].dtlsTransport=D.transceivers[0].dtlsTransport,D.transceivers[F].rtpSender&&D.transceivers[F].rtpSender.setTransport(D.transceivers[0].dtlsTransport),D.transceivers[F].rtpReceiver&&D.transceivers[F].rtpReceiver.setTransport(D.transceivers[0].dtlsTransport)),g.type==="offer"&&!k){I=D.transceivers[F]||D._createTransceiver(W),I.mid=P,I.iceGatherer||(I.iceGatherer=D._createIceGatherer(F,j)),de.length&&I.iceTransport.state==="new"&&(Q&&(!j||F===0)?I.iceTransport.setRemoteCandidates(de):de.forEach(function(Ee){c(I.iceTransport,Ee)})),ue=l.RTCRtpReceiver.getCapabilities(W),d<15019&&(ue.codecs=ue.codecs.filter(function(Ee){return Ee.name!=="rtx"})),re=I.sendEncodingParameters||[{ssrc:(2*F+2)*1001}];var De=!1;if(S==="sendrecv"||S==="sendonly"){if(De=!I.rtpReceiver,Z=I.rtpReceiver||new l.RTCRtpReceiver(I.dtlsTransport,W),De){var Ae;z=Z.track,T&&T.stream==="-"||(T?(b[T.stream]||(b[T.stream]=new l.MediaStream,Object.defineProperty(b[T.stream],"id",{get:function(){return T.stream}})),Object.defineProperty(z,"id",{get:function(){return T.track}}),Ae=b[T.stream]):(b.default||(b.default=new l.MediaStream),Ae=b.default)),Ae&&(h(z,Ae),I.associatedRemoteMediaStreams.push(Ae)),y.push([z,Z,Ae])}}else I.rtpReceiver&&I.rtpReceiver.track&&(I.associatedRemoteMediaStreams.forEach(function(Ee){var Ft=Ee.getTracks().find(function(Mr){return Mr.id===I.rtpReceiver.track.id});Ft&&f(Ft,Ee)}),I.associatedRemoteMediaStreams=[]);I.localCapabilities=ue,I.remoteCapabilities=O,I.rtpReceiver=Z,I.rtcpParameters=ae,I.sendEncodingParameters=re,I.recvEncodingParameters=oe,D._transceive(D.transceivers[F],!1,De)}else if(g.type==="answer"&&!k){I=D.transceivers[F],J=I.iceGatherer,ee=I.iceTransport,X=I.dtlsTransport,Z=I.rtpReceiver,re=I.sendEncodingParameters,ue=I.localCapabilities,D.transceivers[F].recvEncodingParameters=oe,D.transceivers[F].remoteCapabilities=O,D.transceivers[F].rtcpParameters=ae,de.length&&ee.state==="new"&&((B||Q)&&(!j||F===0)?ee.setRemoteCandidates(de):de.forEach(function(Ee){c(I.iceTransport,Ee)})),(!j||F===0)&&(ee.state==="new"&&ee.start(J,L,"controlling"),X.state==="new"&&X.start(q));var He=s(I.localCapabilities,I.remoteCapabilities),qt=He.codecs.filter(function(Ee){return Ee.name.toLowerCase()==="rtx"}).length;!qt&&I.sendEncodingParameters[0].rtx&&delete I.sendEncodingParameters[0].rtx,D._transceive(I,S==="sendrecv"||S==="recvonly",S==="sendrecv"||S==="sendonly"),Z&&(S==="sendrecv"||S==="sendonly")?(z=Z.track,T?(b[T.stream]||(b[T.stream]=new l.MediaStream),h(z,b[T.stream]),y.push([z,Z,b[T.stream]])):(b.default||(b.default=new l.MediaStream),h(z,b.default),y.push([z,Z,b.default]))):delete I.rtpReceiver}}),D._dtlsRole===void 0&&(D._dtlsRole=g.type==="offer"?"active":"passive"),D._remoteDescription={type:g.type,sdp:g.sdp},g.type==="offer"?D._updateSignalingState("have-remote-offer"):D._updateSignalingState("stable"),Object.keys(b).forEach(function(M){var F=b[M];if(F.getTracks().length){if(D.remoteStreams.indexOf(F)===-1){D.remoteStreams.push(F);var V=new Event("addstream");V.stream=F,l.setTimeout(function(){D._dispatchEvent("addstream",V)})}y.forEach(function(W){var k=W[0],Y=W[1];F.id===W[2].id&&v(D,k,Y,[F])})}}),y.forEach(function(M){M[2]||v(D,M[0],M[1],[])}),l.setTimeout(function(){!(D&&D.transceivers)||D.transceivers.forEach(function(M){M.iceTransport&&M.iceTransport.state==="new"&&M.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),M.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},m.prototype.close=function(){this.transceivers.forEach(function(g){g.iceTransport&&g.iceTransport.stop(),g.dtlsTransport&&g.dtlsTransport.stop(),g.rtpSender&&g.rtpSender.stop(),g.rtpReceiver&&g.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},m.prototype._updateSignalingState=function(g){this.signalingState=g;var D=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",D)},m.prototype._maybeFireNegotiationNeeded=function(){var g=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,l.setTimeout(function(){if(g.needNegotiation){g.needNegotiation=!1;var D=new Event("negotiationneeded");g._dispatchEvent("negotiationneeded",D)}},0))},m.prototype._updateIceConnectionState=function(){var g,D={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(y){y.iceTransport&&!y.rejected&&D[y.iceTransport.state]++}),g="new",D.failed>0?g="failed":D.checking>0?g="checking":D.disconnected>0?g="disconnected":D.new>0?g="new":D.connected>0?g="connected":D.completed>0&&(g="completed"),g!==this.iceConnectionState){this.iceConnectionState=g;var b=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",b)}},m.prototype._updateConnectionState=function(){var g,D={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(y){y.iceTransport&&y.dtlsTransport&&!y.rejected&&(D[y.iceTransport.state]++,D[y.dtlsTransport.state]++)}),D.connected+=D.completed,g="new",D.failed>0?g="failed":D.connecting>0?g="connecting":D.disconnected>0?g="disconnected":D.new>0?g="new":D.connected>0&&(g="connected"),g!==this.connectionState){this.connectionState=g;var b=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",b)}},m.prototype.createOffer=function(){var g=this;if(g._isClosed)return Promise.reject(u("InvalidStateError","Can not call createOffer after close"));var D=g.transceivers.filter(function(B){return B.kind==="audio"}).length,b=g.transceivers.filter(function(B){return B.kind==="video"}).length,y=arguments[0];if(y){if(y.mandatory||y.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");y.offerToReceiveAudio!==void 0&&(y.offerToReceiveAudio===!0?D=1:y.offerToReceiveAudio===!1?D=0:D=y.offerToReceiveAudio),y.offerToReceiveVideo!==void 0&&(y.offerToReceiveVideo===!0?b=1:y.offerToReceiveVideo===!1?b=0:b=y.offerToReceiveVideo)}for(g.transceivers.forEach(function(B){B.kind==="audio"?(D--,D<0&&(B.wantReceive=!1)):B.kind==="video"&&(b--,b<0&&(B.wantReceive=!1))});D>0||b>0;)D>0&&(g._createTransceiver("audio"),D--),b>0&&(g._createTransceiver("video"),b--);var A=r.writeSessionBoilerplate(g._sdpSessionId,g._sdpSessionVersion++);g.transceivers.forEach(function(B,j){var H=B.track,M=B.kind,F=B.mid||r.generateIdentifier();B.mid=F,B.iceGatherer||(B.iceGatherer=g._createIceGatherer(j,g.usingBundle));var V=l.RTCRtpSender.getCapabilities(M);d<15019&&(V.codecs=V.codecs.filter(function(k){return k.name!=="rtx"})),V.codecs.forEach(function(k){k.name==="H264"&&k.parameters["level-asymmetry-allowed"]===void 0&&(k.parameters["level-asymmetry-allowed"]="1"),B.remoteCapabilities&&B.remoteCapabilities.codecs&&B.remoteCapabilities.codecs.forEach(function(Y){k.name.toLowerCase()===Y.name.toLowerCase()&&k.clockRate===Y.clockRate&&(k.preferredPayloadType=Y.payloadType)})}),V.headerExtensions.forEach(function(k){var Y=B.remoteCapabilities&&B.remoteCapabilities.headerExtensions||[];Y.forEach(function(S){k.uri===S.uri&&(k.id=S.id)})});var W=B.sendEncodingParameters||[{ssrc:(2*j+1)*1001}];H&&d>=15019&&M==="video"&&!W[0].rtx&&(W[0].rtx={ssrc:W[0].ssrc+1}),B.wantReceive&&(B.rtpReceiver=new l.RTCRtpReceiver(B.dtlsTransport,M)),B.localCapabilities=V,B.sendEncodingParameters=W}),g._config.bundlePolicy!=="max-compat"&&(A+="a=group:BUNDLE "+g.transceivers.map(function(B){return B.mid}).join(" ")+`\r
`),A+=`a=ice-options:trickle\r
`,g.transceivers.forEach(function(B,j){A+=i(B,B.localCapabilities,"offer",B.stream,g._dtlsRole),A+=`a=rtcp-rsize\r
`,B.iceGatherer&&g.iceGatheringState!=="new"&&(j===0||!g.usingBundle)&&(B.iceGatherer.getLocalCandidates().forEach(function(H){H.component=1,A+="a="+r.writeCandidate(H)+`\r
`}),B.iceGatherer.state==="completed"&&(A+=`a=end-of-candidates\r
`))});var x=new l.RTCSessionDescription({type:"offer",sdp:A});return Promise.resolve(x)},m.prototype.createAnswer=function(){var g=this;if(g._isClosed)return Promise.reject(u("InvalidStateError","Can not call createAnswer after close"));if(!(g.signalingState==="have-remote-offer"||g.signalingState==="have-local-pranswer"))return Promise.reject(u("InvalidStateError","Can not call createAnswer in signalingState "+g.signalingState));var D=r.writeSessionBoilerplate(g._sdpSessionId,g._sdpSessionVersion++);g.usingBundle&&(D+="a=group:BUNDLE "+g.transceivers.map(function(A){return A.mid}).join(" ")+`\r
`),D+=`a=ice-options:trickle\r
`;var b=r.getMediaSections(g._remoteDescription.sdp).length;g.transceivers.forEach(function(A,x){if(!(x+1>b)){if(A.rejected){A.kind==="application"?A.protocol==="DTLS/SCTP"?D+=`m=application 0 DTLS/SCTP 5000\r
`:D+="m=application 0 "+A.protocol+` webrtc-datachannel\r
`:A.kind==="audio"?D+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:A.kind==="video"&&(D+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),D+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+A.mid+`\r
`;return}if(A.stream){var B;A.kind==="audio"?B=A.stream.getAudioTracks()[0]:A.kind==="video"&&(B=A.stream.getVideoTracks()[0]),B&&d>=15019&&A.kind==="video"&&!A.sendEncodingParameters[0].rtx&&(A.sendEncodingParameters[0].rtx={ssrc:A.sendEncodingParameters[0].ssrc+1})}var j=s(A.localCapabilities,A.remoteCapabilities),H=j.codecs.filter(function(M){return M.name.toLowerCase()==="rtx"}).length;!H&&A.sendEncodingParameters[0].rtx&&delete A.sendEncodingParameters[0].rtx,D+=i(A,j,"answer",A.stream,g._dtlsRole),A.rtcpParameters&&A.rtcpParameters.reducedSize&&(D+=`a=rtcp-rsize\r
`)}});var y=new l.RTCSessionDescription({type:"answer",sdp:D});return Promise.resolve(y)},m.prototype.addIceCandidate=function(g){var D=this,b;return g&&!(g.sdpMLineIndex!==void 0||g.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(y,A){if(D._remoteDescription)if(!g||g.candidate==="")for(var x=0;x<D.transceivers.length&&!(!D.transceivers[x].rejected&&(D.transceivers[x].iceTransport.addRemoteCandidate({}),b=r.getMediaSections(D._remoteDescription.sdp),b[x]+=`a=end-of-candidates\r
`,D._remoteDescription.sdp=r.getDescription(D._remoteDescription.sdp)+b.join(""),D.usingBundle));x++);else{var B=g.sdpMLineIndex;if(g.sdpMid){for(var j=0;j<D.transceivers.length;j++)if(D.transceivers[j].mid===g.sdpMid){B=j;break}}var H=D.transceivers[B];if(H){if(H.rejected)return y();var M=Object.keys(g.candidate).length>0?r.parseCandidate(g.candidate):{};if(M.protocol==="tcp"&&(M.port===0||M.port===9)||M.component&&M.component!==1)return y();if((B===0||B>0&&H.iceTransport!==D.transceivers[0].iceTransport)&&!c(H.iceTransport,M))return A(u("OperationError","Can not add ICE candidate"));var F=g.candidate.trim();F.indexOf("a=")===0&&(F=F.substr(2)),b=r.getMediaSections(D._remoteDescription.sdp),b[B]+="a="+(M.type?F:"end-of-candidates")+`\r
`,D._remoteDescription.sdp=r.getDescription(D._remoteDescription.sdp)+b.join("")}else return A(u("OperationError","Can not add ICE candidate"))}else return A(u("InvalidStateError","Can not add ICE candidate without a remote description"));y()})},m.prototype.getStats=function(g){if(g&&g instanceof l.MediaStreamTrack){var D=null;if(this.transceivers.forEach(function(y){y.rtpSender&&y.rtpSender.track===g?D=y.rtpSender:y.rtpReceiver&&y.rtpReceiver.track===g&&(D=y.rtpReceiver)}),!D)throw u("InvalidAccessError","Invalid selector.");return D.getStats()}var b=[];return this.transceivers.forEach(function(y){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(A){y[A]&&b.push(y[A].getStats())})}),Promise.all(b).then(function(y){var A=new Map;return y.forEach(function(x){x.forEach(function(B){A.set(B.id,B)})}),A})};var E=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];E.forEach(function(g){var D=l[g];if(D&&D.prototype&&D.prototype.getStats){var b=D.prototype.getStats;D.prototype.getStats=function(){return b.apply(this).then(function(y){var A=new Map;return Object.keys(y).forEach(function(x){y[x].type=n(y[x]),A.set(x,y[x])}),A})}}});var w=["createOffer","createAnswer"];return w.forEach(function(g){var D=m.prototype[g];m.prototype[g]=function(){var b=arguments;return typeof b[0]=="function"||typeof b[1]=="function"?D.apply(this,[arguments[2]]).then(function(y){typeof b[0]=="function"&&b[0].apply(null,[y])},function(y){typeof b[1]=="function"&&b[1].apply(null,[y])}):D.apply(this,arguments)}}),w=["setLocalDescription","setRemoteDescription","addIceCandidate"],w.forEach(function(g){var D=m.prototype[g];m.prototype[g]=function(){var b=arguments;return typeof b[1]=="function"||typeof b[2]=="function"?D.apply(this,arguments).then(function(){typeof b[1]=="function"&&b[1].apply(null)},function(y){typeof b[2]=="function"&&b[2].apply(null,[y])}):D.apply(this,arguments)}}),["getStats"].forEach(function(g){var D=m.prototype[g];m.prototype[g]=function(){var b=arguments;return typeof b[1]=="function"?D.apply(this,arguments).then(function(){typeof b[1]=="function"&&b[1].apply(null)}):D.apply(this,arguments)}}),m}}}),ku=lt(n0(),1),Pl=!0,Rl=!0;function qr(e,t,r){const n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function Ir(e,t,r){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(s,o){if(s!==t)return i.apply(this,arguments);const c=u=>{const l=r(u);l&&(o.handleEvent?o.handleEvent(l):o(l))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(o,c),i.apply(this,[s,c])};const a=n.removeEventListener;n.removeEventListener=function(s,o){if(s!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(o))return a.apply(this,arguments);const c=this._eventMap[t].get(o);return this._eventMap[t].delete(o),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[s,c])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(s){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),s&&this.addEventListener(t,this["_on"+t]=s)},enumerable:!0,configurable:!0})}function a0(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Pl=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function s0(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Rl=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function $s(){if(typeof window=="object"){if(Pl)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function ji(e,t){!Rl||console.warn(e+" is deprecated, please use "+t+" instead.")}function o0(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator)return t.browser="Not a browser.",t;const{navigator:r}=e;if(r.mozGetUserMedia)t.browser="firefox",t.version=qr(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=qr(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(r.mediaDevices&&r.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=qr(r.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(e.RTCPeerConnection&&r.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=qr(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function Tu(e){return Object.prototype.toString.call(e)==="[object Object]"}function Il(e){return Tu(e)?Object.keys(e).reduce(function(t,r){const n=Tu(e[r]),i=n?Il(e[r]):e[r],a=n&&!Object.keys(i).length;return i===void 0||a?t:Object.assign(t,{[r]:i})},{}):e}function Ma(e,t,r){!t||r.has(t.id)||(r.set(t.id,t),Object.keys(t).forEach(n=>{n.endsWith("Id")?Ma(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach(i=>{Ma(e,e.get(i),r)})}))}function Fu(e,t,r){const n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const a=[];return e.forEach(s=>{s.type==="track"&&s.trackIdentifier===t.id&&a.push(s)}),a.forEach(s=>{e.forEach(o=>{o.type===n&&o.trackId===s.id&&Ma(e,o,i)})}),i}var ja={};Dn(ja,{fixNegotiationNeeded:()=>Vl,shimAddTrackRemoveTrack:()=>Wl,shimAddTrackRemoveTrackWithNative:()=>$l,shimGetDisplayMedia:()=>u0,shimGetSendersWithDtmf:()=>Nl,shimGetStats:()=>Ul,shimGetUserMedia:()=>Ml,shimMediaStream:()=>jl,shimOnTrack:()=>Ll,shimPeerConnection:()=>La,shimSenderReceiverGetStats:()=>zl});var Ou=$s;function Ml(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const n=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const c={};return Object.keys(o).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const l=typeof o[u]=="object"?o[u]:{ideal:o[u]};l.exact!==void 0&&typeof l.exact=="number"&&(l.min=l.max=l.exact);const d=function(h,f){return h?h+f.charAt(0).toUpperCase()+f.slice(1):f==="deviceId"?"sourceId":f};if(l.ideal!==void 0){c.optional=c.optional||[];let h={};typeof l.ideal=="number"?(h[d("min",u)]=l.ideal,c.optional.push(h),h={},h[d("max",u)]=l.ideal,c.optional.push(h)):(h[d("",u)]=l.ideal,c.optional.push(h))}l.exact!==void 0&&typeof l.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[d("",u)]=l.exact):["min","max"].forEach(h=>{l[h]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[d(h,u)]=l[h])})}),o.advanced&&(c.optional=(c.optional||[]).concat(o.advanced)),c},i=function(o,c){if(t.version>=61)return c(o);if(o=JSON.parse(JSON.stringify(o)),o&&typeof o.audio=="object"){const u=function(l,d,h){d in l&&!(h in l)&&(l[h]=l[d],delete l[d])};o=JSON.parse(JSON.stringify(o)),u(o.audio,"autoGainControl","googAutoGainControl"),u(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=n(o.audio)}if(o&&typeof o.video=="object"){let u=o.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const l=t.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(r.mediaDevices.getSupportedConstraints&&r.mediaDevices.getSupportedConstraints().facingMode&&!l)){delete o.video.facingMode;let d;if(u.exact==="environment"||u.ideal==="environment"?d=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(d=["front"]),d)return r.mediaDevices.enumerateDevices().then(h=>{h=h.filter(v=>v.kind==="videoinput");let f=h.find(v=>d.some(m=>v.label.toLowerCase().includes(m)));return!f&&h.length&&d.includes("back")&&(f=h[h.length-1]),f&&(o.video.deviceId=u.exact?{exact:f.deviceId}:{ideal:f.deviceId}),o.video=n(o.video),Ou("chrome: "+JSON.stringify(o)),c(o)})}o.video=n(o.video)}return Ou("chrome: "+JSON.stringify(o)),c(o)},a=function(o){return t.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},s=function(o,c,u){i(o,l=>{r.webkitGetUserMedia(l,c,d=>{u&&u(a(d))})})};if(r.getUserMedia=s.bind(r),r.mediaDevices.getUserMedia){const o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(c){return i(c,u=>o(u).then(l=>{if(u.audio&&!l.getAudioTracks().length||u.video&&!l.getVideoTracks().length)throw l.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return l},l=>Promise.reject(a(l))))}}}function u0(e,t){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&!!e.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(i=>{const a=n.video&&n.video.width,s=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:o||3}},a&&(n.video.mandatory.maxWidth=a),s&&(n.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(n)})}}}function jl(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Ll(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let a;e.RTCPeerConnection.prototype.getReceivers?a=this.getReceivers().find(o=>o.track&&o.track.id===i.track.id):a={track:i.track};const s=new Event("track");s.track=i.track,s.receiver=a,s.transceiver={receiver:a},s.streams=[n.stream],this.dispatchEvent(s)}),n.stream.getTracks().forEach(i=>{let a;e.RTCPeerConnection.prototype.getReceivers?a=this.getReceivers().find(o=>o.track&&o.track.id===i.id):a={track:i};const s=new Event("track");s.track=i,s.receiver=a,s.transceiver={receiver:a},s.streams=[n.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Ir(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Nl(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=i.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,c){let u=i.apply(this,arguments);return u||(u=t(this,o),this._senders.push(u)),u};const a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){a.apply(this,arguments);const c=this._senders.indexOf(o);c!==-1&&this._senders.splice(c,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._senders=this._senders||[],r.apply(this,[a]),a.getTracks().forEach(s=>{this._senders.push(t(this,s))})};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){this._senders=this._senders||[],n.apply(this,[a]),a.getTracks().forEach(s=>{const o=this._senders.find(c=>c.track===s);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Ul(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,i,a]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const s=function(c){const u={};return c.result().forEach(d=>{const h={id:d.id,timestamp:d.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type};d.names().forEach(f=>{h[f]=d.stat(f)}),u[h.id]=h}),u},o=function(c){return new Map(Object.keys(c).map(u=>[u,c[u]]))};if(arguments.length>=2){const c=function(u){i(o(s(u)))};return t.apply(this,[c,n])}return new Promise((c,u)=>{t.apply(this,[function(l){c(o(s(l)))},u])}).then(i,a)}}function zl(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const a=r.apply(this,[]);return a.forEach(s=>s._pc=this),a});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const a=n.apply(this,arguments);return a._pc=this,a}),e.RTCRtpSender.prototype.getStats=function(){const a=this;return this._pc.getStats().then(s=>Fu(s,a.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=r.apply(this,[]);return i.forEach(a=>a._pc=this),i}),Ir(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(a=>Fu(a,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let i,a,s;return this.getSenders().forEach(o=>{o.track===n&&(i?s=!0:i=o)}),this.getReceivers().forEach(o=>(o.track===n&&(a?s=!0:a=o),o.track===n)),s||i&&a?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():a?a.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function $l(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,o){if(!o)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=t.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(c)===-1&&this._shimmedLocalStreams[o.id].push(c):this._shimmedLocalStreams[o.id]=[o,c],c};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(u=>{if(this.getSenders().find(d=>d.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();r.apply(this,arguments);const c=this.getSenders().filter(u=>o.indexOf(u)===-1);this._shimmedLocalStreams[s.id]=[s].concat(c)};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],n.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const c=this._shimmedLocalStreams[o].indexOf(s);c!==-1&&this._shimmedLocalStreams[o].splice(c,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),i.apply(this,arguments)}}function Wl(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return $l(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const l=r.apply(this);return this._reverseStreams=this._reverseStreams||{},l.map(d=>this._reverseStreams[d.id])};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.getTracks().forEach(d=>{if(this.getSenders().find(f=>f.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[l.id]){const d=new e.MediaStream(l.getTracks());this._streams[l.id]=d,this._reverseStreams[d.id]=l,l=d}n.apply(this,[l])};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[l.id]||l]),delete this._reverseStreams[this._streams[l.id]?this._streams[l.id].id:l.id],delete this._streams[l.id]},e.RTCPeerConnection.prototype.addTrack=function(l,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(m=>m===l))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(m=>m.track===l))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[d.id];if(v)v.addTrack(l),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const m=new e.MediaStream([l]);this._streams[d.id]=m,this._reverseStreams[m.id]=d,this.addStream(m)}return this.getSenders().find(m=>m.track===l)};function a(u,l){let d=l.sdp;return Object.keys(u._reverseStreams||[]).forEach(h=>{const f=u._reverseStreams[h],v=u._streams[f.id];d=d.replace(new RegExp(v.id,"g"),f.id)}),new RTCSessionDescription({type:l.type,sdp:d})}function s(u,l){let d=l.sdp;return Object.keys(u._reverseStreams||[]).forEach(h=>{const f=u._reverseStreams[h],v=u._streams[f.id];d=d.replace(new RegExp(f.id,"g"),v.id)}),new RTCSessionDescription({type:l.type,sdp:d})}["createOffer","createAnswer"].forEach(function(u){const l=e.RTCPeerConnection.prototype[u],d={[u](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?l.apply(this,[v=>{const m=a(this,v);h[0].apply(null,[m])},v=>{h[1]&&h[1].apply(null,v)},arguments[2]]):l.apply(this,arguments).then(v=>a(this,v))}};e.RTCPeerConnection.prototype[u]=d[u]});const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?o.apply(this,arguments):(arguments[0]=s(this,arguments[0]),o.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const u=c.get.apply(this);return u.type===""?u:a(this,u)}}),e.RTCPeerConnection.prototype.removeTrack=function(l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!l._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(l._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(f=>{this._streams[f].getTracks().find(m=>l.track===m)&&(h=this._streams[f])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(l.track),this.dispatchEvent(new Event("negotiationneeded")))}}function La(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!!e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const n=e.RTCPeerConnection.prototype[r],i={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=i[r]})}function Vl(e,t){Ir(e,"negotiationneeded",r=>{const n=r.target;if(!((t.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")&&n.signalingState!=="stable"))return r})}var Na={};Dn(Na,{shimGetDisplayMedia:()=>ql,shimGetUserMedia:()=>Gl,shimPeerConnection:()=>Ua,shimReplaceTrack:()=>Hl});function c0(e,t){let r=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(n=>{if(n&&(n.urls||n.url)){let i=n.urls||n.url;n.url&&!n.urls&&ji("RTCIceServer.url","RTCIceServer.urls");const a=typeof i=="string";return a&&(i=[i]),i=i.filter(s=>{if(s.indexOf("stun:")===0)return!1;const o=s.startsWith("turn")&&!s.startsWith("turn:[")&&s.includes("transport=udp");return o&&!r?(r=!0,!0):o&&!r}),delete n.url,n.urls=a?i[0]:i,!!i.length}})}var l0=lt(i0());function Gl(e){const t=e&&e.navigator,r=function(i){return{name:{PermissionDeniedError:"NotAllowedError"}[i.name]||i.name,message:i.message,constraint:i.constraint,toString(){return this.name}}},n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(i){return n(i).catch(a=>Promise.reject(r(a)))}}function ql(e){"getDisplayMedia"in e.navigator&&(!e.navigator.mediaDevices||e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function Ua(e,t){if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(i){return i}),e.RTCSessionDescription||(e.RTCSessionDescription=function(i){return i}),t.version<15025)){const n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set(i){n.set.call(this,i);const a=new Event("enabled");a.enabled=i,this.dispatchEvent(a)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new e.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const r=(0,l0.default)(e,t.version);e.RTCPeerConnection=function(i){return i&&i.iceServers&&(i.iceServers=c0(i.iceServers,t.version),$s("ICE servers after filtering:",i.iceServers)),new r(i)},e.RTCPeerConnection.prototype=r.prototype}function Hl(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}var za={};Dn(za,{shimAddTransceiver:()=>ef,shimCreateAnswer:()=>nf,shimCreateOffer:()=>rf,shimGetDisplayMedia:()=>f0,shimGetParameters:()=>tf,shimGetUserMedia:()=>Kl,shimOnTrack:()=>Yl,shimPeerConnection:()=>$a,shimRTCDataChannel:()=>Ql,shimReceiverGetStats:()=>Xl,shimRemoveStream:()=>Zl,shimSenderGetStats:()=>Jl});function Kl(e,t){const r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(i,a,s){ji("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(i).then(a,s)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const i=function(s,o,c){o in s&&!(c in s)&&(s[c]=s[o],delete s[o])},a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(s){return typeof s=="object"&&typeof s.audio=="object"&&(s=JSON.parse(JSON.stringify(s)),i(s.audio,"autoGainControl","mozAutoGainControl"),i(s.audio,"noiseSuppression","mozNoiseSuppression")),a(s)},n&&n.prototype.getSettings){const s=n.prototype.getSettings;n.prototype.getSettings=function(){const o=s.apply(this,arguments);return i(o,"mozAutoGainControl","autoGainControl"),i(o,"mozNoiseSuppression","noiseSuppression"),o}}if(n&&n.prototype.applyConstraints){const s=n.prototype.applyConstraints;n.prototype.applyConstraints=function(o){return this.kind==="audio"&&typeof o=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o,"autoGainControl","mozAutoGainControl"),i(o,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[o])}}}}function f0(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||!e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!(n&&n.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function Yl(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function $a(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const a=e.RTCPeerConnection.prototype[i],s={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=s[i]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[a,s,o]=arguments;return n.apply(this,[a||null]).then(c=>{if(t.version<53&&!s)try{c.forEach(u=>{u.type=r[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;c.forEach((l,d)=>{c.set(d,Object.assign({},l,{type:r[l.type]||l.type}))})}return c}).then(s,o)}}function Jl(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(a=>a._pc=this),i});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Xl(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n}),Ir(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Zl(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){ji("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&r.getTracks().includes(n.track)&&this.removeTrack(n)})})}function Ql(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function ef(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const n=arguments[1],i=n&&"sendEncodings"in n;i&&n.sendEncodings.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const a=t.apply(this,arguments);if(i){const{sender:s}=a,o=s.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=n.sendEncodings,s.sendEncodings=n.sendEncodings,this.setParametersPromises.push(s.setParameters(o).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return a})}function tf(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function rf(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function nf(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var Wa={};Dn(Wa,{shimAudioContext:()=>hf,shimCallbacksAPI:()=>of,shimConstraints:()=>cf,shimCreateOfferLegacy:()=>df,shimGetUserMedia:()=>uf,shimLocalStreamsAPI:()=>af,shimRTCIceServerUrls:()=>lf,shimRemoteStreamsAPI:()=>sf,shimTrackEventTransceiver:()=>ff});function af(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>t.call(this,i,n)),n.getVideoTracks().forEach(i=>t.call(this,i,n))},e.RTCPeerConnection.prototype.addTrack=function(n,...i){return i&&i.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(r);if(n===-1)return;this._localStreams.splice(n,1);const i=r.getTracks();this.getSenders().forEach(a=>{i.includes(a.track)&&this.removeTrack(a)})})}}function sf(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const a=new Event("addstream");a.stream=i,this.dispatchEvent(a)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(a=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(a)>=0)return;n._remoteStreams.push(a);const s=new Event("addstream");s.stream=a,n.dispatchEvent(s)})}),t.apply(n,arguments)}}}function of(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(u,l){const d=arguments.length>=2?arguments[2]:arguments[0],h=r.apply(this,[d]);return l?(h.then(u,l),Promise.resolve()):h},t.createAnswer=function(u,l){const d=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[d]);return l?(h.then(u,l),Promise.resolve()):h};let o=function(c,u,l){const d=i.apply(this,[c]);return l?(d.then(u,l),Promise.resolve()):d};t.setLocalDescription=o,o=function(c,u,l){const d=a.apply(this,[c]);return l?(d.then(u,l),Promise.resolve()):d},t.setRemoteDescription=o,o=function(c,u,l){const d=s.apply(this,[c]);return l?(d.then(u,l),Promise.resolve()):d},t.addIceCandidate=o}function uf(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=i=>n(cf(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(n,i,a){t.mediaDevices.getUserMedia(n).then(i,a)}.bind(t))}function cf(e){return e&&e.video!==void 0?Object.assign({},e,{video:Il(e.video)}):e}function lf(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const a=[];for(let s=0;s<n.iceServers.length;s++){let o=n.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(ji("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,a.push(o)):a.push(n.iceServers[s])}n.iceServers=a}return new t(n,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function ff(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function df(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){typeof n.offerToReceiveAudio<"u"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio"),typeof n.offerToReceiveVideo<"u"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const a=this.getTransceivers().find(s=>s.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):n.offerToReceiveVideo===!0&&!a&&this.addTransceiver("video")}return t.apply(this,arguments)}}function hf(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var pf={};Dn(pf,{removeExtmapAllowMixed:()=>Ga,shimAddIceCandidateNullOrEmpty:()=>Zn,shimConnectionState:()=>Va,shimMaxMessageSize:()=>Hr,shimRTCIceCandidate:()=>Xn,shimSendThrowTypeError:()=>Kr});var Jn=lt(xl());function Xn(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&(n=JSON.parse(JSON.stringify(n)),n.candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new t(n),a=Jn.default.parseCandidate(n.candidate),s=Object.assign(i,a);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,Ir(e,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r))}function Hr(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const r=function(o){if(!o||!o.sdp)return!1;const c=Jn.default.splitSections(o.sdp);return c.shift(),c.some(u=>{const l=Jn.default.parseMLine(u);return l&&l.kind==="application"&&l.protocol.indexOf("SCTP")!==-1})},n=function(o){const c=o.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const u=parseInt(c[1],10);return u!==u?-1:u},i=function(o){let c=65536;return t.browser==="firefox"&&(t.version<57?o===-1?c=16384:c=2147483637:t.version<60?c=t.version===57?65535:65536:c=2147483637),c},a=function(o,c){let u=65536;t.browser==="firefox"&&t.version===57&&(u=65535);const l=Jn.default.matchPrefix(o.sdp,"a=max-message-size:");return l.length>0?u=parseInt(l[0].substr(19),10):t.browser==="firefox"&&c!==-1&&(u=2147483637),u},s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const c=n(arguments[0]),u=i(c),l=a(arguments[0],c);let d;u===0&&l===0?d=Number.POSITIVE_INFINITY:u===0||l===0?d=Math.max(u,l):d=Math.min(u,l);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return d}}),this._sctp=h}return s.apply(this,arguments)}}function Kr(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(n,i){const a=n.send;n.send=function(){const o=arguments[0],c=o.length||o.size||o.byteLength;if(n.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return a.apply(n,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=r.apply(this,arguments);return t(i,this),i},Ir(e,"datachannel",n=>(t(n.channel,n.target),n))}function Va(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const n=t[r];t[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const a=i.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;const s=new Event("connectionstatechange",i);a.dispatchEvent(s)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function Ga(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const a=i.sdp.split(`
`).filter(s=>s.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:a}):i.sdp=a}return r.apply(this,arguments)}}function Zn(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const r=e.RTCPeerConnection.prototype.addIceCandidate;!r||r.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function d0({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const r=$s,n=o0(e),i={browserDetails:n,commonShim:pf,extractVersion:qr,disableLog:a0,disableWarnings:s0};switch(n.browser){case"chrome":if(!ja||!La||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(n.version===null)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=ja,Zn(e,n),Ml(e,n),jl(e),La(e,n),Ll(e),Wl(e,n),Nl(e),Ul(e),zl(e),Vl(e,n),Xn(e),Va(e),Hr(e,n),Kr(e),Ga(e,n);break;case"firefox":if(!za||!$a||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=za,Zn(e,n),Kl(e,n),$a(e,n),Yl(e),Zl(e),Jl(e),Xl(e),Ql(e),ef(e),tf(e),rf(e),nf(e),Xn(e),Va(e),Hr(e,n),Kr(e);break;case"edge":if(!Na||!Ua||!t.shimEdge)return r("MS edge shim is not included in this adapter release."),i;r("adapter.js shimming edge."),i.browserShim=Na,Gl(e),ql(e),Ua(e,n),Hl(e),Hr(e,n),Kr(e);break;case"safari":if(!Wa||!t.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=Wa,Zn(e,n),lf(e),df(e),of(e),af(e),sf(e),ff(e),uf(e),hf(e),Xn(e),Hr(e,n),Kr(e),Ga(e,n);break;default:r("Unsupported browser!");break}return i}var h0=d0({window:typeof window>"u"?void 0:window}),xu=h0;function mt(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var ua=xu.default||xu,zr=new(function(){function e(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return e.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},e.prototype.isBrowserSupported=function(){var t=this.getBrowser(),r=this.getVersion(),n=this.supportedBrowsers.includes(t);return n?t==="chrome"?r>=this.minChromeVersion:t==="firefox"?r>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&r>=this.minSafariVersion:!1:!1},e.prototype.getBrowser=function(){return ua.browserDetails.browser},e.prototype.getVersion=function(){return ua.browserDetails.version||0},e.prototype.isUnifiedPlanSupported=function(){var t=this.getBrowser(),r=ua.browserDetails.version||0;if(t==="chrome"&&r<this.minChromeVersion)return!1;if(t==="firefox"&&r>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var n,i=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),i=!0}catch{}finally{n&&n.close()}return i},e.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},e}()),Pu={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},p0=function(){function e(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=Pu,this.browser=zr.getBrowser(),this.browserVersion=zr.getVersion(),this.supports=function(){var t={browser:zr.isBrowserSupported(),webRTC:zr.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;var r;try{r=new RTCPeerConnection(Pu),t.audioVideo=!0;var n=void 0;try{n=r.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!n.ordered;try{n.binaryType="blob",t.binaryBlob=!zr.isIOS}catch{}}catch{}finally{n&&n.close()}}catch{}finally{r&&r.close()}return t}(),this.pack=ku.default.pack,this.unpack=ku.default.unpack,this._dataCount=1}return e.prototype.noop=function(){},e.prototype.validateId=function(t){return!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t)},e.prototype.chunk=function(t){for(var r=[],n=t.size,i=Math.ceil(n/le.chunkedMTU),a=0,s=0;s<n;){var o=Math.min(n,s+le.chunkedMTU),c=t.slice(s,o),u={__peerData:this._dataCount,n:a,data:c,total:i};r.push(u),s=o,a++}return this._dataCount++,r},e.prototype.blobToArrayBuffer=function(t,r){var n=new FileReader;return n.onload=function(i){i.target&&r(i.target.result)},n.readAsArrayBuffer(t),n},e.prototype.binaryStringToArrayBuffer=function(t){for(var r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n)&255;return r.buffer},e.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},e.prototype.isSecure=function(){return location.protocol==="https:"},e}(),le=new p0,vf={};mt(vf,"Peer",()=>Ka,e=>Ka=e);var Bn={},v0=Object.prototype.hasOwnProperty,Me="~";function mn(){}Object.create&&(mn.prototype=Object.create(null),new mn().__proto__||(Me=!1));function g0(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function gf(e,t,r,n,i){if(typeof r!="function")throw new TypeError("The listener must be a function");var a=new g0(r,n||e,i),s=Me?Me+t:t;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],a]:e._events[s].push(a):(e._events[s]=a,e._eventsCount++),e}function Qn(e,t){--e._eventsCount===0?e._events=new mn:delete e._events[t]}function Ie(){this._events=new mn,this._eventsCount=0}Ie.prototype.eventNames=function(){var t=[],r,n;if(this._eventsCount===0)return t;for(n in r=this._events)v0.call(r,n)&&t.push(Me?n.slice(1):n);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(r)):t};Ie.prototype.listeners=function(t){var r=Me?Me+t:t,n=this._events[r];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,a=n.length,s=new Array(a);i<a;i++)s[i]=n[i].fn;return s};Ie.prototype.listenerCount=function(t){var r=Me?Me+t:t,n=this._events[r];return n?n.fn?1:n.length:0};Ie.prototype.emit=function(t,r,n,i,a,s){var o=Me?Me+t:t;if(!this._events[o])return!1;var c=this._events[o],u=arguments.length,l,d;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,r),!0;case 3:return c.fn.call(c.context,r,n),!0;case 4:return c.fn.call(c.context,r,n,i),!0;case 5:return c.fn.call(c.context,r,n,i,a),!0;case 6:return c.fn.call(c.context,r,n,i,a,s),!0}for(d=1,l=new Array(u-1);d<u;d++)l[d-1]=arguments[d];c.fn.apply(c.context,l)}else{var h=c.length,f;for(d=0;d<h;d++)switch(c[d].once&&this.removeListener(t,c[d].fn,void 0,!0),u){case 1:c[d].fn.call(c[d].context);break;case 2:c[d].fn.call(c[d].context,r);break;case 3:c[d].fn.call(c[d].context,r,n);break;case 4:c[d].fn.call(c[d].context,r,n,i);break;default:if(!l)for(f=1,l=new Array(u-1);f<u;f++)l[f-1]=arguments[f];c[d].fn.apply(c[d].context,l)}}return!0};Ie.prototype.on=function(t,r,n){return gf(this,t,r,n,!1)};Ie.prototype.once=function(t,r,n){return gf(this,t,r,n,!0)};Ie.prototype.removeListener=function(t,r,n,i){var a=Me?Me+t:t;if(!this._events[a])return this;if(!r)return Qn(this,a),this;var s=this._events[a];if(s.fn)s.fn===r&&(!i||s.once)&&(!n||s.context===n)&&Qn(this,a);else{for(var o=0,c=[],u=s.length;o<u;o++)(s[o].fn!==r||i&&!s[o].once||n&&s[o].context!==n)&&c.push(s[o]);c.length?this._events[a]=c.length===1?c[0]:c:Qn(this,a)}return this};Ie.prototype.removeAllListeners=function(t){var r;return t?(r=Me?Me+t:t,this._events[r]&&Qn(this,r)):(this._events=new mn,this._eventsCount=0),this};Ie.prototype.off=Ie.prototype.removeListener;Ie.prototype.addListener=Ie.prototype.on;Ie.prefixed=Me;Ie.EventEmitter=Ie;Bn=Ie;var K={};mt(K,"LogLevel",()=>Le,e=>Le=e);mt(K,"default",()=>Ru,e=>Ru=e);var Yt=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,a=[],s;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(o){s={error:o}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return a},Jt=function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,a;n<i;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},m0="PeerJS: ",Le;(function(e){e[e.Disabled=0]="Disabled",e[e.Errors=1]="Errors",e[e.Warnings=2]="Warnings",e[e.All=3]="All"})(Le||(Le={}));var D0=function(){function e(){this._logLevel=Le.Disabled}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){this._logLevel=t},enumerable:!1,configurable:!0}),e.prototype.log=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this._logLevel>=Le.All&&this._print.apply(this,Jt([Le.All],Yt(t),!1))},e.prototype.warn=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this._logLevel>=Le.Warnings&&this._print.apply(this,Jt([Le.Warnings],Yt(t),!1))},e.prototype.error=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this._logLevel>=Le.Errors&&this._print.apply(this,Jt([Le.Errors],Yt(t),!1))},e.prototype.setLogFunction=function(t){this._print=t},e.prototype._print=function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var i=Jt([m0],Yt(r),!1);for(var a in i)i[a]instanceof Error&&(i[a]="("+i[a].name+") "+i[a].message);t>=Le.All?console.log.apply(console,Jt([],Yt(i),!1)):t>=Le.Warnings?console.warn.apply(console,Jt(["WARNING"],Yt(i),!1)):t>=Le.Errors&&console.error.apply(console,Jt(["ERROR"],Yt(i),!1))},e}(),Ru=new D0,mf={};mt(mf,"Socket",()=>Iu,e=>Iu=e);var st;(function(e){e.Data="data",e.Media="media"})(st||(st={}));var ye;(function(e){e.BrowserIncompatible="browser-incompatible",e.Disconnected="disconnected",e.InvalidID="invalid-id",e.InvalidKey="invalid-key",e.Network="network",e.PeerUnavailable="peer-unavailable",e.SslUnavailable="ssl-unavailable",e.ServerError="server-error",e.SocketError="socket-error",e.SocketClosed="socket-closed",e.UnavailableID="unavailable-id",e.WebRTC="webrtc"})(ye||(ye={}));var bt;(function(e){e.Binary="binary",e.BinaryUTF8="binary-utf8",e.JSON="json"})(bt||(bt={}));var St;(function(e){e.Message="message",e.Disconnected="disconnected",e.Error="error",e.Close="close"})(St||(St={}));var Oe;(function(e){e.Heartbeat="HEARTBEAT",e.Candidate="CANDIDATE",e.Offer="OFFER",e.Answer="ANSWER",e.Open="OPEN",e.Error="ERROR",e.IdTaken="ID-TAKEN",e.InvalidKey="INVALID-KEY",e.Leave="LEAVE",e.Expire="EXPIRE"})(Oe||(Oe={}));var Ws={};Ws=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz St\xFCckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","So\u0308ren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var C0=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),y0=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,a=[],s;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(o){s={error:o}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return a},b0=function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,a;n<i;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},E0=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Iu=function(e){C0(t,e);function t(r,n,i,a,s,o){o===void 0&&(o=5e3);var c=e.call(this)||this;c.pingInterval=o,c._disconnected=!0,c._messagesQueue=[];var u=r?"wss://":"ws://";return c._baseUrl=u+n+":"+i+a+"peerjs?key="+s,c}return t.prototype.start=function(r,n){var i=this;this._id=r;var a="".concat(this._baseUrl,"&id=").concat(r,"&token=").concat(n);!!this._socket||!this._disconnected||(this._socket=new WebSocket(a+"&version="+Ws.version),this._disconnected=!1,this._socket.onmessage=function(s){var o;try{o=JSON.parse(s.data),K.default.log("Server message received:",o)}catch{K.default.log("Invalid server message",s.data);return}i.emit(St.Message,o)},this._socket.onclose=function(s){i._disconnected||(K.default.log("Socket closed.",s),i._cleanup(),i._disconnected=!0,i.emit(St.Disconnected))},this._socket.onopen=function(){i._disconnected||(i._sendQueuedMessages(),K.default.log("Socket open"),i._scheduleHeartbeat())})},t.prototype._scheduleHeartbeat=function(){var r=this;this._wsPingTimer=setTimeout(function(){r._sendHeartbeat()},this.pingInterval)},t.prototype._sendHeartbeat=function(){if(!this._wsOpen()){K.default.log("Cannot send heartbeat, because socket closed");return}var r=JSON.stringify({type:Oe.Heartbeat});this._socket.send(r),this._scheduleHeartbeat()},t.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},t.prototype._sendQueuedMessages=function(){var r,n,i=b0([],y0(this._messagesQueue),!1);this._messagesQueue=[];try{for(var a=E0(i),s=a.next();!s.done;s=a.next()){var o=s.value;this.send(o)}}catch(c){r={error:c}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}},t.prototype.send=function(r){if(!this._disconnected){if(!this._id){this._messagesQueue.push(r);return}if(!r.type){this.emit(St.Error,"Invalid message");return}if(!!this._wsOpen()){var n=JSON.stringify(r);this._socket.send(n)}}},t.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},t.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},t}(Bn.EventEmitter),qa={};mt(qa,"MediaConnection",()=>Lu,e=>Lu=e);var Vs={};mt(Vs,"Negotiator",()=>Mu,e=>Mu=e);var gi=function(){return gi=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},gi.apply(this,arguments)},Un=function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function o(l){try{u(n.next(l))}catch(d){s(d)}}function c(l){try{u(n.throw(l))}catch(d){s(d)}}function u(l){l.done?a(l.value):i(l.value).then(o,c)}u((n=n.apply(e,t||[])).next())})},zn=function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=u[0]&2?i.return:u[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,u[1])).done)return a;switch(i=0,a&&(u=[u[0]&2,a.value]),u[0]){case 0:case 1:a=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!a||u[1]>a[0]&&u[1]<a[3])){r.label=u[1];break}if(u[0]===6&&r.label<a[1]){r.label=a[1],a=u;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(u);break}a[2]&&r.ops.pop(),r.trys.pop();continue}u=t.call(e,r)}catch(l){u=[6,l],i=0}finally{n=a=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},Mu=function(){function e(t){this.connection=t}return e.prototype.startConnection=function(t){var r=this._startPeerConnection();if(this.connection.peerConnection=r,this.connection.type===st.Media&&t._stream&&this._addTracksToConnection(t._stream,r),t.originator){if(this.connection.type===st.Data){var n=this.connection,i={ordered:!!t.reliable},a=r.createDataChannel(n.label,i);n.initialize(a)}this._makeOffer()}else this.handleSDP("OFFER",t.sdp)},e.prototype._startPeerConnection=function(){K.default.log("Creating RTCPeerConnection.");var t=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(t),t},e.prototype._setupListeners=function(t){var r=this,n=this.connection.peer,i=this.connection.connectionId,a=this.connection.type,s=this.connection.provider;K.default.log("Listening for ICE candidates."),t.onicecandidate=function(o){!o.candidate||!o.candidate.candidate||(K.default.log("Received ICE candidates for ".concat(n,":"),o.candidate),s.socket.send({type:Oe.Candidate,payload:{candidate:o.candidate,type:a,connectionId:i},dst:n}))},t.oniceconnectionstatechange=function(){switch(t.iceConnectionState){case"failed":K.default.log("iceConnectionState is failed, closing connections to "+n),r.connection.emit("error",new Error("Negotiation of connection to "+n+" failed.")),r.connection.close();break;case"closed":K.default.log("iceConnectionState is closed, closing connections to "+n),r.connection.emit("error",new Error("Connection to "+n+" closed.")),r.connection.close();break;case"disconnected":K.default.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":t.onicecandidate=le.noop;break}r.connection.emit("iceStateChanged",t.iceConnectionState)},K.default.log("Listening for data channel"),t.ondatachannel=function(o){K.default.log("Received data channel");var c=o.channel,u=s.getConnection(n,i);u.initialize(c)},K.default.log("Listening for remote stream"),t.ontrack=function(o){K.default.log("Received remote stream");var c=o.streams[0],u=s.getConnection(n,i);if(u.type===st.Media){var l=u;r._addStreamToMediaConnection(c,l)}}},e.prototype.cleanup=function(){K.default.log("Cleaning up PeerConnection to "+this.connection.peer);var t=this.connection.peerConnection;if(!!t){this.connection.peerConnection=null,t.onicecandidate=t.oniceconnectionstatechange=t.ondatachannel=t.ontrack=function(){};var r=t.signalingState!=="closed",n=!1;if(this.connection.type===st.Data){var i=this.connection,a=i.dataChannel;a&&(n=!!a.readyState&&a.readyState!=="closed")}(r||n)&&t.close()}},e.prototype._makeOffer=function(){return Un(this,void 0,Promise,function(){var t,r,n,i,a,s,o;return zn(this,function(c){switch(c.label){case 0:t=this.connection.peerConnection,r=this.connection.provider,c.label=1;case 1:return c.trys.push([1,7,,8]),[4,t.createOffer(this.connection.options.constraints)];case 2:n=c.sent(),K.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),c.label=3;case 3:return c.trys.push([3,5,,6]),[4,t.setLocalDescription(n)];case 4:return c.sent(),K.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),i={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:le.browser},this.connection.type===st.Data&&(a=this.connection,i=gi(gi({},i),{label:a.label,reliable:a.reliable,serialization:a.serialization})),r.socket.send({type:Oe.Offer,payload:i,dst:this.connection.peer}),[3,6];case 5:return s=c.sent(),s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(r.emitError(ye.WebRTC,s),K.default.log("Failed to setLocalDescription, ",s)),[3,6];case 6:return[3,8];case 7:return o=c.sent(),r.emitError(ye.WebRTC,o),K.default.log("Failed to createOffer, ",o),[3,8];case 8:return[2]}})})},e.prototype._makeAnswer=function(){return Un(this,void 0,Promise,function(){var t,r,n,i,a;return zn(this,function(s){switch(s.label){case 0:t=this.connection.peerConnection,r=this.connection.provider,s.label=1;case 1:return s.trys.push([1,7,,8]),[4,t.createAnswer()];case 2:n=s.sent(),K.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),s.label=3;case 3:return s.trys.push([3,5,,6]),[4,t.setLocalDescription(n)];case 4:return s.sent(),K.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),r.socket.send({type:Oe.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,browser:le.browser},dst:this.connection.peer}),[3,6];case 5:return i=s.sent(),r.emitError(ye.WebRTC,i),K.default.log("Failed to setLocalDescription, ",i),[3,6];case 6:return[3,8];case 7:return a=s.sent(),r.emitError(ye.WebRTC,a),K.default.log("Failed to create answer, ",a),[3,8];case 8:return[2]}})})},e.prototype.handleSDP=function(t,r){return Un(this,void 0,Promise,function(){var n,i,a,s;return zn(this,function(o){switch(o.label){case 0:r=new RTCSessionDescription(r),n=this.connection.peerConnection,i=this.connection.provider,K.default.log("Setting remote description",r),a=this,o.label=1;case 1:return o.trys.push([1,5,,6]),[4,n.setRemoteDescription(r)];case 2:return o.sent(),K.default.log("Set remoteDescription:".concat(t," for:").concat(this.connection.peer)),t!=="OFFER"?[3,4]:[4,a._makeAnswer()];case 3:o.sent(),o.label=4;case 4:return[3,6];case 5:return s=o.sent(),i.emitError(ye.WebRTC,s),K.default.log("Failed to setRemoteDescription, ",s),[3,6];case 6:return[2]}})})},e.prototype.handleCandidate=function(t){return Un(this,void 0,Promise,function(){var r,n,i,a,s,o;return zn(this,function(c){switch(c.label){case 0:K.default.log("handleCandidate:",t),r=t.candidate,n=t.sdpMLineIndex,i=t.sdpMid,a=this.connection.peerConnection,s=this.connection.provider,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,a.addIceCandidate(new RTCIceCandidate({sdpMid:i,sdpMLineIndex:n,candidate:r}))];case 2:return c.sent(),K.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return o=c.sent(),s.emitError(ye.WebRTC,o),K.default.log("Failed to handleCandidate, ",o),[3,4];case 4:return[2]}})})},e.prototype._addTracksToConnection=function(t,r){if(K.default.log("add tracks from stream ".concat(t.id," to peer connection")),!r.addTrack)return K.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");t.getTracks().forEach(function(n){r.addTrack(n,t)})},e.prototype._addStreamToMediaConnection=function(t,r){K.default.log("add stream ".concat(t.id," to media connection ").concat(r.connectionId)),r.addStream(t)},e}(),Gs={};mt(Gs,"BaseConnection",()=>ju,e=>ju=e);var S0=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),ju=function(e){S0(t,e);function t(r,n,i){var a=e.call(this)||this;return a.peer=r,a.provider=n,a.options=i,a._open=!1,a.metadata=i.metadata,a}return Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),t}(Bn.EventEmitter),B0=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),mi=function(){return mi=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},mi.apply(this,arguments)},A0=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Lu=function(e){B0(t,e);function t(r,n,i){var a=e.call(this,r,n,i)||this;return a._localStream=a.options._stream,a.connectionId=a.options.connectionId||t.ID_PREFIX+le.randomToken(),a._negotiator=new Vs.Negotiator(a),a._localStream&&a._negotiator.startConnection({_stream:a._localStream,originator:!0}),a}return Object.defineProperty(t.prototype,"type",{get:function(){return st.Media},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),t.prototype.addStream=function(r){K.default.log("Receiving stream",r),this._remoteStream=r,e.prototype.emit.call(this,"stream",r)},t.prototype.handleMessage=function(r){var n=r.type,i=r.payload;switch(r.type){case Oe.Answer:this._negotiator.handleSDP(n,i.sdp),this._open=!0;break;case Oe.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:K.default.warn("Unrecognized message type:".concat(n," from peer:").concat(this.peer));break}},t.prototype.answer=function(r,n){var i,a;if(n===void 0&&(n={}),this._localStream){K.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=r,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection(mi(mi({},this.options._payload),{_stream:r}));var s=this.provider._getMessages(this.connectionId);try{for(var o=A0(s),c=o.next();!c.done;c=o.next()){var u=c.value;this.handleMessage(u)}}catch(l){i={error:l}}finally{try{c&&!c.done&&(a=o.return)&&a.call(o)}finally{if(i)throw i.error}}this._open=!0},t.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,e.prototype.emit.call(this,"close"))},t.ID_PREFIX="mc_",t}(Gs.BaseConnection),Ha={};mt(Ha,"DataConnection",()=>Uu,e=>Uu=e);var Df={};mt(Df,"EncodingQueue",()=>Nu,e=>Nu=e);var w0=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Nu=function(e){w0(t,e);function t(){var r=e.call(this)||this;return r.fileReader=new FileReader,r._queue=[],r._processing=!1,r.fileReader.onload=function(n){r._processing=!1,n.target&&r.emit("done",n.target.result),r.doNextTask()},r.fileReader.onerror=function(n){K.default.error("EncodingQueue error:",n),r._processing=!1,r.destroy(),r.emit("error",n)},r}return Object.defineProperty(t.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),t.prototype.enque=function(r){this.queue.push(r),!this.processing&&this.doNextTask()},t.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},t.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},t}(Bn.EventEmitter),_0=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),k0=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Uu=function(e){_0(t,e);function t(r,n,i){var a=e.call(this,r,n,i)||this;return a.stringify=JSON.stringify,a.parse=JSON.parse,a._buffer=[],a._bufferSize=0,a._buffering=!1,a._chunkedData={},a._encodingQueue=new Df.EncodingQueue,a.connectionId=a.options.connectionId||t.ID_PREFIX+le.randomToken(),a.label=a.options.label||a.connectionId,a.serialization=a.options.serialization||bt.Binary,a.reliable=!!a.options.reliable,a._encodingQueue.on("done",function(s){a._bufferedSend(s)}),a._encodingQueue.on("error",function(){K.default.error("DC#".concat(a.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),a.close()}),a._negotiator=new Vs.Negotiator(a),a._negotiator.startConnection(a.options._payload||{originator:!0}),a}return Object.defineProperty(t.prototype,"type",{get:function(){return st.Data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),t.prototype.initialize=function(r){this._dc=r,this._configureDataChannel()},t.prototype._configureDataChannel=function(){var r=this;(!le.supports.binaryBlob||le.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){K.default.log("DC#".concat(r.connectionId," dc connection success")),r._open=!0,r.emit("open")},this.dataChannel.onmessage=function(n){K.default.log("DC#".concat(r.connectionId," dc onmessage:"),n.data),r._handleDataMessage(n)},this.dataChannel.onclose=function(){K.default.log("DC#".concat(r.connectionId," dc closed for:"),r.peer),r.close()}},t.prototype._handleDataMessage=function(r){var n=this,i=r.data,a=i.constructor,s=this.serialization===bt.Binary||this.serialization===bt.BinaryUTF8,o=i;if(s){if(a===Blob){le.blobToArrayBuffer(i,function(u){var l=le.unpack(u);n.emit("data",l)});return}else if(a===ArrayBuffer)o=le.unpack(i);else if(a===String){var c=le.binaryStringToArrayBuffer(i);o=le.unpack(c)}}else this.serialization===bt.JSON&&(o=this.parse(i));if(o.__peerData){this._handleChunk(o);return}e.prototype.emit.call(this,"data",o)},t.prototype._handleChunk=function(r){var n=r.__peerData,i=this._chunkedData[n]||{data:[],count:0,total:r.total};if(i.data[r.n]=r.data,i.count++,this._chunkedData[n]=i,i.total===i.count){delete this._chunkedData[n];var a=new Blob(i.data);this._handleDataMessage({data:a})}},t.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,e.prototype.emit.call(this,"close"))},t.prototype.send=function(r,n){if(!this.open){e.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===bt.JSON)this._bufferedSend(this.stringify(r));else if(this.serialization===bt.Binary||this.serialization===bt.BinaryUTF8){var i=le.pack(r);if(!n&&i.size>le.chunkedMTU){this._sendChunks(i);return}le.supports.binaryBlob?this._bufferedSend(i):this._encodingQueue.enque(i)}else this._bufferedSend(r)},t.prototype._bufferedSend=function(r){(this._buffering||!this._trySend(r))&&(this._buffer.push(r),this._bufferSize=this._buffer.length)},t.prototype._trySend=function(r){var n=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>t.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){n._buffering=!1,n._tryBuffer()},50),!1;try{this.dataChannel.send(r)}catch(i){return K.default.error("DC#:".concat(this.connectionId," Error when sending:"),i),this._buffering=!0,this.close(),!1}return!0},t.prototype._tryBuffer=function(){if(!!this.open&&this._buffer.length!==0){var r=this._buffer[0];this._trySend(r)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},t.prototype._sendChunks=function(r){var n,i,a=le.chunk(r);K.default.log("DC#".concat(this.connectionId," Try to send ").concat(a.length," chunks..."));try{for(var s=k0(a),o=s.next();!o.done;o=s.next()){var c=o.value;this.send(c,!0)}}catch(u){n={error:u}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}},t.prototype.handleMessage=function(r){var n=r.payload;switch(r.type){case Oe.Answer:this._negotiator.handleSDP(r.type,n.sdp);break;case Oe.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:K.default.warn("Unrecognized message type:",r.type,"from peer:",this.peer);break}},t.ID_PREFIX="dc_",t.MAX_BUFFERED_AMOUNT=8388608,t}(Gs.BaseConnection),Cf={};mt(Cf,"API",()=>Wu,e=>Wu=e);var zu=function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function o(l){try{u(n.next(l))}catch(d){s(d)}}function c(l){try{u(n.throw(l))}catch(d){s(d)}}function u(l){l.done?a(l.value):i(l.value).then(o,c)}u((n=n.apply(e,t||[])).next())})},$u=function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=u[0]&2?i.return:u[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,u[1])).done)return a;switch(i=0,a&&(u=[u[0]&2,a.value]),u[0]){case 0:case 1:a=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!a||u[1]>a[0]&&u[1]<a[3])){r.label=u[1];break}if(u[0]===6&&r.label<a[1]){r.label=a[1],a=u;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(u);break}a[2]&&r.ops.pop(),r.trys.pop();continue}u=t.call(e,r)}catch(l){u=[6,l],i=0}finally{n=a=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},Wu=function(){function e(t){this._options=t}return e.prototype._buildRequest=function(t){var r=this._options.secure?"https":"http",n=this._options,i=n.host,a=n.port,s=n.path,o=n.key,c=new URL("".concat(r,"://").concat(i,":").concat(a).concat(s).concat(o,"/").concat(t));return c.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),c.searchParams.set("version",Ws.version),fetch(c.href,{referrerPolicy:this._options.referrerPolicy})},e.prototype.retrieveId=function(){return zu(this,void 0,Promise,function(){var t,r,n;return $u(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(t=i.sent(),t.status!==200)throw new Error("Error. Status:".concat(t.status));return[2,t.text()];case 2:throw r=i.sent(),K.default.error("Error retrieving ID",r),n="",this._options.path==="/"&&this._options.host!==le.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n);case 3:return[2]}})})},e.prototype.listAllPeers=function(){return zu(this,void 0,Promise,function(){var t,r,n;return $u(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(t=i.sent(),t.status!==200)throw t.status===401?(r="",this._options.host===le.CLOUD_HOST?r="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":r="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+r)):new Error("Error. Status:".concat(t.status));return[2,t.json()];case 2:throw n=i.sent(),K.default.error("Error retrieving list peers",n),new Error("Could not get list peers from the server."+n);case 3:return[2]}})})},e}(),T0=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),en=function(){return en=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},en.apply(this,arguments)},$r=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},F0=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,a=[],s;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(o){s={error:o}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return a},Ka=function(e){T0(t,e);function t(r,n){var i=e.call(this)||this;i._id=null,i._lastServerId=null,i._destroyed=!1,i._disconnected=!1,i._open=!1,i._connections=new Map,i._lostMessages=new Map;var a;return r&&r.constructor==Object?n=r:r&&(a=r.toString()),n=en({debug:0,host:le.CLOUD_HOST,port:le.CLOUD_PORT,path:"/",key:t.DEFAULT_KEY,token:le.randomToken(),config:le.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},n),i._options=n,i._options.host==="/"&&(i._options.host=window.location.hostname),i._options.path&&(i._options.path[0]!=="/"&&(i._options.path="/"+i._options.path),i._options.path[i._options.path.length-1]!=="/"&&(i._options.path+="/")),i._options.secure===void 0&&i._options.host!==le.CLOUD_HOST?i._options.secure=le.isSecure():i._options.host==le.CLOUD_HOST&&(i._options.secure=!0),i._options.logFunction&&K.default.setLogFunction(i._options.logFunction),K.default.logLevel=i._options.debug||0,i._api=new Cf.API(n),i._socket=i._createServerConnection(),!le.supports.audioVideo&&!le.supports.data?(i._delayedAbort(ye.BrowserIncompatible,"The current browser does not support WebRTC"),i):!!a&&!le.validateId(a)?(i._delayedAbort(ye.InvalidID,'ID "'.concat(a,'" is invalid')),i):(a?i._initialize(a):i._api.retrieveId().then(function(s){return i._initialize(s)}).catch(function(s){return i._abort(ye.ServerError,s)}),i)}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connections",{get:function(){var r,n,i=Object.create(null);try{for(var a=$r(this._connections),s=a.next();!s.done;s=a.next()){var o=F0(s.value,2),c=o[0],u=o[1];i[c]=u}}catch(l){r={error:l}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),t.prototype._createServerConnection=function(){var r=this,n=new mf.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return n.on(St.Message,function(i){r._handleMessage(i)}),n.on(St.Error,function(i){r._abort(ye.SocketError,i)}),n.on(St.Disconnected,function(){r.disconnected||(r.emitError(ye.Network,"Lost connection to server."),r.disconnect())}),n.on(St.Close,function(){r.disconnected||r._abort(ye.SocketClosed,"Underlying socket is already closed.")}),n},t.prototype._initialize=function(r){this._id=r,this.socket.start(r,this._options.token)},t.prototype._handleMessage=function(r){var n,i,a=r.type,s=r.payload,o=r.src;switch(a){case Oe.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Oe.Error:this._abort(ye.ServerError,s.msg);break;case Oe.IdTaken:this._abort(ye.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case Oe.InvalidKey:this._abort(ye.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case Oe.Leave:K.default.log("Received leave message from ".concat(o)),this._cleanupPeer(o),this._connections.delete(o);break;case Oe.Expire:this.emitError(ye.PeerUnavailable,"Could not connect to peer ".concat(o));break;case Oe.Offer:var v=s.connectionId,m=this.getConnection(o,v);if(m&&(m.close(),K.default.warn("Offer received for existing Connection ID:".concat(v))),s.type===st.Media){var c=new qa.MediaConnection(o,this,{connectionId:v,_payload:s,metadata:s.metadata});m=c,this._addConnection(o,m),this.emit("call",c)}else if(s.type===st.Data){var u=new Ha.DataConnection(o,this,{connectionId:v,_payload:s,metadata:s.metadata,label:s.label,serialization:s.serialization,reliable:s.reliable});m=u,this._addConnection(o,m),this.emit("connection",u)}else{K.default.warn("Received malformed connection type:".concat(s.type));return}var l=this._getMessages(v);try{for(var d=$r(l),h=d.next();!h.done;h=d.next()){var f=h.value;m.handleMessage(f)}}catch(E){n={error:E}}finally{try{h&&!h.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}break;default:if(!s){K.default.warn("You received a malformed message from ".concat(o," of type ").concat(a));return}var v=s.connectionId,m=this.getConnection(o,v);m&&m.peerConnection?m.handleMessage(r):v?this._storeMessage(v,r):K.default.warn("You received an unrecognized message:",r);break}},t.prototype._storeMessage=function(r,n){this._lostMessages.has(r)||this._lostMessages.set(r,[]),this._lostMessages.get(r).push(n)},t.prototype._getMessages=function(r){var n=this._lostMessages.get(r);return n?(this._lostMessages.delete(r),n):[]},t.prototype.connect=function(r,n){if(n===void 0&&(n={}),this.disconnected){K.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(ye.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var i=new Ha.DataConnection(r,this,n);return this._addConnection(r,i),i},t.prototype.call=function(r,n,i){if(i===void 0&&(i={}),this.disconnected){K.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(ye.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){K.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var a=new qa.MediaConnection(r,this,en(en({},i),{_stream:n}));return this._addConnection(r,a),a},t.prototype._addConnection=function(r,n){K.default.log("add connection ".concat(n.type,":").concat(n.connectionId," to peerId:").concat(r)),this._connections.has(r)||this._connections.set(r,[]),this._connections.get(r).push(n)},t.prototype._removeConnection=function(r){var n=this._connections.get(r.peer);if(n){var i=n.indexOf(r);i!==-1&&n.splice(i,1)}this._lostMessages.delete(r.connectionId)},t.prototype.getConnection=function(r,n){var i,a,s=this._connections.get(r);if(!s)return null;try{for(var o=$r(s),c=o.next();!c.done;c=o.next()){var u=c.value;if(u.connectionId===n)return u}}catch(l){i={error:l}}finally{try{c&&!c.done&&(a=o.return)&&a.call(o)}finally{if(i)throw i.error}}return null},t.prototype._delayedAbort=function(r,n){var i=this;setTimeout(function(){i._abort(r,n)},0)},t.prototype._abort=function(r,n){K.default.error("Aborting!"),this.emitError(r,n),this._lastServerId?this.disconnect():this.destroy()},t.prototype.emitError=function(r,n){K.default.error("Error:",n);var i;typeof n=="string"?i=new Error(n):i=n,i.type=r,this.emit("error",i)},t.prototype.destroy=function(){this.destroyed||(K.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},t.prototype._cleanup=function(){var r,n;try{for(var i=$r(this._connections.keys()),a=i.next();!a.done;a=i.next()){var s=a.value;this._cleanupPeer(s),this._connections.delete(s)}}catch(o){r={error:o}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}this.socket.removeAllListeners()},t.prototype._cleanupPeer=function(r){var n,i,a=this._connections.get(r);if(!!a)try{for(var s=$r(a),o=s.next();!o.done;o=s.next()){var c=o.value;c.close()}}catch(u){n={error:u}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}},t.prototype.disconnect=function(){if(!this.disconnected){var r=this.id;K.default.log("Disconnect peer with ID:".concat(r)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=r,this._id=null,this.emit("disconnected",r)}},t.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)K.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)K.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},t.prototype.listAllPeers=function(r){var n=this;r===void 0&&(r=function(i){}),this._api.listAllPeers().then(function(i){return r(i)}).catch(function(i){return n._abort(ye.ServerError,i)})},t.DEFAULT_KEY="peerjs",t}(Bn.EventEmitter);vf.Peer;const Vu=1,O0=1e3,x0=6;function P0(){const e=Xa().replaceAll("-","").slice(0,x0),t=`${e}`,r=new Ka(t);let n=[],i;const a=[];r.on("connection",o=>{a.push(o),o.on("data",c=>{for(const u of n)u(c)}),o.on("open",()=>{i&&i(o,"open")}),o.on("close",()=>{a.splice(a.indexOf(o),Vu),i&&i(o,"close")}),o.on("error",c=>{i&&i(o,"error",c)})});let s="";return{startHost(){return e},startClient(o){return s===o||(s=o,setTimeout(()=>{const c=r.connect(`${o}`);a.push(c),c.on("data",u=>{for(const l of n)l(u)}),c.on("open",()=>{i&&i(c,"open")}),c.on("close",()=>{a.splice(a.indexOf(c),Vu),i&&i(c,"close")}),c.on("error",u=>{i&&i(c,"error",u)})},O0)),e},sendMessage(o){for(const c of a)c.open&&c.send(o)},connectionEventListener(o){i=o},setListener(o){n.push(o)},removeListener(o){const c=[];for(const u of n)o!==u&&c.push(u);n=c},close(){r.disconnect();for(const o of a)o.close();a.splice(0,a.length)}}}function R0(e,t){return e.setListener(r=>{switch(r.type){case"CreateFile":t.createFile(r.name,r.fileType,r.key);break;case"GetCurrentList":e.sendMessage({type:"CurrentListResult",listings:t.getCurrentList()});break;case"RenameFile":t.renameFile(r.key,r.name);break;case"DeleteFile":t.deleteFile(r.key);break}}),{setCallback(r){t.setCallback(n=>{r(n),e.sendMessage({type:"CurrentListResult",listings:n})})},async createFile(r,n){return t.createFile(r,n)},getCurrentList(){return t.getCurrentList()},async deleteFile(r){t.deleteFile(r)},async renameFile(r,n){t.renameFile(r,n)}}}function I0(e){let t=[],r;return e.setListener(n=>{n.type==="CurrentListResult"&&(t=n.listings,r&&r(t))}),e.sendMessage({type:"GetCurrentList"}),{setCallback(n){r=n},async createFile(n,i){const a=Xa(),s={name:n,key:a,type:i};return t=[...t,s],e.sendMessage({type:"CreateFile",name:n,fileType:i,key:a}),r&&r(t),a},getCurrentList(){return t},async deleteFile(n){e.sendMessage({type:"DeleteFile",key:n}),t=t.filter(i=>i.key!==n),r&&r(t)},async renameFile(n,i){let a=!1;t=t.map(s=>s.key===n?(a={...s,name:i},a):s),e.sendMessage({type:"RenameFile",name:i,key:n}),a&&r&&r(t)}}}var M0=typeof atob=="function",j0=typeof btoa=="function",Li=typeof Buffer=="function";typeof TextDecoder=="function"&&new TextDecoder;typeof TextEncoder=="function"&&new TextEncoder;var L0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Yr=Array.prototype.slice.call(L0),$n=(e=>{let t={};return e.forEach((r,n)=>t[r]=n),t})(Yr),N0=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,ei=String.fromCharCode.bind(String),Gu=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):(e,t=r=>r)=>new Uint8Array(Array.prototype.slice.call(e,0).map(t)),U0=e=>e.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_"),yf=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),z0=e=>{let t,r,n,i,a="";const s=e.length%3;for(let o=0;o<e.length;){if((r=e.charCodeAt(o++))>255||(n=e.charCodeAt(o++))>255||(i=e.charCodeAt(o++))>255)throw new TypeError("invalid character found");t=r<<16|n<<8|i,a+=Yr[t>>18&63]+Yr[t>>12&63]+Yr[t>>6&63]+Yr[t&63]}return s?a.slice(0,s-3)+"===".substring(s):a},$0=j0?e=>btoa(e):Li?e=>Buffer.from(e,"binary").toString("base64"):z0,qu=Li?e=>Buffer.from(e).toString("base64"):e=>{let r=[];for(let n=0,i=e.length;n<i;n+=4096)r.push(ei.apply(null,e.subarray(n,n+4096)));return $0(r.join(""))},Di=(e,t=!1)=>t?U0(qu(e)):qu(e),W0=e=>{if(e=e.replace(/\s+/g,""),!N0.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let t,r="",n,i;for(let a=0;a<e.length;)t=$n[e.charAt(a++)]<<18|$n[e.charAt(a++)]<<12|(n=$n[e.charAt(a++)])<<6|(i=$n[e.charAt(a++)]),r+=n===64?ei(t>>16&255):i===64?ei(t>>16&255,t>>8&255):ei(t>>16&255,t>>8&255,t&255);return r},V0=M0?e=>atob(yf(e)):Li?e=>Buffer.from(e,"base64").toString("binary"):W0,G0=Li?e=>Gu(Buffer.from(e,"base64")):e=>Gu(V0(e),t=>t.charCodeAt(0)),Ya=e=>G0(q0(e)),q0=e=>yf(e.replace(/[-_]/g,t=>t=="-"?"+":"/"));let ti;const H0=200,Jr={},bf={};let Ef="",tn;function K0(e,t){const r=t.doc();bf[e]=r;let n=!1;return r.on("update",()=>{n&&clearTimeout(n),n=setTimeout(()=>{const i=Di(Nt(r));ti?.sendMessage({type:"FileContentUpdated",key:e,update:i})},H0)}),t}async function Ja(e){if(e in Jr)return Jr[e];if(!tn)throw new Error("No getter set");return Jr[e]=tn(e,Ef).then(t=>K0(e,t)),Jr[e]}function Y0(e,t,r){ti=e,Ef=t,tn=r,ti.setListener(n=>{switch(n.type){case"FileContentUpdated":tn!==void 0&&Ja(n.key).then(()=>{Jr[n.key].then(a=>a.updateAll(Ya(n.update)))});break;case"RequestFileState":tn!==void 0&&Ja(n.key).then(()=>{const i=bf[n.key];ti?.sendMessage({type:"FullFileState",key:n.key,update:Di(Nt(i))})});break}})}const br={},Hu=200;let rn;function J0(e){rn=e,rn.setListener(t=>{switch(t.type){case"FullFileState":{const r=br[t.key];r!==void 0&&r.then(n=>n.updateAll(Ya(t.update)))}break;case"FileContentUpdated":{const r=br[t.key];r!==void 0&&r.then(n=>n.updateAll(Ya(t.update)))}break}})}async function X0(e){rn?.sendMessage({type:"RequestFileState",key:e});const t=new $t;let r={},n=!1;return{doc(){return t},connect(){const i=new $t,a=Nt(t);return it(i,a),i.on("update",s=>{n&&clearTimeout(n),n=setTimeout(()=>{const o=Di(Nt(t));rn?.sendMessage({type:"FileContentUpdated",key:e,update:o})},Hu),it(t,s);for(const o of Object.keys(r)){const c=r[o];it(c,s)}}),r[i.clientID]=i,{id:i.clientID,content:i.get("content",Fe)}},updateAll(i){n&&clearTimeout(n),n=setTimeout(()=>{const a=Di(Nt(t));rn?.sendMessage({type:"FileContentUpdated",key:e,update:a})},Hu),it(t,i);for(const a of Object.keys(r)){const s=r[a];it(s,i)}},disconnect(i){const a=i.toString();if(a in r){const s=r[i],o=r;r={};for(const c of Object.keys(o))c!==a&&(r[c]=o[c]);s.destroy()}}}}async function Z0(e){return e in br||(br[e]=X0(e)),br[e]}const Ku=Fr.useMemo,ca=Fr.useState,Xt=P0();function rD({isHost:e}){const[t,r]=ca(),{name:n,project:i,code:a}=xf(),[s,o]=ca({}),[c,u]=ca(!1),l=Ku(()=>e?(u(!0),Y0(Xt,i??"",r0),Xt.startHost()):a?(Xt.connectionEventListener((h,f,v)=>{u(f==="error"?v??new Error("Unknown Error"):f==="open")}),J0(Xt),Xt.startClient(a)):"",[e,a,i]);if(Ku(async()=>{if(!!c)if(i){const h=await e0(i),f=R0(Xt,h);r(f)}else{const h=I0(Xt);r(h)}},[i,c]),c!==!0)return Se(Js,{error:c instanceof Error?c:void 0});if(!t)return Se(Js,{});const d=Object.keys(s).map(h=>s[h]).filter(h=>h!==!1);return It("div",{className:"flex h-screen flex-col items-stretch justify-start",children:[It("div",{className:"flex flex-row justify-between bg-slate-900 p-2",children:[Se("span",{children:e?"Hosting":"Joining"})," ",Se("span",{className:"flex-grow text-center",children:n}),"\xA0",e?It("span",{children:["Share Link:\xA0",Se("a",{className:"text-blue-200",target:"_blank",href:`${window.location.toString().split("/host")[0]}/join/${l}`,rel:"noreferrer",children:l})]}):""]}),It("div",{className:"flex flex-grow flex-row",children:[Se("div",{className:"flex w-56 flex-col justify-start border-r-2 border-r-slate-900 bg-slate-800 p-2",children:Se(Gf,{list:t,selectFile:h=>{if(!(h.key in s)){{const f={...s,[h.key]:!1};o(f)}i?Ja(h.key).then(f=>{const v={...s,[h.key]:{listing:h,file:f}};o(v)}):Z0(h.key).then(f=>{const v={...s,[h.key]:{listing:h,file:f}};o(v)})}}})}),Se(Wf,{className:"split flex flex-grow flex-row",children:d.length>0?d.map(({listing:h,file:f})=>Se(zm,{listing:h,file:f,renameFile:v=>{const m={...s,[h.key]:{file:f,listing:{...h,name:v}}};o(m),t.renameFile(h.key,v)},closeFile:()=>{const v={};for(const m of Object.keys(s))m!==h.key&&(v[m]=s[m]);o(v)}},h.key)):Se("div",{children:"No Open Files"})},d.map(h=>h.listing.key).join(":"))]})]})}export{rD as default};
